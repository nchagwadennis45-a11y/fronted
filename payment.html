<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>ConnectPay - kynecta</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    
    <style>
        /* All existing CSS styles remain */
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .primary-gradient {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }
        .security-gradient {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        .rewards-gradient {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        .crypto-gradient {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }
        
        .card-glow {
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.4);
        }
        .pulse-effect {
            animation: pulseEffect 2s infinite;
        }
        @keyframes pulseEffect {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* Payment-specific styles */
        .payment-method {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .payment-method:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        .payment-method.selected {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }
        
        /* Security badges */
        .security-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.5);
        }
        
        /* Progress indicators */
        .progress-step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        .progress-step.active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-color: #3b82f6;
            color: white;
        }
        .progress-step.completed {
            background: linear-gradient(135deg, #10b981, #059669);
            border-color: #10b981;
            color: white;
        }
        
        /* Transaction history */
        .transaction-item {
            transition: all 0.3s ease;
        }
        .transaction-item:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(5px);
        }
        
        /* Fraud detection alerts */
        .fraud-alert {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(220, 38, 38, 0.2));
            border: 1px solid rgba(239, 68, 68, 0.5);
            animation: pulseEffect 1.5s infinite;
        }
        
        /* Gamification elements */
        .reward-spin {
            animation: spin 3s ease-in-out;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .cashback-badge {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        /* Form styles */
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #cbd5e1;
        }
        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #475569;
            border-radius: 0.75rem;
            color: white;
            font-size: 1rem;
        }
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }
        
        /* Loading states */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        /* Toast notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            z-index: 10000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        .toast.show {
            transform: translateX(0);
        }
        .toast.success {
            background: #10b981;
        }
        .toast.error {
            background: #ef4444;
        }
        .toast.info {
            background: #3b82f6;
        }
        
        /* M-Pesa specific styles */
        .mpesa-green {
            background: linear-gradient(135deg, #00B300 0%, #006400 100%);
        }
        .mpesa-card {
            border: 1px solid rgba(0, 179, 0, 0.5);
            background: rgba(0, 179, 0, 0.1);
        }
        
        /* Connection status */
        .connection-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .connection-status.connected {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.5);
        }
        .connection-status.connecting {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.5);
        }
        .connection-status.error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.5);
        }
        
        /* Modal animations */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        /* Reward wheel animation */
        .spin-wheel {
            animation: spinWheel 3s cubic-bezier(0.2, 0.8, 0.3, 1);
        }
        @keyframes spinWheel {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(1080deg); }
        }
        
        /* New styles for enhanced features */
        .payment-option.selected {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.2);
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .category-tag {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        
        .emergency-tag {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.5);
        }
        
        .charity-tag {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.5);
        }
        
        .celebration-tag {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.5);
        }
        
        .scrollable-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .scrollable-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .scrollable-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        .scrollable-list::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
            border-radius: 10px;
        }
        
        /* Responsive improvements */
        .responsive-text {
            font-size: clamp(1rem, 4vw, 1.5rem);
        }
        
        .responsive-heading {
            font-size: clamp(1.5rem, 6vw, 2.5rem);
        }
        
        .responsive-subheading {
            font-size: clamp(1rem, 3vw, 1.25rem);
        }

        /* Better mobile layout */
        @media (max-width: 767px) {
            .mobile-padding {
                padding: 1rem;
            }
            
            .mobile-margin {
                margin-bottom: 1.5rem;
            }
            
            .mobile-text-center {
                text-align: center;
            }
            
            .mobile-stack {
                flex-direction: column;
            }
            
            .mobile-space-y > * + * {
                margin-top: 1rem;
            }
            
            .modal-content {
                padding: 1rem;
            }
        }
        
        @media (min-width: 768px) {
            .modal-content {
                padding: 2rem;
            }
        }
        
        /* Dashboard background */
        .dashboard-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
            transition: all 0.5s ease-in-out;
        }
        
        .bg-grid-pattern {
            background-image: 
                linear-gradient(rgba(99, 102, 241, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(99, 102, 241, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
        }
        
        /* Mood Theme Colors */
        .theme-calm {
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #0f172a 100%) !important;
        }
        
        .theme-energetic {
            background: linear-gradient(135deg, #431407 0%, #9a3412 50%, #431407 100%) !important;
        }
        
        .theme-creative {
            background: linear-gradient(135deg, #1e1b4b 0%, #7e22ce 50%, #1e1b4b 100%) !important;
        }
        
        .theme-chill {
            background: linear-gradient(135deg, #064e3b 0%, #059669 50%, #064e3b 100%) !important;
        }
        
        .theme-romantic {
            background: linear-gradient(135deg, #831843 0%, #db2777 50%, #831843 100%) !important;
        }
        
        /* Mood Selector */
        .mood-selector {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 1000;
        }
        
        .mood-btn {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .mood-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }
        
        .mood-options {
            position: absolute;
            top: 100%;
            left: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 10px;
            display: none;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            min-width: 150px;
        }
        
        .mood-options.show {
            display: grid;
        }
        
        .mood-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .mood-option:hover {
            transform: scale(1.1);
            border-color: white;
        }
        
        .mood-calm { background: linear-gradient(135deg, #3B82F6, #8B5CF6); }
        .mood-energetic { background: linear-gradient(135deg, #DC2626, #EA580C); }
        .mood-creative { background: linear-gradient(135deg, #7C3AED, #DB2777); }
        .mood-chill { background: linear-gradient(135deg, #059669, #10B981); }
        .mood-romantic { background: linear-gradient(135deg, #DB2777, #BE185D); }
        .mood-default { background: linear-gradient(135deg, #6B7280, #4B5563); }
    </style>
</head>
<body class="h-full dashboard-container bg-grid-pattern theme-calm overflow-x-hidden">
    <!-- Mood Theme Selector -->
    <div class="mood-selector">
        <button class="mood-btn flex items-center space-x-2">
            <i class="fas fa-palette"></i>
            <span class="hidden sm:inline">Mood</span>
        </button>
        <div class="mood-options">
            <div class="mood-option mood-calm" data-theme="calm" title="Calm"></div>
            <div class="mood-option mood-energetic" data-theme="energetic" title="Energetic"></div>
            <div class="mood-option mood-creative" data-theme="creative" title="Creative"></div>
            <div class="mood-option mood-chill" data-theme="chill" title="Chill"></div>
            <div class="mood-option mood-romantic" data-theme="romantic" title="Romantic"></div>
            <div class="mood-option mood-default" data-theme="default" title="Default"></div>
        </div>
    </div>

    <!-- Connection Status Indicator -->
    <div id="connectionStatus" class="connection-status connecting">
        <i class="fas fa-sync fa-spin"></i>
        <span>Connecting to Firebase...</span>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer"></div>

    <div class="min-h-screen container mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="glass-card border-b border-slate-700">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 primary-gradient rounded-2xl flex items-center justify-center">
                        <i class="fas fa-wallet text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-400">
                            ConnectPay
                        </h1>
                        <p class="text-slate-400 text-sm">Secure, fast, and social payments</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right hidden sm:block">
                        <div class="font-semibold text-white" id="userBalance">Loading...</div>
                        <div class="text-slate-400 text-sm">Available Balance</div>
                    </div>
                    <div class="w-10 h-10 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center">
                        <i class="fas fa-shield-alt text-white"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="py-8">
            <!-- Quick Actions -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                <button class="glass-card rounded-2xl border border-slate-700 p-4 text-center hover:border-blue-400 transition" onclick="openSendMoneyModal()">
                    <div class="w-12 h-12 primary-gradient rounded-full flex items-center justify-center mx-auto mb-2">
                        <i class="fas fa-paper-plane text-white"></i>
                    </div>
                    <span class="font-semibold text-white text-sm md:text-base">Send Money</span>
                </button>
                
                <button class="glass-card rounded-2xl border border-slate-700 p-4 text-center hover:border-green-400 transition" onclick="openRequestMoneyModal()">
                    <div class="w-12 h-12 security-gradient rounded-full flex items-center justify-center mx-auto mb-2">
                        <i class="fas fa-hand-holding-usd text-white"></i>
                    </div>
                    <span class="font-semibold text-white text-sm md:text-base">Request Money</span>
                </button>
                
                <button class="glass-card rounded-2xl border border-slate-700 p-4 text-center hover:border-yellow-400 transition" onclick="openMarketplaceModal()">
                    <div class="w-12 h-12 rewards-gradient rounded-full flex items-center justify-center mx-auto mb-2">
                        <i class="fas fa-shopping-cart text-white"></i>
                    </div>
                    <span class="font-semibold text-white text-sm md:text-base">Marketplace</span>
                </button>
                
                <button class="glass-card rounded-2xl border border-slate-700 p-4 text-center hover:border-purple-400 transition" onclick="openCryptoModal()">
                    <div class="w-12 h-12 crypto-gradient rounded-full flex items-center justify-center mx-auto mb-2">
                        <i class="fas fa-coins text-white"></i>
                    </div>
                    <span class="font-semibold text-white text-sm md:text-base">Crypto</span>
                </button>
            </div>

            <!-- Payment Overview -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <!-- Balance Card -->
                <div class="glass-card rounded-2xl border border-slate-700 p-6">
                    <h3 class="text-xl font-black text-white mb-4">Account Balance</h3>
                    <div class="text-3xl font-black text-green-400 mb-2" id="balanceAmount">Loading...</div>
                    <p class="text-slate-400 text-sm mb-4">Available for transactions</p>
                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3">
                        <button class="flex-1 px-4 py-2 primary-gradient text-white rounded-xl font-semibold hover:scale-105 transition text-sm md:text-base" onclick="openAddMoneyModal()">
                            Add Money
                        </button>
                        <button class="flex-1 px-4 py-2 glass-card border border-slate-700 rounded-xl text-slate-400 hover:text-white transition text-sm md:text-base" onclick="openWithdrawModal()">
                            Withdraw
                        </button>
                    </div>
                </div>

                <!-- Security Status -->
                <div class="glass-card rounded-2xl border border-slate-700 p-6">
                    <h3 class="text-xl font-black text-white mb-4">Security Status</h3>
                    <div class="space-y-3 mb-4">
                        <div class="flex justify-between items-center">
                            <span class="text-slate-400 text-sm md:text-base">AI Fraud Detection</span>
                            <span class="security-badge text-xs" id="fraudDetectionStatus">
                                <i class="fas fa-shield-alt mr-1"></i> Loading...
                            </span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-slate-400 text-sm md:text-base">Biometric Auth</span>
                            <span class="security-badge text-xs" id="biometricStatus">
                                <i class="fas fa-fingerprint mr-1"></i> Loading...
                            </span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-slate-400 text-sm md:text-base">2FA</span>
                            <span class="security-badge text-xs" id="twoFAStatus">
                                <i class="fas fa-mobile-alt mr-1"></i> Loading...
                            </span>
                        </div>
                    </div>
                    <button class="w-full px-4 py-2 security-gradient text-white rounded-xl font-semibold hover:scale-105 transition text-sm md:text-base" onclick="openSecuritySettings()">
                        <i class="fas fa-cog mr-2"></i> Security Settings
                    </button>
                </div>

                <!-- Rewards & Cashback -->
                <div class="glass-card rounded-2xl border border-slate-700 p-6">
                    <h3 class="text-xl font-black text-white mb-4">Rewards</h3>
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-2xl font-black text-yellow-400" id="cashbackAmount">Loading...</div>
                            <div class="text-slate-400 text-sm">Cashback Earned</div>
                        </div>
                        <div class="cashback-badge w-12 h-12 rounded-full flex items-center justify-center">
                            <i class="fas fa-gift text-white"></i>
                        </div>
                    </div>
                    <div class="space-y-2 mb-4">
                        <div class="flex justify-between text-sm">
                            <span class="text-slate-400">Daily Spin Available</span>
                            <span class="text-green-400 font-semibold cursor-pointer" onclick="openRewardsSpinModal()">Spin Now</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-slate-400">Streak Bonus</span>
                            <span class="text-yellow-400 font-semibold" id="streakCount">Loading...</span>
                        </div>
                    </div>
                    <button class="w-full px-4 py-2 rewards-gradient text-white rounded-xl font-semibold hover:scale-105 transition text-sm md:text-base" onclick="claimRewards()">
                        <i class="fas fa-trophy mr-2"></i> Claim Rewards
                    </button>
                </div>
            </div>

            <!-- Payment Methods -->
            <div class="mb-8">
                <h2 class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-400 mb-6 responsive-heading">
                    Payment Methods
                </h2>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6" id="paymentMethods">
                    <div class="payment-method glass-card rounded-2xl border border-slate-700 p-4 text-center" data-method="mpesa">
                        <div class="w-16 h-16 mpesa-green rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fas fa-mobile-alt text-white text-2xl"></i>
                        </div>
                        <h3 class="font-semibold text-white text-base md:text-lg">M-Pesa</h3>
                        <p class="text-slate-400 text-sm">Mobile Money</p>
                    </div>

                    <div class="payment-method glass-card rounded-2xl border border-slate-700 p-4 text-center" data-method="card">
                        <div class="w-16 h-16 primary-gradient rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fas fa-credit-card text-white text-2xl"></i>
                        </div>
                        <h3 class="font-semibold text-white text-base md:text-lg">Card</h3>
                        <p class="text-slate-400 text-sm">Visa • MasterCard</p>
                    </div>

                    <div class="payment-method glass-card rounded-2xl border border-slate-700 p-4 text-center" data-method="bank">
                        <div class="w-16 h-16 security-gradient rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fas fa-university text-white text-2xl"></i>
                        </div>
                        <h3 class="font-semibold text-white text-base md:text-lg">Bank Transfer</h3>
                        <p class="text-slate-400 text-sm">Direct Transfer</p>
                    </div>

                    <div class="payment-method glass-card rounded-2xl border border-slate-700 p-4 text-center" data-method="crypto">
                        <div class="w-16 h-16 crypto-gradient rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="fas fa-coins text-white text-2xl"></i>
                        </div>
                        <h3 class="font-semibold text-white text-base md:text-lg">Crypto</h3>
                        <p class="text-slate-400 text-sm">Bitcoin • Ethereum</p>
                    </div>
                </div>
            </div>

            <!-- Recent Transactions -->
            <div class="mb-8">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400 responsive-heading">
                        Recent Transactions
                    </h2>
                    <button class="text-purple-400 hover:text-pink-300 font-semibold transition text-sm md:text-base" onclick="viewAllTransactions()">
                        View All
                    </button>
                </div>

                <div class="glass-card rounded-2xl border border-slate-700 p-6">
                    <div class="space-y-4" id="transactionsList">
                        <div class="text-center py-8 text-slate-400">
                            <i class="fas fa-sync fa-spin text-2xl mb-2"></i>
                            <p>Loading transactions...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Fraud Detection -->
            <div class="glass-card rounded-2xl border border-slate-700 p-6 mb-8">
                <div class="flex flex-col md:flex-row md:items-center justify-between mb-4">
                    <h3 class="text-2xl font-black text-white mb-2 md:mb-0">AI Fraud Detection</h3>
                    <span class="security-badge pulse-effect text-xs md:text-sm">
                        <i class="fas fa-shield-alt mr-1"></i> Real-time Protection
                    </span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="text-center">
                        <div class="text-3xl font-black text-green-400">99.7%</div>
                        <div class="text-slate-400 text-sm md:text-base">Detection Accuracy</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-black text-blue-400">0.2s</div>
                        <div class="text-slate-400 text-sm md:text-base">Response Time</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-black text-purple-400">24/7</div>
                        <div class="text-slate-400 text-sm md:text-base">Active Monitoring</div>
                    </div>
                </div>
            </div>

            <!-- Social Payment Features -->
            <div class="mb-8">
                <h2 class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-cyan-400 mb-6 responsive-heading">
                    Social Payments
                </h2>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="glass-card rounded-2xl border border-slate-700 p-6 text-center">
                        <div class="w-16 h-16 primary-gradient rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-users text-white text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-white mb-2">Group Payments</h3>
                        <p class="text-slate-400 text-sm mb-4">Split bills and collect money from groups</p>
                        <button class="w-full px-4 py-2 primary-gradient text-white rounded-xl font-semibold hover:scale-105 transition text-sm md:text-base" onclick="openGroupPaymentModal()">
                            Create Group
                        </button>
                    </div>

                    <div class="glass-card rounded-2xl border border-slate-700 p-6 text-center">
                        <div class="w-16 h-16 rewards-gradient rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-gift text-white text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-white mb-2">Social Gifting</h3>
                        <p class="text-slate-400 text-sm mb-4">Send gifts with personalized messages</p>
                        <button class="w-full px-4 py-2 rewards-gradient text-white rounded-xl font-semibold hover:scale-105 transition text-sm md:text-base" onclick="openSocialGiftingModal()">
                            Send Gift
                        </button>
                    </div>

                    <div class="glass-card rounded-2xl border border-slate-700 p-6 text-center">
                        <div class="w-16 h-16 security-gradient rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-bullseye text-white text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-white mb-2">Shared Goals</h3>
                        <p class="text-slate-400 text-sm mb-4">Save together for common objectives</p>
                        <button class="w-full px-4 py-2 security-gradient text-white rounded-xl font-semibold hover:scale-105 transition text-sm md:text-base" onclick="openSharedGoalsModal()">
                            Start Goal
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Modals -->
    
    <!-- Send Money Modal -->
    <div id="sendMoneyModal" class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 hidden">
        <div class="glass-card rounded-2xl modal-content max-w-md w-full fade-in">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-black text-white">Send Money</h3>
                <button class="text-slate-400 hover:text-white" onclick="closeModal('sendMoneyModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-6">
                <div class="flex justify-between mb-4">
                    <div class="progress-step completed">1</div>
                    <div class="flex-1 h-1 bg-slate-700 mx-2 mt-4"></div>
                    <div class="progress-step active">2</div>
                    <div class="flex-1 h-1 bg-slate-700 mx-2 mt-4"></div>
                    <div class="progress-step">3</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Recipient</label>
                    <input type="text" class="form-input" id="recipientInput" placeholder="Search friends or enter phone number">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Amount</label>
                    <input type="number" class="form-input" id="sendAmountInput" placeholder="KSh 0.00">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Message (Optional)</label>
                    <input type="text" class="form-input" id="sendMessageInput" placeholder="Add a note">
                </div>
                
                <div class="fraud-alert rounded-xl p-4 mb-4 hidden" id="fraudAlert">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle text-red-400 mr-2"></i>
                        <span class="text-red-400 font-semibold">Suspicious Activity Detected</span>
                    </div>
                    <p class="text-slate-400 text-sm mt-1">This transaction matches known fraud patterns</p>
                </div>
            </div>
            
            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3">
                <button class="flex-1 px-4 py-2 glass-card border border-slate-700 rounded-xl text-slate-400 hover:border-blue-400 hover:text-blue-400 transition text-sm md:text-base" onclick="closeModal('sendMoneyModal')">
                    Cancel
                </button>
                <button class="flex-1 px-4 py-2 primary-gradient text-white rounded-xl font-semibold hover:scale-105 transition text-sm md:text-base" onclick="processPayment()">
                    Send Money
                </button>
            </div>
        </div>
    </div>

    <!-- Request Money Modal -->
    <div id="requestMoneyModal" class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 hidden">
        <div class="glass-card rounded-2xl modal-content max-w-md w-full fade-in">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-black text-white">Request Money</h3>
                <button class="text-slate-400 hover:text-white" onclick="closeModal('requestMoneyModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-6">
                <div class="form-group">
                    <label class="form-label">From</label>
                    <input type="text" class="form-input" id="requestFromInput" placeholder="Select friends or groups">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Amount</label>
                    <input type="number" class="form-input" id="requestAmountInput" placeholder="KSh 0.00">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Reason</label>
                    <input type="text" class="form-input" id="requestReasonInput" placeholder="Dinner, rent, etc.">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Split Equally</label>
                    <div class="flex items-center">
                        <input type="checkbox" class="mr-2" id="splitEqually">
                        <label for="splitEqually" class="text-slate-400 text-sm md:text-base">Divide amount between selected people</label>
                    </div>
                </div>
            </div>
            
            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3">
                <button class="flex-1 px-4 py-2 glass-card border border-slate-700 rounded-xl text-slate-400 hover:border-green-400 hover:text-green-400 transition text-sm md:text-base" onclick="closeModal('requestMoneyModal')">
                    Cancel
                </button>
                <button class="flex-1 px-4 py-2 security-gradient text-white rounded-xl font-semibold hover:scale-105 transition text-sm md:text-base" onclick="sendRequest()">
                    Send Request
                </button>
            </div>
        </div>
    </div>

    <!-- Add Money Modal -->
    <div id="addMoneyModal" class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 hidden">
        <div class="glass-card rounded-2xl modal-content max-w-md w-full fade-in">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-black text-white">Add Money</h3>
                <button class="text-slate-400 hover:text-white" onclick="closeModal('addMoneyModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-6">
                <div class="form-group">
                    <label class="form-label">Amount</label>
                    <input type="number" class="form-input" id="addAmountInput" placeholder="KSh 0.00">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Payment Method</label>
                    <div class="grid grid-cols-2 gap-3" id="paymentOptions">
                        <div class="payment-option glass-card rounded-xl p-3 text-center cursor-pointer border border-slate-700 hover:border-blue-400" data-method="mpesa">
                            <i class="fas fa-mobile-alt text-green-400 mb-1"></i>
                            <div class="text-sm">M-Pesa</div>
                        </div>
                        <div class="payment-option glass-card rounded-xl p-3 text-center cursor-pointer border border-slate-700 hover:border-blue-400" data-method="card">
                            <i class="fas fa-credit-card text-blue-400 mb-1"></i>
                            <div class="text-sm">Card</div>
                        </div>
                        <div class="payment-option glass-card rounded-xl p-3 text-center cursor-pointer border border-slate-700 hover:border-blue-400" data-method="bank">
                            <i class="fas fa-university text-emerald-400 mb-1"></i>
                            <div class="text-sm">Bank Transfer</div>
                        </div>
                        <div class="payment-option glass-card rounded-xl p-3 text-center cursor-pointer border border-slate-700 hover:border-blue-400" data-method="crypto">
                            <i class="fas fa-coins text-purple-400 mb-1"></i>
                            <div class="text-sm">Crypto</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3">
                <button class="flex-1 px-4 py-2 glass-card border border-slate-700 rounded-xl text-slate-400 hover:border-blue-400 hover:text-blue-400 transition text-sm md:text-base" onclick="closeModal('addMoneyModal')">
                    Cancel
                </button>
                <button class="flex-1 px-4 py-2 primary-gradient text-white rounded-xl font-semibold hover:scale-105 transition text-sm md:text-base" onclick="addMoney()">
                    Add Money
                </button>
            </div>
        </div>
    </div>

    <!-- Security Settings Modal -->
    <div id="securitySettingsModal" class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 hidden">
        <div class="glass-card rounded-2xl modal-content max-w-md w-full fade-in">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-black text-white">Security Settings</h3>
                <button class="text-slate-400 hover:text-white" onclick="closeModal('securitySettingsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-6 space-y-4">
                <div class="flex justify-between items-center">
                    <div>
                        <div class="font-semibold text-white text-sm md:text-base">AI Fraud Detection</div>
                        <div class="text-slate-400 text-sm">Real-time transaction monitoring</div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" class="sr-only peer" id="fraudToggle" checked>
                        <div class="w-11 h-6 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div>
                    </label>
                </div>
                
                <div class="flex justify-between items-center">
                    <div>
                        <div class="font-semibold text-white text-sm md:text-base">Biometric Authentication</div>
                        <div class="text-slate-400 text-sm">Use fingerprint or face ID</div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" class="sr-only peer" id="biometricToggle" checked>
                        <div class="w-11 h-6 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div>
                    </label>
                </div>
                
                <div class="flex justify-between items-center">
                    <div>
                        <div class="font-semibold text-white text-sm md:text-base">Two-Factor Authentication</div>
                        <div class="text-slate-400 text-sm">Extra security for logins</div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" class="sr-only peer" id="twoFAToggle" checked>
                        <div class="w-11 h-6 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div>
                    </label>
                </div>
                
                <div class="flex justify-between items-center">
                    <div>
                        <div class="font-semibold text-white text-sm md:text-base">Transaction Limits</div>
                        <div class="text-slate-400 text-sm">Set daily spending limits</div>
                    </div>
                    <button class="text-blue-400 hover:text-blue-300 text-sm md:text-base" onclick="setTransactionLimits()">
                        Configure
                    </button>
                </div>
            </div>
            
            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3">
                <button class="flex-1 px-4 py-2 glass-card border border-slate-700 rounded-xl text-slate-400 hover:border-green-400 hover:text-green-400 transition text-sm md:text-base" onclick="closeModal('securitySettingsModal')">
                    Cancel
                </button>
                <button class="flex-1 px-4 py-2 security-gradient text-white rounded-xl font-semibold hover:scale-105 transition text-sm md:text-base" onclick="saveSecuritySettings()">
                    Save Settings
                </button>
            </div>
        </div>
    </div>

    <!-- Rewards Spin Modal -->
    <div id="rewardsSpinModal" class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 hidden">
        <div class="glass-card rounded-2xl modal-content max-w-md w-full fade-in">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-black text-white">Daily Rewards</h3>
                <button class="text-slate-400 hover:text-white" onclick="closeModal('rewardsSpinModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-6 text-center">
                <div class="relative w-48 h-48 md:w-64 md:h-64 mx-auto mb-4">
                    <div class="absolute inset-0 rounded-full primary-gradient flex items-center justify-center">
                        <div class="w-44 h-44 md:w-60 md:h-60 bg-slate-900 rounded-full flex items-center justify-center">
                            <div class="text-center">
                                <div class="text-xl md:text-2xl font-black text-white mb-2">Spin to Win!</div>
                                <div class="text-slate-400 text-sm">Tap the button below</div>
                            </div>
                        </div>
                    </div>
                    <div class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1 w-4 h-8 bg-yellow-400 rounded-t-lg"></div>
                </div>
                
                <div class="text-slate-400 text-sm mb-4">
                    Spin the wheel to win cashback, bonus points, or special rewards!
                </div>
            </div>
            
            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3">
                <button class="flex-1 px-4 py-2 glass-card border border-slate-700 rounded-xl text-slate-400 hover:border-yellow-400 hover:text-yellow-400 transition text-sm md:text-base" onclick="closeModal('rewardsSpinModal')">
                    Maybe Later
                </button>
                <button class="flex-1 px-4 py-2 rewards-gradient text-white rounded-xl font-semibold hover:scale-105 transition text-sm md:text-base" onclick="spinRewardsWheel()">
                    <i class="fas fa-sync mr-2"></i> Spin Now
                </button>
            </div>
        </div>
    </div>

    <!-- Group Payment Modal -->
    <div id="groupPaymentModal" class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 hidden">
        <div class="glass-card rounded-2xl modal-content max-w-md w-full fade-in">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-black text-white">Create Group Payment</h3>
                <button class="text-slate-400 hover:text-white" onclick="closeModal('groupPaymentModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-6">
                <div class="form-group">
                    <label class="form-label">Group Name</label>
                    <input type="text" class="form-input" id="groupNameInput" placeholder="Enter group name">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Total Amount</label>
                    <input type="number" class="form-input" id="groupAmountInput" placeholder="KSh 0.00">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <input type="text" class="form-input" id="groupDescriptionInput" placeholder="What's this payment for?">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Add Members</label>
                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mb-2">
                        <input type="text" class="form-input flex-1" id="memberSearchInput" placeholder="Search users">
                        <button class="px-4 py-2 primary-gradient text-white rounded-xl font-semibold text-sm md:text-base" onclick="addMember()">
                            Add
                        </button>
                    </div>
                    <div class="scrollable-list border border-slate-700 rounded-xl p-3 max-h-32" id="membersList">
                        <div class="text-slate-400 text-center py-2">No members added yet</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Split Options</label>
                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3">
                        <button class="flex-1 px-4 py-2 glass-card border border-slate-700 rounded-xl text-slate-400 hover:border-blue-400 hover:text-blue-400 transition text-sm md:text-base" onclick="setSplitOption('equal')">
                            Equal Split
                        </button>
                        <button class="flex-1 px-4 py-2 glass-card border border-slate-700 rounded-xl text-slate-400 hover:border-blue-400 hover:text-blue-400 transition text-sm md:text-base" onclick="setSplitOption('custom')">
                            Custom Split
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3">
                <button class="flex-1 px-4 py-2 glass-card border border-slate-700 rounded-xl text-slate-400 hover:border-blue-400 hover:text-blue-400 transition text-sm md:text-base" onclick="closeModal('groupPaymentModal')">
                    Cancel
                </button>
                <button class="flex-1 px-4 py-2 primary-gradient text-white rounded-xl font-semibold hover:scale-105 transition text-sm md:text-base" onclick="createGroupPayment()">
                    Create Group
                </button>
            </div>
        </div>
    </div>

    <!-- Social Gifting Modal -->
    <div id="socialGiftingModal" class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 hidden">
        <div class="glass-card rounded-2xl modal-content max-w-md w-full fade-in">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-black text-white">Send a Gift</h3>
                <button class="text-slate-400 hover:text-white" onclick="closeModal('socialGiftingModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-6">
                <div class="form-group">
                    <label class="form-label">Recipient</label>
                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                        <select class="form-input flex-1" id="giftRecipientType">
                            <option value="user">Individual User</option>
                            <option value="group">Group</option>
                            <option value="charity">Charity Organization</option>
                        </select>
                        <input type="text" class="form-input flex-2" id="giftRecipientInput" placeholder="Search users or groups">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Gift Amount</label>
                    <input type="number" class="form-input" id="giftAmountInput" placeholder="KSh 0.00">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Gift Category</label>
                    <div class="flex flex-wrap gap-2">
                        <span class="category-tag emergency-tag cursor-pointer" onclick="selectGiftCategory('emergency')">Emergency Aid</span>
                        <span class="category-tag charity-tag cursor-pointer" onclick="selectGiftCategory('charity')">Charity Donation</span>
                        <span class="category-tag celebration-tag cursor-pointer" onclick="selectGiftCategory('celebration')">Celebration</span>
                        <span class="category-tag cursor-pointer" style="background: rgba(59, 130, 246, 0.2); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.5);" onclick="selectGiftCategory('appreciation')">Appreciation</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Personal Message</label>
                    <textarea class="form-input" id="giftMessageInput" placeholder="Add a personal message..." rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Gift Anonymously</label>
                    <div class="flex items-center">
                        <input type="checkbox" class="mr-2" id="anonymousGift">
                        <label for="anonymousGift" class="text-slate-400 text-sm md:text-base">Send gift without revealing your identity</label>
                    </div>
                </div>
            </div>
            
            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3">
                <button class="flex-1 px-4 py-2 glass-card border border-slate-700 rounded-xl text-slate-400 hover:border-yellow-400 hover:text-yellow-400 transition text-sm md:text-base" onclick="closeModal('socialGiftingModal')">
                    Cancel
                </button>
                <button class="flex-1 px-4 py-2 rewards-gradient text-white rounded-xl font-semibold hover:scale-105 transition text-sm md:text-base" onclick="sendGift()">
                    Send Gift
                </button>
            </div>
        </div>
    </div>

    <!-- Shared Goals Modal -->
    <div id="sharedGoalsModal" class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 hidden">
        <div class="glass-card rounded-2xl modal-content max-w-md w-full fade-in">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-black text-white">Create Shared Goal</h3>
                <button class="text-slate-400 hover:text-white" onclick="closeModal('sharedGoalsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-6">
                <div class="form-group">
                    <label class="form-label">Goal Name</label>
                    <input type="text" class="form-input" id="goalNameInput" placeholder="e.g., Trip to Mombasa">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Target Amount</label>
                    <input type="number" class="form-input" id="goalAmountInput" placeholder="KSh 0.00">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-input" id="goalDescriptionInput" placeholder="Describe your goal..." rows="2"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Target Date</label>
                    <input type="date" class="form-input" id="goalDateInput">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Add Participants</label>
                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mb-2">
                        <input type="text" class="form-input flex-1" id="participantSearchInput" placeholder="Search users">
                        <button class="px-4 py-2 primary-gradient text-white rounded-xl font-semibold text-sm md:text-base" onclick="addParticipant()">
                            Add
                        </button>
                    </div>
                    <div class="scrollable-list border border-slate-700 rounded-xl p-3 max-h-32" id="participantsList">
                        <div class="text-slate-400 text-center py-2">No participants added yet</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Contribution Type</label>
                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3">
                        <button class="flex-1 px-4 py-2 glass-card border border-slate-700 rounded-xl text-slate-400 hover:border-blue-400 hover:text-blue-400 transition text-sm md:text-base" onclick="setContributionType('equal')">
                            Equal Shares
                        </button>
                        <button class="flex-1 px-4 py-2 glass-card border border-slate-700 rounded-xl text-slate-400 hover:border-blue-400 hover:text-blue-400 transition text-sm md:text-base" onclick="setContributionType('custom')">
                            Custom Amounts
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3">
                <button class="flex-1 px-4 py-2 glass-card border border-slate-700 rounded-xl text-slate-400 hover:border-green-400 hover:text-green-400 transition text-sm md:text-base" onclick="closeModal('sharedGoalsModal')">
                    Cancel
                </button>
                <button class="flex-1 px-4 py-2 security-gradient text-white rounded-xl font-semibold hover:scale-105 transition text-sm md:text-base" onclick="createSharedGoal()">
                    Create Goal
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script>
        // Firebase configuration for the live project
        const firebaseConfig = {
            apiKey: "AIzaSyDHHyGgsSV18BcXrGgzi4C8frzDAE1C1zo",
            authDomain: "uniconnect-ee95c.firebaseapp.com",
            projectId: "uniconnect-ee95c",
            storageBucket: "uniconnect-ee95c.firebasestorage.app",
            messagingSenderId: "1003264444309",
            appId: "1:1003264444309:web:9f0307516e44d21e97d89c"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Global variables
        let currentUser = null;
        let userData = null;
        let selectedPaymentMethod = null;
        let selectedPaymentOption = null;
        let groupMembers = [];
        let goalParticipants = [];
        let selectedGiftCategory = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Clear any cached demo data
            clearCachedData();
            
            // Initialize Firebase and check authentication
            initFirebase();
            
            // Set up payment method selection
            setupPaymentMethods();
            
            // Set up event listeners
            setupEventListeners();
            
            // Set up mood selector
            setupMoodSelector();
        });

        // Clear all cached demo data
        function clearCachedData() {
            localStorage.removeItem('demoUserData');
            localStorage.removeItem('demoTransactions');
            sessionStorage.removeItem('demoBalance');
            console.log('Cleared all cached demo data');
        }

        // Initialize Firebase and authentication
        function initFirebase() {
            updateConnectionStatus('connecting', 'Connecting to Firebase...');
            
            // Check authentication state
            auth.onAuthStateChanged((user) => {
                if (user) {
                    // User is signed in
                    currentUser = user;
                    updateConnectionStatus('connected', 'Connected to Firebase');
                    loadUserData();
                } else {
                    // User is signed out
                    updateConnectionStatus('error', 'Not authenticated. Please log in.');
                    showToast('Please log in to access payment features', 'error');
                    
                    // Redirect to login page after a delay
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 3000);
                }
            }, (error) => {
                console.error('Auth state change error:', error);
                updateConnectionStatus('error', 'Authentication error');
                showToast('Authentication error. Please try again.', 'error');
            });
        }

        // Load user data from Firestore
        function loadUserData() {
            if (!currentUser) return;
            
            // Reference to the user's document in Firestore
            const userRef = db.collection('users').doc(currentUser.uid);
            
            userRef.get().then((doc) => {
                if (doc.exists) {
                    userData = doc.data();
                    updateUIWithUserData();
                    loadTransactions();
                    loadSecuritySettings();
                } else {
                    // User document doesn't exist, create one
                    createUserDocument();
                }
            }).catch((error) => {
                console.error('Error loading user data:', error);
                showToast('Error loading user data', 'error');
            });
        }

        // Create a new user document in Firestore
        function createUserDocument() {
            if (!currentUser) return;
            
            const userRef = db.collection('users').doc(currentUser.uid);
            const initialUserData = {
                uid: currentUser.uid,
                email: currentUser.email,
                displayName: currentUser.displayName || 'User',
                balance: 0,
                cashback: 0,
                streak: 0,
                security: {
                    fraudDetection: true,
                    biometricAuth: false,
                    twoFA: false
                },
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            userRef.set(initialUserData).then(() => {
                userData = initialUserData;
                updateUIWithUserData();
                showToast('Account setup complete!', 'success');
            }).catch((error) => {
                console.error('Error creating user document:', error);
                showToast('Error setting up account', 'error');
            });
        }

        // Update UI with real user data
        function updateUIWithUserData() {
            if (!userData) return;
            
            // Update balance
            document.getElementById('userBalance').textContent = `KSh ${userData.balance?.toLocaleString() || '0'}`;
            document.getElementById('balanceAmount').textContent = `KSh ${userData.balance?.toLocaleString() || '0'}`;
            
            // Update cashback
            document.getElementById('cashbackAmount').textContent = `KSh ${userData.cashback?.toLocaleString() || '0'}`;
            
            // Update streak
            document.getElementById('streakCount').textContent = `${userData.streak || 0} days`;
            
            // Update security status
            if (userData.security) {
                document.getElementById('fraudDetectionStatus').innerHTML = 
                    `<i class="fas fa-shield-alt mr-1"></i> ${userData.security.fraudDetection ? 'Active' : 'Inactive'}`;
                
                document.getElementById('biometricStatus').innerHTML = 
                    `<i class="fas fa-fingerprint mr-1"></i> ${userData.security.biometricAuth ? 'Enabled' : 'Disabled'}`;
                
                document.getElementById('twoFAStatus').innerHTML = 
                    `<i class="fas fa-mobile-alt mr-1"></i> ${userData.security.twoFA ? 'Enabled' : 'Disabled'}`;
            }
        }

        // Load transactions from Firestore
        function loadTransactions() {
            if (!currentUser) return;
            
            const transactionsRef = db.collection('users').doc(currentUser.uid).collection('transactions')
                .orderBy('timestamp', 'desc')
                .limit(5);
            
            transactionsRef.get().then((querySnapshot) => {
                const transactionsList = document.getElementById('transactionsList');
                transactionsList.innerHTML = '';
                
                if (querySnapshot.empty) {
                    transactionsList.innerHTML = `
                        <div class="text-center py-8 text-slate-400">
                            <i class="fas fa-exchange-alt text-2xl mb-2"></i>
                            <p>No transactions yet</p>
                        </div>
                    `;
                    return;
                }
                
                querySnapshot.forEach((doc) => {
                    const transaction = doc.data();
                    const transactionElement = createTransactionElement(transaction);
                    transactionsList.appendChild(transactionElement);
                });
            }).catch((error) => {
                console.error('Error loading transactions:', error);
                document.getElementById('transactionsList').innerHTML = `
                    <div class="text-center py-8 text-red-400">
                        <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
                        <p>Error loading transactions</p>
                    </div>
                `;
            });
        }

        // Create a transaction element for the UI
        function createTransactionElement(transaction) {
            const div = document.createElement('div');
            div.className = 'transaction-item flex justify-between items-center p-4 rounded-xl border border-slate-700';
            
            const isPositive = transaction.type === 'received' || transaction.type === 'cashback' || transaction.type === 'gift_received';
            const icon = transaction.type === 'sent' ? 'fa-arrow-up' : 
                         transaction.type === 'received' ? 'fa-arrow-down' : 
                         transaction.type === 'cashback' ? 'fa-gift' : 
                         transaction.type === 'gift_sent' ? 'fa-gift' :
                         transaction.type === 'gift_received' ? 'fa-gift' : 'fa-exchange-alt';
            
            const colorClass = isPositive ? 'text-green-400' : 'text-red-400';
            const sign = isPositive ? '+' : '-';
            
            div.innerHTML = `
                <div class="flex items-center">
                    <div class="w-10 h-10 rounded-full ${isPositive ? 'bg-green-500/20' : 'bg-red-500/20'} flex items-center justify-center mr-3">
                        <i class="fas ${icon} ${isPositive ? 'text-green-400' : 'text-red-400'}"></i>
                    </div>
                    <div>
                        <div class="font-semibold text-white text-sm md:text-base">${transaction.description || 'Payment'}</div>
                        <div class="text-slate-400 text-sm">${formatDate(transaction.timestamp?.toDate())}</div>
                    </div>
                </div>
                <div class="text-right">
                    <div class="font-bold ${colorClass} text-sm md:text-base">${sign}KSh ${Math.abs(transaction.amount).toLocaleString()}</div>
                    <div class="text-slate-400 text-sm">${transaction.status || 'Completed'}</div>
                </div>
            `;
            
            return div;
        }

        // Format date for display
        function formatDate(date) {
            if (!date) return 'Unknown date';
            
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins} min ago`;
            if (diffHours < 24) return `${diffHours} hr ago`;
            if (diffDays < 7) return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
            
            return date.toLocaleDateString();
        }

        // Load security settings
        function loadSecuritySettings() {
            if (!userData || !userData.security) return;
            
            // Update toggle states in security modal
            document.getElementById('fraudToggle').checked = userData.security.fraudDetection || false;
            document.getElementById('biometricToggle').checked = userData.security.biometricAuth || false;
            document.getElementById('twoFAToggle').checked = userData.security.twoFA || false;
        }

        // Set up payment method selection
        function setupPaymentMethods() {
            const paymentMethods = document.querySelectorAll('.payment-method');
            
            paymentMethods.forEach(method => {
                method.addEventListener('click', function() {
                    // Remove selected class from all methods
                    paymentMethods.forEach(m => m.classList.remove('selected'));
                    
                    // Add selected class to clicked method
                    this.classList.add('selected');
                    
                    // Store selected method
                    selectedPaymentMethod = this.getAttribute('data-method');
                    
                    showToast(`Selected ${getPaymentMethodName(selectedPaymentMethod)}`, 'info');
                });
            });

            // Set up payment option selection in Add Money modal
            const paymentOptions = document.querySelectorAll('.payment-option');
            paymentOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Remove selected class from all options
                    paymentOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Add selected class to clicked option
                    this.classList.add('selected');
                    
                    // Store selected option
                    selectedPaymentOption = this.getAttribute('data-method');
                    
                    console.log(`Selected payment option: ${selectedPaymentOption}`);
                });
            });
        }

        // Set up mood theme selector
        function setupMoodSelector() {
            const moodBtn = document.querySelector('.mood-btn');
            const moodOptions = document.querySelector('.mood-options');
            const moodOptionsList = document.querySelectorAll('.mood-option');

            // Toggle mood options visibility
            if (moodBtn) {
                moodBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    moodOptions.classList.toggle('show');
                });
            }

            // Close mood options when clicking outside
            document.addEventListener('click', () => {
                if (moodOptions) {
                    moodOptions.classList.remove('show');
                }
            });

            // Prevent mood options from closing when clicking inside
            if (moodOptions) {
                moodOptions.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
            }

            // Handle mood selection
            if (moodOptionsList) {
                moodOptionsList.forEach(option => {
                    option.addEventListener('click', () => {
                        const theme = option.getAttribute('data-theme');
                        changeTheme(theme);
                        if (moodOptions) {
                            moodOptions.classList.remove('show');
                        }
                    });
                });
            }
        }

        // Change theme based on mood selection
        function changeTheme(theme) {
            const body = document.body;
            
            // Remove all theme classes
            body.classList.remove('theme-calm', 'theme-energetic', 'theme-creative', 'theme-chill', 'theme-romantic', 'theme-default');
            
            // Add new theme class
            body.classList.add(`theme-${theme}`);
            
            // Save theme preference
            localStorage.setItem('kynecta-theme', theme);
            
            // Show theme change message
            const themeNames = {
                'calm': 'Calm Blue',
                'energetic': 'Energetic Orange',
                'creative': 'Creative Purple',
                'chill': 'Chill Green',
                'romantic': 'Romantic Pink',
                'default': 'Default Dark'
            };
            
            showToast(`Theme changed to ${themeNames[theme]}`, 'success');
            console.log(`🎨 Theme changed to: ${theme}`);
        }

        // Get display name for payment method
        function getPaymentMethodName(method) {
            const names = {
                'mpesa': 'M-Pesa',
                'card': 'Credit/Debit Card',
                'bank': 'Bank Transfer',
                'crypto': 'Cryptocurrency'
            };
            
            return names[method] || method;
        }

        // Set up event listeners
        function setupEventListeners() {
            // Payment option selection
            document.addEventListener('click', function(e) {
                if (e.target.closest('.payment-option')) {
                    const options = document.querySelectorAll('.payment-option');
                    options.forEach(opt => opt.classList.remove('selected'));
                    e.target.closest('.payment-option').classList.add('selected');
                    selectedPaymentOption = e.target.closest('.payment-option').getAttribute('data-method');
                }
            });

            // Fraud detection simulation
            const amountInput = document.querySelector('#sendAmountInput');
            if (amountInput) {
                amountInput.addEventListener('input', function() {
                    const amount = parseFloat(this.value);
                    const fraudAlert = document.getElementById('fraudAlert');
                    
                    if (amount > 50000) {
                        fraudAlert.classList.remove('hidden');
                        console.warn('🚨 Fraud alert triggered for amount:', amount);
                    } else {
                        fraudAlert.classList.add('hidden');
                    }
                });
            }
        }

        // Update connection status indicator
        function updateConnectionStatus(status, message) {
            const statusElement = document.getElementById('connectionStatus');
            statusElement.className = `connection-status ${status}`;
            statusElement.innerHTML = `
                <i class="fas ${status === 'connected' ? 'fa-check-circle' : status === 'connecting' ? 'fa-sync fa-spin' : 'fa-exclamation-triangle'}"></i>
                <span>${message}</span>
            `;
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();
            
            const toast = document.createElement('div');
            toast.id = toastId;
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-triangle' : 'fa-info-circle'} mr-2"></i>
                    <span class="text-sm md:text-base">${message}</span>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Show toast
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            // Hide toast after 5 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 5000);
        }

        // Modal functions
        function openSendMoneyModal() {
            if (!currentUser) {
                showToast('Please log in to send money', 'error');
                return;
            }
            document.getElementById('sendMoneyModal').classList.remove('hidden');
        }

        function openRequestMoneyModal() {
            if (!currentUser) {
                showToast('Please log in to request money', 'error');
                return;
            }
            document.getElementById('requestMoneyModal').classList.remove('hidden');
        }

        function openAddMoneyModal() {
            if (!currentUser) {
                showToast('Please log in to add money', 'error');
                return;
            }
            document.getElementById('addMoneyModal').classList.remove('hidden');
        }

        function openSecuritySettings() {
            document.getElementById('securitySettingsModal').classList.remove('hidden');
        }

        function openRewardsSpinModal() {
            document.getElementById('rewardsSpinModal').classList.remove('hidden');
        }

        function openGroupPaymentModal() {
            document.getElementById('groupPaymentModal').classList.remove('hidden');
            groupMembers = [];
            updateMembersList();
        }

        function openSocialGiftingModal() {
            document.getElementById('socialGiftingModal').classList.remove('hidden');
            selectedGiftCategory = null;
        }

        function openSharedGoalsModal() {
            document.getElementById('sharedGoalsModal').classList.remove('hidden');
            goalParticipants = [];
            updateParticipantsList();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function selectPaymentOption(element, method) {
            const options = document.querySelectorAll('.payment-option');
            options.forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            selectedPaymentOption = method;
        }

        // Process payment
        function processPayment() {
            const amount = parseFloat(document.getElementById('sendAmountInput').value);
            const recipient = document.getElementById('recipientInput').value;
            const message = document.getElementById('sendMessageInput').value;
            
            if (!amount || amount <= 0) {
                showToast('Please enter a valid amount', 'error');
                return;
            }
            
            if (!recipient) {
                showToast('Please enter a recipient', 'error');
                return;
            }
            
            if (!selectedPaymentMethod) {
                showToast('Please select a payment method', 'error');
                return;
            }
            
            if (amount > userData.balance) {
                showToast('Insufficient balance', 'error');
                return;
            }
            
            // Show loading state
            const sendButton = document.querySelector('#sendMoneyModal button:last-child');
            const originalText = sendButton.innerHTML;
            sendButton.innerHTML = '<div class="loading-spinner"></div> Processing...';
            sendButton.disabled = true;
            
            // Simulate payment processing
            setTimeout(() => {
                // In a real app, this would call your payment API
                recordTransaction({
                    type: 'sent',
                    amount: amount,
                    description: `Payment to ${recipient}`,
                    method: selectedPaymentMethod,
                    message: message,
                    status: 'completed'
                });
                
                // Update balance
                updateBalance(-amount);
                
                // Reset form
                document.getElementById('sendAmountInput').value = '';
                document.getElementById('recipientInput').value = '';
                document.getElementById('sendMessageInput').value = '';
                
                // Close modal
                closeModal('sendMoneyModal');
                
                // Reset button
                sendButton.innerHTML = originalText;
                sendButton.disabled = false;
                
                showToast(`Payment of KSh ${amount.toLocaleString()} sent successfully!`, 'success');
            }, 2000);
        }

        // Send money request
        function sendRequest() {
            const amount = parseFloat(document.getElementById('requestAmountInput').value);
            const from = document.getElementById('requestFromInput').value;
            const reason = document.getElementById('requestReasonInput').value;
            const splitEqually = document.getElementById('splitEqually').checked;
            
            if (!amount || amount <= 0) {
                showToast('Please enter a valid amount', 'error');
                return;
            }
            
            if (!from) {
                showToast('Please specify who to request from', 'error');
                return;
            }
            
            // Show loading state
            const requestButton = document.querySelector('#requestMoneyModal button:last-child');
            const originalText = requestButton.innerHTML;
            requestButton.innerHTML = '<div class="loading-spinner"></div> Sending...';
            requestButton.disabled = true;
            
            // Simulate request sending
            setTimeout(() => {
                // In a real app, this would send notifications to the requested users
                
                // Reset form
                document.getElementById('requestAmountInput').value = '';
                document.getElementById('requestFromInput').value = '';
                document.getElementById('requestReasonInput').value = '';
                document.getElementById('splitEqually').checked = false;
                
                // Close modal
                closeModal('requestMoneyModal');
                
                // Reset button
                requestButton.innerHTML = originalText;
                requestButton.disabled = false;
                
                showToast(`Money request sent to ${from}`, 'success');
            }, 1500);
        }

        // Add money to account
        function addMoney() {
            const amount = parseFloat(document.getElementById('addAmountInput').value);
            
            if (!amount || amount <= 0) {
                showToast('Please enter a valid amount', 'error');
                return;
            }
            
            if (!selectedPaymentOption) {
                showToast('Please select a payment method', 'error');
                return;
            }
            
            // Show loading state
            const addButton = document.querySelector('#addMoneyModal button:last-child');
            const originalText = addButton.innerHTML;
            addButton.innerHTML = '<div class="loading-spinner"></div> Processing...';
            addButton.disabled = true;
            
            // Simulate adding money
            setTimeout(() => {
                // In a real app, this would integrate with payment gateway
                recordTransaction({
                    type: 'received',
                    amount: amount,
                    description: `Added via ${getPaymentMethodName(selectedPaymentOption)}`,
                    method: selectedPaymentOption,
                    status: 'completed'
                });
                
                // Update balance
                updateBalance(amount);
                
                // Reset form
                document.getElementById('addAmountInput').value = '';
                
                // Close modal
                closeModal('addMoneyModal');
                
                // Reset button
                addButton.innerHTML = originalText;
                addButton.disabled = false;
                
                showToast(`KSh ${amount.toLocaleString()} added to your account!`, 'success');
            }, 2000);
        }

        // Save security settings
        function saveSecuritySettings() {
            if (!currentUser) return;
            
            const fraudDetection = document.getElementById('fraudToggle').checked;
            const biometricAuth = document.getElementById('biometricToggle').checked;
            const twoFA = document.getElementById('twoFAToggle').checked;
            
            // Update user data in Firestore
            const userRef = db.collection('users').doc(currentUser.uid);
            
            userRef.update({
                'security.fraudDetection': fraudDetection,
                'security.biometricAuth': biometricAuth,
                'security.twoFA': twoFA,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                // Update local user data
                if (!userData.security) userData.security = {};
                userData.security.fraudDetection = fraudDetection;
                userData.security.biometricAuth = biometricAuth;
                userData.security.twoFA = twoFA;
                
                // Update UI
                updateUIWithUserData();
                
                // Close modal
                closeModal('securitySettingsModal');
                
                showToast('Security settings updated successfully', 'success');
            }).catch((error) => {
                console.error('Error updating security settings:', error);
                showToast('Error updating security settings', 'error');
            });
        }

        // Spin rewards wheel
        function spinRewardsWheel() {
            const spinButton = document.querySelector('#rewardsSpinModal button:last-child');
            const originalText = spinButton.innerHTML;
            spinButton.innerHTML = '<div class="loading-spinner"></div> Spinning...';
            spinButton.disabled = true;
            
            // Simulate spinning animation
            setTimeout(() => {
                // Determine reward (in a real app, this would be random)
                const rewards = [
                    { type: 'cashback', amount: 50, message: 'KSh 50 Cashback!' },
                    { type: 'bonus', amount: 100, message: 'KSh 100 Bonus!' },
                    { type: 'points', amount: 500, message: '500 Points!' }
                ];
                
                const reward = rewards[Math.floor(Math.random() * rewards.length)];
                
                // Update user data
                if (reward.type === 'cashback') {
                    updateCashback(reward.amount);
                }
                
                // Reset button
                spinButton.innerHTML = originalText;
                spinButton.disabled = false;
                
                // Close modal
                closeModal('rewardsSpinModal');
                
                showToast(`Congratulations! You won ${reward.message}`, 'success');
            }, 3000);
        }

        // Claim rewards
        function claimRewards() {
            if (!userData || userData.cashback <= 0) {
                showToast('No cashback available to claim', 'info');
                return;
            }
            
            const cashbackAmount = userData.cashback;
            
            // Show loading state
            const claimButton = document.querySelector('.rewards-gradient');
            const originalText = claimButton.innerHTML;
            claimButton.innerHTML = '<div class="loading-spinner"></div> Claiming...';
            claimButton.disabled = true;
            
            // Simulate claiming rewards
            setTimeout(() => {
                // Update balance
                updateBalance(cashbackAmount);
                
                // Reset cashback
                updateCashback(-cashbackAmount);
                
                // Record transaction
                recordTransaction({
                    type: 'cashback',
                    amount: cashbackAmount,
                    description: 'Cashback Claimed',
                    status: 'completed'
                });
                
                // Reset button
                claimButton.innerHTML = originalText;
                claimButton.disabled = false;
                
                showToast(`Successfully claimed KSh ${cashbackAmount.toLocaleString()} cashback!`, 'success');
            }, 1500);
        }

        // Group Payment Functions
        function addMember() {
            const memberInput = document.getElementById('memberSearchInput');
            const memberName = memberInput.value.trim();
            
            if (!memberName) {
                showToast('Please enter a member name', 'error');
                return;
            }
            
            // Check if member already exists
            if (groupMembers.some(member => member.name === memberName)) {
                showToast('Member already added', 'info');
                return;
            }
            
            // Add member to list
            groupMembers.push({
                name: memberName,
                amount: 0
            });
            
            // Clear input
            memberInput.value = '';
            
            // Update UI
            updateMembersList();
            
            showToast(`Added ${memberName} to group`, 'success');
        }

        function updateMembersList() {
            const membersList = document.getElementById('membersList');
            
            if (groupMembers.length === 0) {
                membersList.innerHTML = '<div class="text-slate-400 text-center py-2">No members added yet</div>';
                return;
            }
            
            membersList.innerHTML = '';
            
            groupMembers.forEach((member, index) => {
                const memberElement = document.createElement('div');
                memberElement.className = 'flex justify-between items-center py-2 border-b border-slate-700 last:border-b-0';
                memberElement.innerHTML = `
                    <div class="flex items-center">
                        <div class="user-avatar mr-3">${member.name.charAt(0).toUpperCase()}</div>
                        <span class="text-white text-sm md:text-base">${member.name}</span>
                    </div>
                    <button class="text-red-400 hover:text-red-300" onclick="removeMember(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                membersList.appendChild(memberElement);
            });
        }

        function removeMember(index) {
            const removedMember = groupMembers.splice(index, 1)[0];
            updateMembersList();
            showToast(`Removed ${removedMember.name} from group`, 'info');
        }

        function setSplitOption(option) {
            const buttons = document.querySelectorAll('#groupPaymentModal .form-group:last-child button');
            buttons.forEach(button => {
                if (button.textContent.includes(option === 'equal' ? 'Equal' : 'Custom')) {
                    button.classList.add('border-blue-400', 'text-blue-400');
                } else {
                    button.classList.remove('border-blue-400', 'text-blue-400');
                }
            });
            
            showToast(`Split set to ${option === 'equal' ? 'equal amounts' : 'custom amounts'}`, 'info');
        }

        function createGroupPayment() {
            const groupName = document.getElementById('groupNameInput').value.trim();
            const amount = parseFloat(document.getElementById('groupAmountInput').value);
            const description = document.getElementById('groupDescriptionInput').value.trim();
            
            if (!groupName) {
                showToast('Please enter a group name', 'error');
                return;
            }
            
            if (!amount || amount <= 0) {
                showToast('Please enter a valid amount', 'error');
                return;
            }
            
            if (groupMembers.length === 0) {
                showToast('Please add at least one member to the group', 'error');
                return;
            }
            
            // Show loading state
            const createButton = document.querySelector('#groupPaymentModal button:last-child');
            const originalText = createButton.innerHTML;
            createButton.innerHTML = '<div class="loading-spinner"></div> Creating...';
            createButton.disabled = true;
            
            // Simulate group creation
            setTimeout(() => {
                // In a real app, this would create a group in Firestore and send notifications
                
                // Reset form
                document.getElementById('groupNameInput').value = '';
                document.getElementById('groupAmountInput').value = '';
                document.getElementById('groupDescriptionInput').value = '';
                document.getElementById('memberSearchInput').value = '';
                groupMembers = [];
                updateMembersList();
                
                // Close modal
                closeModal('groupPaymentModal');
                
                // Reset button
                createButton.innerHTML = originalText;
                createButton.disabled = false;
                
                showToast(`Group "${groupName}" created successfully!`, 'success');
                
                // Integrate with chat system
                integrateWithChatSystem(groupName, description, amount, groupMembers);
            }, 2000);
        }

        // Social Gifting Functions
        function selectGiftCategory(category) {
            selectedGiftCategory = category;
            
            // Update UI to show selected category
            const tags = document.querySelectorAll('.category-tag');
            tags.forEach(tag => {
                if (tag.textContent.includes(getCategoryDisplayName(category))) {
                    tag.classList.add('border-2', 'border-white');
                } else {
                    tag.classList.remove('border-2', 'border-white');
                }
            });
            
            showToast(`Selected ${getCategoryDisplayName(category)} category`, 'info');
        }

        function getCategoryDisplayName(category) {
            const names = {
                'emergency': 'Emergency Aid',
                'charity': 'Charity Donation',
                'celebration': 'Celebration',
                'appreciation': 'Appreciation'
            };
            
            return names[category] || category;
        }

        function sendGift() {
            const recipientType = document.getElementById('giftRecipientType').value;
            const recipient = document.getElementById('giftRecipientInput').value.trim();
            const amount = parseFloat(document.getElementById('giftAmountInput').value);
            const message = document.getElementById('giftMessageInput').value.trim();
            const anonymous = document.getElementById('anonymousGift').checked;
            
            if (!recipient) {
                showToast('Please enter a recipient', 'error');
                return;
            }
            
            if (!amount || amount <= 0) {
                showToast('Please enter a valid amount', 'error');
                return;
            }
            
            if (!selectedGiftCategory) {
                showToast('Please select a gift category', 'error');
                return;
            }
            
            if (amount > userData.balance) {
                showToast('Insufficient balance', 'error');
                return;
            }
            
            // Show loading state
            const sendButton = document.querySelector('#socialGiftingModal button:last-child');
            const originalText = sendButton.innerHTML;
            sendButton.innerHTML = '<div class="loading-spinner"></div> Sending...';
            sendButton.disabled = true;
            
            // Simulate gift sending
            setTimeout(() => {
                // In a real app, this would send the gift and notify the recipient
                recordTransaction({
                    type: 'gift_sent',
                    amount: amount,
                    description: `Gift to ${recipient}`,
                    category: selectedGiftCategory,
                    message: message,
                    anonymous: anonymous,
                    status: 'completed'
                });
                
                // Update balance
                updateBalance(-amount);
                
                // Reset form
                document.getElementById('giftRecipientInput').value = '';
                document.getElementById('giftAmountInput').value = '';
                document.getElementById('giftMessageInput').value = '';
                document.getElementById('anonymousGift').checked = false;
                selectedGiftCategory = null;
                
                // Reset category tags
                const tags = document.querySelectorAll('.category-tag');
                tags.forEach(tag => tag.classList.remove('border-2', 'border-white'));
                
                // Close modal
                closeModal('socialGiftingModal');
                
                // Reset button
                sendButton.innerHTML = originalText;
                sendButton.disabled = false;
                
                showToast(`Gift of KSh ${amount.toLocaleString()} sent to ${recipient}!`, 'success');
            }, 2000);
        }

        // Shared Goals Functions
        function addParticipant() {
            const participantInput = document.getElementById('participantSearchInput');
            const participantName = participantInput.value.trim();
            
            if (!participantName) {
                showToast('Please enter a participant name', 'error');
                return;
            }
            
            // Check if participant already exists
            if (goalParticipants.some(participant => participant.name === participantName)) {
                showToast('Participant already added', 'info');
                return;
            }
            
            // Add participant to list
            goalParticipants.push({
                name: participantName,
                contribution: 0
            });
            
            // Clear input
            participantInput.value = '';
            
            // Update UI
            updateParticipantsList();
            
            showToast(`Added ${participantName} to goal`, 'success');
        }

        function updateParticipantsList() {
            const participantsList = document.getElementById('participantsList');
            
            if (goalParticipants.length === 0) {
                participantsList.innerHTML = '<div class="text-slate-400 text-center py-2">No participants added yet</div>';
                return;
            }
            
            participantsList.innerHTML = '';
            
            goalParticipants.forEach((participant, index) => {
                const participantElement = document.createElement('div');
                participantElement.className = 'flex justify-between items-center py-2 border-b border-slate-700 last:border-b-0';
                participantElement.innerHTML = `
                    <div class="flex items-center">
                        <div class="user-avatar mr-3">${participant.name.charAt(0).toUpperCase()}</div>
                        <span class="text-white text-sm md:text-base">${participant.name}</span>
                    </div>
                    <button class="text-red-400 hover:text-red-300" onclick="removeParticipant(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                participantsList.appendChild(participantElement);
            });
        }

        function removeParticipant(index) {
            const removedParticipant = goalParticipants.splice(index, 1)[0];
            updateParticipantsList();
            showToast(`Removed ${removedParticipant.name} from goal`, 'info');
        }

        function setContributionType(type) {
            const buttons = document.querySelectorAll('#sharedGoalsModal .form-group:last-child button');
            buttons.forEach(button => {
                if (button.textContent.includes(type === 'equal' ? 'Equal' : 'Custom')) {
                    button.classList.add('border-blue-400', 'text-blue-400');
                } else {
                    button.classList.remove('border-blue-400', 'text-blue-400');
                }
            });
            
            showToast(`Contribution set to ${type === 'equal' ? 'equal shares' : 'custom amounts'}`, 'info');
        }

        function createSharedGoal() {
            const goalName = document.getElementById('goalNameInput').value.trim();
            const amount = parseFloat(document.getElementById('goalAmountInput').value);
            const description = document.getElementById('goalDescriptionInput').value.trim();
            const targetDate = document.getElementById('goalDateInput').value;
            
            if (!goalName) {
                showToast('Please enter a goal name', 'error');
                return;
            }
            
            if (!amount || amount <= 0) {
                showToast('Please enter a valid amount', 'error');
                return;
            }
            
            if (!targetDate) {
                showToast('Please select a target date', 'error');
                return;
            }
            
            if (goalParticipants.length === 0) {
                showToast('Please add at least one participant to the goal', 'error');
                return;
            }
            
            // Show loading state
            const createButton = document.querySelector('#sharedGoalsModal button:last-child');
            const originalText = createButton.innerHTML;
            createButton.innerHTML = '<div class="loading-spinner"></div> Creating...';
            createButton.disabled = true;
            
            // Simulate goal creation
            setTimeout(() => {
                // In a real app, this would create a goal in Firestore and notify participants
                
                // Reset form
                document.getElementById('goalNameInput').value = '';
                document.getElementById('goalAmountInput').value = '';
                document.getElementById('goalDescriptionInput').value = '';
                document.getElementById('goalDateInput').value = '';
                document.getElementById('participantSearchInput').value = '';
                goalParticipants = [];
                updateParticipantsList();
                
                // Close modal
                closeModal('sharedGoalsModal');
                
                // Reset button
                createButton.innerHTML = originalText;
                createButton.disabled = false;
                
                showToast(`Shared goal "${goalName}" created successfully!`, 'success');
            }, 2000);
        }

        // Record a transaction in Firestore
        function recordTransaction(transactionData) {
            if (!currentUser) return;
            
            const transaction = {
                ...transactionData,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                uid: currentUser.uid
            };
            
            const transactionsRef = db.collection('users').doc(currentUser.uid).collection('transactions');
            
            transactionsRef.add(transaction).then(() => {
                // Reload transactions to show the new one
                loadTransactions();
            }).catch((error) => {
                console.error('Error recording transaction:', error);
            });
        }

        // Update user balance in Firestore
        function updateBalance(amount) {
            if (!currentUser || !userData) return;
            
            const newBalance = (userData.balance || 0) + amount;
            
            const userRef = db.collection('users').doc(currentUser.uid);
            
            userRef.update({
                balance: newBalance,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                // Update local user data
                userData.balance = newBalance;
                
                // Update UI
                updateUIWithUserData();
            }).catch((error) => {
                console.error('Error updating balance:', error);
            });
        }

        // Update user cashback in Firestore
        function updateCashback(amount) {
            if (!currentUser || !userData) return;
            
            const newCashback = (userData.cashback || 0) + amount;
            
            const userRef = db.collection('users').doc(currentUser.uid);
            
            userRef.update({
                cashback: newCashback,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                // Update local user data
                userData.cashback = newCashback;
                
                // Update UI
                updateUIWithUserData();
            }).catch((error) => {
                console.error('Error updating cashback:', error);
            });
        }

        // Integrate with chat system
        function integrateWithChatSystem(groupName, description, amount, members) {
            // In a real implementation, this would create a chat group and send notifications
            console.log(`Creating chat group for "${groupName}" with ${members.length} members`);
            
            // Simulate creating a chat group
            setTimeout(() => {
                showToast(`Chat group "${groupName}" created! Members have been notified.`, 'success');
                
                // Redirect to chat page with the new group
                // window.location.href = `chat.html?group=${encodeURIComponent(groupName)}`;
            }, 1000);
        }

        // Placeholder functions for other features
        function openWithdrawModal() {
            showToast('Withdrawal feature coming soon', 'info');
        }

        function openMarketplaceModal() {
            showToast('Marketplace feature coming soon', 'info');
        }

        function openCryptoModal() {
            showToast('Crypto feature coming soon', 'info');
        }

        function viewAllTransactions() {
            showToast('Transaction history feature coming soon', 'info');
        }

        function setTransactionLimits() {
            showToast('Transaction limits feature coming soon', 'info');
        }
    </script>
</body>
</html>