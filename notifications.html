<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Neural Alerts - ConnectSphere</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
    
    <style>
        .neuro-glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .cyber-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .neural-pulse {
            animation: neuralPulse 2s infinite;
        }
        @keyframes neuralPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .notification-glow {
            box-shadow: 0 0 20px rgba(34, 211, 238, 0.3);
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-in-right {
            animation: slideInRight 0.3s ease-out;
        }
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .slide-in-bottom {
            animation: slideInBottom 0.3s ease-out;
        }
        @keyframes slideInBottom {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 400px;
        }
        .tab-active {
            border-bottom: 2px solid #22d3ee;
            color: #22d3ee;
        }
        .filter-active {
            background: rgba(34, 211, 238, 0.2);
            border-color: #22d3ee;
        }
        .notification-priority-critical {
            border-left: 4px solid #ef4444;
        }
        .notification-priority-high {
            border-left: 4px solid #f59e0b;
        }
        .notification-priority-medium {
            border-left: 4px solid #22d3ee;
        }
        .notification-priority-low {
            border-left: 4px solid #10b981;
        }
        .notification-priority-info {
            border-left: 4px solid #8b5cf6;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        .modal-content {
            background: rgba(30, 30, 50, 0.9);
            border-radius: 1rem;
            padding: 1.5rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        /* New notification category styles */
        .notification-category-messages {
            border-left: 4px solid #3b82f6;
        }
        .notification-category-games {
            border-left: 4px solid #8b5cf6;
        }
        .notification-category-marketplace {
            border-left: 4px solid #10b981;
        }
        .notification-category-system {
            border-left: 4px solid #6b7280;
        }
        
        .category-badge {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 12px;
            margin-left: 8px;
        }
        .category-messages { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .category-games { background: rgba(139, 92, 246, 0.2); color: #8b5cf6; }
        .category-marketplace { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .category-system { background: rgba(107, 114, 128, 0.2); color: #9ca3af; }
        
        .realtime-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .realtime-connected {
            background: rgba(34, 197, 94, 0.8);
            color: white;
        }
        .realtime-connecting {
            background: rgba(245, 158, 11, 0.8);
            color: white;
        }
        .realtime-disconnected {
            background: rgba(239, 68, 68, 0.8);
            color: white;
        }

        /* Notification Detail Styles */
        .notification-detail-content {
            max-height: 400px;
            overflow-y: auto;
        }
        .message-bubble {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            margin: 8px 0;
        }
        .message-bubble.user {
            background: rgba(34, 211, 238, 0.2);
            border: 1px solid rgba(34, 211, 238, 0.3);
            margin-left: auto;
        }
        .message-bubble.other {
            background: rgba(147, 51, 234, 0.2);
            border: 1px solid rgba(147, 51, 234, 0.3);
        }
        
        /* Connection Status */
        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            z-index: 1000;
            transition: all 0.3s;
        }
        .connection-status.connected {
            background: rgba(34, 197, 94, 0.8);
            color: white;
        }
        .connection-status.connecting {
            background: rgba(245, 158, 11, 0.8);
            color: white;
        }
        .connection-status.disconnected {
            background: rgba(239, 68, 68, 0.8);
            color: white;
        }
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid #3B82F6;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mobile Responsive Styles */
        @media (max-width: 767px) {
            .mobile-padding {
                padding: 1rem;
            }
            
            .mobile-margin {
                margin-bottom: 1.5rem;
            }
            
            .mobile-text-center {
                text-align: center;
            }
            
            .mobile-stack {
                flex-direction: column;
            }
            
            .mobile-space-y > * + * {
                margin-top: 1rem;
            }
            
            .modal-content {
                padding: 1rem;
            }
            
            .notification-category {
                margin-bottom: 2rem;
            }
            
            .category-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .notification-actions {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .notification-action-btn {
                font-size: 0.7rem;
                padding: 0.25rem 0.5rem;
            }
            
            .quick-actions-panel {
                bottom: 1rem;
                right: 1rem;
            }
            
            .quick-action-btn {
                width: 2.5rem;
                height: 2.5rem;
            }
        }
        
        @media (min-width: 768px) {
            .modal-content {
                padding: 2rem;
            }
        }
    </style>
</head>
<body class="h-full bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 text-white overflow-x-hidden">
    <!-- Firebase Connection Status -->
    <div class="connection-status connecting" id="connectionStatus">
        <i class="fas fa-circle-notch fa-spin mr-2"></i>
        <span id="connectionText">Connecting to Firebase...</span>
    </div>

    <!-- Real-time Connection Indicator -->
    <div class="realtime-indicator realtime-connected" id="realtimeIndicator">
        <i class="fas fa-circle text-xs"></i>
        <span id="realtimeStatus">Real-time Connected</span>
    </div>

    <div class="flex h-full">
        <!-- Neural Navigation - Hidden on mobile -->
        <div class="hidden lg:flex w-20 lg:w-64 neuro-glass border-r border-purple-800 flex-col">
            <div class="p-4">
                <a href="integration.html" class="flex items-center space-x-3">
                    <div class="w-10 h-10 cyber-gradient rounded-2xl flex items-center justify-center">
                        <i class="fas fa-brain text-white"></i>
                    </div>
                    <span class="hidden lg:block text-xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400">
                        ConnectSphere
                    </span>
                </a>
            </div>

            <nav class="flex-1 px-2 lg:px-4 space-y-2">
                <a href="home.html" class="flex items-center space-x-3 p-3 rounded-xl text-purple-300 hover:bg-purple-900/30 hover:text-cyan-400 transition">
                    <i class="fas fa-home w-6"></i>
                    <span class="hidden lg:block">Neural Feed</span>
                </a>
                <a href="chat.html" class="flex items-center space-x-3 p-3 rounded-xl text-purple-300 hover:bg-purple-900/30 hover:text-cyan-400 transition">
                    <i class="fas fa-comment-dots w-6"></i>
                    <span class="hidden lg:block">Quantum Chat</span>
                </a>
                <a href="notifications.html" class="flex items-center space-x-3 p-3 rounded-xl bg-cyan-900/30 text-cyan-400 border border-cyan-500/50">
                    <i class="fas fa-bell w-6"></i>
                    <span class="hidden lg:block">Neural Alerts</span>
                    <span id="notificationBadge" class="hidden lg:block bg-cyan-500 text-white text-xs px-2 py-1 rounded-full neural-pulse">5</span>
                </a>
                <a href="profile.html" class="flex items-center space-x-3 p-3 rounded-xl text-purple-300 hover:bg-purple-900/30 hover:text-cyan-400 transition">
                    <i class="fas fa-user-astronaut w-6"></i>
                    <span class="hidden lg:block">Neural Profile</span>
                </a>
            </nav>
        </div>

        <!-- Main Neural Content -->
        <div class="flex-1 flex flex-col overflow-hidden w-full">
            <!-- Cyber Header -->
            <header class="neuro-glass border-b border-purple-800 px-4 md:px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <!-- Mobile Menu Button -->
                        <button id="mobileMenuBtn" class="lg:hidden text-purple-400 hover:text-cyan-400 transition">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                        <h1 class="text-xl md:text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400">Neural Alerts</h1>
                    </div>
                    <div class="flex items-center space-x-2 md:space-x-4">
                        <button id="notificationSettingsBtn" class="text-purple-400 hover:text-cyan-400 transition">
                            <i class="fas fa-sliders-h"></i>
                        </button>
                        <button id="markAllReadBtn" class="text-purple-400 hover:text-cyan-400 transition">
                            <i class="fas fa-check-double"></i>
                        </button>
                        <button id="clearAllBtn" class="text-purple-400 hover:text-cyan-400 transition">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Neural Alert Tabs & Filters -->
            <div class="neuro-glass border-b border-purple-800">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between px-4 md:px-6">
                    <nav class="flex space-x-4 md:space-x-8 overflow-x-auto py-2 lg:py-0">
                        <button class="tab-btn border-b-2 border-cyan-400 text-cyan-400 py-2 md:py-4 px-1 font-semibold whitespace-nowrap" data-tab="all">
                            All Alerts
                        </button>
                        <button class="tab-btn text-purple-400 hover:text-cyan-400 py-2 md:py-4 px-1 font-semibold whitespace-nowrap transition" data-tab="unread">
                            Unread
                        </button>
                        <button class="tab-btn text-purple-400 hover:text-cyan-400 py-2 md:py-4 px-1 font-semibold whitespace-nowrap transition" data-tab="messages">
                            Messages
                        </button>
                        <button class="tab-btn text-purple-400 hover:text-cyan-400 py-2 md:py-4 px-1 font-semibold whitespace-nowrap transition" data-tab="games">
                            Games
                        </button>
                        <button class="tab-btn text-purple-400 hover:text-cyan-400 py-2 md:py-4 px-1 font-semibold whitespace-nowrap transition" data-tab="marketplace">
                            Marketplace
                        </button>
                    </nav>
                    
                    <div class="flex space-x-2 py-2 lg:py-0 overflow-x-auto">
                        <button class="filter-btn px-3 py-1 neuro-glass text-cyan-400 rounded-2xl border border-cyan-500/50 filter-active whitespace-nowrap" data-filter="all">
                            All
                        </button>
                        <button class="filter-btn px-3 py-1 neuro-glass text-purple-400 rounded-2xl hover:border-purple-500/50 whitespace-nowrap" data-filter="quantum">
                            Quantum
                        </button>
                        <button class="filter-btn px-3 py-1 neuro-glass text-purple-400 rounded-2xl hover:border-purple-500/50 whitespace-nowrap" data-filter="neural">
                            Neural
                        </button>
                        <button class="filter-btn px-3 py-1 neuro-glass text-purple-400 rounded-2xl hover:border-purple-500/50 whitespace-nowrap" data-filter="ai">
                            AI
                        </button>
                    </div>
                </div>
            </div>

            <!-- Neural Alerts Stream -->
            <main class="flex-1 overflow-y-auto bg-gradient-to-b from-purple-900/20 to-gray-900/50">
                <div class="max-w-4xl mx-auto p-4 md:p-6">
                    <!-- Notification Stats -->
                    <div class="neuro-glass rounded-2xl p-4 md:p-6 mb-4 md:mb-6 border border-purple-700">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
                            <div class="text-center p-3 md:p-4 rounded-xl bg-cyan-900/20 border border-cyan-500/30">
                                <div class="text-xl md:text-2xl font-bold text-cyan-400" id="totalAlerts">12</div>
                                <div class="text-xs md:text-sm text-purple-300">Total Alerts</div>
                            </div>
                            <div class="text-center p-3 md:p-4 rounded-xl bg-purple-900/20 border border-purple-500/30">
                                <div class="text-xl md:text-2xl font-bold text-purple-400" id="unreadAlerts">5</div>
                                <div class="text-xs md:text-sm text-purple-300">Unread</div>
                            </div>
                            <div class="text-center p-3 md:p-4 rounded-xl bg-green-900/20 border border-green-500/30">
                                <div class="text-xl md:text-2xl font-bold text-green-400" id="todayAlerts">3</div>
                                <div class="text-xs md:text-sm text-purple-300">Today</div>
                            </div>
                            <div class="text-center p-3 md:p-4 rounded-xl bg-yellow-900/20 border border-yellow-500/30">
                                <div class="text-xl md:text-2xl font-bold text-yellow-400" id="priorityAlerts">2</div>
                                <div class="text-xs md:text-sm text-purple-300">High Priority</div>
                            </div>
                        </div>
                    </div>

                    <!-- Category Sections -->
                    <div class="space-y-6 md:space-y-8" id="notificationsContainer">
                        <!-- Messages Category -->
                        <div class="notification-category" data-category="messages">
                            <div class="flex items-center justify-between mb-4 category-header">
                                <div class="flex items-center space-x-3">
                                    <div class="w-3 h-3 bg-blue-500 rounded-full neural-pulse"></div>
                                    <h3 class="text-base md:text-lg font-semibold text-blue-400">Messages</h3>
                                    <span class="category-badge category-messages" id="messagesCount">3</span>
                                </div>
                                <button class="text-xs neuro-glass text-blue-400 rounded-2xl px-3 py-1 hover:bg-blue-900/30 transition mark-category-read" data-category="messages">
                                    <i class="fas fa-check mr-1"></i> Mark all as read
                                </button>
                            </div>
                            <div class="space-y-3 md:space-y-4" id="messagesNotifications">
                                <!-- Message notifications will be loaded here -->
                            </div>
                        </div>

                        <!-- Games Category -->
                        <div class="notification-category" data-category="games">
                            <div class="flex items-center justify-between mb-4 category-header">
                                <div class="flex items-center space-x-3">
                                    <div class="w-3 h-3 bg-purple-500 rounded-full neural-pulse"></div>
                                    <h3 class="text-base md:text-lg font-semibold text-purple-400">Games</h3>
                                    <span class="category-badge category-games" id="gamesCount">2</span>
                                </div>
                                <button class="text-xs neuro-glass text-purple-400 rounded-2xl px-3 py-1 hover:bg-purple-900/30 transition mark-category-read" data-category="games">
                                    <i class="fas fa-check mr-1"></i> Mark all as read
                                </button>
                            </div>
                            <div class="space-y-3 md:space-y-4" id="gamesNotifications">
                                <!-- Game notifications will be loaded here -->
                            </div>
                        </div>

                        <!-- Marketplace Category -->
                        <div class="notification-category" data-category="marketplace">
                            <div class="flex items-center justify-between mb-4 category-header">
                                <div class="flex items-center space-x-3">
                                    <div class="w-3 h-3 bg-green-500 rounded-full neural-pulse"></div>
                                    <h3 class="text-base md:text-lg font-semibold text-green-400">Marketplace</h3>
                                    <span class="category-badge category-marketplace" id="marketplaceCount">2</span>
                                </div>
                                <button class="text-xs neuro-glass text-green-400 rounded-2xl px-3 py-1 hover:bg-green-900/30 transition mark-category-read" data-category="marketplace">
                                    <i class="fas fa-check mr-1"></i> Mark all as read
                                </button>
                            </div>
                            <div class="space-y-3 md:space-y-4" id="marketplaceNotifications">
                                <!-- Marketplace notifications will be loaded here -->
                            </div>
                        </div>

                        <!-- System Category -->
                        <div class="notification-category" data-category="system">
                            <div class="flex items-center justify-between mb-4 category-header">
                                <div class="flex items-center space-x-3">
                                    <div class="w-3 h-3 bg-gray-500 rounded-full neural-pulse"></div>
                                    <h3 class="text-base md:text-lg font-semibold text-gray-400">System</h3>
                                    <span class="category-badge category-system" id="systemCount">5</span>
                                </div>
                                <button class="text-xs neuro-glass text-gray-400 rounded-2xl px-3 py-1 hover:bg-gray-900/30 transition mark-category-read" data-category="system">
                                    <i class="fas fa-check mr-1"></i> Mark all as read
                                </button>
                            </div>
                            <div class="space-y-3 md:space-y-4" id="systemNotifications">
                                <!-- System notifications will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Empty State -->
                    <div id="emptyState" class="hidden text-center py-8 md:py-12">
                        <div class="w-16 h-16 md:w-24 md:h-24 neuro-glass rounded-2xl mx-auto mb-4 flex items-center justify-center">
                            <i class="fas fa-bell-slash text-2xl md:text-3xl text-purple-400"></i>
                        </div>
                        <h3 class="text-lg md:text-xl font-semibold text-cyan-400 mb-2">No Notifications</h3>
                        <p class="text-purple-300 max-w-md mx-auto text-sm md:text-base">Your neural stream is quiet. New alerts will appear here as they're detected.</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Mobile Navigation Menu -->
    <div id="mobileNavMenu" class="fixed inset-0 bg-black bg-opacity-80 z-50 hidden lg:hidden">
        <div class="flex flex-col h-full neuro-glass max-w-xs w-full">
            <div class="p-4 border-b border-purple-800">
                <div class="flex items-center justify-between">
                    <a href="integration.html" class="flex items-center space-x-3">
                        <div class="w-10 h-10 cyber-gradient rounded-2xl flex items-center justify-center">
                            <i class="fas fa-brain text-white"></i>
                        </div>
                        <span class="text-xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400">
                            ConnectSphere
                        </span>
                    </a>
                    <button id="closeMobileMenuBtn" class="text-purple-400 hover:text-cyan-400">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <nav class="flex-1 p-4 space-y-2">
                <a href="home.html" class="flex items-center space-x-3 p-3 rounded-xl text-purple-300 hover:bg-purple-900/30 hover:text-cyan-400 transition">
                    <i class="fas fa-home w-6"></i>
                    <span>Neural Feed</span>
                </a>
                <a href="chat.html" class="flex items-center space-x-3 p-3 rounded-xl text-purple-300 hover:bg-purple-900/30 hover:text-cyan-400 transition">
                    <i class="fas fa-comment-dots w-6"></i>
                    <span>Quantum Chat</span>
                </a>
                <a href="notifications.html" class="flex items-center space-x-3 p-3 rounded-xl bg-cyan-900/30 text-cyan-400 border border-cyan-500/50">
                    <i class="fas fa-bell w-6"></i>
                    <span>Neural Alerts</span>
                    <span id="mobileNotificationBadge" class="bg-cyan-500 text-white text-xs px-2 py-1 rounded-full neural-pulse">5</span>
                </a>
                <a href="profile.html" class="flex items-center space-x-3 p-3 rounded-xl text-purple-300 hover:bg-purple-900/30 hover:text-cyan-400 transition">
                    <i class="fas fa-user-astronaut w-6"></i>
                    <span>Neural Profile</span>
                </a>
            </nav>
        </div>
    </div>

    <!-- Enhanced Notification Settings Modal -->
    <div id="settingsModal" class="modal-overlay hidden">
        <div class="modal-content fade-in">
            <div class="flex justify-between items-center mb-4 md:mb-6">
                <h3 class="text-lg md:text-xl font-bold text-cyan-400">Notification Settings</h3>
                <button id="closeSettingsBtn" class="text-purple-400 hover:text-cyan-400">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="space-y-4 md:space-y-6">
                <!-- Push Notification Preferences -->
                <div>
                    <h4 class="text-base md:text-lg font-semibold text-purple-300 mb-3">Push Notifications</h4>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <div>
                                <span class="text-gray-300 font-medium text-sm md:text-base">Enable Push Notifications</span>
                                <p class="text-xs md:text-sm text-gray-400">Receive notifications even when app is closed</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" id="pushNotificationsToggle" checked>
                                <div class="w-11 h-6 bg-purple-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-600"></div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Notification Categories -->
                <div>
                    <h4 class="text-base md:text-lg font-semibold text-purple-300 mb-3">Notification Categories</h4>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <div>
                                <span class="text-gray-300 text-sm md:text-base">Messages</span>
                                <p class="text-xs md:text-sm text-gray-400">New messages, replies, mentions</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-category="messages" checked>
                                <div class="w-11 h-6 bg-purple-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-600"></div>
                            </label>
                        </div>
                        <div class="flex items-center justify-between">
                            <div>
                                <span class="text-gray-300 text-sm md:text-base">Games</span>
                                <p class="text-xs md:text-sm text-gray-400">Game invites, achievements, updates</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-category="games" checked>
                                <div class="w-11 h-6 bg-purple-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-600"></div>
                            </label>
                        </div>
                        <div class="flex items-center justify-between">
                            <div>
                                <span class="text-gray-300 text-sm md:text-base">Marketplace</span>
                                <p class="text-xs md:text-sm text-gray-400">Sales, purchases, listings</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-category="marketplace" checked>
                                <div class="w-11 h-6 bg-purple-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-600"></div>
                            </label>
                        </div>
                        <div class="flex items-center justify-between">
                            <div>
                                <span class="text-gray-300 text-sm md:text-base">System</span>
                                <p class="text-xs md:text-sm text-gray-400">Updates, maintenance, security</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-category="system" checked>
                                <div class="w-11 h-6 bg-purple-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-600"></div>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Notification Sound -->
                <div>
                    <h4 class="text-base md:text-lg font-semibold text-purple-300 mb-3">Notification Sound</h4>
                    <div class="flex space-x-3 md:space-x-4 mobile-stack">
                        <button class="flex-1 neuro-glass text-cyan-400 rounded-2xl p-3 border border-cyan-500/50 hover:bg-cyan-900/30 transition text-center sound-option active" data-sound="quantum">
                            <i class="fas fa-volume-up text-lg md:text-xl mb-2"></i>
                            <div class="text-sm md:text-base">Quantum Pulse</div>
                        </button>
                        <button class="flex-1 neuro-glass text-purple-400 rounded-2xl p-3 border border-purple-700 hover:bg-purple-900/30 transition text-center sound-option" data-sound="neural">
                            <i class="fas fa-wave-square text-lg md:text-xl mb-2"></i>
                            <div class="text-sm md:text-base">Neural Wave</div>
                        </button>
                    </div>
                </div>

                <!-- Real-time Settings -->
                <div>
                    <h4 class="text-base md:text-lg font-semibold text-purple-300 mb-3">Real-time Updates</h4>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <div>
                                <span class="text-gray-300 text-sm md:text-base">Live Updates</span>
                                <p class="text-xs md:text-sm text-gray-400">Receive notifications in real-time</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" id="realtimeUpdatesToggle" checked>
                                <div class="w-11 h-6 bg-purple-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-600"></div>
                            </label>
                        </div>
                        <div class="flex items-center justify-between">
                            <div>
                                <span class="text-gray-300 text-sm md:text-base">Desktop Notifications</span>
                                <p class="text-xs md:text-sm text-gray-400">Show notifications on your desktop</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" id="desktopNotificationsToggle">
                                <div class="w-11 h-6 bg-purple-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-600"></div>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 pt-4">
                    <button id="cancelSettingsBtn" class="px-4 py-2 neuro-glass text-purple-300 rounded-2xl hover:bg-purple-900/30 border border-purple-700 transition text-sm md:text-base">
                        Cancel
                    </button>
                    <button id="saveSettingsBtn" class="px-4 py-2 cyber-gradient text-white rounded-2xl hover:scale-105 font-medium transition text-sm md:text-base">
                        Save Settings
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Detail Modal -->
    <div id="notificationDetailModal" class="modal-overlay hidden">
        <div class="modal-content fade-in" style="max-width: 700px;">
            <div class="flex justify-between items-center mb-4 md:mb-6">
                <h3 class="text-lg md:text-xl font-bold text-cyan-400" id="detailTitle">Notification Details</h3>
                <button id="closeDetailBtn" class="text-purple-400 hover:text-cyan-400">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="space-y-4 md:space-y-6">
                <!-- Notification Header -->
                <div class="neuro-glass rounded-2xl p-3 md:p-4 border border-purple-700">
                    <div class="flex items-start space-x-3 md:space-x-4">
                        <div id="detailAvatar" class="w-12 h-12 md:w-16 md:h-16 rounded-2xl flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-user text-white text-lg md:text-xl"></i>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-start justify-between">
                                <div>
                                    <h4 id="detailUser" class="text-base md:text-lg font-bold text-cyan-400">User Name</h4>
                                    <p id="detailTime" class="text-xs md:text-sm text-purple-400">Time</p>
                                </div>
                                <div id="detailCategory" class="text-xs px-2 py-1 rounded-full">Category</div>
                            </div>
                            <p id="detailContent" class="text-gray-300 mt-2 text-sm md:text-base">Notification content</p>
                        </div>
                    </div>
                </div>

                <!-- Detailed Content -->
                <div id="detailContentArea" class="neuro-glass rounded-2xl p-3 md:p-4 border border-purple-700">
                    <h4 class="text-base md:text-lg font-semibold text-purple-300 mb-3">Details</h4>
                    <div id="detailedContent" class="notification-detail-content">
                        <!-- Detailed content will be loaded here -->
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex justify-between pt-4 mobile-stack mobile-space-y">
                    <div class="flex space-x-2 md:space-x-3 notification-actions">
                        <button id="markDetailReadBtn" class="px-3 md:px-4 py-2 neuro-glass text-purple-300 rounded-2xl hover:bg-purple-900/30 border border-purple-700 transition text-xs md:text-sm notification-action-btn">
                            <i class="fas fa-envelope-open mr-1 md:mr-2"></i>Mark as Read
                        </button>
                        <button id="archiveDetailBtn" class="px-3 md:px-4 py-2 neuro-glass text-green-400 rounded-2xl hover:bg-green-900/30 border border-green-500/50 transition text-xs md:text-sm notification-action-btn">
                            <i class="fas fa-archive mr-1 md:mr-2"></i>Archive
                        </button>
                    </div>
                    <div class="flex space-x-2 md:space-x-3 notification-actions">
                        <button id="closeDetailActionBtn" class="px-3 md:px-4 py-2 neuro-glass text-gray-300 rounded-2xl hover:bg-gray-900/30 border border-gray-700 transition text-xs md:text-sm notification-action-btn">
                            Close
                        </button>
                        <button id="respondDetailBtn" class="px-3 md:px-4 py-2 cyber-gradient text-white rounded-2xl hover:scale-105 font-medium transition text-xs md:text-sm notification-action-btn">
                            <i class="fas fa-reply mr-1 md:mr-2"></i>Respond
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions Panel -->
    <div id="quickActionsPanel" class="fixed bottom-4 md:bottom-6 right-4 md:right-6 flex flex-col space-y-2 md:space-y-3 z-50 quick-actions-panel">
        <button id="quickReplyBtn" class="w-10 h-10 md:w-12 md:h-12 neuro-glass text-cyan-400 rounded-2xl border border-cyan-500/50 hover:bg-cyan-900/30 transition flex items-center justify-center quick-action-btn">
            <i class="fas fa-reply text-sm md:text-base"></i>
        </button>
        <button id="snoozeBtn" class="w-10 h-10 md:w-12 md:h-12 neuro-glass text-purple-400 rounded-2xl border border-purple-700 hover:bg-purple-900/30 transition flex items-center justify-center quick-action-btn">
            <i class="fas fa-clock text-sm md:text-base"></i>
        </button>
        <button id="archiveBtn" class="w-10 h-10 md:w-12 md:h-12 neuro-glass text-green-400 rounded-2xl border border-green-500/50 hover:bg-green-900/30 transition flex items-center justify-center quick-action-btn">
            <i class="fas fa-archive text-sm md:text-base"></i>
        </button>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDHHyGgsSV18BcXrGgzi4C8frzDAE1C1zo",
            authDomain: "uniconnect-ee95c.firebaseapp.com",
            projectId: "uniconnect-ee95c",
            storageBucket: "uniconnect-ee95c.firebasestorage.app",
            messagingSenderId: "1003264444309",
            appId: "1:1003264444309:web:9f0307516e44d21e97d89c"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        const auth = firebase.auth();
        const db = firebase.firestore();

        // Enhanced neural alerts data with detailed content
        const neuralAlerts = {
            messages: [
                {
                    id: 1,
                    type: 'message',
                    user: 'Dr. Quantum',
                    avatar: 'bg-gradient-to-r from-cyan-500 to-blue-500',
                    content: 'sent you a message: "Your research on quantum entanglement is fascinating!"',
                    time: 'Just now',
                    read: false,
                    priority: 'high',
                    category: 'messages',
                    actions: ['view', 'reply', 'dismiss'],
                    detailedContent: `
                        <div class="space-y-4">
                            <div class="message-bubble other">
                                <div class="font-semibold text-cyan-400">Dr. Quantum</div>
                                <div class="mt-2">Hey there! I just read your latest paper on quantum entanglement and it's absolutely fascinating. The way you approach the superposition principle is revolutionary!</div>
                                <div class="text-xs text-purple-400 mt-2">2 minutes ago</div>
                            </div>
                            <div class="text-center text-purple-400 text-sm">
                                <i class="fas fa-arrow-down"></i>
                                <span class="ml-2">Your response will appear here</span>
                            </div>
                        </div>
                    `
                },
                {
                    id: 2,
                    type: 'mention',
                    user: 'AI_Explorer',
                    avatar: 'bg-gradient-to-r from-purple-500 to-pink-500',
                    content: 'mentioned you in a discussion about neural networks',
                    time: '5 min ago',
                    read: false,
                    priority: 'medium',
                    category: 'messages',
                    actions: ['view', 'reply', 'dismiss'],
                    detailedContent: `
                        <div class="space-y-4">
                            <div class="p-4 neuro-glass rounded-2xl border border-purple-700">
                                <h5 class="font-semibold text-cyan-400 mb-2">Discussion: Advanced Neural Networks</h5>
                                <p class="text-gray-300">AI_Explorer mentioned you in a conversation about quantum-enhanced neural networks:</p>
                                <div class="mt-3 p-3 bg-purple-900/20 rounded-xl">
                                    <p>"I think @YourName's approach to quantum neural interfaces could revolutionize how we think about AI consciousness. The potential applications are enormous!"</p>
                                </div>
                                <div class="flex space-x-2 mt-3">
                                    <span class="text-xs neuro-glass text-cyan-400 rounded-xl px-2 py-1">#NeuralNetworks</span>
                                    <span class="text-xs neuro-glass text-purple-400 rounded-xl px-2 py-1">#QuantumAI</span>
                                </div>
                            </div>
                        </div>
                    `
                }
            ],
            games: [
                {
                    id: 3,
                    type: 'game_invite',
                    user: 'Cyber_Nova',
                    avatar: 'bg-gradient-to-r from-yellow-500 to-orange-500',
                    content: 'invited you to play Quantum Chess',
                    time: '2 hours ago',
                    read: false,
                    priority: 'medium',
                    category: 'games',
                    actions: ['view', 'accept', 'decline'],
                    detailedContent: `
                        <div class="space-y-4">
                            <div class="text-center">
                                <div class="w-16 h-16 md:w-20 md:h-20 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-2xl mx-auto mb-4 flex items-center justify-center">
                                    <i class="fas fa-chess-queen text-white text-xl md:text-2xl"></i>
                                </div>
                                <h4 class="text-lg md:text-xl font-bold text-cyan-400">Quantum Chess Invitation</h4>
                                <p class="text-purple-300 mt-2 text-sm md:text-base">Cyber_Nova challenges you to a game of Quantum Chess</p>
                            </div>
                            <div class="grid grid-cols-2 gap-3 md:gap-4 mt-4 md:mt-6">
                                <div class="text-center p-2 md:p-3 neuro-glass rounded-xl">
                                    <div class="text-base md:text-lg font-bold text-cyan-400">1,240</div>
                                    <div class="text-xs md:text-sm text-purple-400">Cyber_Nova's Rating</div>
                                </div>
                                <div class="text-center p-2 md:p-3 neuro-glass rounded-xl">
                                    <div class="text-base md:text-lg font-bold text-green-400">1,150</div>
                                    <div class="text-xs md:text-sm text-purple-400">Your Rating</div>
                                </div>
                            </div>
                            <div class="mt-3 md:mt-4 p-2 md:p-3 neuro-glass rounded-xl">
                                <h5 class="font-semibold text-purple-300 mb-2 text-sm md:text-base">Game Settings</h5>
                                <ul class="text-xs md:text-sm text-gray-300 space-y-1">
                                    <li>• Time Control: 10 minutes + 5 seconds</li>
                                    <li>• Variant: Standard Quantum Rules</li>
                                    <li>• Rated: Yes</li>
                                </ul>
                            </div>
                        </div>
                    `
                }
            ],
            marketplace: [
                {
                    id: 4,
                    type: 'sale',
                    user: 'Marketplace',
                    avatar: 'bg-gradient-to-r from-blue-500 to-cyan-500',
                    content: 'Your quantum processor listing has a new offer',
                    time: '3 hours ago',
                    read: false,
                    priority: 'high',
                    category: 'marketplace',
                    actions: ['view', 'respond', 'dismiss'],
                    detailedContent: `
                        <div class="space-y-4">
                            <div class="flex items-center space-x-3 md:space-x-4">
                                <div class="w-12 h-12 md:w-16 md:h-16 neuro-glass rounded-xl flex items-center justify-center">
                                    <i class="fas fa-microchip text-cyan-400 text-lg md:text-2xl"></i>
                                </div>
                                <div class="flex-1">
                                    <h4 class="text-base md:text-lg font-bold text-cyan-400">Quantum Processor QP-9000</h4>
                                    <p class="text-purple-300 text-sm md:text-base">Listed: $2,450</p>
                                </div>
                            </div>
                            <div class="p-3 md:p-4 neuro-glass rounded-2xl border border-green-500/50">
                                <h5 class="font-semibold text-green-400 mb-2 text-sm md:text-base">New Offer Received</h5>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-xl md:text-2xl font-bold text-white">$2,200</p>
                                        <p class="text-xs md:text-sm text-purple-400">from Quantum_Collector</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-xs md:text-sm text-gray-300">10% below asking</p>
                                        <p class="text-xs text-purple-400">Expires in 24 hours</p>
                                    </div>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-2 md:gap-3">
                                <button class="p-2 md:p-3 neuro-glass text-green-400 rounded-xl border border-green-500/50 hover:bg-green-900/30 transition text-xs md:text-sm">
                                    <i class="fas fa-check mr-1 md:mr-2"></i>Accept
                                </button>
                                <button class="p-2 md:p-3 neuro-glass text-purple-400 rounded-xl border border-purple-700 hover:bg-purple-900/30 transition text-xs md:text-sm">
                                    <i class="fas fa-times mr-1 md:mr-2"></i>Decline
                                </button>
                            </div>
                        </div>
                    `
                }
            ],
            system: [
                {
                    id: 5,
                    type: 'security',
                    user: 'Security System',
                    avatar: 'bg-gradient-to-r from-red-500 to-orange-500',
                    content: 'New login detected from unknown device',
                    time: '2 days ago',
                    read: true,
                    priority: 'critical',
                    category: 'system',
                    actions: ['view', 'secure', 'dismiss'],
                    detailedContent: `
                        <div class="space-y-4">
                            <div class="p-3 md:p-4 neuro-glass rounded-2xl border border-red-500/50">
                                <div class="flex items-center space-x-2 md:space-x-3">
                                    <i class="fas fa-shield-alt text-red-400 text-lg md:text-2xl"></i>
                                    <div>
                                        <h4 class="text-base md:text-lg font-bold text-red-400">Security Alert</h4>
                                        <p class="text-xs md:text-sm text-purple-300">Unusual login activity detected</p>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-2 md:space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-300 text-sm md:text-base">Location:</span>
                                    <span class="text-cyan-400 text-sm md:text-base">Tokyo, Japan</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-300 text-sm md:text-base">Device:</span>
                                    <span class="text-cyan-400 text-sm md:text-base">Unknown Browser</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-300 text-sm md:text-base">Time:</span>
                                    <span class="text-cyan-400 text-sm md:text-base">2024-01-15 08:23:45 UTC</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-300 text-sm md:text-base">Status:</span>
                                    <span class="text-yellow-400 text-sm md:text-base">Requires Verification</span>
                                </div>
                            </div>
                            <div class="mt-3 md:mt-4 p-2 md:p-3 neuro-glass rounded-xl">
                                <h5 class="font-semibold text-purple-300 mb-2 text-sm md:text-base">Recommended Actions</h5>
                                <ul class="text-xs md:text-sm text-gray-300 space-y-1 md:space-y-2">
                                    <li>• Verify if this was you</li>
                                    <li>• Change your password if suspicious</li>
                                    <li>• Enable two-factor authentication</li>
                                    <li>• Review recent account activity</li>
                                </ul>
                            </div>
                        </div>
                    `
                }
            ]
        };

        // Current state
        let currentTab = 'all';
        let currentFilter = 'all';
        let isStreamPaused = false;
        let realtimeConnection = true;
        let currentDetailNotification = null;
        let notificationSettings = {
            pushEnabled: true,
            categories: {
                messages: true,
                games: true,
                marketplace: true,
                system: true
            },
            sound: 'quantum',
            realtime: true,
            desktop: false
        };

        // Firebase Notifications Application
        class NotificationsApplication {
            constructor() {
                this.currentUser = null;
                this.isConnected = false;
                this.userSettings = {};
                this.realtimeUnsubscribe = null;
            }

            async initialize() {
                try {
                    console.log("🚀 Initializing Notifications Application...");
                    await this.initializeFirebase();
                    this.setupEventListeners();
                    await this.loadUserSettings();
                    await this.loadNotificationsFromFirebase();
                    this.showToast("Notifications loaded successfully!", "success");
                } catch (error) {
                    console.error('❌ Initialization failed:', error);
                    this.updateConnectionStatus('disconnected');
                    this.showToast("Failed to load notifications. Please refresh the page.", "error");
                }
            }

            async initializeFirebase() {
                this.updateConnectionStatus('connecting');
                
                return new Promise((resolve, reject) => {
                    const unsubscribe = auth.onAuthStateChanged(async (user) => {
                        if (user) {
                            this.currentUser = user;
                            console.log("✅ User authenticated:", user.uid);
                            
                            try {
                                // Load user settings
                                await this.loadUserSettings();
                                this.updateConnectionStatus('connected');
                                resolve();
                            } catch (error) {
                                console.error("❌ Error loading user settings:", error);
                                reject(error);
                            }
                        } else {
                            console.log("❌ User not authenticated, redirecting to login...");
                            window.location.href = 'index.html';
                            reject(new Error('User not authenticated'));
                        }
                    }, (error) => {
                        console.error("❌ Auth state change error:", error);
                        reject(error);
                    });
                });
            }

            async loadUserSettings() {
                try {
                    const userDoc = await db.collection('users').doc(this.currentUser.uid).get();
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        if (userData.settings) {
                            this.userSettings = userData.settings;
                            // Apply settings to notification settings
                            if (this.userSettings.pushNotifications !== undefined) {
                                notificationSettings.pushEnabled = this.userSettings.pushNotifications;
                            }
                            if (this.userSettings.messageNotifications !== undefined) {
                                notificationSettings.categories.messages = this.userSettings.messageNotifications;
                            }
                            // Apply other settings as needed
                        }
                    }
                } catch (error) {
                    console.error('❌ Error loading user settings:', error);
                }
            }

            async loadNotificationsFromFirebase() {
                try {
                    console.log("📥 Loading notifications from Firestore...");
                    
                    // In a real app, you would load actual notifications from Firestore
                    // For now, we'll use the static data but mark it as loaded from Firebase
                    
                    this.setupRealtimeNotifications();
                    renderNotifications();
                    
                } catch (error) {
                    console.error('❌ Error loading notifications:', error);
                    throw error;
                }
            }

            setupRealtimeNotifications() {
                // Set up real-time listener for new notifications
                if (this.realtimeUnsubscribe) {
                    this.realtimeUnsubscribe();
                }

                this.realtimeUnsubscribe = db.collection('notifications')
                    .where('userId', '==', this.currentUser.uid)
                    .where('read', '==', false)
                    .orderBy('timestamp', 'desc')
                    .limit(50)
                    .onSnapshot(snapshot => {
                        snapshot.docChanges().forEach(change => {
                            if (change.type === 'added') {
                                const notification = change.doc.data();
                                console.log('🔔 New real-time notification:', notification);
                                this.handleNewNotification(notification);
                            }
                        });
                    }, error => {
                        console.error('❌ Error in real-time notifications:', error);
                    });
            }

            handleNewNotification(notification) {
                // Convert Firebase notification to our format
                const newAlert = {
                    id: notification.id || Date.now(),
                    type: notification.type || 'system',
                    user: notification.senderName || 'System',
                    avatar: this.getAvatarForType(notification.type),
                    content: notification.message || 'New notification',
                    time: 'Just now',
                    read: notification.read || false,
                    priority: notification.priority || 'medium',
                    category: notification.category || 'system',
                    actions: ['view', 'dismiss'],
                    detailedContent: notification.details || '<p class="text-gray-400">No additional details available.</p>'
                };

                // Add to appropriate category
                const category = notification.category || 'system';
                if (neuralAlerts[category]) {
                    neuralAlerts[category].unshift(newAlert);
                    renderNotifications();
                    
                    // Show toast notification
                    this.showToast(`New ${category} notification received`);
                    
                    // Show desktop notification if enabled
                    if (notificationSettings.desktop && 'Notification' in window && Notification.permission === 'granted') {
                        new Notification(`New ${category} notification`, {
                            body: newAlert.content,
                            icon: '/favicon.ico'
                        });
                    }
                }
            }

            getAvatarForType(type) {
                const avatars = {
                    'message': 'bg-gradient-to-r from-cyan-500 to-blue-500',
                    'game_invite': 'bg-gradient-to-r from-yellow-500 to-orange-500',
                    'sale': 'bg-gradient-to-r from-blue-500 to-cyan-500',
                    'security': 'bg-gradient-to-r from-red-500 to-orange-500'
                };
                return avatars[type] || 'bg-gradient-to-r from-gray-500 to-blue-500';
            }

            async markNotificationAsRead(notificationId) {
                try {
                    await db.collection('notifications').doc(notificationId.toString()).update({
                        read: true,
                        readAt: new Date()
                    });
                } catch (error) {
                    console.error('❌ Error marking notification as read:', error);
                }
            }

            async deleteNotification(notificationId) {
                try {
                    await db.collection('notifications').doc(notificationId.toString()).delete();
                } catch (error) {
                    console.error('❌ Error deleting notification:', error);
                }
            }

            updateConnectionStatus(status) {
                const statusElement = document.getElementById('connectionStatus');
                
                statusElement.className = `connection-status ${status}`;
                
                switch(status) {
                    case 'connected':
                        statusElement.innerHTML = '<i class="fas fa-wifi mr-2"></i><span id="connectionText">Connected to Firebase</span>';
                        break;
                    case 'connecting':
                        statusElement.innerHTML = '<i class="fas fa-circle-notch fa-spin mr-2"></i><span id="connectionText">Connecting to Firebase...</span>';
                        break;
                    case 'disconnected':
                        statusElement.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i><span id="connectionText">Disconnected from Firebase</span>';
                        break;
                }
            }

            showToast(message, type = 'info') {
                const toast = document.createElement('div');
                const bgColor = type === 'success' ? 'border-green-500/50' : 
                               type === 'error' ? 'border-red-500/50' : 
                               'border-cyan-500/50';
                const icon = type === 'success' ? 'fa-check-circle text-green-400' : 
                            type === 'error' ? 'fa-exclamation-circle text-red-400' : 
                            'fa-info-circle text-cyan-400';
                
                toast.className = `neuro-glass rounded-2xl p-3 md:p-4 mb-2 border ${bgColor} slide-in-right`;
                toast.innerHTML = `
                    <div class="flex items-center space-x-2 md:space-x-3">
                        <i class="fas ${icon}"></i>
                        <span class="text-gray-200 text-sm md:text-base">${message}</span>
                        <button class="ml-auto text-purple-400 hover:text-cyan-400" onclick="this.parentElement.parentElement.remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                
                let toastContainer = document.querySelector('.toast');
                if (!toastContainer) {
                    toastContainer = document.createElement('div');
                    toastContainer.className = 'toast';
                    document.body.appendChild(toastContainer);
                }
                
                toastContainer.appendChild(toast);
                
                setTimeout(() => {
                    if (toast.parentElement) {
                        toast.remove();
                    }
                }, 5000);
            }

            setupEventListeners() {
                console.log("🔧 Setting up event listeners...");
                
                // Listen for settings changes from other pages
                if (window.settingsApp) {
                    window.settingsApp.addSettingsListener((settings) => {
                        console.log("🎯 Settings updated in notifications:", settings);
                        this.userSettings = settings;
                        // Apply relevant settings to notification system
                        if (settings.pushNotifications !== undefined) {
                            notificationSettings.pushEnabled = settings.pushNotifications;
                        }
                    });
                }
            }

            cleanup() {
                if (this.realtimeUnsubscribe) {
                    this.realtimeUnsubscribe();
                }
            }
        }

        // Utility functions
        function getCategoryIcon(category) {
            const icons = {
                messages: 'fas fa-comments text-blue-400',
                games: 'fas fa-gamepad text-purple-400',
                marketplace: 'fas fa-shopping-cart text-green-400',
                system: 'fas fa-cog text-gray-400'
            };
            return icons[category] || 'fas fa-bell text-gray-400';
        }

        function getCategoryStyle(category) {
            const styles = {
                messages: 'notification-category-messages',
                games: 'notification-category-games',
                marketplace: 'notification-category-marketplace',
                system: 'notification-category-system'
            };
            return styles[category] || '';
        }

        function getCategoryBadge(category) {
            const badges = {
                messages: 'category-messages',
                games: 'category-games',
                marketplace: 'category-marketplace',
                system: 'category-system'
            };
            return badges[category] || 'category-system';
        }

        function showToast(message, type = 'info') {
            // Use the instance method if available, otherwise fall back to static function
            if (window.notificationsApp && window.notificationsApp.showToast) {
                window.notificationsApp.showToast(message, type);
            } else {
                // Fallback implementation
                const toast = document.createElement('div');
                const bgColor = type === 'success' ? 'border-green-500/50' : 
                               type === 'error' ? 'border-red-500/50' : 
                               'border-cyan-500/50';
                const icon = type === 'success' ? 'fa-check-circle text-green-400' : 
                            type === 'error' ? 'fa-exclamation-circle text-red-400' : 
                            'fa-info-circle text-cyan-400';
                
                toast.className = `neuro-glass rounded-2xl p-3 md:p-4 mb-2 border ${bgColor} slide-in-right`;
                toast.innerHTML = `
                    <div class="flex items-center space-x-2 md:space-x-3">
                        <i class="fas ${icon}"></i>
                        <span class="text-gray-200 text-sm md:text-base">${message}</span>
                        <button class="ml-auto text-purple-400 hover:text-cyan-400" onclick="this.parentElement.parentElement.remove()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                
                let toastContainer = document.querySelector('.toast');
                if (!toastContainer) {
                    toastContainer = document.createElement('div');
                    toastContainer.className = 'toast';
                    document.body.appendChild(toastContainer);
                }
                
                toastContainer.appendChild(toast);
                
                setTimeout(() => {
                    if (toast.parentElement) {
                        toast.remove();
                    }
                }, 5000);
            }
        }

        function updateNotificationStats() {
            const allAlerts = getAllAlerts();
            const unreadCount = allAlerts.filter(alert => !alert.read).length;
            const todayCount = allAlerts.filter(alert => alert.time.includes('now') || alert.time.includes('min') || alert.time.includes('hour')).length;
            const priorityCount = allAlerts.filter(alert => alert.priority === 'high' || alert.priority === 'critical').length;

            document.getElementById('totalAlerts').textContent = allAlerts.length;
            document.getElementById('unreadAlerts').textContent = unreadCount;
            document.getElementById('todayAlerts').textContent = todayCount;
            document.getElementById('priorityAlerts').textContent = priorityCount;
            
            // Update notification badge
            const badge = document.getElementById('notificationBadge');
            const mobileBadge = document.getElementById('mobileNotificationBadge');
            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.classList.remove('hidden');
                mobileBadge.textContent = unreadCount;
                mobileBadge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
                mobileBadge.classList.add('hidden');
            }
        }

        function updateCategoryCounts() {
            const categories = ['messages', 'games', 'marketplace', 'system'];
            categories.forEach(category => {
                const count = neuralAlerts[category].filter(alert => !alert.read).length;
                document.getElementById(`${category}Count`).textContent = count;
            });
        }

        function getAllAlerts() {
            return [...neuralAlerts.messages, ...neuralAlerts.games, ...neuralAlerts.marketplace, ...neuralAlerts.system];
        }

        function renderNotifications() {
            const container = document.getElementById('notificationsContainer');
            const emptyState = document.getElementById('emptyState');
            
            // Clear all category containers
            document.getElementById('messagesNotifications').innerHTML = '';
            document.getElementById('gamesNotifications').innerHTML = '';
            document.getElementById('marketplaceNotifications').innerHTML = '';
            document.getElementById('systemNotifications').innerHTML = '';
            
            let hasVisibleNotifications = false;
            
            // Render notifications by category
            Object.keys(neuralAlerts).forEach(category => {
                const categoryAlerts = neuralAlerts[category];
                const categoryContainer = document.getElementById(`${category}Notifications`);
                
                categoryAlerts.forEach(alert => {
                    if (shouldShowAlert(alert)) {
                        hasVisibleNotifications = true;
                        const alertElement = createNotificationElement(alert);
                        categoryContainer.appendChild(alertElement);
                    }
                });
            });
            
            // Show/hide empty state
            if (hasVisibleNotifications) {
                container.classList.remove('hidden');
                emptyState.classList.add('hidden');
            } else {
                container.classList.add('hidden');
                emptyState.classList.remove('hidden');
            }
            
            updateNotificationStats();
            updateCategoryCounts();
        }

        function shouldShowAlert(alert) {
            // Check tab filter
            if (currentTab === 'unread' && alert.read) return false;
            if (currentTab !== 'all' && currentTab !== 'unread' && alert.category !== currentTab) return false;
            
            // Check type filter
            if (currentFilter !== 'all' && !alert.type.includes(currentFilter)) return false;
            
            return true;
        }

        function createNotificationElement(alert) {
            const div = document.createElement('div');
            div.className = `neuro-glass rounded-2xl p-3 md:p-4 border ${getCategoryStyle(alert.category)} ${alert.read ? 'border-purple-700' : 'notification-glow border-cyan-500/50'} fade-in cursor-pointer hover:scale-105 transition-transform duration-200`;
            div.setAttribute('data-notification-id', alert.id);
            div.innerHTML = `
                <div class="flex items-start space-x-2 md:space-x-3">
                    <div class="w-8 h-8 md:w-10 md:h-10 ${alert.avatar} rounded-xl flex items-center justify-center">
                        <i class="${getCategoryIcon(alert.category)} text-sm md:text-base"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-1 md:space-x-2">
                                <span class="font-semibold text-cyan-400 text-sm md:text-base">${alert.user}</span>
                                <span class="text-xs ${getCategoryBadge(alert.category)} rounded-full px-2 py-1">${alert.category}</span>
                                ${alert.priority === 'critical' ? '<span class="text-xs bg-red-500/20 text-red-400 rounded-full px-2 py-1">Critical</span>' : ''}
                                ${alert.priority === 'high' ? '<span class="text-xs bg-yellow-500/20 text-yellow-400 rounded-full px-2 py-1">High</span>' : ''}
                            </div>
                            <div class="flex items-center space-x-1 md:space-x-2">
                                <span class="text-xs text-purple-300">${alert.time}</span>
                                ${!alert.read ? '<div class="w-2 h-2 bg-cyan-400 rounded-full neural-pulse"></div>' : ''}
                            </div>
                        </div>
                        <p class="text-purple-200 mt-1 text-sm md:text-base">${alert.content}</p>
                        <div class="flex space-x-1 md:space-x-2 mt-2 md:mt-3 notification-actions">
                            ${alert.actions.map(action => `
                                <button class="action-btn text-xs neuro-glass text-purple-300 rounded-xl px-2 md:px-3 py-1 hover:bg-purple-900/30 hover:text-cyan-400 transition notification-action-btn" data-action="${action}" data-id="${alert.id}">
                                    <i class="fas fa-${getActionIcon(action)} mr-1"></i>${action.charAt(0).toUpperCase() + action.slice(1)}
                                </button>
                            `).join('')}
                            <button class="mark-read-btn text-xs neuro-glass text-purple-300 rounded-xl px-2 md:px-3 py-1 hover:bg-purple-900/30 hover:text-green-400 transition notification-action-btn" data-id="${alert.id}">
                                <i class="fas fa-${alert.read ? 'envelope' : 'envelope-open'} mr-1"></i>${alert.read ? 'Mark Unread' : 'Mark Read'}
                            </button>
                        </div>
                    </div>
                </div>
            `;
            return div;
        }

        function getActionIcon(action) {
            const icons = {
                view: 'eye',
                reply: 'reply',
                dismiss: 'times',
                accept: 'check',
                decline: 'times',
                respond: 'comment',
                secure: 'shield-alt'
            };
            return icons[action] || 'info-circle';
        }

        function openNotificationDetail(notificationId) {
            // Find the notification
            let notification = null;
            Object.keys(neuralAlerts).forEach(category => {
                const found = neuralAlerts[category].find(a => a.id === notificationId);
                if (found) notification = found;
            });
            
            if (!notification) return;
            
            currentDetailNotification = notification;
            
            // Update modal content
            document.getElementById('detailTitle').textContent = `${notification.type.charAt(0).toUpperCase() + notification.type.slice(1)} Details`;
            document.getElementById('detailUser').textContent = notification.user;
            document.getElementById('detailTime').textContent = notification.time;
            document.getElementById('detailContent').textContent = notification.content;
            
            // Update avatar
            const avatar = document.getElementById('detailAvatar');
            avatar.className = `w-12 h-12 md:w-16 md:h-16 ${notification.avatar} rounded-2xl flex items-center justify-center flex-shrink-0`;
            
            // Update category badge
            const categoryBadge = document.getElementById('detailCategory');
            categoryBadge.textContent = notification.category.toUpperCase();
            categoryBadge.className = `text-xs px-2 py-1 rounded-full ${getCategoryBadge(notification.category)}`;
            
            // Update detailed content
            const detailedContent = document.getElementById('detailedContent');
            detailedContent.innerHTML = notification.detailedContent || '<p class="text-gray-400">No additional details available.</p>';
            
            // Update mark as read button text
            const markReadBtn = document.getElementById('markDetailReadBtn');
            markReadBtn.innerHTML = `<i class="fas fa-${notification.read ? 'envelope' : 'envelope-open'} mr-1 md:mr-2"></i>${notification.read ? 'Mark Unread' : 'Mark Read'}`;
            
            // Show modal
            document.getElementById('notificationDetailModal').classList.remove('hidden');
            
            // Mark as read when viewing
            if (!notification.read) {
                notification.read = true;
                if (window.notificationsApp) {
                    window.notificationsApp.markNotificationAsRead(notification.id);
                }
                renderNotifications();
            }
        }

        function handleNotificationAction(notificationId, action) {
            // Find the notification
            let notification = null;
            let category = null;
            Object.keys(neuralAlerts).forEach(cat => {
                const found = neuralAlerts[cat].find(a => a.id === notificationId);
                if (found) {
                    notification = found;
                    category = cat;
                }
            });
            
            if (!notification) return;
            
            switch(action) {
                case 'view':
                    openNotificationDetail(notificationId);
                    break;
                    
                case 'reply':
                    openNotificationDetail(notificationId);
                    showToast('Reply interface activated', 'success');
                    break;
                    
                case 'accept':
                    if (category === 'games') {
                        showToast('Game invite accepted! Starting Quantum Chess...', 'success');
                        // Remove the notification
                        neuralAlerts[category] = neuralAlerts[category].filter(a => a.id !== notificationId);
                        if (window.notificationsApp) {
                            window.notificationsApp.deleteNotification(notificationId);
                        }
                    }
                    break;
                    
                case 'decline':
                    if (category === 'games') {
                        showToast('Game invite declined', 'info');
                        neuralAlerts[category] = neuralAlerts[category].filter(a => a.id !== notificationId);
                        if (window.notificationsApp) {
                            window.notificationsApp.deleteNotification(notificationId);
                        }
                    }
                    break;
                    
                case 'respond':
                    openNotificationDetail(notificationId);
                    showToast('Opening response interface...', 'info');
                    break;
                    
                case 'secure':
                    showToast('Security measures activated', 'success');
                    notification.read = true;
                    if (window.notificationsApp) {
                        window.notificationsApp.markNotificationAsRead(notificationId);
                    }
                    break;
                    
                case 'dismiss':
                    neuralAlerts[category] = neuralAlerts[category].filter(a => a.id !== notificationId);
                    if (window.notificationsApp) {
                        window.notificationsApp.deleteNotification(notificationId);
                    }
                    showToast('Notification dismissed', 'info');
                    break;
            }
            
            renderNotifications();
            
            // Close detail modal if it's open for this notification
            if (currentDetailNotification && currentDetailNotification.id === notificationId) {
                document.getElementById('notificationDetailModal').classList.add('hidden');
            }
        }

        // Real-time notification simulation
        function simulateRealTimeNotification() {
            if (isStreamPaused || !realtimeConnection) return;
            
            const categories = ['messages', 'games', 'marketplace', 'system'];
            const randomCategory = categories[Math.floor(Math.random() * categories.length)];
            
            // Only add notification if category is enabled
            if (!notificationSettings.categories[randomCategory]) return;
            
            const newNotification = {
                id: Date.now(),
                type: 'new_' + randomCategory,
                user: randomCategory === 'messages' ? 'Quantum_Friend' : 
                      randomCategory === 'games' ? 'Game_System' :
                      randomCategory === 'marketplace' ? 'Marketplace_AI' : 'System_AI',
                avatar: randomCategory === 'messages' ? 'bg-gradient-to-r from-blue-500 to-cyan-500' :
                       randomCategory === 'games' ? 'bg-gradient-to-r from-purple-500 to-pink-500' :
                       randomCategory === 'marketplace' ? 'bg-gradient-to-r from-green-500 to-emerald-500' : 
                       'bg-gradient-to-r from-gray-500 to-blue-500',
                content: randomCategory === 'messages' ? 'sent you a new message' :
                        randomCategory === 'games' ? 'New game achievement unlocked!' :
                        randomCategory === 'marketplace' ? 'New marketplace activity detected' : 
                        'System notification update',
                time: 'Just now',
                read: false,
                priority: ['low', 'medium', 'high'][Math.floor(Math.random() * 3)],
                category: randomCategory,
                actions: ['view', 'dismiss'],
                detailedContent: '<p class="text-gray-400">This is a simulated real-time notification. In a real application, this would contain actual content.</p>'
            };
            
            neuralAlerts[randomCategory].unshift(newNotification);
            
            // Show desktop notification if enabled
            if (notificationSettings.desktop && 'Notification' in window && Notification.permission === 'granted') {
                new Notification(`New ${randomCategory} notification`, {
                    body: newNotification.content,
                    icon: '/favicon.ico'
                });
            }
            
            renderNotifications();
            showToast(`New ${randomCategory} notification received`);
        }

        function updateRealtimeStatus(status) {
            const indicator = document.getElementById('realtimeIndicator');
            const statusText = document.getElementById('realtimeStatus');
            
            indicator.className = 'realtime-indicator';
            statusText.textContent = status;
            
            if (status === 'Connected') {
                indicator.classList.add('realtime-connected');
            } else if (status === 'Connecting...') {
                indicator.classList.add('realtime-connecting');
            } else {
                indicator.classList.add('realtime-disconnected');
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Firebase notifications app
            window.notificationsApp = new NotificationsApplication();
            window.notificationsApp.initialize().catch(error => {
                console.error("❌ Failed to initialize notifications application:", error);
            });
            
            // Start real-time simulation (for demo purposes)
            setInterval(simulateRealTimeNotification, 15000);
            
            // Mobile menu functionality
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const mobileNavMenu = document.getElementById('mobileNavMenu');
            const closeMobileMenuBtn = document.getElementById('closeMobileMenuBtn');
            
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', function() {
                    mobileNavMenu.classList.remove('hidden');
                });
            }
            
            if (closeMobileMenuBtn) {
                closeMobileMenuBtn.addEventListener('click', function() {
                    mobileNavMenu.classList.add('hidden');
                });
            }
            
            // Close mobile menu when clicking outside
            mobileNavMenu.addEventListener('click', function(e) {
                if (e.target === mobileNavMenu) {
                    mobileNavMenu.classList.add('hidden');
                }
            });
            
            // Tab switching
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.tab-btn').forEach(b => {
                        b.classList.remove('tab-active');
                        b.classList.add('text-purple-400', 'hover:text-cyan-400');
                    });
                    this.classList.add('tab-active');
                    this.classList.remove('text-purple-400', 'hover:text-cyan-400');
                    
                    currentTab = this.dataset.tab;
                    renderNotifications();
                });
            });
            
            // Filter switching
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => {
                        b.classList.remove('filter-active', 'border-cyan-500/50', 'text-cyan-400');
                        b.classList.add('text-purple-400');
                    });
                    this.classList.add('filter-active', 'border-cyan-500/50', 'text-cyan-400');
                    this.classList.remove('text-purple-400');
                    
                    currentFilter = this.dataset.filter;
                    renderNotifications();
                });
            });
            
            // Notification click to open details
            document.addEventListener('click', function(e) {
                const notificationElement = e.target.closest('[data-notification-id]');
                if (notificationElement && !e.target.closest('.action-btn') && !e.target.closest('.mark-read-btn')) {
                    const notificationId = parseInt(notificationElement.getAttribute('data-notification-id'));
                    openNotificationDetail(notificationId);
                }
            });
            
            // Mark as read/unread
            document.addEventListener('click', function(e) {
                if (e.target.closest('.mark-read-btn')) {
                    const btn = e.target.closest('.mark-read-btn');
                    const id = parseInt(btn.dataset.id);
                    
                    // Find and update the alert
                    Object.keys(neuralAlerts).forEach(category => {
                        const alert = neuralAlerts[category].find(a => a.id === id);
                        if (alert) {
                            alert.read = !alert.read;
                            if (window.notificationsApp) {
                                if (alert.read) {
                                    window.notificationsApp.markNotificationAsRead(id);
                                }
                            }
                        }
                    });
                    
                    renderNotifications();
                    showToast('Notification status updated');
                }
                
                // Mark category as read
                if (e.target.closest('.mark-category-read')) {
                    const btn = e.target.closest('.mark-category-read');
                    const category = btn.dataset.category;
                    
                    neuralAlerts[category].forEach(alert => {
                        alert.read = true;
                        if (window.notificationsApp) {
                            window.notificationsApp.markNotificationAsRead(alert.id);
                        }
                    });
                    
                    renderNotifications();
                    showToast(`All ${category} notifications marked as read`);
                }
            });
            
            // Action buttons
            document.addEventListener('click', function(e) {
                if (e.target.closest('.action-btn')) {
                    const btn = e.target.closest('.action-btn');
                    const action = btn.dataset.action;
                    const id = parseInt(btn.dataset.id);
                    handleNotificationAction(id, action);
                }
            });
            
            // Detail modal actions
            document.getElementById('markDetailReadBtn').addEventListener('click', function() {
                if (currentDetailNotification) {
                    currentDetailNotification.read = !currentDetailNotification.read;
                    if (window.notificationsApp) {
                        if (currentDetailNotification.read) {
                            window.notificationsApp.markNotificationAsRead(currentDetailNotification.id);
                        }
                    }
                    renderNotifications();
                    document.getElementById('notificationDetailModal').classList.add('hidden');
                    showToast('Notification status updated');
                }
            });
            
            document.getElementById('archiveDetailBtn').addEventListener('click', function() {
                if (currentDetailNotification) {
                    const category = currentDetailNotification.category;
                    neuralAlerts[category] = neuralAlerts[category].filter(a => a.id !== currentDetailNotification.id);
                    if (window.notificationsApp) {
                        window.notificationsApp.deleteNotification(currentDetailNotification.id);
                    }
                    renderNotifications();
                    document.getElementById('notificationDetailModal').classList.add('hidden');
                    showToast('Notification archived');
                }
            });
            
            document.getElementById('respondDetailBtn').addEventListener('click', function() {
                showToast('Response interface activated', 'success');
            });
            
            document.getElementById('closeDetailBtn').addEventListener('click', function() {
                document.getElementById('notificationDetailModal').classList.add('hidden');
            });
            
            document.getElementById('closeDetailActionBtn').addEventListener('click', function() {
                document.getElementById('notificationDetailModal').classList.add('hidden');
            });
            
            // Settings modal
            const settingsModal = document.getElementById('settingsModal');
            const openSettingsBtn = document.getElementById('notificationSettingsBtn');
            const closeSettingsBtn = document.getElementById('closeSettingsBtn');
            const cancelSettingsBtn = document.getElementById('cancelSettingsBtn');
            const saveSettingsBtn = document.getElementById('saveSettingsBtn');
            
            openSettingsBtn.addEventListener('click', function() {
                // Load current settings into modal
                document.getElementById('pushNotificationsToggle').checked = notificationSettings.pushEnabled;
                document.getElementById('realtimeUpdatesToggle').checked = notificationSettings.realtime;
                document.getElementById('desktopNotificationsToggle').checked = notificationSettings.desktop;
                
                // Set category toggles
                Object.keys(notificationSettings.categories).forEach(category => {
                    const toggle = document.querySelector(`input[data-category="${category}"]`);
                    if (toggle) {
                        toggle.checked = notificationSettings.categories[category];
                    }
                });
                
                // Set sound options
                document.querySelectorAll('.sound-option').forEach(option => {
                    option.classList.remove('active', 'border-cyan-500/50', 'bg-cyan-900/30');
                    if (option.dataset.sound === notificationSettings.sound) {
                        option.classList.add('active', 'border-cyan-500/50', 'bg-cyan-900/30');
                    }
                });
                
                settingsModal.classList.remove('hidden');
            });
            
            closeSettingsBtn.addEventListener('click', function() {
                settingsModal.classList.add('hidden');
            });
            
            cancelSettingsBtn.addEventListener('click', function() {
                settingsModal.classList.add('hidden');
            });
            
            saveSettingsBtn.addEventListener('click', function() {
                // Save settings
                notificationSettings.pushEnabled = document.getElementById('pushNotificationsToggle').checked;
                notificationSettings.realtime = document.getElementById('realtimeUpdatesToggle').checked;
                notificationSettings.desktop = document.getElementById('desktopNotificationsToggle').checked;
                
                // Save category settings
                Object.keys(notificationSettings.categories).forEach(category => {
                    const toggle = document.querySelector(`input[data-category="${category}"]`);
                    if (toggle) {
                        notificationSettings.categories[category] = toggle.checked;
                    }
                });
                
                // Save sound setting
                const activeSound = document.querySelector('.sound-option.active');
                if (activeSound) {
                    notificationSettings.sound = activeSound.dataset.sound;
                }
                
                // Update real-time connection based on settings
                realtimeConnection = notificationSettings.realtime;
                updateRealtimeStatus(realtimeConnection ? 'Connected' : 'Disabled');
                
                // Request desktop notification permission if enabled
                if (notificationSettings.desktop && 'Notification' in window && Notification.permission === 'default') {
                    Notification.requestPermission();
                }
                
                showToast('Notification settings saved successfully', 'success');
                settingsModal.classList.add('hidden');
            });
            
            // Sound option selection
            document.querySelectorAll('.sound-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.sound-option').forEach(opt => {
                        opt.classList.remove('active', 'border-cyan-500/50', 'bg-cyan-900/30');
                    });
                    this.classList.add('active', 'border-cyan-500/50', 'bg-cyan-900/30');
                });
            });
            
            // Mark all as read
            document.getElementById('markAllReadBtn').addEventListener('click', function() {
                Object.keys(neuralAlerts).forEach(category => {
                    neuralAlerts[category].forEach(alert => {
                        alert.read = true;
                        if (window.notificationsApp) {
                            window.notificationsApp.markNotificationAsRead(alert.id);
                        }
                    });
                });
                renderNotifications();
                showToast('All notifications marked as read', 'success');
            });
            
            // Clear all notifications
            document.getElementById('clearAllBtn').addEventListener('click', function() {
                if (confirm('Are you sure you want to clear all notifications?')) {
                    Object.keys(neuralAlerts).forEach(category => {
                        neuralAlerts[category].forEach(alert => {
                            if (window.notificationsApp) {
                                window.notificationsApp.deleteNotification(alert.id);
                            }
                        });
                        neuralAlerts[category] = [];
                    });
                    renderNotifications();
                    showToast('All notifications cleared', 'success');
                }
            });
            
            // Quick actions
            document.getElementById('quickReplyBtn').addEventListener('click', function() {
                showToast('Quick reply interface activated', 'info');
            });
            
            document.getElementById('snoozeBtn').addEventListener('click', function() {
                isStreamPaused = !isStreamPaused;
                showToast(isStreamPaused ? 'Notifications snoozed for 1 hour' : 'Notifications resumed', 'info');
                updateRealtimeStatus(isStreamPaused ? 'Snoozed' : 'Connected');
            });
            
            document.getElementById('archiveBtn').addEventListener('click', function() {
                // Archive read notifications
                let archivedCount = 0;
                Object.keys(neuralAlerts).forEach(category => {
                    neuralAlerts[category] = neuralAlerts[category].filter(alert => {
                        if (alert.read) {
                            archivedCount++;
                            if (window.notificationsApp) {
                                window.notificationsApp.deleteNotification(alert.id);
                            }
                            return false;
                        }
                        return true;
                    });
                });
                
                renderNotifications();
                showToast(`${archivedCount} read notifications archived`, 'success');
            });
            
            // Close modals when clicking outside
            window.addEventListener('click', function(e) {
                if (e.target === document.getElementById('settingsModal')) {
                    document.getElementById('settingsModal').classList.add('hidden');
                }
                if (e.target === document.getElementById('notificationDetailModal')) {
                    document.getElementById('notificationDetailModal').classList.add('hidden');
                }
            });

            // Cleanup on page unload
            window.addEventListener('beforeunload', function() {
                if (window.notificationsApp) {
                    window.notificationsApp.cleanup();
                }
            });
        });
    </script>
</body>
</html>