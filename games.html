[file name]: games.html
[file content begin]
<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Games Hub - ConnectSphere</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    
    <style>
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .primary-gradient {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }
        .premium-gradient {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        .game-gradient-1 { background: linear-gradient(135deg, #8b5cf6, #a855f7); }
        .game-gradient-2 { background: linear-gradient(135deg, #ec4899, #db2777); }
        .game-gradient-3 { background: linear-gradient(135deg, #10b981, #059669); }
        .game-gradient-4 { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        .game-gradient-5 { background: linear-gradient(135deg, #f97316, #ea580c); }
        
        .card-glow {
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.4);
        }
        
        /* Game-specific styles */
        .game-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        /* Chess Board */
        .chess-board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            width: 400px;
            height: 400px;
            border: 2px solid #374151;
        }
        .chess-square {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .chess-square.white {
            background: #f0d9b5;
        }
        .chess-square.black {
            background: #b58863;
        }
        .chess-square.selected {
            background: #bbcb2b;
        }
        .chess-square.valid-move {
            background: #86efac;
        }
        
        /* Word Puzzle */
        .word-puzzle-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }
        .word-cell {
            width: 50px;
            height: 50px;
            border: 2px solid #374151;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            text-transform: uppercase;
        }
        .word-cell.filled {
            background: #4b5563;
        }
        .word-cell.correct {
            background: #10b981;
            border-color: #059669;
        }
        .word-cell.partial {
            background: #f59e0b;
            border-color: #d97706;
        }
        .word-cell.incorrect {
            background: #6b7280;
            border-color: #4b5563;
        }
        
        /* Memory Game */
        .memory-card {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: transform 0.3s ease;
            transform-style: preserve-3d;
        }
        .memory-card.flipped {
            transform: rotateY(180deg);
            background: linear-gradient(135deg, #4fd1c7, #38b2ac);
        }
        .memory-card.matched {
            background: linear-gradient(135deg, #10b981, #059669);
            cursor: default;
        }
        
        /* Quiz Game */
        .quiz-option {
            background: #374151;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .quiz-option:hover {
            background: #4b5563;
        }
        .quiz-option.correct {
            background: #10b981;
        }
        .quiz-option.incorrect {
            background: #ef4444;
        }
        
        /* Premium Badge */
        .premium-badge {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* Loading states */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Toast notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            z-index: 10000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        .toast.show {
            transform: translateX(0);
        }
        .toast.success {
            background: #10b981;
        }
        .toast.error {
            background: #ef4444;
        }
        .toast.info {
            background: #3b82f6;
        }

        /* Debug panel */
        .debug-panel {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            z-index: 1000;
        }

        /* Keyboard for word puzzle */
        .keyboard {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
            margin-top: 20px;
        }
        .key {
            padding: 10px;
            background: #4b5563;
            border: none;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .key:hover {
            background: #6b7280;
        }
        .key:active {
            transform: scale(0.95);
        }
        .key.used {
            background: #6b7280;
        }
        .key.correct {
            background: #10b981;
        }
        .key.partial {
            background: #f59e0b;
        }

        /* Level progression */
        .level-badge {
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            animation: glow 2s infinite;
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px #8b5cf6; }
            50% { box-shadow: 0 0 20px #8b5cf6; }
        }

        /* Payment methods */
        .payment-method {
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        .payment-method.selected {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        /* Fade in animation */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="h-full bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white">
    <!-- Debug Panel -->
    <div class="debug-panel" id="debugPanel">
        <div>Firebase: <span id="firebaseStatus">Checking...</span></div>
        <div>User: <span id="userStatus">Unknown</span></div>
        <div>Coins: <span id="coinsStatus">0</span></div>
        <div>Level: <span id="levelStatus">1</span></div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer"></div>

    <div class="min-h-screen">
        <!-- Header -->
        <div class="glass-card border-b border-slate-700">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 primary-gradient rounded-2xl flex items-center justify-center">
                            <i class="fas fa-gamepad text-white"></i>
                        </div>
                        <div>
                            <h1 class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-400">
                                Premium Game Center
                            </h1>
                            <p class="text-slate-400 text-sm">Unlimited levels & premium rewards</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-right">
                            <div class="font-semibold text-white" id="userCoins">0 coins</div>
                            <div class="text-slate-400 text-sm" id="userLevel">Level 1</div>
                        </div>
                        <img id="userAvatar" class="w-10 h-10 rounded-full border-2 border-slate-600" alt="User Avatar">
                    </div>
                </div>
            </div>
        </div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Level Progression Banner -->
            <div class="glass-card rounded-2xl p-6 mb-8 border border-purple-500/30">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-black text-white mb-2">Unlimited Gaming Experience</h2>
                        <p class="text-slate-400">Play thousands of levels across all games. Progress never resets!</p>
                    </div>
                    <div class="level-badge px-4 py-2 rounded-full text-white font-bold">
                        Level <span id="currentLevelDisplay">1</span>
                    </div>
                </div>
                <div class="mt-4 bg-slate-700 rounded-full h-3">
                    <div id="levelProgress" class="bg-gradient-to-r from-purple-500 to-pink-500 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>
                <div class="flex justify-between text-sm text-slate-400 mt-2">
                    <span>Level <span id="currentLevel">1</span></span>
                    <span>Next: <span id="nextLevel">2</span></span>
                </div>
            </div>

            <!-- Premium Subscription Banner -->
            <div class="premium-gradient rounded-2xl p-6 mb-8 text-center">
                <div class="flex items-center justify-center mb-4">
                    <i class="fas fa-crown text-white text-2xl mr-3"></i>
                    <h2 class="text-2xl font-black text-white">Premium Games Access</h2>
                </div>
                <p class="text-white mb-4">Unlock all premium games and exclusive features</p>
                <button class="px-6 py-3 glass-card text-white rounded-xl font-semibold hover:scale-105 transition" onclick="showPremiumModal()">
                    <i class="fas fa-gem mr-2"></i> Upgrade to Premium
                </button>
            </div>

            <!-- Featured Games -->
            <div class="mb-8">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400">
                        Featured Games
                    </h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="featuredGames">
                    <!-- Game cards will be loaded here -->
                </div>
            </div>

            <!-- Premium Games Section -->
            <div class="mb-8">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-400">
                        <i class="fas fa-crown mr-2"></i>Premium Games
                    </h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="premiumGames">
                    <!-- Premium game cards will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Game Modals -->
    
    <!-- Chess Game Modal -->
    <div id="chessGameModal" class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 hidden">
        <div class="glass-card rounded-2xl p-6 max-w-2xl w-full fade-in">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h3 class="text-2xl font-black text-white">Quantum Chess</h3>
                    <p class="text-slate-400">Level <span id="chessLevel">1</span> - Unlimited progression</p>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-green-400 font-bold" id="chessStatus">White's Turn</span>
                    <button class="text-slate-400 hover:text-white" onclick="closeGameModal('chessGameModal')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="flex justify-center mb-6">
                <div class="chess-board" id="chessBoard">
                    <!-- Chess board will be generated here -->
                </div>
            </div>
            
            <div class="flex space-x-3">
                <button class="flex-1 px-4 py-2 glass-card border border-slate-700 rounded-xl text-slate-400 hover:border-blue-400 hover:text-blue-400 transition" onclick="closeGameModal('chessGameModal')">
                    Exit Game
                </button>
                <button class="flex-1 px-4 py-2 primary-gradient text-white rounded-xl font-semibold hover:scale-105 transition" onclick="nextChessLevel()">
                    Next Level
                </button>
            </div>
        </div>
    </div>

    <!-- Word Puzzle Modal -->
    <div id="wordPuzzleModal" class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 hidden">
        <div class="glass-card rounded-2xl p-6 max-w-2xl w-full fade-in">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h3 class="text-2xl font-black text-white">Word Master</h3>
                    <p class="text-slate-400">Level <span id="wordPuzzleLevel">1</span> - Unlimited words</p>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-green-400 font-bold" id="wordPuzzleStatus">Guess the 5-letter word!</span>
                    <button class="text-slate-400 hover:text-white" onclick="closeGameModal('wordPuzzleModal')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="mb-6 text-center">
                <div id="wordPuzzleGrid" class="word-puzzle-grid">
                    <!-- Word puzzle grid will be generated here -->
                </div>
                <div class="keyboard" id="wordKeyboard">
                    <!-- Keyboard will be generated here -->
                </div>
            </div>
            
            <div class="flex space-x-3">
                <button class="flex-1 px-4 py-2 glass-card border border-slate-700 rounded-xl text-slate-400 hover:border-blue-400 hover:text-blue-400 transition" onclick="closeGameModal('wordPuzzleModal')">
                    Exit Game
                </button>
                <button class="flex-1 px-4 py-2 primary-gradient text-white rounded-xl font-semibold hover:scale-105 transition" onclick="nextWordPuzzleLevel()">
                    Next Word
                </button>
            </div>
        </div>
    </div>

    <!-- Memory Game Modal -->
    <div id="memoryGameModal" class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 hidden">
        <div class="glass-card rounded-2xl p-6 max-w-2xl w-full fade-in">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h3 class="text-2xl font-black text-white">Memory Matrix</h3>
                    <p class="text-slate-400">Level <span id="memoryLevel">1</span> - Increasing difficulty</p>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-green-400 font-bold" id="memoryMoves">Moves: 0</span>
                    <button class="text-slate-400 hover:text-white" onclick="closeGameModal('memoryGameModal')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="mb-4 text-center" id="memoryGameGrid">
                <!-- Memory cards will be generated here -->
            </div>
            
            <div class="flex space-x-3">
                <button class="flex-1 px-4 py-2 glass-card border border-slate-700 rounded-xl text-slate-400 hover:border-blue-400 hover:text-blue-400 transition" onclick="closeGameModal('memoryGameModal')">
                    Exit Game
                </button>
                <button class="flex-1 px-4 py-2 primary-gradient text-white rounded-xl font-semibold hover:scale-105 transition" onclick="nextMemoryLevel()">
                    Next Level
                </button>
            </div>
        </div>
    </div>

    <!-- Quiz Game Modal -->
    <div id="quizGameModal" class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 hidden">
        <div class="glass-card rounded-2xl p-6 max-w-2xl w-full fade-in">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h3 class="text-2xl font-black text-white" id="quizGameTitle">Knowledge Challenge</h3>
                    <p class="text-slate-400">Level <span id="quizLevel">1</span> - Choose your category</p>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-green-400 font-bold" id="quizScore">Score: 0/0</span>
                    <button class="text-slate-400 hover:text-white" onclick="closeGameModal('quizGameModal')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="mb-6" id="quizGameContent">
                <!-- Quiz content will be loaded here -->
            </div>
            
            <div class="flex space-x-3">
                <button class="flex-1 px-4 py-2 glass-card border border-slate-700 rounded-xl text-slate-400 hover:border-blue-400 hover:text-blue-400 transition" onclick="closeGameModal('quizGameModal')">
                    Exit Game
                </button>
                <button class="flex-1 px-4 py-2 primary-gradient text-white rounded-xl font-semibold hover:scale-105 transition" id="nextQuizQuestion" onclick="loadNextQuizQuestion()">
                    Next Question
                </button>
            </div>
        </div>
    </div>

    <!-- Quiz Category Selection Modal -->
    <div id="quizCategoryModal" class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 hidden">
        <div class="glass-card rounded-2xl p-6 max-w-md w-full fade-in">
            <div class="text-center mb-6">
                <div class="w-16 h-16 primary-gradient rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-brain text-white text-2xl"></i>
                </div>
                <h3 class="text-2xl font-black text-white mb-2">Choose Quiz Category</h3>
                <p class="text-slate-400">Select your preferred topic</p>
            </div>
            
            <div class="space-y-3 mb-6" id="quizCategories">
                <!-- Categories will be loaded here -->
            </div>
            
            <div class="flex space-x-3">
                <button class="flex-1 px-4 py-2 glass-card border border-slate-700 rounded-xl text-slate-400 hover:border-blue-400 hover:text-blue-400 transition" onclick="closeGameModal('quizCategoryModal')">
                    Cancel
                </button>
                <button class="flex-1 px-4 py-2 primary-gradient text-white rounded-xl font-semibold hover:scale-105 transition" onclick="startSelectedQuiz()">
                    Start Quiz
                </button>
            </div>
        </div>
    </div>

    <!-- Premium Subscription Modal -->
    <div id="premiumModal" class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 hidden">
        <div class="glass-card rounded-2xl p-6 max-w-2xl w-full fade-in">
            <div class="text-center mb-6">
                <div class="w-16 h-16 premium-gradient rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-crown text-white text-2xl"></i>
                </div>
                <h3 class="text-2xl font-black text-white mb-2">Upgrade to Premium</h3>
                <p class="text-slate-400">Choose your preferred payment method</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <!-- Coins Payment -->
                <div class="payment-method glass-card p-6 rounded-xl cursor-pointer" onclick="selectPaymentMethod('coins')">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-coins text-yellow-400 text-2xl mr-3"></i>
                        <h4 class="text-lg font-bold text-white">Pay with Coins</h4>
                    </div>
                    <p class="text-slate-400 text-sm mb-4">Use your earned coins to unlock premium</p>
                    <div class="text-center">
                        <div class="text-2xl font-black text-yellow-400">5,000</div>
                        <div class="text-slate-400 text-sm">coins</div>
                    </div>
                    <div class="text-xs text-slate-500 mt-2">Your coins: <span id="userCoinBalance">0</span></div>
                </div>

                <!-- M-Pesa Payment -->
                <div class="payment-method glass-card p-6 rounded-xl cursor-pointer" onclick="selectPaymentMethod('mpesa')">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-mobile-alt text-green-400 text-2xl mr-3"></i>
                        <h4 class="text-lg font-bold text-white">M-Pesa</h4>
                    </div>
                    <p class="text-slate-400 text-sm mb-4">Instant activation via M-Pesa</p>
                    <div class="text-center">
                        <div class="text-2xl font-black text-green-400">KSh 99</div>
                        <div class="text-slate-400 text-sm">per month</div>
                    </div>
                    <div class="text-xs text-slate-500 mt-2">+254 XXX XXX XXX</div>
                </div>

                <!-- Bank Transfer -->
                <div class="payment-method glass-card p-6 rounded-xl cursor-pointer" onclick="selectPaymentMethod('bank')">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-university text-blue-400 text-2xl mr-3"></i>
                        <h4 class="text-lg font-bold text-white">Bank Transfer</h4>
                    </div>
                    <p class="text-slate-400 text-sm mb-4">Direct bank transfer option</p>
                    <div class="text-center">
                        <div class="text-2xl font-black text-blue-400">KSh 99</div>
                        <div class="text-slate-400 text-sm">per month</div>
                    </div>
                    <div class="text-xs text-slate-500 mt-2">Account: 1234567890</div>
                </div>

                <!-- Credit Card -->
                <div class="payment-method glass-card p-6 rounded-xl cursor-pointer" onclick="selectPaymentMethod('card')">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-credit-card text-purple-400 text-2xl mr-3"></i>
                        <h4 class="text-lg font-bold text-white">Credit Card</h4>
                    </div>
                    <p class="text-slate-400 text-sm mb-4">Secure card payment</p>
                    <div class="text-center">
                        <div class="text-2xl font-black text-purple-400">$0.99</div>
                        <div class="text-slate-400 text-sm">per month</div>
                    </div>
                    <div class="text-xs text-slate-500 mt-2">Visa, MasterCard, Amex</div>
                </div>
            </div>

            <div class="text-center mb-6">
                <div class="text-sm text-slate-400">
                    <i class="fas fa-shield-check text-green-400 mr-1"></i>
                    All payments are secure and encrypted
                </div>
            </div>
            
            <div class="flex space-x-3">
                <button class="flex-1 px-4 py-2 glass-card border border-slate-700 rounded-xl text-slate-400 hover:border-blue-400 hover:text-blue-400 transition" onclick="closePremiumModal()">
                    Maybe Later
                </button>
                <button class="flex-1 px-4 py-2 premium-gradient text-white rounded-xl font-semibold hover:scale-105 transition" id="subscribeButton" onclick="processPremiumPayment()">
                    Subscribe Now
                </button>
            </div>
        </div>
    </div>

    <!-- Payment Processing Modal -->
    <div id="paymentModal" class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 hidden">
        <div class="glass-card rounded-2xl p-6 max-w-md w-full fade-in text-center">
            <div class="w-16 h-16 primary-gradient rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-spinner fa-spin text-white text-2xl" id="paymentIcon"></i>
            </div>
            <h3 class="text-2xl font-black text-white mb-2" id="paymentTitle">Processing Payment</h3>
            <p class="text-slate-400 mb-6" id="paymentMessage">Please wait while we process your payment...</p>
            <div class="loading-spinner mx-auto mb-4"></div>
            <button class="w-full px-4 py-2 glass-card border border-slate-700 rounded-xl text-slate-400 hover:border-blue-400 hover:text-blue-400 transition hidden" id="paymentCloseButton" onclick="closePaymentModal()">
                Close
            </button>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDHHyGgsSV18BcXrGgzi4C8frzDAE1C1zo",
            authDomain: "uniconnect-ee95c.firebaseapp.com",
            projectId: "uniconnect-ee95c",
            storageBucket: "uniconnect-ee95c.firebasestorage.app",
            messagingSenderId: "1003264444309",
            appId: "1:1003264444309:web:9f0307516e44d21e97d89c"
        };

        // Cloudinary configuration
        const cloudinaryCloudName = 'your-cloudinary-name';

        // Firebase services
        let auth;
        let db;

        // Games data
        const freeGames = [
            {
                id: "memory",
                name: "Memory Matrix",
                description: "Test your memory with unlimited levels",
                category: "puzzle",
                players: "1",
                coins: 80,
                gradient: "game-gradient-1",
                icon: "fa-brain",
                featured: true,
                premium: false,
                unlimitedLevels: true
            },
            {
                id: "quiz",
                name: "Knowledge Challenge",
                description: "Test your knowledge across multiple categories",
                category: "trivia",
                players: "1",
                coins: 120,
                gradient: "game-gradient-2",
                icon: "fa-brain",
                featured: true,
                premium: false,
                unlimitedLevels: true
            }
        ];

        const premiumGames = [
            {
                id: "chess",
                name: "Quantum Chess",
                description: "Strategic chess with unlimited progression",
                category: "strategy",
                players: "2",
                coins: 200,
                gradient: "game-gradient-3",
                icon: "fa-chess",
                featured: true,
                premium: true,
                unlimitedLevels: true
            },
            {
                id: "wordpuzzle",
                name: "Word Master",
                description: "Unlimited word puzzles with increasing difficulty",
                category: "puzzle",
                players: "1",
                coins: 150,
                gradient: "game-gradient-4",
                icon: "fa-font",
                featured: true,
                premium: true,
                unlimitedLevels: true
            },
            {
                id: "sudoku",
                name: "Number Matrix",
                description: "Thousands of Sudoku puzzles",
                category: "puzzle",
                players: "1",
                coins: 180,
                gradient: "game-gradient-5",
                icon: "fa-th-large",
                featured: false,
                premium: true,
                unlimitedLevels: true
            }
        ];

        // Quiz Categories
        const quizCategories = [
            {
                id: "technology",
                name: "Technology & Programming",
                icon: "fa-laptop-code",
                color: "text-blue-400",
                questions: [
                    {
                        question: "What does API stand for?",
                        options: [
                            "Application Programming Interface",
                            "Advanced Programming Interface", 
                            "Application Process Integration",
                            "Automated Programming Interface"
                        ],
                        correct: 0
                    },
                    {
                        question: "Which language is used for web styling?",
                        options: [
                            "JavaScript",
                            "Python",
                            "CSS",
                            "HTML"
                        ],
                        correct: 2
                    }
                ]
            },
            {
                id: "science",
                name: "Science & Nature",
                icon: "fa-flask",
                color: "text-green-400",
                questions: [
                    {
                        question: "What is the chemical symbol for gold?",
                        options: [
                            "Go",
                            "Gd", 
                            "Au",
                            "Ag"
                        ],
                        correct: 2
                    }
                ]
            }
        ];

        // Game state variables
        let currentUser = null;
        let userData = {
            coins: 0,
            level: 1,
            gamesPlayed: 0,
            displayName: "Guest",
            isPremium: false,
            profilePicture: null,
            gameProgress: {
                chess: { level: 1, xp: 0 },
                wordpuzzle: { level: 1, xp: 0 },
                memory: { level: 1, xp: 0 },
                quiz: { level: 1, xp: 0 }
            }
        };

        // Chess Game Variables
        let chessGame = {
            board: [],
            currentPlayer: 'white',
            selectedPiece: null,
            validMoves: [],
            currentLevel: 1
        };

        // Word Puzzle Variables
        let wordPuzzle = {
            targetWord: '',
            currentGuess: '',
            guesses: [],
            maxGuesses: 6,
            gameOver: false,
            currentLevel: 1,
            wordList: [
                'APPLE', 'BRAIN', 'CHESS', 'DREAM', 'EARTH', 'FLAME', 'GRAPE', 'HOUSE',
                'IMAGE', 'JOKER', 'KNIFE', 'LIGHT', 'MAGIC', 'NIGHT', 'OCEAN', 'PIANO'
            ]
        };

        // Memory Game Variables
        let memoryGame = {
            cards: [],
            flippedCards: [],
            matchedPairs: 0,
            moves: 0,
            totalPairs: 8,
            currentLevel: 1
        };

        // Quiz Game Variables
        let quizGame = {
            questions: [],
            currentQuestion: 0,
            score: 0,
            totalQuestions: 5,
            currentLevel: 1,
            selectedCategory: null
        };

        // Payment state
        let selectedPaymentMethod = null;

        // Level progression system
        const LEVEL_XP_REQUIREMENTS = {
            1: 100, 2: 250, 3: 500, 4: 1000, 5: 2000,
            6: 4000, 7: 8000, 8: 16000, 9: 32000, 10: 64000
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            // Initialize Firebase
            try {
                firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.firestore();
                
                document.getElementById('firebaseStatus').textContent = 'Connected ✅';
                document.getElementById('firebaseStatus').style.color = '#10b981';
            } catch (error) {
                document.getElementById('firebaseStatus').textContent = 'Failed ❌';
                document.getElementById('firebaseStatus').style.color = '#ef4444';
            }

            // Set up auth state listener
            auth.onAuthStateChanged(async (user) => {
                currentUser = user;
                
                if (user) {
                    document.getElementById('userStatus').textContent = user.email;
                    document.getElementById('userStatus').style.color = '#10b981';
                    await loadUserData(user.uid);
                } else {
                    document.getElementById('userStatus').textContent = 'Not signed in';
                    document.getElementById('userStatus').style.color = '#ef4444';
                    // Use demo data for guests
                    userData = { 
                        coins: 1000, 
                        level: 1, 
                        gamesPlayed: 0, 
                        displayName: "Guest", 
                        isPremium: false,
                        profilePicture: null,
                        gameProgress: {
                            chess: { level: 1, xp: 0 },
                            wordpuzzle: { level: 1, xp: 0 },
                            memory: { level: 1, xp: 0 },
                            quiz: { level: 1, xp: 0 }
                        }
                    };
                    updateUI();
                }
                
                loadGames();
            });
        }

        async function loadUserData(userId) {
            try {
                const userDoc = await db.collection('users').doc(userId).get();
                
                if (userDoc.exists) {
                    const data = userDoc.data();
                    userData = {
                        coins: data.coins || 0,
                        level: data.level || 1,
                        gamesPlayed: data.gamesPlayed || 0,
                        displayName: data.displayName || "Player",
                        isPremium: data.isPremium || false,
                        profilePicture: data.profilePicture || null,
                        gameProgress: data.gameProgress || {
                            chess: { level: 1, xp: 0 },
                            wordpuzzle: { level: 1, xp: 0 },
                            memory: { level: 1, xp: 0 },
                            quiz: { level: 1, xp: 0 }
                        }
                    };
                } else {
                    // Create new user document
                    userData = {
                        coins: 100,
                        level: 1,
                        gamesPlayed: 0,
                        displayName: "New Player",
                        isPremium: false,
                        profilePicture: null,
                        gameProgress: {
                            chess: { level: 1, xp: 0 },
                            wordpuzzle: { level: 1, xp: 0 },
                            memory: { level: 1, xp: 0 },
                            quiz: { level: 1, xp: 0 }
                        },
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    await db.collection('users').doc(userId).set(userData);
                }
                
                updateUI();
            } catch (error) {
                console.error("Error loading user data:", error);
                userData = { 
                    coins: 500, 
                    level: 1, 
                    gamesPlayed: 0, 
                    displayName: "Guest", 
                    isPremium: false,
                    profilePicture: null,
                    gameProgress: {
                        chess: { level: 1, xp: 0 },
                        wordpuzzle: { level: 1, xp: 0 },
                        memory: { level: 1, xp: 0 },
                        quiz: { level: 1, xp: 0 }
                    }
                };
                updateUI();
            }
        }

        function updateUI() {
            document.getElementById('userCoins').textContent = `${userData.coins.toLocaleString()} coins`;
            document.getElementById('userLevel').textContent = `Level ${userData.level}`;
            document.getElementById('coinsStatus').textContent = userData.coins;
            document.getElementById('levelStatus').textContent = userData.level;
            document.getElementById('currentLevelDisplay').textContent = userData.level;
            document.getElementById('currentLevel').textContent = userData.level;
            document.getElementById('nextLevel').textContent = userData.level + 1;
            document.getElementById('userCoinBalance').textContent = userData.coins.toLocaleString();
            
            // Update user avatar
            updateUserAvatar();
            
            // Update level progress
            const currentLevel = userData.level;
            const currentXP = userData.gameProgress ? Object.values(userData.gameProgress).reduce((total, game) => total + game.xp, 0) : 0;
            const xpForCurrentLevel = LEVEL_XP_REQUIREMENTS[currentLevel] || 100;
            const xpForNextLevel = LEVEL_XP_REQUIREMENTS[currentLevel + 1] || xpForCurrentLevel * 2;
            const progress = ((currentXP - xpForCurrentLevel) / (xpForNextLevel - xpForCurrentLevel)) * 100;
            
            document.getElementById('levelProgress').style.width = `${Math.max(0, Math.min(100, progress))}%`;
        }

        function updateUserAvatar() {
            const avatarElement = document.getElementById('userAvatar');
            if (userData.profilePicture) {
                avatarElement.src = `https://res.cloudinary.com/${cloudinaryCloudName}/image/upload/w_100,h_100,c_fill/${userData.profilePicture}`;
            } else {
                avatarElement.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(userData.displayName)}&background=3b82f6&color=fff`;
            }
        }

        function loadGames() {
            loadFreeGames();
            loadPremiumGames();
        }

        function loadFreeGames() {
            const featuredGamesContainer = document.getElementById('featuredGames');
            
            featuredGamesContainer.innerHTML = freeGames.map(game => `
                <div class="game-card glass-card rounded-2xl border border-slate-700 overflow-hidden" onclick="startGame('${game.id}')">
                    <div class="h-32 ${game.gradient} flex items-center justify-center">
                        <i class="fas ${game.icon} text-white text-4xl"></i>
                    </div>
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-xl font-black text-white">${game.name}</h3>
                            <span class="px-2 py-1 bg-slate-700 text-slate-300 text-xs rounded-full">
                                ${game.players} player
                            </span>
                        </div>
                        <p class="text-slate-400 text-sm mb-4">${game.description}</p>
                        <div class="flex justify-between items-center">
                            <span class="text-yellow-400 font-bold">${game.coins} coins</span>
                            <button class="px-4 py-2 primary-gradient text-white rounded-xl font-semibold hover:scale-105 transition">
                                Play Free
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadPremiumGames() {
            const premiumGamesContainer = document.getElementById('premiumGames');
            
            premiumGamesContainer.innerHTML = premiumGames.map(game => `
                <div class="game-card glass-card rounded-2xl border border-slate-700 overflow-hidden relative" onclick="startGame('${game.id}')">
                    <div class="absolute top-3 right-3 premium-badge text-xs text-black font-bold px-2 py-1 rounded-full">
                        <i class="fas fa-crown mr-1"></i> PREMIUM
                    </div>
                    <div class="h-32 ${game.gradient} flex items-center justify-center ${userData.isPremium ? '' : 'opacity-70'}">
                        <i class="fas ${game.icon} text-white text-4xl"></i>
                    </div>
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-xl font-black text-white">${game.name}</h3>
                            <span class="px-2 py-1 bg-slate-700 text-slate-300 text-xs rounded-full">
                                ${game.players} player
                            </span>
                        </div>
                        <p class="text-slate-400 text-sm mb-4">${game.description}</p>
                        <div class="flex justify-between items-center">
                            <span class="text-yellow-400 font-bold">${game.coins} coins</span>
                            <button class="px-4 py-2 ${userData.isPremium ? 'primary-gradient' : 'premium-gradient'} text-white rounded-xl font-semibold hover:scale-105 transition">
                                ${userData.isPremium ? 'Play Now' : 'Unlock'}
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function startGame(gameId) {
            const game = [...freeGames, ...premiumGames].find(g => g.id === gameId);
            if (game.premium && !userData.isPremium) {
                showToast('This is a premium game. Upgrade to play!', 'info');
                showPremiumModal();
                return;
            }
            
            if (!currentUser && !game.premium) {
                showToast('Sign in to save your progress and earn coins!', 'info');
            }
            
            // Load current level for the game
            const currentLevel = userData.gameProgress[gameId]?.level || 1;
            
            switch(gameId) {
                case 'chess':
                    chessGame.currentLevel = currentLevel;
                    startChessGame();
                    break;
                case 'wordpuzzle':
                    wordPuzzle.currentLevel = currentLevel;
                    startWordPuzzle();
                    break;
                case 'memory':
                    memoryGame.currentLevel = currentLevel;
                    startMemoryGame();
                    break;
                case 'quiz':
                    quizGame.currentLevel = currentLevel;
                    showQuizCategorySelection();
                    break;
                default:
                    showToast('Game coming soon!', 'info');
            }
        }

        // ==================== CHESS GAME ====================
        function startChessGame() {
            openGameModal('chessGameModal');
            document.getElementById('chessLevel').textContent = chessGame.currentLevel;
            initializeChessBoard();
            renderChessBoard();
        }

        function initializeChessBoard() {
            chessGame.board = Array(8).fill().map(() => Array(8).fill(null));
            
            // Set up pawns
            for (let i = 0; i < 8; i++) {
                chessGame.board[1][i] = { type: 'pawn', color: 'black' };
                chessGame.board[6][i] = { type: 'pawn', color: 'white' };
            }
            
            // Set up other pieces
            const backRow = ['rook', 'knight', 'bishop', 'queen', 'king', 'bishop', 'knight', 'rook'];
            for (let i = 0; i < 8; i++) {
                chessGame.board[0][i] = { type: backRow[i], color: 'black' };
                chessGame.board[7][i] = { type: backRow[i], color: 'white' };
            }
            
            chessGame.currentPlayer = 'white';
            chessGame.selectedPiece = null;
            chessGame.validMoves = [];
            
            updateChessStatus();
        }

        function renderChessBoard() {
            const board = document.getElementById('chessBoard');
            board.innerHTML = '';
            
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const square = document.createElement('div');
                    const isWhite = (row + col) % 2 === 0;
                    square.className = `chess-square ${isWhite ? 'white' : 'black'}`;
                    
                    const piece = chessGame.board[row][col];
                    if (piece) {
                        square.innerHTML = getChessSymbol(piece);
                        square.style.cursor = 'pointer';
                    }
                    
                    if (chessGame.validMoves.some(move => move.row === row && move.col === col)) {
                        square.classList.add('valid-move');
                    }
                    
                    if (chessGame.selectedPiece && chessGame.selectedPiece.row === row && chessGame.selectedPiece.col === col) {
                        square.classList.add('selected');
                    }
                    
                    square.onclick = () => handleChessClick(row, col);
                    board.appendChild(square);
                }
            }
        }

        function getChessSymbol(piece) {
            const symbols = {
                'king': { white: '♔', black: '♚' },
                'queen': { white: '♕', black: '♛' },
                'rook': { white: '♖', black: '♜' },
                'bishop': { white: '♗', black: '♝' },
                'knight': { white: '♘', black: '♞' },
                'pawn': { white: '♙', black: '♟' }
            };
            return symbols[piece.type][piece.color];
        }

        function handleChessClick(row, col) {
            const piece = chessGame.board[row][col];
            
            if (chessGame.selectedPiece) {
                const selectedRow = chessGame.selectedPiece.row;
                const selectedCol = chessGame.selectedPiece.col;
                
                const isValidMove = chessGame.validMoves.some(move => move.row === row && move.col === col);
                
                if (isValidMove) {
                    chessGame.board[row][col] = chessGame.board[selectedRow][selectedCol];
                    chessGame.board[selectedRow][selectedCol] = null;
                    
                    chessGame.currentPlayer = chessGame.currentPlayer === 'white' ? 'black' : 'white';
                    updateChessStatus();
                    awardCoins(10);
                }
                
                chessGame.selectedPiece = null;
                chessGame.validMoves = [];
                renderChessBoard();
                return;
            }
            
            if (piece && piece.color === chessGame.currentPlayer) {
                chessGame.selectedPiece = { row, col };
                chessGame.validMoves = calculateValidMoves(row, col, piece);
                renderChessBoard();
            }
        }

        function calculateValidMoves(row, col, piece) {
            const moves = [];
            
            if (piece.type === 'pawn') {
                const direction = piece.color === 'white' ? -1 : 1;
                if (row + direction >= 0 && row + direction < 8 && !chessGame.board[row + direction][col]) {
                    moves.push({ row: row + direction, col });
                }
                if (col > 0 && chessGame.board[row + direction][col - 1] && chessGame.board[row + direction][col - 1].color !== piece.color) {
                    moves.push({ row: row + direction, col: col - 1 });
                }
                if (col < 7 && chessGame.board[row + direction][col + 1] && chessGame.board[row + direction][col + 1].color !== piece.color) {
                    moves.push({ row: row + direction, col: col + 1 });
                }
            }
            
            return moves;
        }

        function updateChessStatus() {
            document.getElementById('chessStatus').textContent = `${chessGame.currentPlayer.charAt(0).toUpperCase() + chessGame.currentPlayer.slice(1)}'s Turn`;
        }

        function nextChessLevel() {
            chessGame.currentLevel++;
            document.getElementById('chessLevel').textContent = chessGame.currentLevel;
            initializeChessBoard();
            renderChessBoard();
            showToast(`Advanced to Chess Level ${chessGame.currentLevel}!`, 'success');
            awardCoins(50);
        }

        // ==================== WORD PUZZLE GAME ====================
        function startWordPuzzle() {
            openGameModal('wordPuzzleModal');
            document.getElementById('wordPuzzleLevel').textContent = wordPuzzle.currentLevel;
            wordPuzzle.maxGuesses = Math.max(4, 7 - Math.floor(wordPuzzle.currentLevel / 10));
            initializeWordPuzzle();
            renderWordPuzzle();
        }

        function initializeWordPuzzle() {
            const startIndex = Math.min(wordPuzzle.currentLevel - 1, wordPuzzle.wordList.length - 1);
            const endIndex = Math.min(startIndex + 20, wordPuzzle.wordList.length);
            const levelWords = wordPuzzle.wordList.slice(startIndex, endIndex);
            
            wordPuzzle.targetWord = levelWords[Math.floor(Math.random() * levelWords.length)];
            wordPuzzle.currentGuess = '';
            wordPuzzle.guesses = [];
            wordPuzzle.gameOver = false;
            
            updateWordPuzzleStatus();
        }

        function renderWordPuzzle() {
            const grid = document.getElementById('wordPuzzleGrid');
            const keyboard = document.getElementById('wordKeyboard');
            
            grid.innerHTML = '';
            keyboard.innerHTML = '';
            
            for (let i = 0; i < wordPuzzle.maxGuesses; i++) {
                for (let j = 0; j < 5; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'word-cell';
                    
                    if (wordPuzzle.guesses[i] && wordPuzzle.guesses[i][j]) {
                        cell.textContent = wordPuzzle.guesses[i][j];
                        cell.classList.add('filled');
                        
                        if (wordPuzzle.guesses[i][j] === wordPuzzle.targetWord[j]) {
                            cell.classList.add('correct');
                        } else if (wordPuzzle.targetWord.includes(wordPuzzle.guesses[i][j])) {
                            cell.classList.add('partial');
                        } else {
                            cell.classList.add('incorrect');
                        }
                    }
                    
                    grid.appendChild(cell);
                }
            }
            
            const keyboardLayout = 'QWERTYUIOPASDFGHJKLZXCVBNM';
            for (let char of keyboardLayout) {
                const key = document.createElement('button');
                key.className = 'key';
                key.textContent = char;
                key.onclick = () => handleKeyPress(char);
                keyboard.appendChild(key);
            }
            
            const enterKey = document.createElement('button');
            enterKey.className = 'key';
            enterKey.textContent = 'ENTER';
            enterKey.onclick = submitGuess;
            keyboard.appendChild(enterKey);
            
            const backspaceKey = document.createElement('button');
            backspaceKey.className = 'key';
            backspaceKey.innerHTML = '<i class="fas fa-backspace"></i>';
            backspaceKey.onclick = handleBackspace;
            keyboard.appendChild(backspaceKey);
        }

        function handleKeyPress(char) {
            if (wordPuzzle.gameOver) return;
            
            if (wordPuzzle.currentGuess.length < 5) {
                wordPuzzle.currentGuess += char;
                renderWordPuzzle();
            }
        }

        function handleBackspace() {
            if (wordPuzzle.gameOver) return;
            
            if (wordPuzzle.currentGuess.length > 0) {
                wordPuzzle.currentGuess = wordPuzzle.currentGuess.slice(0, -1);
                renderWordPuzzle();
            }
        }

        function submitGuess() {
            if (wordPuzzle.gameOver || wordPuzzle.currentGuess.length !== 5) return;
            
            wordPuzzle.guesses.push(wordPuzzle.currentGuess);
            
            if (wordPuzzle.currentGuess === wordPuzzle.targetWord) {
                wordPuzzle.gameOver = true;
                showToast('Congratulations! You guessed the word!', 'success');
                awardCoins(100);
            } else if (wordPuzzle.guesses.length >= wordPuzzle.maxGuesses) {
                wordPuzzle.gameOver = true;
                showToast(`Game Over! The word was: ${wordPuzzle.targetWord}`, 'info');
            }
            
            wordPuzzle.currentGuess = '';
            renderWordPuzzle();
            updateWordPuzzleStatus();
        }

        function updateWordPuzzleStatus() {
            if (wordPuzzle.gameOver) {
                if (wordPuzzle.guesses[wordPuzzle.guesses.length - 1] === wordPuzzle.targetWord) {
                    document.getElementById('wordPuzzleStatus').textContent = 'You won! 🎉';
                } else {
                    document.getElementById('wordPuzzleStatus').textContent = `The word was: ${wordPuzzle.targetWord}`;
                }
            } else {
                document.getElementById('wordPuzzleStatus').textContent = `Guess ${wordPuzzle.guesses.length + 1}/${wordPuzzle.maxGuesses}`;
            }
        }

        function nextWordPuzzleLevel() {
            wordPuzzle.currentLevel++;
            document.getElementById('wordPuzzleLevel').textContent = wordPuzzle.currentLevel;
            initializeWordPuzzle();
            renderWordPuzzle();
            showToast(`Advanced to Word Puzzle Level ${wordPuzzle.currentLevel}!`, 'success');
            awardCoins(50);
        }

        // ==================== MEMORY GAME ====================
        function startMemoryGame() {
            openGameModal('memoryGameModal');
            document.getElementById('memoryLevel').textContent = memoryGame.currentLevel;
            memoryGame.totalPairs = Math.min(16, 8 + Math.floor(memoryGame.currentLevel / 3));
            resetMemoryGame();
            generateMemoryCards();
            renderMemoryCards();
        }

        function resetMemoryGame() {
            memoryGame.cards = [];
            memoryGame.flippedCards = [];
            memoryGame.matchedPairs = 0;
            memoryGame.moves = 0;
            updateMemoryMoves();
        }

        function generateMemoryCards() {
            const symbols = ['🚀', '🌟', '🔮', '💎', '🎯', '🎨', '🎭', '🎪', '⚡', '🔥', '🌈', '⭐', '🎵', '🎮', '🏆', '🎲'];
            let cards = [];
            
            const levelSymbols = symbols.slice(0, memoryGame.totalPairs);
            levelSymbols.forEach(symbol => {
                cards.push({ symbol, matched: false });
                cards.push({ symbol, matched: false });
            });
            
            memoryGame.cards = cards.sort(() => Math.random() - 0.5);
        }

        function renderMemoryCards() {
            const grid = document.getElementById('memoryGameGrid');
            grid.innerHTML = '';
            const columns = Math.min(6, Math.ceil(Math.sqrt(memoryGame.totalPairs * 2)));
            grid.className = `grid grid-cols-${columns} gap-2 max-w-md mx-auto`;
            
            memoryGame.cards.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = `memory-card ${card.matched ? 'matched' : ''}`;
                cardElement.innerHTML = card.matched || memoryGame.flippedCards.includes(index) ? 
                    card.symbol : '<i class="fas fa-question text-white"></i>';
                cardElement.onclick = () => flipMemoryCard(index);
                grid.appendChild(cardElement);
            });
        }

        function flipMemoryCard(index) {
            if (memoryGame.flippedCards.length >= 2 || 
                memoryGame.flippedCards.includes(index) || 
                memoryGame.cards[index].matched) {
                return;
            }
            
            memoryGame.flippedCards.push(index);
            memoryGame.moves++;
            updateMemoryMoves();
            
            renderMemoryCards();
            
            if (memoryGame.flippedCards.length === 2) {
                checkMemoryMatch();
            }
        }

        function checkMemoryMatch() {
            const [index1, index2] = memoryGame.flippedCards;
            const card1 = memoryGame.cards[index1];
            const card2 = memoryGame.cards[index2];
            
            if (card1.symbol === card2.symbol) {
                card1.matched = true;
                card2.matched = true;
                memoryGame.matchedPairs++;
                memoryGame.flippedCards = [];
                
                if (memoryGame.matchedPairs === memoryGame.totalPairs) {
                    setTimeout(() => {
                        showToast(`Congratulations! You won in ${memoryGame.moves} moves!`, 'success');
                        awardCoins(80);
                    }, 500);
                }
            } else {
                setTimeout(() => {
                    memoryGame.flippedCards = [];
                    renderMemoryCards();
                }, 1000);
            }
        }

        function updateMemoryMoves() {
            document.getElementById('memoryMoves').textContent = `Moves: ${memoryGame.moves}`;
        }

        function nextMemoryLevel() {
            memoryGame.currentLevel++;
            document.getElementById('memoryLevel').textContent = memoryGame.currentLevel;
            startMemoryGame();
            showToast(`Advanced to Memory Level ${memoryGame.currentLevel}!`, 'success');
            awardCoins(50);
        }

        // ==================== QUIZ GAME ====================
        function showQuizCategorySelection() {
            const categoriesContainer = document.getElementById('quizCategories');
            categoriesContainer.innerHTML = quizCategories.map(category => `
                <div class="quiz-option flex items-center p-4" onclick="selectQuizCategory('${category.id}')">
                    <i class="fas ${category.icon} ${category.color} text-xl mr-3"></i>
                    <span class="text-white font-medium">${category.name}</span>
                </div>
            `).join('');
            
            openGameModal('quizCategoryModal');
        }

        function selectQuizCategory(categoryId) {
            quizGame.selectedCategory = categoryId;
            const category = quizCategories.find(c => c.id === categoryId);
            
            document.querySelectorAll('.quiz-option').forEach(opt => {
                opt.classList.remove('correct');
            });
            
            event.currentTarget.classList.add('correct');
        }

        function startSelectedQuiz() {
            if (!quizGame.selectedCategory) {
                showToast('Please select a quiz category', 'error');
                return;
            }
            
            closeGameModal('quizCategoryModal');
            startQuizGame();
        }

        function startQuizGame() {
            openGameModal('quizGameModal');
            document.getElementById('quizLevel').textContent = quizGame.currentLevel;
            
            const category = quizCategories.find(c => c.id === quizGame.selectedCategory);
            if (category) {
                document.getElementById('quizGameTitle').textContent = category.name;
            }
            
            resetQuizGame();
            loadQuizQuestions();
        }

        function resetQuizGame() {
            quizGame.currentQuestion = 0;
            quizGame.score = 0;
            updateQuizScore();
        }

        function loadQuizQuestions() {
            const category = quizCategories.find(c => c.id === quizGame.selectedCategory);
            if (!category) return;

            if (quizGame.currentLevel > 5) {
                const allQuestions = quizCategories.flatMap(cat => cat.questions);
                quizGame.questions = allQuestions.sort(() => 0.5 - Math.random()).slice(0, quizGame.totalQuestions);
            } else {
                quizGame.questions = category.questions.slice(0, quizGame.totalQuestions);
            }
            
            loadNextQuizQuestion();
        }

        function loadNextQuizQuestion() {
            if (quizGame.currentQuestion >= quizGame.questions.length) {
                showQuizResults();
                return;
            }
            
            const question = quizGame.questions[quizGame.currentQuestion];
            const content = document.getElementById('quizGameContent');
            
            content.innerHTML = `
                <div class="glass-card rounded-xl p-6 mb-4">
                    <h4 class="text-xl font-semibold text-white mb-4">${question.question}</h4>
                    <div class="space-y-3" id="quizOptions">
                        ${question.options.map((option, index) => `
                            <div class="quiz-option" onclick="selectQuizAnswer(${index})">
                                ${option}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            document.getElementById('nextQuizQuestion').style.display = 'none';
        }

        function selectQuizAnswer(selectedIndex) {
            const question = quizGame.questions[quizGame.currentQuestion];
            const options = document.querySelectorAll('.quiz-option');
            
            options.forEach((option, index) => {
                if (index === question.correct) {
                    option.classList.add('correct');
                } else if (index === selectedIndex && index !== question.correct) {
                    option.classList.add('incorrect');
                }
                option.style.pointerEvents = 'none';
            });
            
            if (selectedIndex === question.correct) {
                quizGame.score++;
                updateQuizScore();
            }
            
            document.getElementById('nextQuizQuestion').style.display = 'block';
            quizGame.currentQuestion++;
        }

        function updateQuizScore() {
            document.getElementById('quizScore').textContent = `Score: ${quizGame.score}/${quizGame.currentQuestion}`;
        }

        function showQuizResults() {
            const content = document.getElementById('quizGameContent');
            content.innerHTML = `
                <div class="glass-card rounded-xl p-6 text-center">
                    <h4 class="text-2xl font-black text-white mb-4">Quiz Complete!</h4>
                    <div class="text-4xl font-black text-green-400 mb-4">${quizGame.score}/${quizGame.questions.length}</div>
                    <p class="text-slate-400 mb-4">You scored ${Math.round((quizGame.score / quizGame.questions.length) * 100)}%</p>
                    ${quizGame.score === quizGame.questions.length ? 
                        '<p class="text-yellow-400 font-semibold">Perfect score! Amazing job! 🎉</p>' :
                        quizGame.score >= quizGame.questions.length * 0.7 ?
                        '<p class="text-green-400 font-semibold">Great job! Well done! 👍</p>' :
                        '<p class="text-blue-400 font-semibold">Good effort! Keep practicing! 💪</p>'
                    }
                </div>
            `;
            
            document.getElementById('nextQuizQuestion').style.display = 'none';
            awardCoins(quizGame.score * 20);
        }

        // ==================== PAYMENT SYSTEM ====================
        function selectPaymentMethod(method) {
            selectedPaymentMethod = method;
            
            document.querySelectorAll('.payment-method').forEach(method => {
                method.classList.remove('selected');
            });
            
            event.currentTarget.classList.add('selected');
            
            const button = document.getElementById('subscribeButton');
            if (method === 'coins') {
                button.innerHTML = '<i class="fas fa-coins mr-2"></i>Pay with Coins (5,000)';
            } else {
                button.innerHTML = '<i class="fas fa-lock mr-2"></i>Subscribe Now';
            }
        }

        async function processPremiumPayment() {
            if (!selectedPaymentMethod) {
                showToast('Please select a payment method', 'error');
                return;
            }

            if (!currentUser) {
                showToast('Please sign in to purchase premium', 'error');
                return;
            }

            showPaymentModal('Processing your payment...', 'Please wait...');

            try {
                if (selectedPaymentMethod === 'coins') {
                    if (userData.coins < 5000) {
                        showPaymentResult('error', 'Insufficient Coins', 'You need 5,000 coins to unlock premium. Keep playing to earn more!');
                        return;
                    }

                    await db.collection('users').doc(currentUser.uid).update({
                        coins: firebase.firestore.FieldValue.increment(-5000),
                        isPremium: true,
                        premiumSince: firebase.firestore.FieldValue.serverTimestamp(),
                        premiumMethod: 'coins'
                    });

                    userData.coins -= 5000;
                    userData.isPremium = true;
                    showPaymentResult('success', 'Premium Unlocked!', 'You have successfully unlocked premium using coins!');
                    
                } else {
                    setTimeout(async () => {
                        await db.collection('users').doc(currentUser.uid).update({
                            isPremium: true,
                            premiumSince: firebase.firestore.FieldValue.serverTimestamp(),
                            premiumMethod: selectedPaymentMethod
                        });

                        userData.isPremium = true;
                        showPaymentResult('success', 'Payment Successful!', 'Welcome to ConnectSphere Premium!');
                    }, 3000);
                }

                loadGames();
                updateUI();

            } catch (error) {
                console.error("Payment processing error:", error);
                showPaymentResult('error', 'Payment Failed', 'There was an error processing your payment. Please try again.');
            }
        }

        function showPaymentModal(title, message) {
            document.getElementById('paymentTitle').textContent = title;
            document.getElementById('paymentMessage').textContent = message;
            document.getElementById('paymentIcon').className = 'fas fa-spinner fa-spin text-white text-2xl';
            document.getElementById('paymentCloseButton').classList.add('hidden');
            openGameModal('paymentModal');
        }

        function showPaymentResult(type, title, message) {
            const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
            const color = type === 'success' ? 'text-green-400' : 'text-red-400';
            
            document.getElementById('paymentTitle').textContent = title;
            document.getElementById('paymentMessage').textContent = message;
            document.getElementById('paymentIcon').className = `fas ${icon} ${color} text-2xl`;
            document.getElementById('paymentCloseButton').classList.remove('hidden');
        }

        function closePaymentModal() {
            closeGameModal('paymentModal');
            closePremiumModal();
        }

        // ==================== COMMON FUNCTIONS ====================
        function openGameModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        function closeGameModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function showPremiumModal() {
            document.getElementById('premiumModal').classList.remove('hidden');
        }

        function closePremiumModal() {
            document.getElementById('premiumModal').classList.add('hidden');
            selectedPaymentMethod = null;
            
            document.querySelectorAll('.payment-method').forEach(method => {
                method.classList.remove('selected');
            });
        }

        async function awardCoins(amount) {
            if (!currentUser) {
                showToast(`You earned ${amount} coins! Sign in to save your progress.`, 'info');
                return;
            }

            try {
                const finalAmount = userData.isPremium ? amount * 2 : amount;
                const newCoins = userData.coins + finalAmount;
                
                await db.collection('users').doc(currentUser.uid).update({
                    coins: newCoins,
                    lastGamePlayed: firebase.firestore.FieldValue.serverTimestamp(),
                    gamesPlayed: firebase.firestore.FieldValue.increment(1)
                });
                
                userData.coins = newCoins;
                userData.gamesPlayed += 1;
                
                updateUI();
                showToast(`+${finalAmount} coins awarded! ${userData.isPremium ? '(Premium bonus!)' : ''}`, 'success');
                
            } catch (error) {
                console.error("Error awarding coins:", error);
                showToast('Error saving coins to database', 'error');
            }
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} mr-2"></i>
                    ${message}
                </div>
            `;
            
            document.getElementById('toastContainer').appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
[file content end]