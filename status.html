<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
    <link rel="icon" href="../icons/moodchat-192.png">
    <link rel="icon" href="../icons/moodchat-512.png">
    <meta name="theme-color" content="#000000">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status | Chat App</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Cloudinary Widget -->
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
    
    <!-- Emoji Picker - Using UMD version instead of ES module -->
    <script src="https://cdn.jsdelivr.net/npm/emoji-picker-element@1.13.0/dist/umd/index.min.js"></script>
    
    <!-- Canvas Tools for Drawing -->
    <script src="https://cdn.jsdelivr.net/npm/fabric@5.3.0/dist/fabric.min.js"></script>
    
    <!-- User data and theme scripts -->
    <script src="user-data.js"></script>
    <script src="display-user-selections.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary-color: #0084ff;
            --secondary-color: #f0f2f5;
            --danger-color: #ff3b30;
            --success-color: #34c759;
            --warning-color: #ff9500;
            --text-primary: #050505;
            --text-secondary: #65676b;
            --bg-color: #ffffff;
            --border-color: #dddfe2;
            --status-gradient: linear-gradient(45deg, #0084ff, #00c6ff);
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        body {
            background-color: #000;
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
            background-color: var(--bg-color);
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: 380px;
            background-color: var(--bg-color);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }
        
        .sidebar-header {
            padding: 20px;
            background: var(--status-gradient);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .sidebar-header h2 {
            font-size: 24px;
            font-weight: 600;
        }
        
        .new-status-btn {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
        }
        
        .new-status-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .status-categories {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--bg-color);
        }
        
        .category-btn {
            flex: 1;
            padding: 15px;
            text-align: center;
            font-weight: 500;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
        }
        
        .category-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        
        .category-btn:hover {
            background-color: var(--secondary-color);
        }
        
        .status-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }
        
        .section-title {
            padding: 15px 20px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .recent-updates {
            padding: 0 20px;
            margin-bottom: 20px;
        }
        
        .my-status-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: var(--secondary-color);
            border-radius: 12px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
            position: relative;
        }
        
        .my-status-item:hover {
            background-color: #e4e6e9;
            border-color: var(--primary-color);
        }
        
        .my-status-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--status-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            margin-right: 15px;
            position: relative;
            overflow: hidden;
            background-size: cover;
            background-position: center;
        }
        
        .add-status-indicator {
            position: absolute;
            bottom: 0;
            right: 0;
            background-color: var(--primary-color);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid var(--bg-color);
        }
        
        .my-status-info {
            flex: 1;
        }
        
        .my-status-title {
            font-weight: 600;
            font-size: 17px;
            margin-bottom: 5px;
        }
        
        .my-status-desc {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .status-options {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .status-option-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .status-option-btn:hover {
            background-color: var(--secondary-color);
            color: var(--primary-color);
        }
        
        .contacts-status-list {
            padding: 0 20px;
        }
        
        .contact-status-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            cursor: pointer;
            transition: background-color 0.2s;
            border-radius: 8px;
            padding-left: 10px;
            position: relative;
        }
        
        .contact-status-item:hover {
            background-color: var(--secondary-color);
        }
        
        .contact-status-item.has-status {
            position: relative;
        }
        
        .contact-status-item.has-status::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 60%;
            background: var(--status-gradient);
            border-radius: 0 4px 4px 0;
        }
        
        .contact-status-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            margin-right: 15px;
            position: relative;
            overflow: hidden;
            background-size: cover;
            background-position: center;
        }
        
        .status-ring {
            position: absolute;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: 2px solid var(--primary-color);
            top: -3px;
            left: -3px;
        }
        
        .contact-status-info {
            flex: 1;
        }
        
        .contact-status-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 3px;
        }
        
        .contact-status-time {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .contact-status-count {
            background-color: var(--primary-color);
            color: white;
            font-size: 12px;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }
        
        /* Main Content - Status Viewer */
        .status-viewer {
            flex: 1;
            background-color: #000;
            position: relative;
            display: none;
        }
        
        .status-viewer.active {
            display: block;
        }
        
        .status-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 10;
            background: linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%);
        }
        
        .status-user-info {
            display: flex;
            align-items: center;
            color: white;
        }
        
        .status-user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            margin-right: 12px;
            overflow: hidden;
            background-size: cover;
            background-position: center;
        }
        
        .status-user-details h4 {
            font-size: 17px;
            font-weight: 600;
            margin-bottom: 3px;
        }
        
        .status-user-details p {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .status-close-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            backdrop-filter: blur(10px);
            transition: all 0.2s;
        }
        
        .status-close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .status-progress-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 10px;
            display: flex;
            gap: 5px;
            z-index: 5;
        }
        
        .status-progress-bar {
            flex: 1;
            height: 3px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .status-progress-fill {
            height: 100%;
            background-color: white;
            width: 0%;
            transition: width 0.1s linear;
        }
        
        .status-content {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .status-media {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .text-status {
            font-size: 32px;
            color: white;
            text-align: center;
            padding: 40px;
            max-width: 800px;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.5);
            word-wrap: break-word;
        }
        
        .status-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 10;
            background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%);
        }
        
        .status-reply-input {
            flex: 1;
            padding: 12px 20px;
            border-radius: 25px;
            border: none;
            font-size: 15px;
            margin-right: 15px;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            backdrop-filter: blur(10px);
        }
        
        .status-reply-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .status-action-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin: 0 5px;
            backdrop-filter: blur(10px);
            transition: all 0.2s;
        }
        
        .status-action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        /* Chat Button in Status Info */
        .chat-user-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            margin-top: 10px;
        }
        
        .chat-user-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Create Status Modal */
        .create-status-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .create-status-modal.active {
            display: flex;
        }
        
        .create-status-container {
            width: 90%;
            max-width: 500px;
            background-color: var(--bg-color);
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            max-height: 90vh;
            box-shadow: var(--shadow-lg);
        }
        
        .create-status-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--status-gradient);
            color: white;
        }
        
        .create-status-header h3 {
            font-size: 20px;
            font-weight: 600;
        }
        
        .create-status-close {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.2s;
        }
        
        .create-status-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .create-status-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
        }
        
        .create-status-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
        }
        
        .create-status-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        
        .create-status-tab:hover {
            background-color: var(--secondary-color);
        }
        
        .create-status-content {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
        }
        
        .create-text-status {
            display: none;
        }
        
        .create-text-status.active {
            display: block;
        }
        
        .text-editor-container {
            width: 100%;
            min-height: 300px;
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .text-editor {
            width: 100%;
            min-height: 200px;
            background: none;
            border: none;
            font-size: 28px;
            color: var(--text-primary);
            resize: none;
            text-align: center;
            outline: none;
            font-weight: 500;
            padding: 20px;
        }
        
        .emoji-only-container {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            margin-bottom: 20px;
            background-color: var(--secondary-color);
            padding: 20px;
        }
        
        .emoji-only-container.active {
            display: flex;
        }
        
        .emoji-only-display {
            font-size: 80px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .emoji-only-display:hover {
            transform: scale(1.2);
        }
        
        .emoji-picker-container {
            position: absolute;
            bottom: 100%;
            left: 0;
            z-index: 1000;
            background: var(--bg-color);
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            display: none;
        }
        
        .emoji-picker-container.active {
            display: block;
        }
        
        .text-toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .text-tool-btn {
            padding: 10px 15px;
            background-color: var(--secondary-color);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .text-tool-btn:hover {
            background-color: #e4e6e9;
        }
        
        .text-tool-btn.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .color-palette {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .color-option {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: transform 0.2s;
        }
        
        .color-option:hover {
            transform: scale(1.1);
        }
        
        .color-option.active {
            border-color: var(--text-primary);
            transform: scale(1.1);
        }
        
        .font-options {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .font-option {
            padding: 8px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .font-option:hover {
            background-color: var(--secondary-color);
        }
        
        .font-option.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .create-media-status {
            display: none;
        }
        
        .create-media-status.active {
            display: block;
        }
        
        .media-upload-area {
            width: 100%;
            min-height: 300px;
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.2s;
            background-color: var(--secondary-color);
            position: relative;
            overflow: hidden;
        }
        
        .media-upload-area:hover {
            border-color: var(--primary-color);
            background-color: #e8f4ff;
        }
        
        .media-upload-icon {
            font-size: 60px;
            color: var(--text-secondary);
            margin-bottom: 15px;
        }
        
        .media-upload-text {
            font-size: 18px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }
        
        .media-upload-subtext {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .media-preview {
            width: 100%;
            height: 300px;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
            position: relative;
            display: none;
        }
        
        .media-preview.active {
            display: block;
        }
        
        .media-preview-img, .media-preview-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .media-edit-tools {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .media-edit-btn {
            padding: 10px 15px;
            background-color: var(--secondary-color);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .media-edit-btn:hover {
            background-color: #e4e6e9;
        }
        
        .drawing-canvas-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1100;
            flex-direction: column;
        }
        
        .drawing-canvas-container.active {
            display: flex;
        }
        
        .drawing-canvas {
            flex: 1;
            background-color: white;
            cursor: crosshair;
        }
        
        .drawing-tools {
            padding: 15px;
            background-color: var(--bg-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .drawing-colors {
            display: flex;
            gap: 10px;
        }
        
        .drawing-color {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .drawing-color.active {
            border-color: var(--text-primary);
        }
        
        .drawing-brushes {
            display: flex;
            gap: 10px;
        }
        
        .drawing-brush {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #333;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
        }
        
        .drawing-brush.active {
            background-color: var(--primary-color);
        }
        
        .create-status-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .privacy-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .privacy-btn {
            padding: 8px 15px;
            background-color: var(--secondary-color);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .privacy-btn.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        /* Privacy Settings Modal */
        .privacy-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .privacy-modal.active {
            display: flex;
        }
        
        .privacy-modal-content {
            width: 90%;
            max-width: 400px;
            background-color: var(--bg-color);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }
        
        .privacy-modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .privacy-modal-header h3 {
            font-size: 18px;
            font-weight: 600;
        }
        
        .privacy-options {
            padding: 20px;
        }
        
        .privacy-option {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
        }
        
        .privacy-option:last-child {
            border-bottom: none;
        }
        
        .privacy-option-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: var(--primary-color);
        }
        
        .privacy-option-info {
            flex: 1;
        }
        
        .privacy-option-title {
            font-weight: 500;
            margin-bottom: 3px;
        }
        
        .privacy-option-desc {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .privacy-option-check {
            color: var(--primary-color);
            font-size: 20px;
            opacity: 0;
        }
        
        .privacy-option.active .privacy-option-check {
            opacity: 1;
        }
        
        /* Status Info Modal */
        .status-info-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .status-info-modal.active {
            display: flex;
        }
        
        .status-info-content {
            width: 90%;
            max-width: 400px;
            background-color: var(--bg-color);
            border-radius: 12px;
            overflow: hidden;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }
        
        .status-info-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status-info-header h3 {
            font-size: 18px;
            font-weight: 600;
        }
        
        .viewers-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }
        
        .viewer-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
        }
        
        .viewer-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
            margin-right: 15px;
            overflow: hidden;
            background-size: cover;
            background-position: center;
        }
        
        .viewer-info {
            flex: 1;
        }
        
        .viewer-name {
            font-weight: 500;
            margin-bottom: 3px;
        }
        
        .viewer-time {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        /* Loading States */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
        
        .spinner {
            border: 3px solid var(--secondary-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Notifications */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--success-color);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
        }
        
        .notification.active {
            transform: translateY(0);
            opacity: 1;
        }
        
        .notification.error {
            background-color: var(--danger-color);
        }
        
        .notification.warning {
            background-color: var(--warning-color);
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                width: 350px;
            }
        }
        
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                max-height: 60vh;
            }
            
            .status-viewer {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: 100;
            }
        }
        
        /* Emoji Reactions */
        .emoji-reactions {
            position: absolute;
            bottom: 100px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 20;
        }
        
        .emoji-reaction {
            background: rgba(255, 255, 255, 0.9);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .emoji-reaction:hover {
            transform: scale(1.1);
        }
        
        /* Text Formatting Preview */
        .text-bold {
            font-weight: bold;
        }
        
        .text-italic {
            font-style: italic;
        }
        
        .text-strikethrough {
            text-decoration: line-through;
        }
        
        .text-monospace {
            font-family: monospace;
        }
        
        /* Link Preview */
        .link-preview {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
            max-width: 400px;
            display: none;
        }
        
        .link-preview.active {
            display: block;
        }
        
        .link-preview-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .link-preview-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-primary);
        }
        
        .link-preview-desc {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }
        
        .link-preview-url {
            font-size: 12px;
            color: var(--primary-color);
            word-break: break-all;
        }
        
        /* Share Status Button */
        .share-status-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            margin-top: 10px;
        }
        
        .share-status-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Screenshot Detection Overlay */
        .screenshot-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .screenshot-overlay.active {
            display: flex;
        }
        
        .screenshot-message {
            background-color: var(--bg-color);
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
            box-shadow: var(--shadow-lg);
        }
        
        .video-duration-warning {
            color: var(--danger-color);
            font-size: 14px;
            margin-top: 10px;
            display: none;
        }
        
        .video-duration-warning.active {
            display: block;
        }
        
        .status-type-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .status-type-btn {
            padding: 10px 15px;
            background-color: var(--secondary-color);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .status-type-btn.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .status-type-btn:hover {
            background-color: #e4e6e9;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar with status updates -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Status</h2>
                <button class="new-status-btn" id="newStatusBtn">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            
            <div class="status-categories">
                <button class="category-btn active" id="recentTab">Recent</button>
                <button class="category-btn" id="viewedTab">Viewed</button>
                <button class="category-btn" id="mutedTab">Muted</button>
            </div>
            
            <div class="status-list">
                <div class="recent-updates">
                    <div class="section-title">My Status</div>
                    <div class="my-status-item" id="myStatusItem">
                        <div class="my-status-avatar" id="myStatusAvatar">
                            <i class="fas fa-user"></i>
                            <div class="add-status-indicator">
                                <i class="fas fa-plus"></i>
                            </div>
                        </div>
                        <div class="my-status-info">
                            <div class="my-status-title">My Status</div>
                            <div class="my-status-desc">Tap to add status update</div>
                        </div>
                        <div class="status-options" id="myStatusOptions" style="display: none;">
                            <button class="status-option-btn" id="deleteMyStatusBtn" title="Delete my status">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="contacts-status-list">
                    <div class="section-title">Recent Updates</div>
                    <div id="recentStatusList">
                        <!-- Recent statuses will be loaded here -->
                        <div class="loading-placeholder" style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                            <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 15px;"></i>
                            <p>Loading status updates...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Status Viewer (Full Screen) -->
        <div class="status-viewer" id="statusViewer">
            <div class="status-progress-container" id="statusProgressContainer">
                <!-- Progress bars will be added dynamically -->
            </div>
            
            <div class="status-header">
                <div class="status-user-info" id="statusUserInfo">
                    <div class="status-user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="status-user-details">
                        <h4 id="statusUserName">User Name</h4>
                        <p id="statusTime">Just now</p>
                    </div>
                </div>
                <button class="status-close-btn" id="closeStatusViewer">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="status-content" id="statusContent">
                <!-- Status content will be loaded here -->
            </div>
            
            <div class="emoji-reactions" id="emojiReactions">
                <div class="emoji-reaction" data-emoji="‚ù§">‚ù§</div>
                <div class="emoji-reaction" data-emoji="üëç">üëç</div>
                <div class="emoji-reaction" data-emoji="üëè">üëè</div>
                <div class="emoji-reaction" data-emoji="üòÇ">üòÇ</div>
            </div>
            
            <div class="status-footer">
                <input type="text" class="status-reply-input" id="statusReplyInput" placeholder="Type a reply...">
                <button class="status-action-btn" id="statusReplyBtn">
                    <i class="fas fa-paper-plane"></i>
                </button>
                <button class="status-action-btn" id="shareStatusBtn" title="Share Status">
                    <i class="fas fa-share"></i>
                </button>
                <button class="status-action-btn" id="statusInfoBtn" title="View Info">
                    <i class="fas fa-info-circle"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Create Status Modal -->
    <div class="create-status-modal" id="createStatusModal">
        <div class="create-status-container">
            <div class="create-status-header">
                <h3>Create Status Update</h3>
                <button class="create-status-close" id="closeCreateStatusModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="create-status-content">
                <!-- Status Type Selection -->
                <div class="status-type-selector" id="statusTypeSelector">
                    <button class="status-type-btn active" data-type="text">
                        <i class="fas fa-font"></i> Text
                    </button>
                    <button class="status-type-btn" data-type="emoji">
                        <i class="fas fa-smile"></i> Emoji
                    </button>
                    <button class="status-type-btn" data-type="photo">
                        <i class="fas fa-image"></i> Photo
                    </button>
                    <button class="status-type-btn" data-type="video">
                        <i class="fas fa-video"></i> Video
                    </button>
                    <button class="status-type-btn" data-type="gif">
                        <i class="fas fa-photo-video"></i> GIF
                    </button>
                </div>
                
                <!-- Text Status Tab -->
                <div class="create-text-status active" id="textStatusTab">
                    <div class="text-editor-container" id="textEditorContainer">
                        <textarea class="text-editor" id="textEditor" placeholder="Type your status here..."></textarea>
                    </div>
                    
                    <div class="text-toolbar">
                        <button class="text-tool-btn" data-format="bold">
                            <i class="fas fa-bold"></i> Bold
                        </button>
                        <button class="text-tool-btn" data-format="italic">
                            <i class="fas fa-italic"></i> Italic
                        </button>
                        <button class="text-tool-btn" data-format="strikethrough">
                            <i class="fas fa-strikethrough"></i> Strikethrough
                        </button>
                        <button class="text-tool-btn" data-format="monospace">
                            <i class="fas fa-code"></i> Monospace
                        </button>
                    </div>
                    
                    <div>
                        <div style="font-weight: 500; margin-bottom: 10px;">Text Color</div>
                        <div class="color-palette" id="textColorPalette">
                            <!-- Colors will be added dynamically -->
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <div style="font-weight: 500; margin-bottom: 10px;">Background Color</div>
                        <div class="color-palette" id="backgroundColorPalette">
                            <!-- Colors will be added dynamically -->
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <div style="font-weight: 500; margin-bottom: 10px;">Font Style</div>
                        <div class="font-options" id="fontOptions">
                            <!-- Fonts will be added dynamically -->
                        </div>
                    </div>
                    
                    <div class="link-preview" id="linkPreview">
                        <!-- Link preview will appear here -->
                    </div>
                </div>
                
                <!-- Emoji Status Tab -->
                <div class="create-text-status" id="emojiStatusTab">
                    <div class="emoji-only-container" id="emojiOnlyContainer">
                        <div class="emoji-only-display" id="emojiOnlyDisplay">üòä</div>
                        <button class="text-tool-btn" id="openEmojiPickerBtn">
                            <i class="fas fa-smile"></i> Choose Emoji
                        </button>
                        <div class="emoji-picker-container" id="emojiPickerContainer">
                            <!-- Emoji picker will be inserted here -->
                        </div>
                    </div>
                    
                    <div>
                        <div style="font-weight: 500; margin-bottom: 10px;">Background Color</div>
                        <div class="color-palette" id="emojiBackgroundPalette">
                            <!-- Colors will be added dynamically -->
                        </div>
                    </div>
                </div>
                
                <!-- Photo/Video/GIF Tab -->
                <div class="create-media-status" id="mediaStatusTab">
                    <div class="media-upload-area" id="mediaUploadArea">
                        <div class="media-upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="media-upload-text" id="mediaUploadText">Tap to upload photo</div>
                        <div class="media-upload-subtext">or drag and drop</div>
                        <div class="video-duration-warning" id="videoDurationWarning">
                            <i class="fas fa-exclamation-triangle"></i> Video must be 10 seconds or less
                        </div>
                        <input type="file" id="mediaUploadInput" accept="image/*,video/*,image/gif" style="display: none;">
                    </div>
                    
                    <div class="media-preview" id="mediaPreview">
                        <img src="" alt="" class="media-preview-img" id="mediaPreviewImg">
                        <video controls class="media-preview-video" id="mediaPreviewVideo" style="display: none;"></video>
                    </div>
                    
                    <div class="media-edit-tools" id="mediaEditTools" style="display: none;">
                        <button class="media-edit-btn" id="addTextBtn">
                            <i class="fas fa-font"></i> Add Text
                        </button>
                        <button class="media-edit-btn" id="addStickerBtn">
                            <i class="fas fa-sticky-note"></i> Add Sticker
                        </button>
                        <button class="media-edit-btn" id="drawBtn">
                            <i class="fas fa-paint-brush"></i> Draw
                        </button>
                        <button class="media-edit-btn" id="addFilterBtn">
                            <i class="fas fa-sliders-h"></i> Filters
                        </button>
                        <button class="media-edit-btn" id="addLinkBtn">
                            <i class="fas fa-link"></i> Add Link
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="create-status-footer">
                <div class="privacy-selector">
                    <button class="privacy-btn" id="privacyBtn">
                        <i class="fas fa-users"></i>
                        <span id="privacyText">My Contacts</span>
                    </button>
                </div>
                <div>
                    <button class="text-tool-btn" id="cancelStatusBtn">Cancel</button>
                    <button class="text-tool-btn" id="postStatusBtn" style="background-color: var(--primary-color); color: white;">Post Status</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Drawing Canvas -->
    <div class="drawing-canvas-container" id="drawingCanvasContainer">
        <canvas class="drawing-canvas" id="drawingCanvas"></canvas>
        <div class="drawing-tools">
            <div class="drawing-colors" id="drawingColors">
                <!-- Colors will be added dynamically -->
            </div>
            <div class="drawing-brushes" id="drawingBrushes">
                <!-- Brushes will be added dynamically -->
            </div>
            <div>
                <button class="text-tool-btn" id="clearDrawingBtn">Clear</button>
                    <button class="text-tool-btn" id="saveDrawingBtn" style="background-color: var(--primary-color); color: white;">Done</button>
            </div>
        </div>
    </div>
    
    <!-- Privacy Settings Modal -->
    <div class="privacy-modal" id="privacyModal">
        <div class="privacy-modal-content">
            <div class="privacy-modal-header">
                <h3>Status Privacy</h3>
            </div>
            <div class="privacy-options">
                <div class="privacy-option active" data-privacy="contacts">
                    <div class="privacy-option-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="privacy-option-info">
                        <div class="privacy-option-title">My Contacts</div>
                        <div class="privacy-option-desc">All your contacts can see your status</div>
                    </div>
                    <div class="privacy-option-check">
                        <i class="fas fa-check"></i>
                    </div>
                </div>
                
                <div class="privacy-option" data-privacy="contacts-except">
                    <div class="privacy-option-icon">
                        <i class="fas fa-user-minus"></i>
                    </div>
                    <div class="privacy-option-info">
                        <div class="privacy-option-title">My Contacts Except...</div>
                        <div class="privacy-option-desc">Exclude specific contacts</div>
                    </div>
                    <div class="privacy-option-check">
                        <i class="fas fa-check"></i>
                    </div>
                </div>
                
                <div class="privacy-option" data-privacy="only-share">
                    <div class="privacy-option-icon">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="privacy-option-info">
                        <div class="privacy-option-title">Only Share With...</div>
                        <div class="privacy-option-desc">Share with selected contacts only</div>
                    </div>
                    <div class="privacy-option-check">
                        <i class="fas fa-check"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Status Info Modal -->
    <div class="status-info-modal" id="statusInfoModal">
        <div class="status-info-content">
            <div class="status-info-header">
                <h3>Status Info</h3>
                <button class="create-status-close" id="closeStatusInfoModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="viewers-list" id="viewersList">
                <!-- Viewers will be listed here -->
            </div>
            <div class="status-info-actions" id="statusInfoActions" style="padding: 20px; border-top: 1px solid var(--border-color); display: none;">
                <button class="chat-user-btn" id="chatUserBtn">
                    <i class="fas fa-comment"></i> Chat with User
                </button>
                <button class="share-status-btn" id="shareStatusInfoBtn" style="margin-top: 10px;">
                    <i class="fas fa-share"></i> Share This Status
                </button>
            </div>
            <div class="status-info-actions" id="ownStatusActions" style="padding: 20px; border-top: 1px solid var(--border-color); display: none;">
                <button class="chat-user-btn" id="deleteStatusBtn" style="background-color: var(--danger-color);">
                    <i class="fas fa-trash"></i> Delete Status
                </button>
            </div>
        </div>
    </div>
    
    <!-- Screenshot Detection Overlay -->
    <div class="screenshot-overlay" id="screenshotOverlay">
        <div class="screenshot-message">
            <h3>Screenshot Detected!</h3>
            <p>You took a screenshot of this status.</p>
            <p style="color: var(--danger-color); font-size: 12px; margin-top: 10px;">
                Note: The status owner will be notified about this screenshot.
            </p>
            <button class="text-tool-btn" id="closeScreenshotOverlay" style="margin-top: 20px;">
                OK
            </button>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Operation completed successfully</span>
    </div>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDHHyGgsSV18BcXrGgzi4C8frzDAE1C1zo",
            authDomain: "uniconnect-ee95c.firebaseapp.com",
            projectId: "uniconnect-ee95c",
            storageBucket: "uniconnect-ee95c.firebasestorage.app",
            messagingSenderId: "1003264444309",
            appId: "1:1003264444309:web:9f0307516e44d21e97d89c"
        };
        
        // Cloudinary Configuration
        const CLOUDINARY_CLOUD_NAME = 'dhjnxa5rh';
        const CLOUDINARY_API_KEY = '817591969559894';
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const storage = firebase.storage();
        
        // Global variables
        let currentUser = null;
        let currentStatusIndex = 0;
        let currentStatusUser = null;
        let userStatuses = [];
        let statusInterval = null;
        let currentMediaType = null;
        let currentMediaFile = null;
        let canvas = null;
        let fabricCanvas = null;
        let selectedPrivacy = 'contacts';
        let allStatuses = [];
        let viewedStatuses = [];
        let mutedUsers = [];
        let currentCategory = 'recent';
        let selectedStatusType = 'text';
        let selectedEmoji = 'üòä';
        let currentStatusId = null;
        let screenshotDetected = false;
        let userTheme = null;
        let userMood = null;
        
        // Color palettes
        const textColors = [
            '#ffffff', '#000000', '#0084ff', '#34c759', '#ff3b30',
            '#ff9500', '#5856d6', '#af52de', '#ff2d55', '#007aff'
        ];
        
        const backgroundColors = [
            '#0084ff', '#34c759', '#ff3b30', '#ff9500', '#5856d6',
            '#af52de', '#ff2d55', '#5ac8fa', '#4cd964', '#ffcc00'
        ];
        
        const fonts = [
            { name: 'Default', value: 'Segoe UI, sans-serif' },
            { name: 'Serif', value: 'Georgia, serif' },
            { name: 'Monospace', value: 'Courier New, monospace' },
            { name: 'Cursive', value: 'cursive' },
            { name: 'Impact', value: 'Impact, sans-serif' }
        ];
        
        // Drawing colors
        const drawingColors = [
            '#000000', '#ffffff', '#ff3b30', '#ff9500', '#ffcc00',
            '#34c759', '#0084ff', '#5856d6', '#af52de', '#ff2d55'
        ];
        
        // Drawing brush sizes
        const brushSizes = [2, 5, 10, 15, 20];
        
        // DOM Elements
        const statusViewer = document.getElementById('statusViewer');
        const createStatusModal = document.getElementById('createStatusModal');
        const privacyModal = document.getElementById('privacyModal');
        const statusInfoModal = document.getElementById('statusInfoModal');
        const drawingCanvasContainer = document.getElementById('drawingCanvasContainer');
        const notification = document.getElementById('notification');
        const screenshotOverlay = document.getElementById('screenshotOverlay');
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadUserThemeAndMood();
            initializeApp();
            setupEventListeners();
            initializeColorPalettes();
            initializeFontOptions();
            initializeDrawingTools();
            initializeEmojiPicker();
            setupScreenshotDetection();
        });
        
        function loadUserThemeAndMood() {
            try {
                // Load theme from localStorage or default
                const savedTheme = localStorage.getItem('selectedTheme');
                const savedMood = localStorage.getItem('selectedMood');
                
                userTheme = savedTheme || 'light';
                userMood = savedMood || 'happy';
                
                // Apply theme
                applyTheme(userTheme);
                
                // Apply mood if needed (for status page, mood affects colors)
                applyMoodColors(userMood);
                
            } catch (error) {
                console.error('Error loading user theme/mood:', error);
                userTheme = 'light';
                userMood = 'happy';
            }
        }
        
        function applyTheme(theme) {
            // Apply theme colors based on selection
            if (theme === 'dark') {
                document.documentElement.style.setProperty('--bg-color', '#1a1a1a');
                document.documentElement.style.setProperty('--text-primary', '#ffffff');
                document.documentElement.style.setProperty('--text-secondary', '#b0b3b8');
                document.documentElement.style.setProperty('--secondary-color', '#2d2d2d');
                document.documentElement.style.setProperty('--border-color', '#3e3e3e');
            } else {
                document.documentElement.style.setProperty('--bg-color', '#ffffff');
                document.documentElement.style.setProperty('--text-primary', '#050505');
                document.documentElement.style.setProperty('--text-secondary', '#65676b');
                document.documentElement.style.setProperty('--secondary-color', '#f0f2f5');
                document.documentElement.style.setProperty('--border-color', '#dddfe2');
            }
        }
        
        function applyMoodColors(mood) {
            // Update color palettes based on mood
            const moodColors = {
                happy: ['#FFD700', '#FF6B6B', '#4ECDC4', '#FF9FF3', '#54A0FF'],
                sad: ['#6C5CE7', '#00CEC9', '#A29BFE', '#FD79A8', '#81ECEC'],
                excited: ['#FF7675', '#FDCB6E', '#00B894', '#6C5CE7', '#FFEAA7'],
                relaxed: ['#74B9FF', '#55E6C1', '#CAD3C8', '#F97F51', '#B33771'],
                angry: ['#D63031', '#E17055', '#FDCB6E', '#00B894', '#6C5CE7']
            };
            
            const moodGradients = {
                happy: 'linear-gradient(45deg, #FFD700, #FF6B6B)',
                sad: 'linear-gradient(45deg, #6C5CE7, #00CEC9)',
                excited: 'linear-gradient(45deg, #FF7675, #FDCB6E)',
                relaxed: 'linear-gradient(45deg, #74B9FF, #55E6C1)',
                angry: 'linear-gradient(45deg, #D63031, #E17055)'
            };
            
            if (moodColors[mood]) {
                // Update background colors with mood colors
                backgroundColors.length = 0;
                backgroundColors.push(...moodColors[mood], ...backgroundColors.slice(5));
                
                // Update status gradient
                document.documentElement.style.setProperty('--status-gradient', moodGradients[mood] || 'linear-gradient(45deg, #0084ff, #00c6ff)');
                
                // Reinitialize color palettes
                initializeColorPalettes();
            }
        }
        
        function initializeApp() {
            // Check if user is logged in
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    loadUserData();
                    loadMutedUsers();
                    loadStatusUpdates();
                } else {
                    // Redirect to login page if not authenticated
                    window.location.href = 'index.html';
                }
            });
        }
        
        async function loadMutedUsers() {
            try {
                const userPrefs = localStorage.getItem(`mutedUsers_${currentUser.uid}`);
                if (userPrefs) {
                    mutedUsers = JSON.parse(userPrefs);
                } else {
                    mutedUsers = [];
                }
            } catch (error) {
                console.error('Error loading muted users:', error);
                mutedUsers = [];
            }
        }
        
        function saveMutedUsers() {
            try {
                localStorage.setItem(`mutedUsers_${currentUser.uid}`, JSON.stringify(mutedUsers));
            } catch (error) {
                console.error('Error saving muted users:', error);
            }
        }
        
        function loadUserData() {
            const myStatusAvatar = document.getElementById('myStatusAvatar');
            const userInitials = currentUser.displayName ? 
                currentUser.displayName.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2) : 
                'ME';
            
            if (currentUser.photoURL) {
                myStatusAvatar.style.backgroundImage = `url('${currentUser.photoURL}')`;
                myStatusAvatar.innerHTML = '';
            } else {
                myStatusAvatar.innerHTML = `<span>${userInitials}</span>`;
            }
        }
        
        async function loadStatusUpdates() {
            try {
                const now = new Date();
                
                // Load all statuses that expire in the future
                let statusesSnapshot;
                try {
                    statusesSnapshot = await db.collection('statuses')
                        .where('expiresAt', '>', now)
                        .orderBy('expiresAt', 'desc')
                        .limit(50)
                        .get();
                } catch (error) {
                    console.warn('Complex query failed, falling back to client-side filtering:', error);
                    statusesSnapshot = await db.collection('statuses')
                        .orderBy('createdAt', 'desc')
                        .limit(100)
                        .get();
                }
                
                // Get user's viewed statuses from localStorage
                const viewedKey = `viewedStatuses_${currentUser.uid}`;
                const viewedData = localStorage.getItem(viewedKey);
                viewedStatuses = viewedData ? JSON.parse(viewedData) : [];
                
                // Process statuses
                allStatuses = [];
                const userStatusMap = new Map();
                
                statusesSnapshot.forEach(doc => {
                    const statusData = doc.data();
                    const status = {
                        id: doc.id,
                        ...statusData,
                        createdAt: statusData.createdAt ? statusData.createdAt.toDate() : new Date(),
                        expiresAt: statusData.expiresAt ? statusData.expiresAt.toDate() : new Date(now.getTime() + 24 * 60 * 60 * 1000)
                    };
                    
                    // Filter out expired statuses client-side if needed
                    if (status.expiresAt > now) {
                        // Don't show user's own statuses in the contacts list
                        if (status.userId !== currentUser.uid) {
                            if (!userStatusMap.has(status.userId)) {
                                userStatusMap.set(status.userId, []);
                            }
                            userStatusMap.get(status.userId).push(status);
                        }
                        
                        allStatuses.push(status);
                    }
                });
                
                // Update my status item
                updateMyStatusItem();
                
                // Update the status list based on current category
                updateStatusListByCategory();
                
            } catch (error) {
                console.error('Error loading status updates:', error);
                showNotification('Failed to load status updates', 'error');
                
                setTimeout(() => {
                    updateStatusListByCategory();
                }, 1000);
            }
        }
        
        async function updateMyStatusItem() {
            const myStatuses = await getUserStatuses(currentUser.uid);
            const myStatusItem = document.getElementById('myStatusItem');
            const myStatusOptions = document.getElementById('myStatusOptions');
            
            if (myStatuses && myStatuses.length > 0) {
                const latestStatus = myStatuses[0];
                const statusCount = myStatuses.length;
                
                myStatusItem.querySelector('.my-status-desc').textContent = 
                    `${statusCount} update${statusCount > 1 ? 's' : ''}`;
                
                // Add status ring to avatar
                myStatusItem.querySelector('.my-status-avatar').classList.add('has-status');
                
                // Show delete button
                myStatusOptions.style.display = 'block';
                
                // Store current user's statuses for deletion
                window.myCurrentStatuses = myStatuses;
            } else {
                myStatusItem.querySelector('.my-status-desc').textContent = 'Tap to add status update';
                myStatusItem.querySelector('.my-status-avatar').classList.remove('has-status');
                myStatusOptions.style.display = 'none';
            }
        }
        
        async function getUserStatuses(userId) {
            try {
                const now = new Date();
                let statusesSnapshot;
                
                try {
                    statusesSnapshot = await db.collection('statuses')
                        .where('userId', '==', userId)
                        .where('expiresAt', '>', now)
                        .orderBy('expiresAt', 'desc')
                        .get();
                } catch (error) {
                    statusesSnapshot = await db.collection('statuses')
                        .where('userId', '==', userId)
                        .orderBy('createdAt', 'desc')
                        .limit(20)
                        .get();
                }
                
                const statuses = [];
                statusesSnapshot.forEach(doc => {
                    const statusData = doc.data();
                    const status = {
                        id: doc.id,
                        ...statusData,
                        createdAt: statusData.createdAt ? statusData.createdAt.toDate() : new Date(),
                        expiresAt: statusData.expiresAt ? statusData.expiresAt.toDate() : new Date(now.getTime() + 24 * 60 * 60 * 1000)
                    };
                    
                    if (status.expiresAt > now) {
                        statuses.push(status);
                    }
                });
                
                return statuses;
            } catch (error) {
                console.error('Error getting user statuses:', error);
                return [];
            }
        }
        
        function updateStatusListByCategory() {
            const recentStatusList = document.getElementById('recentStatusList');
            
            // Filter statuses based on current category
            let filteredStatuses = [];
            
            switch(currentCategory) {
                case 'recent':
                    filteredStatuses = allStatuses.filter(status => 
                        !viewedStatuses.includes(status.id) && 
                        !mutedUsers.includes(status.userId)
                    );
                    break;
                    
                case 'viewed':
                    filteredStatuses = allStatuses.filter(status => 
                        viewedStatuses.includes(status.id) &&
                        !mutedUsers.includes(status.userId)
                    );
                    break;
                    
                case 'muted':
                    filteredStatuses = allStatuses.filter(status => 
                        mutedUsers.includes(status.userId)
                    );
                    break;
            }
            
            // Group by user
            const statusesByUser = {};
            filteredStatuses.forEach(status => {
                if (!statusesByUser[status.userId]) {
                    statusesByUser[status.userId] = [];
                }
                statusesByUser[status.userId].push(status);
            });
            
            // Clear current list
            recentStatusList.innerHTML = '';
            
            // Add status items
            Object.keys(statusesByUser).forEach(userId => {
                const userStatuses = statusesByUser[userId];
                const latestStatus = userStatuses[0];
                const userStatusCount = userStatuses.length;
                
                const timeAgo = getTimeAgo(latestStatus.createdAt);
                const initials = latestStatus.userName ? 
                    latestStatus.userName.split(' ').map(word => word[0]).join('').toUpperCase().substring(0, 2) : 
                    'U';
                
                const statusItem = document.createElement('div');
                statusItem.className = 'contact-status-item has-status';
                statusItem.dataset.userId = latestStatus.userId;
                statusItem.dataset.userName = latestStatus.userName || 'User';
                
                statusItem.innerHTML = `
                    <div class="contact-status-avatar" ${latestStatus.userAvatar ? `style="background-image: url('${latestStatus.userAvatar}')"` : ''}>
                        <div class="status-ring"></div>
                        ${latestStatus.userAvatar ? '' : `<span>${initials}</span>`}
                    </div>
                    <div class="contact-status-info">
                        <div class="contact-status-name">${latestStatus.userName || 'User'}</div>
                        <div class="contact-status-time">${timeAgo}</div>
                    </div>
                    <div class="contact-status-count">${userStatusCount}</div>
                `;
                
                statusItem.addEventListener('click', () => {
                    openStatusViewer(latestStatus.userId, userStatuses);
                });
                
                recentStatusList.appendChild(statusItem);
            });
            
            // If no statuses, show empty state
            if (Object.keys(statusesByUser).length === 0) {
                let emptyMessage = '';
                switch(currentCategory) {
                    case 'recent':
                        emptyMessage = 'No recent status updates from your contacts';
                        break;
                    case 'viewed':
                        emptyMessage = 'No viewed status updates';
                        break;
                    case 'muted':
                        emptyMessage = 'No muted users with status updates';
                        break;
                }
                
                recentStatusList.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                        <i class="fas fa-comment" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>${emptyMessage}</p>
                        ${currentCategory === 'muted' ? 
                            '<p style="font-size: 14px; margin-top: 10px;">Mute users by clicking on their status and selecting "Mute User"</p>' : 
                            ''}
                    </div>
                `;
            }
        }
        
        function getTimeAgo(date) {
            if (!date) return 'Just now';
            
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return `${Math.floor(diffDays / 7)}w ago`;
        }
        
        function openStatusViewer(userId, statuses) {
            currentStatusUser = userId;
            userStatuses = statuses;
            currentStatusIndex = 0;
            
            // Show status viewer
            statusViewer.classList.add('active');
            
            // Load first status
            loadStatus(currentStatusIndex);
            
            // Start auto-advance timer
            startStatusTimer();
            
            // Show share button for other users' statuses
            const shareBtn = document.getElementById('shareStatusBtn');
            shareBtn.style.display = userId !== currentUser.uid ? 'flex' : 'none';
        }
        
        function loadStatus(index) {
            if (!userStatuses || index >= userStatuses.length) {
                closeStatusViewer();
                return;
            }
            
            const status = userStatuses[index];
            currentStatusId = status.id;
            
            // Update user info
            document.getElementById('statusUserName').textContent = status.userName || 'User';
            document.getElementById('statusTime').textContent = getTimeAgo(status.createdAt);
            
            // Update user avatar
            const statusUserAvatar = document.querySelector('.status-user-avatar');
            const initials = status.userName ? 
                status.userName.split(' ').map(word => word[0]).join('').toUpperCase().substring(0, 2) : 
                'U';
            
            if (status.userAvatar) {
                statusUserAvatar.style.backgroundImage = `url('${status.userAvatar}')`;
                statusUserAvatar.innerHTML = '';
            } else {
                statusUserAvatar.style.backgroundImage = '';
                statusUserAvatar.innerHTML = `<span>${initials}</span>`;
            }
            
            // Clear previous content
            const statusContent = document.getElementById('statusContent');
            statusContent.innerHTML = '';
            
            // Create progress bars
            updateProgressBars();
            
            // Load status content based on type
            if (status.type === 'text' || status.type === 'emoji') {
                const textStatus = document.createElement('div');
                textStatus.className = 'text-status';
                textStatus.style.color = status.textColor || '#ffffff';
                textStatus.style.backgroundColor = status.backgroundColor || '#0084ff';
                textStatus.style.fontFamily = status.font || 'Segoe UI, sans-serif';
                textStatus.style.padding = '40px';
                textStatus.style.borderRadius = '20px';
                textStatus.style.maxWidth = '800px';
                textStatus.style.margin = '0 auto';
                textStatus.style.fontSize = status.type === 'emoji' ? '80px' : '32px';
                textStatus.style.display = 'flex';
                textStatus.style.alignItems = 'center';
                textStatus.style.justifyContent = 'center';
                textStatus.style.minHeight = '300px';
                
                if (status.type === 'emoji') {
                    textStatus.textContent = status.content || 'üòä';
                } else {
                    textStatus.innerHTML = formatText(status.content || '');
                }
                
                statusContent.appendChild(textStatus);
            } else if (status.type === 'image' || status.type === 'gif') {
                const img = document.createElement('img');
                img.className = 'status-media';
                img.src = status.content || 'https://via.placeholder.com/800x1400/0084ff/ffffff?text=Status+Image';
                img.alt = status.caption || 'Status image';
                img.onerror = function() {
                    this.src = 'https://via.placeholder.com/800x1400/0084ff/ffffff?text=Image+Not+Found';
                };
                
                statusContent.appendChild(img);
                
                if (status.caption) {
                    const caption = document.createElement('div');
                    caption.className = 'text-status';
                    caption.style.position = 'absolute';
                    caption.style.bottom = '100px';
                    caption.style.left = '0';
                    caption.style.right = '0';
                    caption.style.textAlign = 'center';
                    caption.style.padding = '20px';
                    caption.style.fontSize = '20px';
                    caption.textContent = status.caption;
                    
                    statusContent.appendChild(caption);
                }
            } else if (status.type === 'video') {
                const video = document.createElement('video');
                video.className = 'status-media';
                video.src = status.content || '';
                video.controls = true;
                video.autoplay = true;
                video.muted = false;
                video.onended = function() {
                    // Auto-advance to next status when video ends
                    setTimeout(() => {
                        currentStatusIndex++;
                        if (currentStatusIndex < userStatuses.length) {
                            loadStatus(currentStatusIndex);
                        } else {
                            closeStatusViewer();
                        }
                    }, 1000);
                };
                
                statusContent.appendChild(video);
                
                if (status.caption) {
                    const caption = document.createElement('div');
                    caption.className = 'text-status';
                    caption.style.position = 'absolute';
                    caption.style.bottom = '100px';
                    caption.style.left = '0';
                    caption.style.right = '0';
                    caption.style.textAlign = 'center';
                    caption.style.padding = '20px';
                    caption.style.fontSize = '20px';
                    caption.textContent = status.caption;
                    
                    statusContent.appendChild(caption);
                }
            }
            
            // Mark as viewed (only if not the owner)
            if (status.userId !== currentUser.uid) {
                markStatusAsViewed(status.id);
            }
        }
        
        function formatText(text) {
            return (text || '')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/~~(.*?)~~/g, '<s>$1</s>')
                .replace(/`(.*?)`/g, '<code>$1</code>');
        }
        
        function updateProgressBars() {
            const container = document.getElementById('statusProgressContainer');
            container.innerHTML = '';
            
            userStatuses.forEach((status, index) => {
                const progressBar = document.createElement('div');
                progressBar.className = 'status-progress-bar';
                
                const progressFill = document.createElement('div');
                progressFill.className = 'status-progress-fill';
                progressFill.style.width = index < currentStatusIndex ? '100%' : '0%';
                
                progressBar.appendChild(progressFill);
                container.appendChild(progressBar);
            });
        }
        
        function startStatusTimer() {
            if (statusInterval) clearInterval(statusInterval);
            
            // Don't start timer for videos (they have their own controls)
            if (userStatuses[currentStatusIndex] && userStatuses[currentStatusIndex].type === 'video') {
                return;
            }
            
            statusInterval = setInterval(() => {
                const progressBars = document.querySelectorAll('.status-progress-fill');
                if (progressBars[currentStatusIndex]) {
                    const currentWidth = parseFloat(progressBars[currentStatusIndex].style.width) || 0;
                    const newWidth = Math.min(currentWidth + 0.5, 100); // 10 seconds total
                    progressBars[currentStatusIndex].style.width = `${newWidth}%`;
                    
                    if (newWidth >= 100) {
                        currentStatusIndex++;
                        if (currentStatusIndex < userStatuses.length) {
                            loadStatus(currentStatusIndex);
                        } else {
                            closeStatusViewer();
                        }
                    }
                }
            }, 50);
        }
        
        async function markStatusAsViewed(statusId) {
            try {
                if (!viewedStatuses.includes(statusId)) {
                    viewedStatuses.push(statusId);
                    localStorage.setItem(`viewedStatuses_${currentUser.uid}`, JSON.stringify(viewedStatuses));
                    
                    // Update in Firestore
                    try {
                        await db.collection('statuses')
                            .doc(statusId)
                            .update({
                                viewers: firebase.firestore.FieldValue.arrayUnion(currentUser.uid)
                            });
                    } catch (error) {
                        console.log('Could not update viewers in Firestore:', error.message);
                    }
                    
                    // Update the status list
                    updateStatusListByCategory();
                }
            } catch (error) {
                console.error('Error marking status as viewed:', error);
            }
        }
        
        function closeStatusViewer() {
            statusViewer.classList.remove('active');
            if (statusInterval) {
                clearInterval(statusInterval);
                statusInterval = null;
            }
        }
        
        function initializeColorPalettes() {
            // Text color palette
            const textColorPalette = document.getElementById('textColorPalette');
            textColorPalette.innerHTML = '';
            textColors.forEach(color => {
                const colorOption = document.createElement('div');
                colorOption.className = 'color-option';
                colorOption.style.backgroundColor = color;
                colorOption.dataset.color = color;
                colorOption.addEventListener('click', () => selectTextColor(color));
                textColorPalette.appendChild(colorOption);
            });
            
            if (textColors.length > 0) {
                selectTextColor(textColors[0]);
            }
            
            // Background color palette
            const backgroundColorPalette = document.getElementById('backgroundColorPalette');
            backgroundColorPalette.innerHTML = '';
            backgroundColors.forEach(color => {
                const colorOption = document.createElement('div');
                colorOption.className = 'color-option';
                colorOption.style.backgroundColor = color;
                colorOption.dataset.color = color;
                colorOption.addEventListener('click', () => selectBackgroundColor(color));
                backgroundColorPalette.appendChild(colorOption);
            });
            
            if (backgroundColors.length > 0) {
                selectBackgroundColor(backgroundColors[0]);
            }
            
            // Emoji background palette
            const emojiBackgroundPalette = document.getElementById('emojiBackgroundPalette');
            emojiBackgroundPalette.innerHTML = '';
            backgroundColors.forEach(color => {
                const colorOption = document.createElement('div');
                colorOption.className = 'color-option';
                colorOption.style.backgroundColor = color;
                colorOption.dataset.color = color;
                colorOption.addEventListener('click', () => selectEmojiBackgroundColor(color));
                emojiBackgroundPalette.appendChild(colorOption);
            });
        }
        
        function initializeFontOptions() {
            const fontOptions = document.getElementById('fontOptions');
            fonts.forEach(font => {
                const fontOption = document.createElement('div');
                fontOption.className = 'font-option';
                fontOption.textContent = font.name;
                fontOption.style.fontFamily = font.value;
                fontOption.dataset.font = font.value;
                fontOption.addEventListener('click', () => selectFont(font.value));
                fontOptions.appendChild(fontOption);
            });
            
            if (fonts.length > 0) {
                selectFont(fonts[0].value);
            }
        }
        
        function initializeDrawingTools() {
            const drawingColorsContainer = document.getElementById('drawingColors');
            drawingColors.forEach(color => {
                const colorOption = document.createElement('div');
                colorOption.className = 'drawing-color';
                colorOption.style.backgroundColor = color;
                colorOption.dataset.color = color;
                colorOption.addEventListener('click', () => selectDrawingColor(color));
                drawingColorsContainer.appendChild(colorOption);
            });
            
            if (drawingColors.length > 0) {
                selectDrawingColor(drawingColors[0]);
            }
            
            const drawingBrushesContainer = document.getElementById('drawingBrushes');
            brushSizes.forEach(size => {
                const brushOption = document.createElement('div');
                brushOption.className = 'drawing-brush';
                brushOption.textContent = size;
                brushOption.dataset.size = size;
                brushOption.addEventListener('click', () => selectBrushSize(size));
                drawingBrushesContainer.appendChild(brushOption);
            });
            
            if (brushSizes.length > 0) {
                selectBrushSize(brushSizes[0]);
            }
            
            const canvasElement = document.getElementById('drawingCanvas');
            fabricCanvas = new fabric.Canvas(canvasElement, {
                isDrawingMode: true,
                width: window.innerWidth,
                height: window.innerHeight - 100
            });
            
            fabricCanvas.freeDrawingBrush = new fabric.PencilBrush(fabricCanvas);
            fabricCanvas.freeDrawingBrush.width = brushSizes[0];
            fabricCanvas.freeDrawingBrush.color = drawingColors[0];
        }
        
        function initializeEmojiPicker() {
            // Initialize emoji picker
            const picker = new EmojiPicker();
            picker.addEventListener('emoji-click', event => {
                selectedEmoji = event.detail.unicode;
                document.getElementById('emojiOnlyDisplay').textContent = selectedEmoji;
                document.getElementById('emojiPickerContainer').classList.remove('active');
            });
            
            document.getElementById('emojiPickerContainer').appendChild(picker);
        }
        
        function setupScreenshotDetection() {
            // Listen for key combinations (Ctrl+Shift+S, Print Screen, etc.)
            document.addEventListener('keydown', function(e) {
                // Detect Print Screen key
                if (e.key === 'PrintScreen') {
                    handleScreenshot();
                }
                
                // Detect Ctrl+Shift+S (common screenshot shortcut)
                if (e.ctrlKey && e.shiftKey && e.key === 'S') {
                    handleScreenshot();
                }
            });
            
            // Also listen for the clipboard paste event (for screenshots copied to clipboard)
            document.addEventListener('paste', function(e) {
                // Check if pasted content is an image
                const items = e.clipboardData.items;
                for (let i = 0; i < items.length; i++) {
                    if (items[i].type.indexOf('image') !== -1) {
                        handleScreenshot();
                        break;
                    }
                }
            });
        }
        
        function handleScreenshot() {
            if (statusViewer.classList.contains('active') && !screenshotDetected) {
                screenshotDetected = true;
                
                // Show screenshot overlay
                screenshotOverlay.classList.add('active');
                
                // Notify the status owner
                if (currentStatusUser && currentStatusUser !== currentUser.uid) {
                    notifyScreenshotToOwner(currentStatusUser, currentStatusId);
                }
                
                // Prevent multiple detections
                setTimeout(() => {
                    screenshotDetected = false;
                }, 5000);
            }
        }
        
        async function notifyScreenshotToOwner(userId, statusId) {
            try {
                // Get status data
                const statusDoc = await db.collection('statuses').doc(statusId).get();
                if (!statusDoc.exists) return;
                
                const statusData = statusDoc.data();
                
                // Create notification in Firestore
                await db.collection('notifications').add({
                    type: 'screenshot',
                    fromUserId: currentUser.uid,
                    fromUserName: currentUser.displayName || 'Someone',
                    toUserId: userId,
                    statusId: statusId,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    read: false
                });
                
                console.log('Screenshot notification sent to status owner');
            } catch (error) {
                console.error('Error notifying screenshot:', error);
            }
        }
        
        function selectTextColor(color) {
            document.querySelectorAll('#textColorPalette .color-option').forEach(opt => {
                opt.classList.remove('active');
                if (opt.dataset.color === color) {
                    opt.classList.add('active');
                }
            });
            
            document.getElementById('textEditor').style.color = color;
        }
        
        function selectBackgroundColor(color) {
            document.querySelectorAll('#backgroundColorPalette .color-option').forEach(opt => {
                opt.classList.remove('active');
                if (opt.dataset.color === color) {
                    opt.classList.add('active');
                }
            });
            
            document.getElementById('textEditorContainer').style.backgroundColor = color;
        }
        
        function selectEmojiBackgroundColor(color) {
            document.querySelectorAll('#emojiBackgroundPalette .color-option').forEach(opt => {
                opt.classList.remove('active');
                if (opt.dataset.color === color) {
                    opt.classList.add('active');
                }
            });
            
            document.getElementById('emojiOnlyContainer').style.backgroundColor = color;
        }
        
        function selectFont(font) {
            document.querySelectorAll('#fontOptions .font-option').forEach(opt => {
                opt.classList.remove('active');
                if (opt.dataset.font === font) {
                    opt.classList.add('active');
                }
            });
            
            document.getElementById('textEditor').style.fontFamily = font;
        }
        
        function selectDrawingColor(color) {
            document.querySelectorAll('#drawingColors .drawing-color').forEach(opt => {
                opt.classList.remove('active');
                if (opt.dataset.color === color) {
                    opt.classList.add('active');
                }
            });
            
            if (fabricCanvas) {
                fabricCanvas.freeDrawingBrush.color = color;
            }
        }
        
        function selectBrushSize(size) {
            document.querySelectorAll('#drawingBrushes .drawing-brush').forEach(opt => {
                opt.classList.remove('active');
                if (opt.dataset.size == size) {
                    opt.classList.add('active');
                }
            });
            
            if (fabricCanvas) {
                fabricCanvas.freeDrawingBrush.width = parseInt(size);
            }
        }
        
        function showNotification(message, type = 'success') {
            const notificationText = document.getElementById('notificationText');
            notificationText.textContent = message;
            
            notification.className = 'notification';
            notification.classList.add(type);
            
            notification.classList.add('active');
            
            setTimeout(() => {
                notification.classList.remove('active');
            }, 3000);
        }
        
        async function uploadToCloudinary(file) {
            return new Promise((resolve, reject) => {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('upload_preset', 'status_uploads');
                formData.append('cloud_name', CLOUDINARY_CLOUD_NAME);
                
                fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/upload`, {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.secure_url) {
                        resolve(data.secure_url);
                    } else {
                        reject(new Error('Upload failed'));
                    }
                })
                .catch(error => {
                    reject(error);
                });
            });
        }
        
        async function saveStatusToFirestore(statusData) {
            try {
                // Calculate expiration time (24 hours from now)
                const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000);
                
                const statusRef = await db.collection('statuses').add({
                    ...statusData,
                    userId: currentUser.uid,
                    userName: currentUser.displayName || 'User',
                    userAvatar: currentUser.photoURL || '',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    expiresAt: expiresAt,
                    viewers: [],
                    reactions: {},
                    screenshotNotifications: [],
                    mood: userMood || 'happy'
                });
                
                return statusRef.id;
            } catch (error) {
                console.error('Error saving status:', error);
                throw error;
            }
        }
        
        async function deleteStatus(statusId) {
            try {
                if (!confirm('Are you sure you want to delete this status?')) {
                    return;
                }
                
                await db.collection('statuses').doc(statusId).delete();
                showNotification('Status deleted successfully', 'success');
                
                // Close modals
                statusInfoModal.classList.remove('active');
                closeStatusViewer();
                
                // Reload statuses
                loadStatusUpdates();
                
            } catch (error) {
                console.error('Error deleting status:', error);
                showNotification('Failed to delete status', 'error');
            }
        }
        
        async function shareStatus(statusId) {
            try {
                const statusDoc = await db.collection('statuses').doc(statusId).get();
                if (!statusDoc.exists) {
                    showNotification('Status not found', 'error');
                    return;
                }
                
                const statusData = statusDoc.data();
                
                // Create a shared status record
                await db.collection('shared_statuses').add({
                    originalStatusId: statusId,
                    originalUserId: statusData.userId,
                    sharedByUserId: currentUser.uid,
                    sharedByUserName: currentUser.displayName || 'User',
                    sharedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    statusType: statusData.type,
                    statusContent: statusData.content,
                    statusCaption: statusData.caption || '',
                    privacy: 'contacts'
                });
                
                showNotification('Status shared successfully', 'success');
                
            } catch (error) {
                console.error('Error sharing status:', error);
                showNotification('Failed to share status', 'error');
            }
        }
        
        async function openChatWithUser(userId) {
            try {
                const userDoc = await db.collection('users').doc(userId).get();
                if (!userDoc.exists) {
                    showNotification('User not found', 'error');
                    return;
                }
                
                const userData = userDoc.data();
                const chatId = [currentUser.uid, userId].sort().join('_');
                const chatDoc = await db.collection('chats').doc(chatId).get();
                
                if (!chatDoc.exists) {
                    await db.collection('chats').doc(chatId).set({
                        participants: [currentUser.uid, userId],
                        participantNames: [currentUser.displayName, userData.displayName],
                        participantAvatars: [currentUser.photoURL || '', userData.photoURL || ''],
                        lastMessage: '',
                        lastMessageTime: firebase.firestore.FieldValue.serverTimestamp(),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    await db.collection('chats').doc(chatId).collection('messages').add({
                        senderId: currentUser.uid,
                        senderName: currentUser.displayName,
                        content: `Started a chat from status view`,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        type: 'system'
                    });
                }
                
                statusInfoModal.classList.remove('active');
                closeStatusViewer();
                
                window.location.href = `chat.html?chatId=${chatId}`;
                
            } catch (error) {
                console.error('Error opening chat:', error);
                showNotification('Failed to open chat', 'error');
            }
        }
        
        function setupEventListeners() {
            // New status button
            document.getElementById('newStatusBtn').addEventListener('click', () => {
                createStatusModal.classList.add('active');
            });
            
            // My status item
            document.getElementById('myStatusItem').addEventListener('click', () => {
                createStatusModal.classList.add('active');
            });
            
            // Delete my status button
            document.getElementById('deleteMyStatusBtn').addEventListener('click', async () => {
                const myStatuses = window.myCurrentStatuses;
                if (myStatuses && myStatuses.length > 0) {
                    if (confirm(`Delete all ${myStatuses.length} of your status updates?`)) {
                        for (const status of myStatuses) {
                            await deleteStatus(status.id);
                        }
                        showNotification('All statuses deleted', 'success');
                        loadStatusUpdates();
                    }
                }
            });
            
            // Close status viewer
            document.getElementById('closeStatusViewer').addEventListener('click', closeStatusViewer);
            
            // Close create status modal
            document.getElementById('closeCreateStatusModal').addEventListener('click', () => {
                createStatusModal.classList.remove('active');
                resetCreateStatusForm();
            });
            
            document.getElementById('cancelStatusBtn').addEventListener('click', () => {
                createStatusModal.classList.remove('active');
                resetCreateStatusForm();
            });
            
            // Status type selection
            document.querySelectorAll('.status-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const type = this.dataset.type;
                    selectedStatusType = type;
                    
                    // Update active button
                    document.querySelectorAll('.status-type-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Show corresponding content
                    document.querySelectorAll('.create-text-status, .create-media-status').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    if (type === 'text') {
                        document.getElementById('textStatusTab').classList.add('active');
                        document.getElementById('mediaUploadText').textContent = 'Tap to upload photo';
                        currentMediaType = null;
                    } else if (type === 'emoji') {
                        document.getElementById('emojiStatusTab').classList.add('active');
                        currentMediaType = null;
                    } else {
                        document.getElementById('mediaStatusTab').classList.add('active');
                        currentMediaType = type;
                        document.getElementById('mediaUploadText').textContent = `Tap to upload ${type}`;
                        
                        // Show/hide video duration warning
                        const warning = document.getElementById('videoDurationWarning');
                        if (type === 'video') {
                            warning.classList.add('active');
                        } else {
                            warning.classList.remove('active');
                        }
                    }
                });
            });
            
            // Text formatting buttons
            document.querySelectorAll('.text-tool-btn[data-format]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const format = this.dataset.format;
                    const textEditor = document.getElementById('textEditor');
                    const start = textEditor.selectionStart;
                    const end = textEditor.selectionEnd;
                    const selectedText = textEditor.value.substring(start, end);
                    
                    let formattedText = selectedText;
                    
                    switch(format) {
                        case 'bold':
                            formattedText = `**${selectedText}**`;
                            break;
                        case 'italic':
                            formattedText = `*${selectedText}*`;
                            break;
                        case 'strikethrough':
                            formattedText = `~~${selectedText}~~`;
                            break;
                        case 'monospace':
                            formattedText = `\`${selectedText}\``;
                            break;
                    }
                    
                    textEditor.value = textEditor.value.substring(0, start) + 
                                      formattedText + 
                                      textEditor.value.substring(end);
                    
                    this.classList.toggle('active');
                });
            });
            
            // Open emoji picker
            document.getElementById('openEmojiPickerBtn').addEventListener('click', () => {
                document.getElementById('emojiPickerContainer').classList.toggle('active');
            });
            
            // Media upload area
            document.getElementById('mediaUploadArea').addEventListener('click', () => {
                document.getElementById('mediaUploadInput').click();
            });
            
            document.getElementById('mediaUploadInput').addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    const file = e.target.files[0];
                    currentMediaFile = file;
                    
                    if (file.type.startsWith('image/')) {
                        if (file.type === 'image/gif') {
                            currentMediaType = 'gif';
                        } else {
                            currentMediaType = 'photo';
                        }
                        
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            const mediaPreview = document.getElementById('mediaPreview');
                            const mediaPreviewImg = document.getElementById('mediaPreviewImg');
                            
                            mediaPreviewImg.src = event.target.result;
                            mediaPreview.classList.add('active');
                            mediaPreviewImg.style.display = 'block';
                            document.getElementById('mediaPreviewVideo').style.display = 'none';
                            
                            document.getElementById('mediaEditTools').style.display = 'flex';
                        };
                        reader.readAsDataURL(file);
                        
                    } else if (file.type.startsWith('video/')) {
                        currentMediaType = 'video';
                        
                        const video = document.createElement('video');
                        video.preload = 'metadata';
                        
                        video.onloadedmetadata = function() {
                            window.URL.revokeObjectURL(video.src);
                            
                            // Check video duration (max 10 seconds)
                            if (video.duration > 10) {
                                showNotification('Video must be 10 seconds or less', 'error');
                                currentMediaFile = null;
                                return;
                            }
                            
                            const mediaPreview = document.getElementById('mediaPreview');
                            const mediaPreviewVideo = document.getElementById('mediaPreviewVideo');
                            
                            mediaPreviewVideo.src = URL.createObjectURL(file);
                            mediaPreview.classList.add('active');
                            mediaPreviewVideo.style.display = 'block';
                            document.getElementById('mediaPreviewImg').style.display = 'none';
                            
                            document.getElementById('mediaEditTools').style.display = 'flex';
                        };
                        
                        video.src = URL.createObjectURL(file);
                    }
                }
            });
            
            // Draw button
            document.getElementById('drawBtn').addEventListener('click', () => {
                drawingCanvasContainer.classList.add('active');
                
                const mediaPreviewImg = document.getElementById('mediaPreviewImg');
                if (mediaPreviewImg.src) {
                    fabricCanvas.clear();
                    fabricCanvas.setBackgroundImage(mediaPreviewImg.src, fabricCanvas.renderAll.bind(fabricCanvas), {
                        originX: 'left',
                        originY: 'top',
                        scaleX: fabricCanvas.width / mediaPreviewImg.naturalWidth,
                        scaleY: fabricCanvas.height / mediaPreviewImg.naturalHeight
                    });
                }
            });
            
            // Save drawing
            document.getElementById('saveDrawingBtn').addEventListener('click', () => {
                const dataURL = fabricCanvas.toDataURL({
                    format: 'png',
                    quality: 1
                });
                
                document.getElementById('mediaPreviewImg').src = dataURL;
                drawingCanvasContainer.classList.remove('active');
                
                fetch(dataURL)
                    .then(res => res.blob())
                    .then(blob => {
                        currentMediaFile = new File([blob], 'edited-image.png', { type: 'image/png' });
                    });
            });
            
            // Clear drawing
            document.getElementById('clearDrawingBtn').addEventListener('click', () => {
                fabricCanvas.clear();
                
                const mediaPreviewImg = document.getElementById('mediaPreviewImg');
                if (mediaPreviewImg.src) {
                    fabricCanvas.setBackgroundImage(mediaPreviewImg.src, fabricCanvas.renderAll.bind(fabricCanvas), {
                        originX: 'left',
                        originY: 'top',
                        scaleX: fabricCanvas.width / mediaPreviewImg.naturalWidth,
                        scaleY: fabricCanvas.height / mediaPreviewImg.naturalHeight
                    });
                }
            });
            
            // Close drawing canvas
            drawingCanvasContainer.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
            
            // Add text to media
            document.getElementById('addTextBtn').addEventListener('click', () => {
                const text = prompt('Enter text to add:');
                if (text) {
                    showNotification('Text added to media', 'success');
                }
            });
            
            // Add link to status
            document.getElementById('addLinkBtn').addEventListener('click', () => {
                const link = prompt('Enter URL to add:');
                if (link) {
                    const linkPreview = document.getElementById('linkPreview');
                    linkPreview.innerHTML = `
                        <div class="link-preview-title">Link Preview</div>
                        <div class="link-preview-url">${link}</div>
                        <div class="link-preview-desc">This link will be included in your status</div>
                    `;
                    linkPreview.classList.add('active');
                    
                    showNotification('Link added to status', 'success');
                }
            });
            
            // Privacy button
            document.getElementById('privacyBtn').addEventListener('click', () => {
                privacyModal.classList.add('active');
            });
            
            // Privacy options
            document.querySelectorAll('.privacy-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectedPrivacy = this.dataset.privacy;
                    
                    document.querySelectorAll('.privacy-option').forEach(opt => {
                        opt.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    const privacyText = document.getElementById('privacyText');
                    switch(selectedPrivacy) {
                        case 'contacts':
                            privacyText.textContent = 'My Contacts';
                            break;
                        case 'contacts-except':
                            privacyText.textContent = 'My Contacts Except...';
                            break;
                        case 'only-share':
                            privacyText.textContent = 'Only Share With...';
                            break;
                    }
                    
                    privacyModal.classList.remove('active');
                });
            });
            
            // Close privacy modal
            privacyModal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
            
            // Post status button
            document.getElementById('postStatusBtn').addEventListener('click', async () => {
                try {
                    let statusData = {
                        type: selectedStatusType,
                        privacy: selectedPrivacy,
                        mood: userMood || 'happy'
                    };
                    
                    if (selectedStatusType === 'text') {
                        const textContent = document.getElementById('textEditor').value.trim();
                        if (!textContent) {
                            showNotification('Please enter status text', 'error');
                            return;
                        }
                        
                        statusData.content = textContent;
                        statusData.textColor = document.getElementById('textEditor').style.color || '#ffffff';
                        statusData.backgroundColor = document.getElementById('textEditorContainer').style.backgroundColor || '#0084ff';
                        statusData.font = document.getElementById('textEditor').style.fontFamily || 'Segoe UI, sans-serif';
                        
                    } else if (selectedStatusType === 'emoji') {
                        statusData.content = selectedEmoji;
                        statusData.textColor = '#ffffff';
                        statusData.backgroundColor = document.getElementById('emojiOnlyContainer').style.backgroundColor || '#0084ff';
                        statusData.font = 'Segoe UI, sans-serif';
                        
                    } else {
                        if (!currentMediaFile) {
                            showNotification(`Please select a ${selectedStatusType} file`, 'error');
                            return;
                        }
                        
                        // Additional validation for video duration
                        if (selectedStatusType === 'video') {
                            const video = document.createElement('video');
                            video.preload = 'metadata';
                            video.onloadedmetadata = function() {
                                if (this.duration > 10) {
                                    showNotification('Video must be 10 seconds or less', 'error');
                                    return;
                                }
                            };
                            video.src = URL.createObjectURL(currentMediaFile);
                        }
                        
                        showNotification('Uploading media...', 'success');
                        const mediaUrl = await uploadToCloudinary(currentMediaFile);
                        statusData.content = mediaUrl;
                        
                        const caption = prompt('Add a caption (optional):');
                        if (caption) {
                            statusData.caption = caption;
                        }
                    }
                    
                    showNotification('Posting status...', 'success');
                    const statusId = await saveStatusToFirestore(statusData);
                    
                    createStatusModal.classList.remove('active');
                    resetCreateStatusForm();
                    
                    showNotification('Status posted successfully!', 'success');
                    
                    // Reload statuses
                    loadStatusUpdates();
                    
                } catch (error) {
                    console.error('Error posting status:', error);
                    showNotification('Failed to post status', 'error');
                }
            });
            
            // Status reply
            document.getElementById('statusReplyBtn').addEventListener('click', () => {
                const replyText = document.getElementById('statusReplyInput').value.trim();
                if (replyText) {
                    showNotification('Reply sent as direct message', 'success');
                    document.getElementById('statusReplyInput').value = '';
                }
            });
            
            // Share status button
            document.getElementById('shareStatusBtn').addEventListener('click', () => {
                if (currentStatusId) {
                    shareStatus(currentStatusId);
                }
            });
            
            // Status info button
            document.getElementById('statusInfoBtn').addEventListener('click', async () => {
                if (userStatuses && userStatuses[currentStatusIndex]) {
                    const status = userStatuses[currentStatusIndex];
                    
                    const viewersList = document.getElementById('viewersList');
                    const statusInfoActions = document.getElementById('statusInfoActions');
                    const ownStatusActions = document.getElementById('ownStatusActions');
                    viewersList.innerHTML = '';
                    
                    // Show appropriate actions
                    if (status.userId !== currentUser.uid) {
                        statusInfoActions.style.display = 'block';
                        ownStatusActions.style.display = 'none';
                        document.getElementById('chatUserBtn').onclick = () => openChatWithUser(status.userId);
                        document.getElementById('shareStatusInfoBtn').onclick = () => shareStatus(status.id);
                    } else {
                        statusInfoActions.style.display = 'none';
                        ownStatusActions.style.display = 'block';
                        document.getElementById('deleteStatusBtn').onclick = () => deleteStatus(status.id);
                    }
                    
                    // Fetch viewers from Firestore
                    try {
                        const statusDoc = await db.collection('statuses').doc(status.id).get();
                        if (statusDoc.exists) {
                            const viewers = statusDoc.data().viewers || [];
                            const screenshotNotifications = statusDoc.data().screenshotNotifications || [];
                            
                            if (viewers.length > 0) {
                                for (const viewerId of viewers) {
                                    if (viewerId === currentUser.uid) continue;
                                    
                                    const viewerDoc = await db.collection('users').doc(viewerId).get();
                                    if (viewerDoc.exists) {
                                        const viewerData = viewerDoc.data();
                                        const initials = viewerData.displayName ? 
                                            viewerData.displayName.split(' ').map(word => word[0]).join('').toUpperCase().substring(0, 2) : 
                                            'U';
                                        
                                        const viewerItem = document.createElement('div');
                                        viewerItem.className = 'viewer-item';
                                        
                                        // Check if this viewer took a screenshot
                                        const tookScreenshot = screenshotNotifications.some(notif => notif.userId === viewerId);
                                        
                                        viewerItem.innerHTML = `
                                            <div class="viewer-avatar" ${viewerData.photoURL ? `style="background-image: url('${viewerData.photoURL}')"` : ''}>
                                                ${viewerData.photoURL ? '' : `<span>${initials}</span>`}
                                                ${tookScreenshot ? '<span style="position: absolute; bottom: -5px; right: -5px; background: var(--danger-color); color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px;"><i class="fas fa-camera"></i></span>' : ''}
                                            </div>
                                            <div class="viewer-info">
                                                <div class="viewer-name">${viewerData.displayName || 'User'} ${tookScreenshot ? '<span style="color: var(--danger-color); font-size: 12px;">(took screenshot)</span>' : ''}</div>
                                                <div class="viewer-time">Viewed recently</div>
                                            </div>
                                        `;
                                        viewersList.appendChild(viewerItem);
                                    }
                                }
                                
                                if (viewers.includes(currentUser.uid)) {
                                    const currentUserItem = document.createElement('div');
                                    currentUserItem.className = 'viewer-item';
                                    currentUserItem.innerHTML = `
                                        <div class="viewer-avatar" ${currentUser.photoURL ? `style="background-image: url('${currentUser.photoURL}')"` : ''}>
                                            ${currentUser.photoURL ? '' : '<span>ME</span>'}
                                        </div>
                                        <div class="viewer-info">
                                            <div class="viewer-name">You</div>
                                            <div class="viewer-time">Viewed recently</div>
                                        </div>
                                    `;
                                    viewersList.appendChild(currentUserItem);
                                }
                            } else {
                                viewersList.innerHTML = `
                                    <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                                        <i class="fas fa-eye" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                                        <p>No viewers yet</p>
                                    </div>
                                `;
                            }
                        }
                    } catch (error) {
                        console.error('Error loading viewers:', error);
                        viewersList.innerHTML = `
                            <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                                <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                                <p>Failed to load viewers</p>
                            </div>
                        `;
                    }
                    
                    statusInfoModal.classList.add('active');
                }
            });
            
            // Close status info modal
            document.getElementById('closeStatusInfoModal').addEventListener('click', () => {
                statusInfoModal.classList.remove('active');
            });
            
            statusInfoModal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
            
            // Close screenshot overlay
            document.getElementById('closeScreenshotOverlay').addEventListener('click', () => {
                screenshotOverlay.classList.remove('active');
            });
            
            // Emoji reactions
            document.querySelectorAll('.emoji-reaction').forEach(reaction => {
                reaction.addEventListener('click', function() {
                    const emoji = this.dataset.emoji;
                    
                    if (userStatuses && userStatuses[currentStatusIndex]) {
                        const statusId = userStatuses[currentStatusIndex].id;
                        
                        db.collection('statuses').doc(statusId).update({
                            [`reactions.${currentUser.uid}`]: emoji
                        }).then(() => {
                            showNotification(`Reacted with ${emoji}`, 'success');
                        }).catch(error => {
                            console.error('Error saving reaction:', error);
                        });
                    }
                    
                    this.style.transform = 'scale(1.3)';
                    setTimeout(() => {
                        this.style.transform = 'scale(1)';
                    }, 300);
                });
            });
            
            // Category tabs
            document.getElementById('recentTab').addEventListener('click', function() {
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                currentCategory = 'recent';
                updateStatusListByCategory();
            });
            
            document.getElementById('viewedTab').addEventListener('click', function() {
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                currentCategory = 'viewed';
                updateStatusListByCategory();
            });
            
            document.getElementById('mutedTab').addEventListener('click', function() {
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                currentCategory = 'muted';
                updateStatusListByCategory();
            });
            
            // Handle window resize
            window.addEventListener('resize', () => {
                if (fabricCanvas) {
                    fabricCanvas.setDimensions({
                        width: window.innerWidth,
                        height: window.innerHeight - 100
                    });
                }
            });
        }
        
        function resetCreateStatusForm() {
            // Reset all form elements
            document.getElementById('textEditor').value = '';
            selectTextColor(textColors[0]);
            selectBackgroundColor(backgroundColors[0]);
            selectFont(fonts[0].value);
            selectEmojiBackgroundColor(backgroundColors[0]);
            
            document.getElementById('mediaPreview').classList.remove('active');
            document.getElementById('mediaEditTools').style.display = 'none';
            document.getElementById('mediaUploadInput').value = '';
            currentMediaFile = null;
            
            document.getElementById('linkPreview').classList.remove('active');
            
            // Reset status type to text
            selectedStatusType = 'text';
            document.querySelectorAll('.status-type-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.type === 'text') {
                    btn.classList.add('active');
                }
            });
            
            document.querySelectorAll('.create-text-status, .create-media-status').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById('textStatusTab').classList.add('active');
        }
    </script>
</body>
</html>