<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
    <link rel="icon" href="../icons/moodchat-192.png">
    <link rel="icon" href="../icons/moodchat-512.png">
    <meta name="theme-color" content="#000000">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings | Chat App</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary-color: #0084ff;
            --primary-dark: #0066cc;
            --secondary-color: #f0f2f5;
            --danger-color: #ff3b30;
            --success-color: #34c759;
            --warning-color: #ff9500;
            --text-primary: #050505;
            --text-secondary: #65676b;
            --bg-color: #ffffff;
            --border-color: #dddfe2;
            --card-bg: #ffffff;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.2);
            --sidebar-width: 280px;
            --header-height: 70px;
            --transition: all 0.15s ease;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
        }
        
        /* Sidebar Navigation */
        .settings-sidebar {
            width: var(--sidebar-width);
            background-color: var(--bg-color);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }
        
        .sidebar-header {
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 1px solid var(--border-color);
            height: var(--header-height);
        }
        
        .back-btn {
            background: none;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            color: var(--text-primary);
            transition: var(--transition);
        }
        
        .back-btn:hover {
            background-color: var(--secondary-color);
        }
        
        .sidebar-header h2 {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .nav-category {
            padding: 15px 20px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 10px;
        }
        
        .nav-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            cursor: pointer;
            transition: var(--transition);
            border-left: 4px solid transparent;
        }
        
        .nav-item:hover {
            background-color: var(--secondary-color);
        }
        
        .nav-item.active {
            background-color: rgba(0, 132, 255, 0.1);
            border-left-color: var(--primary-color);
        }
        
        .nav-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 16px;
            color: var(--text-secondary);
        }
        
        .nav-item.active .nav-icon {
            color: var(--primary-color);
        }
        
        .nav-text {
            font-size: 15px;
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .nav-badge {
            margin-left: auto;
            background-color: var(--primary-color);
            color: white;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        /* Main Content Area */
        .settings-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
            background-color: var(--bg-color);
        }
        
        .content-header {
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .content-header h1 {
            font-size: 28px;
            font-weight: 600;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .action-btn:hover {
            background-color: var(--secondary-color);
        }
        
        .action-btn.primary {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .action-btn.primary:hover {
            background-color: var(--primary-dark);
        }
        
        .content-body {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }
        
        /* Settings Sections */
        .settings-section {
            display: none;
            animation: fadeIn 0.15s ease;
        }
        
        .settings-section.active {
            display: block;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
        }
        
        .section-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 30px;
            line-height: 1.5;
        }
        
        /* Settings Cards */
        .settings-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
        }
        
        .card-icon.account { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-icon.privacy { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .card-icon.chat { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .card-icon.friends { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .card-icon.groups { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .card-icon.calls { background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); }
        .card-icon.status { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .card-icon.notifications { background: linear-gradient(135deg, #5ee7df 0%, #b490ca 100%); }
        .card-icon.appearance { background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%); }
        .card-icon.storage { background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%); }
        .card-icon.advanced { background: linear-gradient(135deg, #ffd1ff 0%, #fad0c4 100%); }
        
        /* Settings Items */
        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
        }
        
        .settings-item:last-child {
            border-bottom: none;
        }
        
        .settings-item:hover {
            background-color: rgba(0, 132, 255, 0.02);
        }
        
        .item-label {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex: 1;
        }
        
        .item-title {
            font-weight: 500;
            font-size: 15px;
            color: var(--text-primary);
        }
        
        .item-description {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.4;
        }
        
        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            will-change: transform;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .15s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .15s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        /* Select Dropdown */
        .select-wrapper {
            position: relative;
            min-width: 150px;
        }
        
        .select-wrapper select {
            width: 100%;
            padding: 8px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
            appearance: none;
            outline: none;
        }
        
        .select-wrapper::after {
            content: "â–¾";
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: var(--text-secondary);
        }
        
        /* Radio Buttons */
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .radio-option:hover {
            background-color: var(--secondary-color);
        }
        
        .radio-option.selected {
            border-color: var(--primary-color);
            background-color: rgba(0, 132, 255, 0.1);
        }
        
        .radio-input {
            margin-right: 10px;
        }
        
        .radio-label {
            flex: 1;
        }
        
        .radio-title {
            font-weight: 500;
            font-size: 14px;
            margin-bottom: 3px;
        }
        
        .radio-description {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        /* Color Picker */
        .color-picker {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: var(--transition);
            will-change: transform;
        }
        
        .color-option:hover {
            transform: scale(1.05);
        }
        
        .color-option.selected {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 132, 255, 0.3);
        }
        
        /* Range Slider */
        .range-slider {
            width: 100%;
            margin: 10px 0;
        }
        
        .range-value {
            text-align: center;
            font-weight: 500;
            color: var(--primary-color);
            margin-top: 5px;
        }
        
        /* Friend Privacy Grid */
        .privacy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .privacy-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-color);
        }
        
        .privacy-label {
            font-size: 14px;
            font-weight: 500;
        }
        
        /* Backup Options */
        .backup-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .backup-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .backup-option:hover {
            background-color: var(--secondary-color);
        }
        
        .backup-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .backup-info {
            flex: 1;
        }
        
        .backup-title {
            font-weight: 500;
            font-size: 15px;
            margin-bottom: 3px;
        }
        
        .backup-description {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        /* Danger Zone */
        .danger-zone {
            border: 2px solid var(--danger-color);
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
        }
        
        .danger-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .danger-header i {
            color: var(--danger-color);
            font-size: 20px;
        }
        
        .danger-header h3 {
            color: var(--danger-color);
            font-weight: 600;
        }
        
        .danger-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 59, 48, 0.2);
        }
        
        .danger-item:last-child {
            border-bottom: none;
        }
        
        .danger-label h4 {
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .danger-label p {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .danger-btn {
            padding: 8px 20px;
            background-color: var(--danger-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }
        
        .danger-btn:hover {
            background-color: #ff1a1a;
        }
        
        /* Search Input */
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            background-color: var(--bg-color);
            color: var(--text-primary);
        }
        
        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }
        
        /* Category Tabs */
        .category-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .category-tab {
            padding: 10px 20px;
            background-color: var(--secondary-color);
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-secondary);
            transition: var(--transition);
        }
        
        .category-tab.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.15s ease;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-container {
            width: 90%;
            max-width: 500px;
            background-color: var(--bg-color);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            animation: fadeIn 0.15s ease;
            will-change: transform;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            font-size: 18px;
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-secondary);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-close:hover {
            background-color: var(--secondary-color);
        }
        
        .modal-content {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--success-color);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.15s;
            will-change: transform, opacity;
        }
        
        .notification.active {
            transform: translateY(0);
            opacity: 1;
        }
        
        .notification.error {
            background-color: var(--danger-color);
        }
        
        .notification.warning {
            background-color: var(--warning-color);
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .settings-sidebar {
                width: 100%;
                height: auto;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }
            
            .nav-list {
                display: flex;
                overflow-x: auto;
                padding: 10px;
            }
            
            .nav-item {
                flex-direction: column;
                padding: 10px 15px;
                min-width: 80px;
                border-left: none;
                border-bottom: 3px solid transparent;
            }
            
            .nav-item.active {
                border-left: none;
                border-bottom-color: var(--primary-color);
            }
            
            .nav-icon {
                margin-right: 0;
                margin-bottom: 5px;
            }
            
            .nav-text {
                font-size: 12px;
                text-align: center;
            }
            
            .nav-badge {
                position: absolute;
                top: 5px;
                right: 5px;
            }
            
            .content-header {
                padding: 15px;
            }
            
            .content-header h1 {
                font-size: 22px;
            }
            
            .content-body {
                padding: 20px;
            }
            
            .settings-card {
                padding: 20px;
            }
            
            .privacy-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Offline Indicator */
        .offline-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--warning-color);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow);
            animation: slideInRight 0.15s ease;
            display: none;
            will-change: transform;
        }
        
        .offline-indicator.active {
            display: flex;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 132, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Theme Preview */
        .theme-preview {
            width: 100px;
            height: 60px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .theme-preview:hover {
            transform: scale(1.05);
            border-color: var(--primary-color);
        }
        
        .theme-preview.selected {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 132, 255, 0.2);
        }
        
        /* Storage Bar */
        .storage-bar-container {
            margin-top: 10px;
        }
        
        .storage-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .storage-bar {
            height: 8px;
            background-color: var(--secondary-color);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .storage-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), #00f2fe);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        /* Permissions Matrix */
        .permissions-matrix {
            overflow-x: auto;
        }
        
        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .matrix-table th,
        .matrix-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid var(--border-color);
        }
        
        .matrix-table th {
            background-color: var(--secondary-color);
            font-weight: 600;
            font-size: 12px;
        }
        
        .matrix-table td {
            font-size: 13px;
        }
        
        .matrix-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        /* Quick Settings Grid */
        .quick-settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .quick-setting {
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .quick-setting:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }
        
        .quick-setting-label {
            font-weight: 500;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <div class="settings-sidebar">
            <div class="sidebar-header">
                <button class="back-btn" id="backBtn" title="Go Back">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2>Settings</h2>
            </div>
            
            <div class="nav-list">
                <div class="nav-category">Account</div>
                <div class="nav-item active" data-section="profile">
                    <div class="nav-icon">
                        <i class="fas fa-user"></i>
                    </div>
                    <span class="nav-text">Profile</span>
                </div>
                <div class="nav-item" data-section="security">
                    <div class="nav-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <span class="nav-text">Security</span>
                </div>
                <div class="nav-item" data-section="privacy">
                    <div class="nav-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <span class="nav-text">Privacy</span>
                    <span class="nav-badge" id="privacyBadge">New</span>
                </div>
                
                <div class="nav-category">Communication</div>
                <div class="nav-item" data-section="chat">
                    <div class="nav-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <span class="nav-text">Chat</span>
                </div>
                <div class="nav-item" data-section="friends">
                    <div class="nav-icon">
                        <i class="fas fa-user-friends"></i>
                    </div>
                    <span class="nav-text">Friends</span>
                </div>
                <div class="nav-item" data-section="groups">
                    <div class="nav-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <span class="nav-text">Groups</span>
                </div>
                <div class="nav-item" data-section="calls">
                    <div class="nav-icon">
                        <i class="fas fa-phone-alt"></i>
                    </div>
                    <span class="nav-text">Calls</span>
                </div>
                <div class="nav-item" data-section="status">
                    <div class="nav-icon">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="nav-text">Status</span>
                </div>
                
                <div class="nav-category">Preferences</div>
                <div class="nav-item" data-section="notifications">
                    <div class="nav-icon">
                        <i class="fas fa-bell"></i>
                    </div>
                    <span class="nav-text">Notifications</span>
                </div>
                <div class="nav-item" data-section="appearance">
                    <div class="nav-icon">
                        <i class="fas fa-palette"></i>
                    </div>
                    <span class="nav-text">Appearance</span>
                </div>
                <div class="nav-item" data-section="storage">
                    <div class="nav-icon">
                        <i class="fas fa-database"></i>
                    </div>
                    <span class="nav-text">Storage</span>
                </div>
                
                <div class="nav-category">Advanced</div>
                <div class="nav-item" data-section="advanced">
                    <div class="nav-icon">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <span class="nav-text">Advanced</span>
                </div>
                <div class="nav-item" data-section="backup">
                    <div class="nav-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <span class="nav-text">Backup & Restore</span>
                </div>
                <div class="nav-item" data-section="danger">
                    <div class="nav-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <span class="nav-text">Danger Zone</span>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="settings-content">
            <div class="content-header">
                <h1 id="sectionTitle">Profile Settings</h1>
                <div class="header-actions">
                    <button class="action-btn" id="saveAllBtn">
                        <i class="fas fa-save"></i>
                        Save All Changes
                    </button>
                    <button class="action-btn" id="resetAllBtn">
                        <i class="fas fa-undo"></i>
                        Reset to Default
                    </button>
                </div>
            </div>
            
            <div class="content-body">
                <!-- Profile Section -->
                <div class="settings-section active" id="profileSection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon account">
                                    <i class="fas fa-user"></i>
                                </div>
                                Personal Information
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Profile Photo</span>
                                <span class="item-description">Your profile picture visible to other users</span>
                            </div>
                            <button class="action-btn" id="changePhotoBtn">
                                <i class="fas fa-camera"></i>
                                Change
                            </button>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Display Name</span>
                                <span class="item-description">Name shown to other users</span>
                            </div>
                            <input type="text" class="search-input" id="displayNameInput" placeholder="Enter your name">
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Username</span>
                                <span class="item-description">Your unique identifier (@username)</span>
                            </div>
                            <input type="text" class="search-input" id="usernameInput" placeholder="@username">
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Bio</span>
                                <span class="item-description">Tell others about yourself</span>
                            </div>
                            <textarea class="search-input" id="bioInput" rows="3" placeholder="Write something about yourself..."></textarea>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Phone Number</span>
                                <span class="item-description">Used for account recovery and friend discovery</span>
                            </div>
                            <input type="tel" class="search-input" id="phoneInput" placeholder="+1234567890">
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Email Address</span>
                                <span class="item-description">Used for notifications and account recovery</span>
                            </div>
                            <input type="email" class="search-input" id="emailInput" placeholder="email@example.com">
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon account">
                                    <i class="fas fa-globe"></i>
                                </div>
                                Public Profile
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Profile Visibility</span>
                                <span class="item-description">Who can see your profile information</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="profileVisibility">
                                    <option value="public">Everyone</option>
                                    <option value="friends">Friends Only</option>
                                    <option value="private">Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Last Seen</span>
                                <span class="item-description">Show when you were last active</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="lastSeenToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Online Status</span>
                                <span class="item-description">Show when you're online</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="onlineStatusToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Profile Photo Visibility</span>
                                <span class="item-description">Who can see your profile photo</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="photoVisibility">
                                    <option value="public">Everyone</option>
                                    <option value="friends">Friends Only</option>
                                    <option value="private">Nobody</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Security Section -->
                <div class="settings-section" id="securitySection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon privacy">
                                    <i class="fas fa-key"></i>
                                </div>
                                Account Security
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Two-Factor Authentication</span>
                                <span class="item-description">Add an extra layer of security to your account</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="twoFactorToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Change Password</span>
                                <span class="item-description">Update your account password regularly</span>
                            </div>
                            <button class="action-btn" id="changePasswordBtn">
                                <i class="fas fa-lock"></i>
                                Change
                            </button>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Login Notifications</span>
                                <span class="item-description">Get notified when someone logs into your account</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="loginNotificationsToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Active Sessions</span>
                                <span class="item-description">View and manage devices logged into your account</span>
                            </div>
                            <button class="action-btn" id="viewSessionsBtn">
                                <i class="fas fa-desktop"></i>
                                View All
                            </button>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon privacy">
                                    <i class="fas fa-fingerprint"></i>
                                </div>
                                App Security
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">App Lock</span>
                                <span class="item-description">Require PIN or biometric to open the app</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="appLockToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Screen Capture Protection</span>
                                <span class="item-description">Prevent screenshots in sensitive chats</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="screenCaptureToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Encryption</span>
                                <span class="item-description">End-to-end encryption for all communications</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="encryptionToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Privacy Section -->
                <div class="settings-section" id="privacySection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon privacy">
                                    <i class="fas fa-eye"></i>
                                </div>
                                Privacy Controls
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Who Can Add Me</span>
                                <span class="item-description">Control who can send you friend requests</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="whoCanAddMe">
                                    <option value="everyone">Everyone</option>
                                    <option value="friends_of_friends">Friends of Friends</option>
                                    <option value="nobody">Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Read Receipts</span>
                                <span class="item-description">Let others know when you've read their messages</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="readReceiptsToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Typing Indicators</span>
                                <span class="item-description">Show when you're typing a message</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="typingIndicatorsToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Message Forwarding</span>
                                <span class="item-description">Allow others to forward your messages</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="messageForwardingToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Contact Discovery</span>
                                <span class="item-description">Allow others to find you by phone number</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="contactDiscoveryToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon privacy">
                                    <i class="fas fa-user-friends"></i>
                                </div>
                                Friend Privacy (Default for New Friends)
                            </div>
                        </div>
                        
                        <div class="privacy-grid">
                            <div class="privacy-item">
                                <span class="privacy-label">Can Message Me</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="canMessageToggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="privacy-item">
                                <span class="privacy-label">Can Call Me</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="canCallToggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="privacy-item">
                                <span class="privacy-label">Can See My Status</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="canSeeStatusToggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="privacy-item">
                                <span class="privacy-label">Can See Profile Photo</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="canSeePhotoToggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="privacy-item">
                                <span class="privacy-label">Can See Last Seen</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="canSeeLastSeenToggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="privacy-item">
                                <span class="privacy-label">Can Forward Messages</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="canForwardToggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="privacy-item">
                                <span class="privacy-label">Can Take Screenshots</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="canScreenshotToggle">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon privacy">
                                    <i class="fas fa-ban"></i>
                                </div>
                                Blocked Users
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Blocked List</span>
                                <span class="item-description">Manage users you've blocked</span>
                            </div>
                            <button class="action-btn" id="manageBlockedBtn">
                                <i class="fas fa-user-slash"></i>
                                Manage
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Chat Section -->
                <div class="settings-section" id="chatSection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon chat">
                                    <i class="fas fa-comment-alt"></i>
                                </div>
                                Chat Settings
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Chat Wallpaper</span>
                                <span class="item-description">Set custom background for chats</span>
                            </div>
                            <button class="action-btn" id="changeWallpaperBtn">
                                <i class="fas fa-image"></i>
                                Change
                            </button>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Enter Key Sends</span>
                                <span class="item-description">Press Enter to send messages instead of new line</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="enterKeySendsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Media Auto-Download</span>
                                <span class="item-description">Automatically download images and videos</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="mediaDownloadSetting">
                                    <option value="wifi">Wi-Fi Only</option>
                                    <option value="always">Always</option>
                                    <option value="never">Never</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Save to Camera Roll</span>
                                <span class="item-description">Automatically save media to your device</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="saveMediaToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Message History</span>
                                <span class="item-description">Keep message history for</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="messageHistorySetting">
                                    <option value="forever">Forever</option>
                                    <option value="30days">30 Days</option>
                                    <option value="7days">7 Days</option>
                                    <option value="24hours">24 Hours</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon chat">
                                    <i class="fas fa-clock"></i>
                                </div>
                                Disappearing Messages
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Default Timer</span>
                                <span class="item-description">Set default timer for new disappearing messages</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="disappearingTimer">
                                    <option value="off">Off</option>
                                    <option value="1hour">1 Hour</option>
                                    <option value="1day">1 Day</option>
                                    <option value="7days">7 Days</option>
                                    <option value="30days">30 Days</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon chat">
                                    <i class="fas fa-robot"></i>
                                </div>
                                AI Features
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Smart Replies</span>
                                <span class="item-description">Suggest quick replies based on messages</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="smartRepliesToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Message Translation</span>
                                <span class="item-description">Automatically translate messages</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="messageTranslationToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Chat Summarization</span>
                                <span class="item-description">Summarize long conversations</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="chatSummarizationToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Spam Detection</span>
                                <span class="item-description">Automatically detect and filter spam</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="spamDetectionToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Friends Section -->
                <div class="settings-section" id="friendsSection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon friends">
                                    <i class="fas fa-search"></i>
                                </div>
                                Friend Discovery
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Discover by Phone Number</span>
                                <span class="item-description">Allow others to find you by your phone number</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="discoverByPhoneToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Discover by Email</span>
                                <span class="item-description">Allow others to find you by your email</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="discoverByEmailToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Nearby Discovery</span>
                                <span class="item-description">Find friends nearby (requires location)</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="nearbyDiscoveryToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">QR Code Scanner</span>
                                <span class="item-description">Allow adding friends via QR codes</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="qrCodeToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Friend Suggestions</span>
                                <span class="item-description">Show friend suggestions based on contacts</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="friendSuggestionsToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon friends">
                                    <i class="fas fa-handshake"></i>
                                </div>
                                Friendship Features
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Temporary Friends</span>
                                <span class="item-description">Allow temporary friendships with expiry time</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="temporaryFriendsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Friendship Notes</span>
                                <span class="item-description">Add private notes about your friends</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="friendshipNotesToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Friend Categories</span>
                                <span class="item-description">Organize friends into categories</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="friendCategoriesToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Trust Score</span>
                                <span class="item-description">Display trust score for friends</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="trustScoreToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Friend Analytics</span>
                                <span class="item-description">Show interaction frequency and patterns</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="friendAnalyticsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Groups Section -->
                <div class="settings-section" id="groupsSection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon groups">
                                    <i class="fas fa-users-cog"></i>
                                </div>
                                Group Settings
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Auto-Join Groups</span>
                                <span class="item-description">Automatically join groups you're invited to</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoJoinGroupsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Group Invitations</span>
                                <span class="item-description">Who can invite you to groups</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="groupInvitationsSetting">
                                    <option value="everyone">Everyone</option>
                                    <option value="friends">Friends Only</option>
                                    <option value="nobody">Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Group Privacy</span>
                                <span class="item-description">Who can add you to groups</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="groupPrivacySetting">
                                    <option value="public">Everyone</option>
                                    <option value="private">My Approval Required</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Group Announcements</span>
                                <span class="item-description">Receive announcements from group admins</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="groupAnnouncementsToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Auto-Download Group Media</span>
                                <span class="item-description">Automatically download media in groups</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="groupMediaDownloadToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon groups">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                                Group Moderation
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Message Approval Mode</span>
                                <span class="item-description">Require admin approval for messages in your groups</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="messageApprovalToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Keyword Filtering</span>
                                <span class="item-description">Automatically filter messages with keywords</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="keywordFilteringToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Spam Detection</span>
                                <span class="item-description">Automatically detect spam in groups</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="groupSpamDetectionToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Member Warnings</span>
                                <span class="item-description">Send warnings to members who violate rules</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="memberWarningsToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon groups">
                                    <i class="fas fa-chart-bar"></i>
                                </div>
                                Group Analytics
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Activity Tracking</span>
                                <span class="item-description">Track group activity and engagement</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="activityTrackingToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Top Contributors</span>
                                <span class="item-description">Show top contributors in groups</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="topContributorsToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Message Volume Analytics</span>
                                <span class="item-description">Show message volume statistics</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="messageVolumeToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Calls Section -->
                <div class="settings-section" id="callsSection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon calls">
                                    <i class="fas fa-phone"></i>
                                </div>
                                Call Settings
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Who Can Call Me</span>
                                <span class="item-description">Control who can initiate calls with you</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="whoCanCallMe">
                                    <option value="everyone">Everyone</option>
                                    <option value="friends">Friends Only</option>
                                    <option value="nobody">Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Call Verification</span>
                                <span class="item-description">Verify caller identity before connecting</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="callVerificationToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Ringtone</span>
                                <span class="item-description">Set custom ringtone for incoming calls</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="ringtoneSetting">
                                    <option value="default">Default</option>
                                    <option value="classic">Classic</option>
                                    <option value="modern">Modern</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Vibration</span>
                                <span class="item-description">Vibrate on incoming calls</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="callVibrationToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Auto-Answer</span>
                                <span class="item-description">Automatically answer calls from trusted contacts</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoAnswerToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon calls">
                                    <i class="fas fa-video"></i>
                                </div>
                                Video Call Settings
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Video Quality</span>
                                <span class="item-description">Set default video quality for calls</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="videoQualitySetting">
                                    <option value="auto">Auto (Recommended)</option>
                                    <option value="high">High Quality</option>
                                    <option value="medium">Medium Quality</option>
                                    <option value="low">Low Quality</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Camera Default</span>
                                <span class="item-description">Default camera to use for calls</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="cameraDefaultSetting">
                                    <option value="front">Front Camera</option>
                                    <option value="back">Back Camera</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Noise Cancellation</span>
                                <span class="item-description">Reduce background noise during calls</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="noiseCancellationToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Echo Cancellation</span>
                                <span class="item-description">Reduce echo during calls</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="echoCancellationToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon calls">
                                    <i class="fas fa-broadcast-tower"></i>
                                </div>
                                Call Features
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Live Reactions</span>
                                <span class="item-description">Show reactions during calls</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="liveReactionsToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">In-Call Chat</span>
                                <span class="item-description">Enable chat during calls</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="inCallChatToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Shared Whiteboard</span>
                                <span class="item-description">Enable whiteboard during calls</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="sharedWhiteboardToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Shared Notes</span>
                                <span class="item-description">Enable shared notes during calls</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="sharedNotesToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Polls</span>
                                <span class="item-description">Enable polls during calls</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="pollsToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Status Section -->
                <div class="settings-section" id="statusSection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon status">
                                    <i class="fas fa-circle"></i>
                                </div>
                                Status Settings
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Who Can View My Status</span>
                                <span class="item-description">Control who can see your status updates</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="whoCanViewStatus">
                                    <option value="everyone">Everyone</option>
                                    <option value="friends">Friends Only</option>
                                    <option value="selected">Selected Friends</option>
                                    <option value="nobody">Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Auto-Expire Status</span>
                                <span class="item-description">Automatically expire status after</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="statusExpireTime">
                                    <option value="24h">24 Hours</option>
                                    <option value="12h">12 Hours</option>
                                    <option value="6h">6 Hours</option>
                                    <option value="1h">1 Hour</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Reply Permissions</span>
                                <span class="item-description">Who can reply to your status</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="statusReplyPermissions">
                                    <option value="everyone">Everyone</option>
                                    <option value="friends">Friends Only</option>
                                    <option value="nobody">Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Download Permissions</span>
                                <span class="item-description">Allow others to download your status media</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="statusDownloadToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Hide from Specific Users</span>
                                <span class="item-description">Hide your status from selected users</span>
                            </div>
                            <button class="action-btn" id="hideFromUsersBtn">
                                <i class="fas fa-user-slash"></i>
                                Manage
                            </button>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon status">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                Status Analytics
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">View Count</span>
                                <span class="item-description">Show how many people viewed your status</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="viewCountToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Viewer List</span>
                                <span class="item-description">Show who viewed your status</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="viewerListToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Engagement Reactions</span>
                                <span class="item-description">Allow reactions to your status</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="statusReactionsToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon status">
                                    <i class="fas fa-robot"></i>
                                </div>
                                Status AI Features
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Auto Captions</span>
                                <span class="item-description">Add captions to your status videos</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoCaptionsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">AI Enhancement</span>
                                <span class="item-description">Automatically enhance your status media</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="statusEnhancementToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Status Scheduling</span>
                                <span class="item-description">Schedule status updates for later</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="statusSchedulingToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Notifications Section -->
                <div class="settings-section" id="notificationsSection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon notifications">
                                    <i class="fas fa-bell"></i>
                                </div>
                                Notification Preferences
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Message Notifications</span>
                                <span class="item-description">Get notified for new messages</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="messageNotificationsToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Group Notifications</span>
                                <span class="item-description">Get notified for group messages</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="groupNotificationsToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Friend Request Notifications</span>
                                <span class="item-description">Get notified for friend requests</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="friendRequestNotificationsToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Call Notifications</span>
                                <span class="item-description">Get notified for incoming calls</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="callNotificationsToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Status Notifications</span>
                                <span class="item-description">Get notified for status updates</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="statusNotificationsToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon notifications">
                                    <i class="fas fa-volume-up"></i>
                                </div>
                                Sound & Vibration
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Notification Sound</span>
                                <span class="item-description">Play sound for notifications</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="notificationSoundToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Vibration</span>
                                <span class="item-description">Vibrate for notifications</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="notificationVibrationToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Popup Notifications</span>
                                <span class="item-description">Show popup notifications</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="popupNotificationsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Notification Light</span>
                                <span class="item-description">Use LED light for notifications</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="notificationLightToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon notifications">
                                    <i class="fas fa-moon"></i>
                                </div>
                                Do Not Disturb
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Do Not Disturb</span>
                                <span class="item-description">Silence notifications during specific hours</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="doNotDisturbToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Schedule</span>
                                <span class="item-description">Set schedule for Do Not Disturb</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="dndSchedule">
                                    <option value="custom">Custom Hours</option>
                                    <option value="night">Night (10PM-7AM)</option>
                                    <option value="work">Work Hours (9AM-5PM)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Allow Calls</span>
                                <span class="item-description">Allow calls during Do Not Disturb</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="dndAllowCallsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Allow Messages from</span>
                                <span class="item-description">Allow messages from specific contacts</span>
                            </div>
                            <button class="action-btn" id="dndAllowContactsBtn">
                                <i class="fas fa-user-check"></i>
                                Select
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Appearance Section -->
                <div class="settings-section" id="appearanceSection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon appearance">
                                    <i class="fas fa-palette"></i>
                                </div>
                                Theme & Colors
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Theme</span>
                                <span class="item-description">Choose your app theme</span>
                            </div>
                            <div class="radio-group">
                                <div class="radio-option" data-theme="light">
                                    <input type="radio" name="theme" id="themeLight" class="radio-input" checked>
                                    <div class="radio-label">
                                        <div class="radio-title">Light</div>
                                        <div class="radio-description">Bright theme for day use</div>
                                    </div>
                                </div>
                                <div class="radio-option" data-theme="dark">
                                    <input type="radio" name="theme" id="themeDark" class="radio-input">
                                    <div class="radio-label">
                                        <div class="radio-title">Dark</div>
                                        <div class="radio-description">Dark theme for night use</div>
                                    </div>
                                </div>
                                <div class="radio-option" data-theme="auto">
                                    <input type="radio" name="theme" id="themeAuto" class="radio-input">
                                    <div class="radio-label">
                                        <div class="radio-title">Auto</div>
                                        <div class="radio-description">Follow system theme</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Accent Color</span>
                                <span class="item-description">Choose your primary color</span>
                            </div>
                            <div class="color-picker">
                                <div class="color-option selected" data-color="#0084ff" style="background-color: #0084ff;"></div>
                                <div class="color-option" data-color="#34c759" style="background-color: #34c759;"></div>
                                <div class="color-option" data-color="#ff9500" style="background-color: #ff9500;"></div>
                                <div class="color-option" data-color="#ff3b30" style="background-color: #ff3b30;"></div>
                                <div class="color-option" data-color="#af52de" style="background-color: #af52de;"></div>
                                <div class="color-option" data-color="#5856d6" style="background-color: #5856d6;"></div>
                                <div class="color-option" data-color="#00c7be" style="background-color: #00c7be;"></div>
                                <div class="color-option" data-color="#ff2d55" style="background-color: #ff2d55;"></div>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Font Size</span>
                                <span class="item-description">Adjust text size in the app</span>
                            </div>
                            <input type="range" min="12" max="20" value="16" class="range-slider" id="fontSizeSlider">
                            <div class="range-value" id="fontSizeValue">16px</div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Reduce Motion</span>
                                <span class="item-description">Reduce animations and transitions</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="reduceMotionToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon appearance">
                                    <i class="fas fa-language"></i>
                                </div>
                                Language & Region
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Language</span>
                                <span class="item-description">Choose app language</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="languageSetting">
                                    <option value="en">English</option>
                                    <option value="es">EspaÃ±ol</option>
                                    <option value="fr">FranÃ§ais</option>
                                    <option value="de">Deutsch</option>
                                    <option value="zh">ä¸­æ–‡</option>
                                    <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Time Format</span>
                                <span class="item-description">Choose time display format</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="timeFormatSetting">
                                    <option value="12h">12-hour (2:30 PM)</option>
                                    <option value="24h">24-hour (14:30)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Date Format</span>
                                <span class="item-description">Choose date display format</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="dateFormatSetting">
                                    <option value="mm/dd/yyyy">MM/DD/YYYY</option>
                                    <option value="dd/mm/yyyy">DD/MM/YYYY</option>
                                    <option value="yyyy-mm-dd">YYYY-MM-DD</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Storage Section -->
                <div class="settings-section" id="storageSection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon storage">
                                    <i class="fas fa-sd-card"></i>
                                </div>
                                Storage Usage
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Total Storage Used</span>
                                <span class="item-description">Space used by the app</span>
                            </div>
                            <div class="storage-info">
                                <span id="storageUsed">0 MB</span>
                                <span id="storageTotal">/ 1 GB</span>
                            </div>
                            <div class="storage-bar-container">
                                <div class="storage-bar">
                                    <div class="storage-fill" id="storageFill" style="width: 25%;"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Chats</span>
                                <span class="item-description">Space used by chat messages</span>
                            </div>
                            <div class="storage-info">
                                <span id="chatStorage">0 MB</span>
                                <span>25%</span>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Media</span>
                                <span class="item-description">Space used by photos and videos</span>
                            </div>
                            <div class="storage-info">
                                <span id="mediaStorage">0 MB</span>
                                <span>60%</span>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Other</span>
                                <span class="item-description">Space used by other data</span>
                            </div>
                            <div class="storage-info">
                                <span id="otherStorage">0 MB</span>
                                <span>15%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon storage">
                                    <i class="fas fa-trash"></i>
                                </div>
                                Data Management
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Auto-Clear Cache</span>
                                <span class="item-description">Automatically clear cache every</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="autoClearCache">
                                    <option value="never">Never</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Clear Chat Cache</span>
                                <span class="item-description">Clear temporary chat files</span>
                            </div>
                            <button class="action-btn" id="clearChatCacheBtn">
                                <i class="fas fa-broom"></i>
                                Clear Now
                            </button>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Clear Media Cache</span>
                                <span class="item-description">Clear downloaded media files</span>
                            </div>
                            <button class="action-btn" id="clearMediaCacheBtn">
                                <i class="fas fa-trash"></i>
                                Clear Now
                            </button>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Delete All Data</span>
                                <span class="item-description">Delete all app data (cannot be undone)</span>
                            </div>
                            <button class="danger-btn" id="deleteAllDataBtn">
                                <i class="fas fa-exclamation-triangle"></i>
                                Delete All
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Advanced Section -->
                <div class="settings-section" id="advancedSection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon advanced">
                                    <i class="fas fa-tools"></i>
                                </div>
                                Advanced Settings
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Offline Mode</span>
                                <span class="item-description">Enable offline functionality</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="offlineModeToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Intranet Support</span>
                                <span class="item-description">Enable local network communication</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="intranetSupportToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Low Bandwidth Mode</span>
                                <span class="item-description">Reduce data usage</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="lowBandwidthToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Debug Mode</span>
                                <span class="item-description">Enable debugging features</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="debugModeToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Developer Options</span>
                                <span class="item-description">Show developer settings</span>
                            </div>
                            <button class="action-btn" id="developerOptionsBtn">
                                <i class="fas fa-code"></i>
                                Open
                            </button>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon advanced">
                                    <i class="fas fa-network-wired"></i>
                                </div>
                                Network Settings
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Proxy Settings</span>
                                <span class="item-description">Configure network proxy</span>
                            </div>
                            <button class="action-btn" id="proxySettingsBtn">
                                <i class="fas fa-server"></i>
                                Configure
                            </button>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Connection Test</span>
                                <span class="item-description">Test network connection</span>
                            </div>
                            <button class="action-btn" id="connectionTestBtn">
                                <i class="fas fa-wifi"></i>
                                Test
                            </button>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Data Saver</span>
                                <span class="item-description">Optimize data usage</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="dataSaverToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Backup & Restore Section -->
                <div class="settings-section" id="backupSection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon backup">
                                    <i class="fas fa-cloud"></i>
                                </div>
                                Backup Settings
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Auto Backup</span>
                                <span class="item-description">Automatically backup your data</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoBackupToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Backup Frequency</span>
                                <span class="item-description">How often to backup data</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="backupFrequency">
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Backup Location</span>
                                <span class="item-description">Where to store backups</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="backupLocation">
                                    <option value="cloud">Cloud Storage</option>
                                    <option value="local">Local Device</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Last Backup</span>
                                <span class="item-description">When was the last backup created</span>
                            </div>
                            <span id="lastBackupTime">Never</span>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon backup">
                                    <i class="fas fa-download"></i>
                                </div>
                                Backup & Restore Options
                            </div>
                        </div>
                        
                        <div class="backup-options">
                            <div class="backup-option" data-type="full">
                                <div class="backup-icon">
                                    <i class="fas fa-database"></i>
                                </div>
                                <div class="backup-info">
                                    <div class="backup-title">Full Backup</div>
                                    <div class="backup-description">Backup all chats, media, and settings</div>
                                </div>
                                <button class="action-btn" id="fullBackupBtn">Backup Now</button>
                            </div>
                            
                            <div class="backup-option" data-type="chat">
                                <div class="backup-icon">
                                    <i class="fas fa-comments"></i>
                                </div>
                                <div class="backup-info">
                                    <div class="backup-title">Chat Backup</div>
                                    <div class="backup-description">Backup only chat messages</div>
                                </div>
                                <button class="action-btn" id="chatBackupBtn">Backup Now</button>
                            </div>
                            
                            <div class="backup-option" data-type="media">
                                <div class="backup-icon">
                                    <i class="fas fa-images"></i>
                                </div>
                                <div class="backup-info">
                                    <div class="backup-title">Media Backup</div>
                                    <div class="backup-description">Backup photos and videos</div>
                                </div>
                                <button class="action-btn" id="mediaBackupBtn">Backup Now</button>
                            </div>
                            
                            <div class="backup-option" data-type="restore">
                                <div class="backup-icon">
                                    <i class="fas fa-upload"></i>
                                </div>
                                <div class="backup-info">
                                    <div class="backup-title">Restore Backup</div>
                                    <div class="backup-description">Restore from previous backup</div>
                                </div>
                                <button class="action-btn" id="restoreBackupBtn">Restore</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Danger Zone Section -->
                <div class="settings-section" id="dangerSection">
                    <div class="danger-zone">
                        <div class="danger-header">
                            <i class="fas fa-exclamation-triangle"></i>
                            <h3>Danger Zone</h3>
                        </div>
                        
                        <div class="danger-item">
                            <div class="danger-label">
                                <h4>Clear All Chats</h4>
                                <p>Delete all chat messages and media. This cannot be undone.</p>
                            </div>
                            <button class="danger-btn" id="clearAllChatsBtn">Clear All</button>
                        </div>
                        
                        <div class="danger-item">
                            <div class="danger-label">
                                <h4>Delete Account</h4>
                                <p>Permanently delete your account and all data. This cannot be undone.</p>
                            </div>
                            <button class="danger-btn" id="deleteAccountBtn">Delete Account</button>
                        </div>
                        
                        <div class="danger-item">
                            <div class="danger-label">
                                <h4>Export All Data</h4>
                                <p>Export all your data before deleting your account.</p>
                            </div>
                            <button class="action-btn" id="exportDataBtn">
                                <i class="fas fa-file-export"></i>
                                Export
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    <div class="modal-overlay" id="confirmModal">
        <div class="modal-container">
            <div class="modal-header">
                <h3>Confirm Action</h3>
                <button class="modal-close" id="closeConfirmModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-content">
                <p id="confirmMessage">Are you sure you want to proceed?</p>
            </div>
            <div class="modal-footer">
                <button class="action-btn" id="cancelConfirmBtn">Cancel</button>
                <button class="danger-btn" id="proceedConfirmBtn">Proceed</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="photoModal">
        <div class="modal-container">
            <div class="modal-header">
                <h3>Change Profile Photo</h3>
                <button class="modal-close" id="closePhotoModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-content">
                <div style="text-align: center; padding: 20px;">
                    <div id="photoPreview" style="width: 150px; height: 150px; border-radius: 50%; background-color: var(--secondary-color); margin: 0 auto 20px; overflow: hidden; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-user" style="font-size: 60px; color: var(--text-secondary);"></i>
                    </div>
                    <input type="file" id="photoUpload" accept="image/*" style="display: none;">
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button class="action-btn" id="takePhotoBtn">
                            <i class="fas fa-camera"></i>
                            Take Photo
                        </button>
                        <button class="action-btn" id="choosePhotoBtn">
                            <i class="fas fa-image"></i>
                            Choose Photo
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Settings saved successfully</span>
    </div>
    
    <!-- Offline Indicator -->
    <div class="offline-indicator" id="offlineIndicator">
        <i class="fas fa-wifi-slash"></i>
        <span>Offline - Settings saved locally</span>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDHHyGgsSV18BcXrGgzi4C8frzDAE1C1zo",
            authDomain: "uniconnect-ee95c.firebaseapp.com",
            projectId: "uniconnect-ee95c",
            storageBucket: "uniconnect-ee95c.firebasestorage.app",
            messagingSenderId: "1003264444309",
            appId: "1:1003264444309:web:9f0307516e44d21e97d89c"
        };
        
        // Initialize Firebase
        // Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

        // Global variables
        let currentUser = null;
        let isOnline = navigator.onLine;
        let currentSettings = {};
        let unsavedChanges = false;
        let isAuthenticated = false;
        let saveTimeout = null;
        let pendingSaves = new Map();
        let currentSection = 'profile';
        let connectionPool = null;
        
        // Section-based default settings
        const sectionDefaults = {
            profile: {
                displayName: '',
                username: '',
                bio: '',
                phone: '',
                email: '',
                profileVisibility: 'public',
                lastSeen: true,
                onlineStatus: true,
                photoVisibility: 'friends'
            },
            security: {
                twoFactor: false,
                loginNotifications: true,
                appLock: false,
                screenCapture: false,
                encryption: true
            },
            privacy: {
                whoCanAddMe: 'everyone',
                readReceipts: true,
                typingIndicators: true,
                messageForwarding: true,
                contactDiscovery: true,
                canMessage: true,
                canCall: true,
                canSeeStatus: true,
                canSeePhoto: true,
                canSeeLastSeen: true,
                canForward: true,
                canScreenshot: false
            },
            chat: {
                enterKeySends: false,
                mediaDownload: 'wifi',
                saveMedia: false,
                messageHistory: 'forever',
                disappearingTimer: 'off',
                smartReplies: true,
                messageTranslation: false,
                chatSummarization: false,
                spamDetection: true
            },
            friends: {
                discoverByPhone: true,
                discoverByEmail: false,
                nearbyDiscovery: false,
                qrCode: true,
                friendSuggestions: true,
                temporaryFriends: false,
                friendshipNotes: true,
                friendCategories: true,
                trustScore: false,
                friendAnalytics: false
            },
            groups: {
                autoJoin: false,
                groupInvitations: 'everyone',
                groupPrivacy: 'public',
                groupAnnouncements: true,
                groupMediaDownload: false,
                messageApproval: false,
                keywordFiltering: false,
                groupSpamDetection: true,
                memberWarnings: true,
                activityTracking: false,
                topContributors: true,
                messageVolume: false
            },
            calls: {
                whoCanCallMe: 'everyone',
                callVerification: false,
                ringtone: 'default',
                callVibration: true,
                autoAnswer: false,
                videoQuality: 'auto',
                cameraDefault: 'front',
                noiseCancellation: true,
                echoCancellation: true,
                liveReactions: true,
                inCallChat: true,
                sharedWhiteboard: true,
                sharedNotes: true,
                polls: true
            },
            status: {
                whoCanViewStatus: 'friends',
                statusExpireTime: '24h',
                statusReplyPermissions: 'friends',
                statusDownload: false,
                viewCount: true,
                viewerList: true,
                statusReactions: true,
                autoCaptions: false,
                statusEnhancement: false,
                statusScheduling: false
            },
            notifications: {
                messageNotifications: true,
                groupNotifications: true,
                friendRequestNotifications: true,
                callNotifications: true,
                statusNotifications: true,
                notificationSound: true,
                notificationVibration: true,
                popupNotifications: false,
                notificationLight: false,
                doNotDisturb: false,
                dndSchedule: 'custom',
                dndAllowCalls: false
            },
            appearance: {
                theme: 'light',
                accentColor: '#0084ff',
                fontSize: 16,
                reduceMotion: false,
                language: 'en',
                timeFormat: '12h',
                dateFormat: 'mm/dd/yyyy'
            },
            storage: {
                autoClearCache: 'never'
            },
            advanced: {
                offlineMode: true,
                intranetSupport: false,
                lowBandwidth: false,
                debugMode: false,
                dataSaver: false
            },
            backup: {
                autoBackup: true,
                backupFrequency: 'weekly',
                backupLocation: 'cloud'
            }
        };
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            requestAnimationFrame(() => {
                initializeApp();
            });
        });
        
        async function initializeApp() {
            // Set up connection pooling
            connectionPool = {
                db: db,
                auth: auth,
                isConnected: true,
                lastUsed: Date.now()
            };
            
            // Check online status
            updateOnlineStatus();
            
            // Listen for online/offline events
            window.addEventListener('online', handleOnline);
            window.addEventListener('offline', handleOffline);
            
            // Check authentication once
            auth.onAuthStateChanged(async user => {
                if (user) {
                    currentUser = user;
                    isAuthenticated = true;
                    console.log('User authenticated:', currentUser.uid);
                    
                    // Load initial section settings only
                    await loadSectionSettings('profile');
                    
                    // Setup event listeners
                    setupEventListeners();
                    
                    // Initialize UI
                    initializeUI();
                    
                } else {
                    console.log('No user detected, redirecting to login');
                    window.location.href = 'index.html';
                }
            });
        }
        
        function updateOnlineStatus() {
            isOnline = navigator.onLine;
            
            if (!isOnline) {
                offlineIndicator.classList.add('active');
            } else {
                offlineIndicator.classList.remove('active');
                // Sync pending saves when back online
                syncPendingSaves();
            }
        }
        
        function handleOnline() {
            isOnline = true;
            offlineIndicator.classList.remove('active');
            syncPendingSaves();
        }
        
        function handleOffline() {
            isOnline = false;
            offlineIndicator.classList.add('active');
            showNotification('You are offline. Settings will be saved locally.', 'warning', 1000);
        }
        
        async function loadSectionSettings(section) {
            try {
                // Load from localStorage first (immediate)
                const localSettings = localStorage.getItem(`userSettings_${section}_${currentUser?.uid}`);
                
                if (localSettings) {
                    currentSettings[section] = JSON.parse(localSettings);
                    console.log(`Loaded ${section} settings from localStorage`);
                    updateSectionUI(section);
                } else {
                    currentSettings[section] = { ...sectionDefaults[section] };
                    updateSectionUI(section);
                }
                
                // Load from Firebase in background if online
                if (isOnline && isAuthenticated) {
                    setTimeout(async () => {
                        try {
                            const settingsDoc = await db.collection('userSettings').doc(currentUser.uid).get();
                            if (settingsDoc.exists) {
                                const serverSettings = settingsDoc.data();
                                if (serverSettings[section]) {
                                    currentSettings[section] = { ...currentSettings[section], ...serverSettings[section] };
                                    // Update UI in next frame
                                    requestAnimationFrame(() => {
                                        updateSectionUI(section);
                                    });
                                }
                            }
                        } catch (error) {
                            console.error(`Error loading ${section} from Firebase:`, error);
                        }
                    }, 100);
                }
                
            } catch (error) {
                console.error(`Error loading ${section} settings:`, error);
                currentSettings[section] = { ...sectionDefaults[section] };
                updateSectionUI(section);
            }
        }
        
        function saveSettingImmediate(section, key, value) {
            // Optimistic update - update UI immediately
            if (!currentSettings[section]) {
                currentSettings[section] = {};
            }
            currentSettings[section][key] = value;
            
            // Add to pending saves for background sync
            pendingSaves.set(`${section}.${key}`, { section, key, value, timestamp: Date.now() });
            
            // Debounced save to localStorage (300ms)
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                saveToLocalStorage();
                if (isOnline) {
                    syncToFirebase();
                }
            }, 300);
            
            unsavedChanges = true;
        }
        
        function saveToLocalStorage() {
            if (!currentUser) return;
            
            // Use setTimeout to prevent blocking UI
            setTimeout(() => {
                try {
                    // Save each section separately
                    Object.keys(currentSettings).forEach(section => {
                        if (currentSettings[section]) {
                            localStorage.setItem(`userSettings_${section}_${currentUser.uid}`, 
                                JSON.stringify(currentSettings[section]));
                        }
                    });
                } catch (error) {
                    console.error('Error saving to localStorage:', error);
                }
            }, 0);
        }
        
        async function syncToFirebase() {
            if (!isOnline || !isAuthenticated || !currentUser) return;
            
            if (pendingSaves.size === 0) return;
            
            try {
                // Get current settings from Firebase
                const settingsDoc = await db.collection('userSettings').doc(currentUser.uid).get();
                let serverSettings = settingsDoc.exists ? settingsDoc.data() : {};
                
                // Apply pending saves
                pendingSaves.forEach(({ section, key, value }) => {
                    if (!serverSettings[section]) {
                        serverSettings[section] = {};
                    }
                    serverSettings[section][key] = value;
                });
                
                // Save to Firebase
                await db.collection('userSettings').doc(currentUser.uid).set(serverSettings, { merge: true });
                
                // Clear pending saves
                pendingSaves.clear();
                unsavedChanges = false;
                
                // Broadcast changes to other tabs
                broadcastSettingsChange();
                
            } catch (error) {
                console.error('Error syncing to Firebase:', error);
                // Keep saves in pending queue for retry later
            }
        }
        
        async function syncPendingSaves() {
            if (pendingSaves.size > 0) {
                await syncToFirebase();
            }
        }
        
        function broadcastSettingsChange() {
            // Use localStorage event for cross-tab communication
            localStorage.setItem(`settingsUpdated_${currentUser?.uid}`, Date.now().toString());
        }
        
        function updateSectionUI(section) {
            if (!currentSettings[section]) return;
            
            requestAnimationFrame(() => {
                const settings = currentSettings[section];
                
                switch(section) {
                    case 'profile':
                        document.getElementById('displayNameInput').value = settings.displayName || '';
                        document.getElementById('usernameInput').value = settings.username || '';
                        document.getElementById('bioInput').value = settings.bio || '';
                        document.getElementById('phoneInput').value = settings.phone || '';
                        document.getElementById('emailInput').value = settings.email || '';
                        document.getElementById('profileVisibility').value = settings.profileVisibility || 'public';
                        document.getElementById('lastSeenToggle').checked = settings.lastSeen !== false;
                        document.getElementById('onlineStatusToggle').checked = settings.onlineStatus !== false;
                        document.getElementById('photoVisibility').value = settings.photoVisibility || 'friends';
                        break;
                        
                    case 'security':
                        document.getElementById('twoFactorToggle').checked = settings.twoFactor || false;
                        document.getElementById('loginNotificationsToggle').checked = settings.loginNotifications !== false;
                        document.getElementById('appLockToggle').checked = settings.appLock || false;
                        document.getElementById('screenCaptureToggle').checked = settings.screenCapture || false;
                        document.getElementById('encryptionToggle').checked = settings.encryption !== false;
                        break;
                        
                    case 'privacy':
                        document.getElementById('whoCanAddMe').value = settings.whoCanAddMe || 'everyone';
                        document.getElementById('readReceiptsToggle').checked = settings.readReceipts !== false;
                        document.getElementById('typingIndicatorsToggle').checked = settings.typingIndicators !== false;
                        document.getElementById('messageForwardingToggle').checked = settings.messageForwarding !== false;
                        document.getElementById('contactDiscoveryToggle').checked = settings.contactDiscovery !== false;
                        document.getElementById('canMessageToggle').checked = settings.canMessage !== false;
                        document.getElementById('canCallToggle').checked = settings.canCall !== false;
                        document.getElementById('canSeeStatusToggle').checked = settings.canSeeStatus !== false;
                        document.getElementById('canSeePhotoToggle').checked = settings.canSeePhoto !== false;
                        document.getElementById('canSeeLastSeenToggle').checked = settings.canSeeLastSeen !== false;
                        document.getElementById('canForwardToggle').checked = settings.canForward !== false;
                        document.getElementById('canScreenshotToggle').checked = settings.canScreenshot || false;
                        break;
                        
                    case 'chat':
                        document.getElementById('enterKeySendsToggle').checked = settings.enterKeySends || false;
                        document.getElementById('mediaDownloadSetting').value = settings.mediaDownload || 'wifi';
                        document.getElementById('saveMediaToggle').checked = settings.saveMedia || false;
                        document.getElementById('messageHistorySetting').value = settings.messageHistory || 'forever';
                        document.getElementById('disappearingTimer').value = settings.disappearingTimer || 'off';
                        document.getElementById('smartRepliesToggle').checked = settings.smartReplies !== false;
                        document.getElementById('messageTranslationToggle').checked = settings.messageTranslation || false;
                        document.getElementById('chatSummarizationToggle').checked = settings.chatSummarization || false;
                        document.getElementById('spamDetectionToggle').checked = settings.spamDetection !== false;
                        break;
                        
                    case 'appearance':
                        // Theme
                        const theme = settings.theme || 'light';
                        document.querySelectorAll('.radio-option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        const themeOption = document.querySelector(`[data-theme="${theme}"]`);
                        if (themeOption) {
                            themeOption.classList.add('selected');
                            themeOption.querySelector('.radio-input').checked = true;
                        }
                        
                        // Accent color
                        const accentColor = settings.accentColor || '#0084ff';
                        document.querySelectorAll('.color-option').forEach(c => {
                            c.classList.remove('selected');
                        });
                        const colorOption = document.querySelector(`[data-color="${accentColor}"]`);
                        if (colorOption) {
                            colorOption.classList.add('selected');
                        }
                        
                        // Other settings
                        document.getElementById('fontSizeSlider').value = settings.fontSize || 16;
                        document.getElementById('fontSizeValue').textContent = `${settings.fontSize || 16}px`;
                        document.getElementById('reduceMotionToggle').checked = settings.reduceMotion || false;
                        document.getElementById('languageSetting').value = settings.language || 'en';
                        document.getElementById('timeFormatSetting').value = settings.timeFormat || '12h';
                        document.getElementById('dateFormatSetting').value = settings.dateFormat || 'mm/dd/yyyy';
                        
                        // Apply theme and color immediately
                        applyTheme();
                        applyAccentColor();
                        break;
                }
            });
        }
        
        function resetSectionToDefault(section) {
            currentSettings[section] = { ...sectionDefaults[section] };
            updateSectionUI(section);
            saveSettingImmediate(section, '_reset', true);
        }
        
        function applyTheme() {
            const theme = currentSettings.appearance?.theme || 'light';
            
            requestAnimationFrame(() => {
                if (theme === 'dark') {
                    document.documentElement.style.setProperty('--bg-color', '#1a1a1a');
                    document.documentElement.style.setProperty('--text-primary', '#ffffff');
                    document.documentElement.style.setProperty('--text-secondary', '#b0b3b8');
                    document.documentElement.style.setProperty('--secondary-color', '#2d2d2d');
                    document.documentElement.style.setProperty('--border-color', '#3e4042');
                    document.documentElement.style.setProperty('--card-bg', '#242526');
                } else {
                    document.documentElement.style.setProperty('--bg-color', '#ffffff');
                    document.documentElement.style.setProperty('--text-primary', '#050505');
                    document.documentElement.style.setProperty('--text-secondary', '#65676b');
                    document.documentElement.style.setProperty('--secondary-color', '#f0f2f5');
                    document.documentElement.style.setProperty('--border-color', '#dddfe2');
                    document.documentElement.style.setProperty('--card-bg', '#ffffff');
                }
                
                localStorage.setItem('appTheme', theme);
            });
        }
        
        function applyAccentColor() {
            const color = currentSettings.appearance?.accentColor || '#0084ff';
            
            requestAnimationFrame(() => {
                document.documentElement.style.setProperty('--primary-color', color);
                const darkerColor = shadeColor(color, -20);
                document.documentElement.style.setProperty('--primary-dark', darkerColor);
            });
        }
        
        function shadeColor(color, percent) {
            let R = parseInt(color.substring(1,3),16);
            let G = parseInt(color.substring(3,5),16);
            let B = parseInt(color.substring(5,7),16);

            R = parseInt(R * (100 + percent) / 100);
            G = parseInt(G * (100 + percent) / 100);
            B = parseInt(B * (100 + percent) / 100);

            R = (R<255)?R:255;  
            G = (G<255)?G:255;  
            B = (B<255)?B:255;  

            const RR = ((R.toString(16).length==1)?"0"+R.toString(16):R.toString(16));
            const GG = ((G.toString(16).length==1)?"0"+G.toString(16):G.toString(16));
            const BB = ((B.toString(16).length==1)?"0"+B.toString(16):B.toString(16));

            return "#"+RR+GG+BB;
        }
        
        function loadStorageUsage() {
            setTimeout(() => {
                const total = 1024;
                const used = Math.floor(Math.random() * 500) + 100;
                const chatStorage = Math.floor(used * 0.25);
                const mediaStorage = Math.floor(used * 0.60);
                const otherStorage = Math.floor(used * 0.15);
                
                requestAnimationFrame(() => {
                    document.getElementById('storageUsed').textContent = `${used} MB`;
                    document.getElementById('storageTotal').textContent = `/ ${total} MB`;
                    document.getElementById('storageFill').style.width = `${(used / total) * 100}%`;
                    document.getElementById('chatStorage').textContent = `${chatStorage} MB`;
                    document.getElementById('mediaStorage').textContent = `${mediaStorage} MB`;
                    document.getElementById('otherStorage').textContent = `${otherStorage} MB`;
                });
            }, 100);
        }
        
        function showNotification(message, type = 'success', duration = 1000) {
            requestAnimationFrame(() => {
                const notificationText = document.getElementById('notificationText');
                if (!notificationText) return;
                
                notificationText.textContent = message;
                notification.className = 'notification';
                notification.classList.add(type);
                notification.classList.add('active');
                
                setTimeout(() => {
                    notification.classList.remove('active');
                }, duration);
            });
        }
        
        function showConfirmDialog(message, onConfirm) {
            requestAnimationFrame(() => {
                const confirmMessage = document.getElementById('confirmMessage');
                confirmMessage.textContent = message;
                confirmModal.classList.add('active');
                
                // Set up confirmation handler
                const handleConfirm = () => {
                    confirmModal.classList.remove('active');
                    onConfirm();
                };
                
                // Remove old listeners and add new ones
                const proceedBtn = document.getElementById('proceedConfirmBtn');
                const newProceedBtn = proceedBtn.cloneNode(true);
                proceedBtn.parentNode.replaceChild(newProceedBtn, proceedBtn);
                
                document.getElementById('proceedConfirmBtn').addEventListener('click', handleConfirm);
            });
        }
        
        function initializeUI() {
            document.getElementById('sectionTitle').textContent = 'Profile Settings';
            applyTheme();
            applyAccentColor();
            
            const fontSizeSlider = document.getElementById('fontSizeSlider');
            const fontSizeValue = document.getElementById('fontSizeValue');
            
            fontSizeSlider.addEventListener('input', function() {
                fontSizeValue.textContent = `${this.value}px`;
                saveSettingImmediate('appearance', 'fontSize', parseInt(this.value));
            });
        }
        
        function setupEventListeners() {
            // Navigation
            document.getElementById('backBtn').addEventListener('click', (e) => {
                e.preventDefault();
                if (unsavedChanges) {
                    showConfirmDialog('You have unsaved changes. Are you sure you want to leave?', () => {
                        window.history.back();
                    });
                } else {
                    window.history.back();
                }
            });
            
            // Navigation items with lazy loading
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.dataset.section;
                    
                    // Update navigation
                    document.querySelectorAll('.nav-item').forEach(nav => {
                        nav.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Update sections
                    document.querySelectorAll('.settings-section').forEach(sec => {
                        sec.classList.remove('active');
                    });
                    
                    const sectionElement = document.getElementById(`${section}Section`);
                    if (sectionElement) {
                        sectionElement.classList.add('active');
                        currentSection = section;
                        
                        // Update title
                        const title = this.querySelector('.nav-text').textContent;
                        document.getElementById('sectionTitle').textContent = `${title} Settings`;
                        
                        // Lazy load section settings if not loaded
                        if (!currentSettings[section]) {
                            loadSectionSettings(section);
                        } else {
                            updateSectionUI(section);
                        }
                    }
                });
            });
            
            // Save All button
            document.getElementById('saveAllBtn').addEventListener('click', async (e) => {
                e.preventDefault();
                const btn = document.getElementById('saveAllBtn');
                const originalText = btn.innerHTML;
                
                btn.innerHTML = '<i class="fas fa-check"></i> Saved';
                btn.disabled = true;
                
                // Save immediately
                saveToLocalStorage();
                if (isOnline) {
                    await syncToFirebase();
                }
                
                showNotification('All settings saved', 'success', 1000);
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 1500);
            });
            
            // Reset All button
            document.getElementById('resetAllBtn').addEventListener('click', (e) => {
                e.preventDefault();
                showConfirmDialog('Are you sure you want to reset all settings to default?', () => {
                    resetSectionToDefault(currentSection);
                    showNotification('Settings reset to default', 'success', 1000);
                });
            });
            
            // Profile settings
            document.getElementById('displayNameInput').addEventListener('input', (e) => {
                saveSettingImmediate('profile', 'displayName', e.target.value);
            });
            
            document.getElementById('usernameInput').addEventListener('input', (e) => {
                saveSettingImmediate('profile', 'username', e.target.value);
            });
            
            document.getElementById('bioInput').addEventListener('input', (e) => {
                saveSettingImmediate('profile', 'bio', e.target.value);
            });
            
            document.getElementById('phoneInput').addEventListener('input', (e) => {
                saveSettingImmediate('profile', 'phone', e.target.value);
            });
            
            document.getElementById('emailInput').addEventListener('input', (e) => {
                saveSettingImmediate('profile', 'email', e.target.value);
            });
            
            document.getElementById('profileVisibility').addEventListener('change', (e) => {
                saveSettingImmediate('profile', 'profileVisibility', e.target.value);
            });
            
            document.getElementById('lastSeenToggle').addEventListener('change', (e) => {
                e.preventDefault();
                const isChecked = e.target.checked;
                saveSettingImmediate('profile', 'lastSeen', isChecked);
                showNotification(`Last seen ${isChecked ? 'enabled' : 'disabled'}`, 'success', 1000);
            });
            
            document.getElementById('onlineStatusToggle').addEventListener('change', (e) => {
                e.preventDefault();
                const isChecked = e.target.checked;
                saveSettingImmediate('profile', 'onlineStatus', isChecked);
                showNotification(`Online status ${isChecked ? 'enabled' : 'disabled'}`, 'success', 1000);
            });
            
            document.getElementById('photoVisibility').addEventListener('change', (e) => {
                saveSettingImmediate('profile', 'photoVisibility', e.target.value);
            });
            
            // Security settings
            document.getElementById('twoFactorToggle').addEventListener('change', (e) => {
                e.preventDefault();
                const isChecked = e.target.checked;
                saveSettingImmediate('security', 'twoFactor', isChecked);
                showNotification(`Two-factor authentication ${isChecked ? 'enabled' : 'disabled'}`, 'success', 1000);
            });
            
            document.getElementById('loginNotificationsToggle').addEventListener('change', (e) => {
                e.preventDefault();
                const isChecked = e.target.checked;
                saveSettingImmediate('security', 'loginNotifications', isChecked);
                showNotification(`Login notifications ${isChecked ? 'enabled' : 'disabled'}`, 'success', 1000);
            });
            
            document.getElementById('appLockToggle').addEventListener('change', (e) => {
                e.preventDefault();
                const isChecked = e.target.checked;
                saveSettingImmediate('security', 'appLock', isChecked);
                showNotification(`App lock ${isChecked ? 'enabled' : 'disabled'}`, 'success', 1000);
            });
            
            document.getElementById('screenCaptureToggle').addEventListener('change', (e) => {
                e.preventDefault();
                const isChecked = e.target.checked;
                saveSettingImmediate('security', 'screenCapture', isChecked);
                showNotification(`Screen capture protection ${isChecked ? 'enabled' : 'disabled'}`, 'success', 1000);
            });
            
            document.getElementById('encryptionToggle').addEventListener('change', (e) => {
                e.preventDefault();
                const isChecked = e.target.checked;
                saveSettingImmediate('security', 'encryption', isChecked);
                showNotification(`Encryption ${isChecked ? 'enabled' : 'disabled'}`, 'success', 1000);
            });
            
            // Privacy settings
            document.getElementById('whoCanAddMe').addEventListener('change', (e) => {
                saveSettingImmediate('privacy', 'whoCanAddMe', e.target.value);
            });
            
            document.getElementById('readReceiptsToggle').addEventListener('change', (e) => {
                e.preventDefault();
                const isChecked = e.target.checked;
                saveSettingImmediate('privacy', 'readReceipts', isChecked);
                showNotification(`Read receipts ${isChecked ? 'enabled' : 'disabled'}`, 'success', 1000);
            });
            
            document.getElementById('typingIndicatorsToggle').addEventListener('change', (e) => {
                e.preventDefault();
                const isChecked = e.target.checked;
                saveSettingImmediate('privacy', 'typingIndicators', isChecked);
                showNotification(`Typing indicators ${isChecked ? 'enabled' : 'disabled'}`, 'success', 1000);
            });
            
            document.getElementById('messageForwardingToggle').addEventListener('change', (e) => {
                e.preventDefault();
                const isChecked = e.target.checked;
                saveSettingImmediate('privacy', 'messageForwarding', isChecked);
                showNotification(`Message forwarding ${isChecked ? 'enabled' : 'disabled'}`, 'success', 1000);
            });
            
            document.getElementById('contactDiscoveryToggle').addEventListener('change', (e) => {
                e.preventDefault();
                const isChecked = e.target.checked;
                saveSettingImmediate('privacy', 'contactDiscovery', isChecked);
                showNotification(`Contact discovery ${isChecked ? 'enabled' : 'disabled'}`, 'success', 1000);
            });
            
            // Friend privacy toggles
            document.getElementById('canMessageToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('privacy', 'canMessage', e.target.checked);
            });
            
            document.getElementById('canCallToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('privacy', 'canCall', e.target.checked);
            });
            
            document.getElementById('canSeeStatusToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('privacy', 'canSeeStatus', e.target.checked);
            });
            
            document.getElementById('canSeePhotoToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('privacy', 'canSeePhoto', e.target.checked);
            });
            
            document.getElementById('canSeeLastSeenToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('privacy', 'canSeeLastSeen', e.target.checked);
            });
            
            document.getElementById('canForwardToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('privacy', 'canForward', e.target.checked);
            });
            
            document.getElementById('canScreenshotToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('privacy', 'canScreenshot', e.target.checked);
            });
            
            // Chat settings
            document.getElementById('enterKeySendsToggle').addEventListener('change', (e) => {
                e.preventDefault();
                const isChecked = e.target.checked;
                saveSettingImmediate('chat', 'enterKeySends', isChecked);
                showNotification(`Enter key sends ${isChecked ? 'enabled' : 'disabled'}`, 'success', 1000);
            });
            
            document.getElementById('mediaDownloadSetting').addEventListener('change', (e) => {
                saveSettingImmediate('chat', 'mediaDownload', e.target.value);
            });
            
            document.getElementById('saveMediaToggle').addEventListener('change', (e) => {
                e.preventDefault();
                const isChecked = e.target.checked;
                saveSettingImmediate('chat', 'saveMedia', isChecked);
                showNotification(`Save to camera roll ${isChecked ? 'enabled' : 'disabled'}`, 'success', 1000);
            });
            
            document.getElementById('messageHistorySetting').addEventListener('change', (e) => {
                saveSettingImmediate('chat', 'messageHistory', e.target.value);
            });
            
            document.getElementById('disappearingTimer').addEventListener('change', (e) => {
                saveSettingImmediate('chat', 'disappearingTimer', e.target.value);
            });
            
            document.getElementById('smartRepliesToggle').addEventListener('change', (e) => {
                e.preventDefault();
                const isChecked = e.target.checked;
                saveSettingImmediate('chat', 'smartReplies', isChecked);
                showNotification(`Smart replies ${isChecked ? 'enabled' : 'disabled'}`, 'success', 1000);
            });
            
            document.getElementById('messageTranslationToggle').addEventListener('change', (e) => {
                e.preventDefault();
                const isChecked = e.target.checked;
                saveSettingImmediate('chat', 'messageTranslation', isChecked);
                showNotification(`Message translation ${isChecked ? 'enabled' : 'disabled'}`, 'success', 1000);
            });
            
            document.getElementById('chatSummarizationToggle').addEventListener('change', (e) => {
                e.preventDefault();
                const isChecked = e.target.checked;
                saveSettingImmediate('chat', 'chatSummarization', isChecked);
                showNotification(`Chat summarization ${isChecked ? 'enabled' : 'disabled'}`, 'success', 1000);
            });
            
            document.getElementById('spamDetectionToggle').addEventListener('change', (e) => {
                e.preventDefault();
                const isChecked = e.target.checked;
                saveSettingImmediate('chat', 'spamDetection', isChecked);
                showNotification(`Spam detection ${isChecked ? 'enabled' : 'disabled'}`, 'success', 1000);
            });
            
            // Friends settings
            document.getElementById('discoverByPhoneToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('friends', 'discoverByPhone', e.target.checked);
            });
            
            document.getElementById('discoverByEmailToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('friends', 'discoverByEmail', e.target.checked);
            });
            
            document.getElementById('nearbyDiscoveryToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('friends', 'nearbyDiscovery', e.target.checked);
            });
            
            document.getElementById('qrCodeToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('friends', 'qrCode', e.target.checked);
            });
            
            document.getElementById('friendSuggestionsToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('friends', 'friendSuggestions', e.target.checked);
            });
            
            document.getElementById('temporaryFriendsToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('friends', 'temporaryFriends', e.target.checked);
            });
            
            document.getElementById('friendshipNotesToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('friends', 'friendshipNotes', e.target.checked);
            });
            
            document.getElementById('friendCategoriesToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('friends', 'friendCategories', e.target.checked);
            });
            
            document.getElementById('trustScoreToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('friends', 'trustScore', e.target.checked);
            });
            
            document.getElementById('friendAnalyticsToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('friends', 'friendAnalytics', e.target.checked);
            });
            
            // Groups settings
            document.getElementById('autoJoinGroupsToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('groups', 'autoJoin', e.target.checked);
            });
            
            document.getElementById('groupInvitationsSetting').addEventListener('change', (e) => {
                saveSettingImmediate('groups', 'groupInvitations', e.target.value);
            });
            
            document.getElementById('groupPrivacySetting').addEventListener('change', (e) => {
                saveSettingImmediate('groups', 'groupPrivacy', e.target.value);
            });
            
            document.getElementById('groupAnnouncementsToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('groups', 'groupAnnouncements', e.target.checked);
            });
            
            document.getElementById('groupMediaDownloadToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('groups', 'groupMediaDownload', e.target.checked);
            });
            
            document.getElementById('messageApprovalToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('groups', 'messageApproval', e.target.checked);
            });
            
            document.getElementById('keywordFilteringToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('groups', 'keywordFiltering', e.target.checked);
            });
            
            document.getElementById('groupSpamDetectionToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('groups', 'groupSpamDetection', e.target.checked);
            });
            
            document.getElementById('memberWarningsToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('groups', 'memberWarnings', e.target.checked);
            });
            
            document.getElementById('activityTrackingToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('groups', 'activityTracking', e.target.checked);
            });
            
            document.getElementById('topContributorsToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('groups', 'topContributors', e.target.checked);
            });
            
            document.getElementById('messageVolumeToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('groups', 'messageVolume', e.target.checked);
            });
            
            // Calls settings
            document.getElementById('whoCanCallMe').addEventListener('change', (e) => {
                saveSettingImmediate('calls', 'whoCanCallMe', e.target.value);
            });
            
            document.getElementById('callVerificationToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('calls', 'callVerification', e.target.checked);
            });
            
            document.getElementById('ringtoneSetting').addEventListener('change', (e) => {
                saveSettingImmediate('calls', 'ringtone', e.target.value);
            });
            
            document.getElementById('callVibrationToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('calls', 'callVibration', e.target.checked);
            });
            
            document.getElementById('autoAnswerToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('calls', 'autoAnswer', e.target.checked);
            });
            
            document.getElementById('videoQualitySetting').addEventListener('change', (e) => {
                saveSettingImmediate('calls', 'videoQuality', e.target.value);
            });
            
            document.getElementById('cameraDefaultSetting').addEventListener('change', (e) => {
                saveSettingImmediate('calls', 'cameraDefault', e.target.value);
            });
            
            document.getElementById('noiseCancellationToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('calls', 'noiseCancellation', e.target.checked);
            });
            
            document.getElementById('echoCancellationToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('calls', 'echoCancellation', e.target.checked);
            });
            
            document.getElementById('liveReactionsToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('calls', 'liveReactions', e.target.checked);
            });
            
            document.getElementById('inCallChatToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('calls', 'inCallChat', e.target.checked);
            });
            
            document.getElementById('sharedWhiteboardToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('calls', 'sharedWhiteboard', e.target.checked);
            });
            
            document.getElementById('sharedNotesToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('calls', 'sharedNotes', e.target.checked);
            });
            
            document.getElementById('pollsToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('calls', 'polls', e.target.checked);
            });
            
            // Status settings
            document.getElementById('whoCanViewStatus').addEventListener('change', (e) => {
                saveSettingImmediate('status', 'whoCanViewStatus', e.target.value);
            });
            
            document.getElementById('statusExpireTime').addEventListener('change', (e) => {
                saveSettingImmediate('status', 'statusExpireTime', e.target.value);
            });
            
            document.getElementById('statusReplyPermissions').addEventListener('change', (e) => {
                saveSettingImmediate('status', 'statusReplyPermissions', e.target.value);
            });
            
            document.getElementById('statusDownloadToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('status', 'statusDownload', e.target.checked);
            });
            
            document.getElementById('viewCountToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('status', 'viewCount', e.target.checked);
            });
            
            document.getElementById('viewerListToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('status', 'viewerList', e.target.checked);
            });
            
            document.getElementById('statusReactionsToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('status', 'statusReactions', e.target.checked);
            });
            
            document.getElementById('autoCaptionsToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('status', 'autoCaptions', e.target.checked);
            });
            
            document.getElementById('statusEnhancementToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('status', 'statusEnhancement', e.target.checked);
            });
            
            document.getElementById('statusSchedulingToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('status', 'statusScheduling', e.target.checked);
            });
            
            // Notifications settings
            document.getElementById('messageNotificationsToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('notifications', 'messageNotifications', e.target.checked);
            });
            
            document.getElementById('groupNotificationsToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('notifications', 'groupNotifications', e.target.checked);
            });
            
            document.getElementById('friendRequestNotificationsToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('notifications', 'friendRequestNotifications', e.target.checked);
            });
            
            document.getElementById('callNotificationsToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('notifications', 'callNotifications', e.target.checked);
            });
            
            document.getElementById('statusNotificationsToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('notifications', 'statusNotifications', e.target.checked);
            });
            
            document.getElementById('notificationSoundToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('notifications', 'notificationSound', e.target.checked);
            });
            
            document.getElementById('notificationVibrationToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('notifications', 'notificationVibration', e.target.checked);
            });
            
            document.getElementById('popupNotificationsToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('notifications', 'popupNotifications', e.target.checked);
            });
            
            document.getElementById('notificationLightToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('notifications', 'notificationLight', e.target.checked);
            });
            
            document.getElementById('doNotDisturbToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('notifications', 'doNotDisturb', e.target.checked);
            });
            
            document.getElementById('dndSchedule').addEventListener('change', (e) => {
                saveSettingImmediate('notifications', 'dndSchedule', e.target.value);
            });
            
            document.getElementById('dndAllowCallsToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('notifications', 'dndAllowCalls', e.target.checked);
            });
            
            // Appearance settings - Theme selection
            document.querySelectorAll('.radio-option').forEach(option => {
                option.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('.radio-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    
                    const radioInput = this.querySelector('.radio-input');
                    if (radioInput) {
                        radioInput.checked = true;
                    }
                    
                    const theme = this.dataset.theme;
                    saveSettingImmediate('appearance', 'theme', theme);
                    applyTheme();
                });
            });
            
            // Appearance settings - Color selection
            document.querySelectorAll('.color-option').forEach(color => {
                color.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('.color-option').forEach(c => {
                        c.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    
                    const colorValue = this.dataset.color;
                    saveSettingImmediate('appearance', 'accentColor', colorValue);
                    applyAccentColor();
                });
            });
            
            // Appearance settings - Other
            document.getElementById('reduceMotionToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('appearance', 'reduceMotion', e.target.checked);
            });
            
            document.getElementById('languageSetting').addEventListener('change', (e) => {
                saveSettingImmediate('appearance', 'language', e.target.value);
            });
            
            document.getElementById('timeFormatSetting').addEventListener('change', (e) => {
                saveSettingImmediate('appearance', 'timeFormat', e.target.value);
            });
            
            document.getElementById('dateFormatSetting').addEventListener('change', (e) => {
                saveSettingImmediate('appearance', 'dateFormat', e.target.value);
            });
            
            // Storage settings
            document.getElementById('autoClearCache').addEventListener('change', (e) => {
                saveSettingImmediate('storage', 'autoClearCache', e.target.value);
            });
            
            // Advanced settings
            document.getElementById('offlineModeToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('advanced', 'offlineMode', e.target.checked);
            });
            
            document.getElementById('intranetSupportToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('advanced', 'intranetSupport', e.target.checked);
            });
            
            document.getElementById('lowBandwidthToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('advanced', 'lowBandwidth', e.target.checked);
            });
            
            document.getElementById('debugModeToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('advanced', 'debugMode', e.target.checked);
            });
            
            document.getElementById('dataSaverToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('advanced', 'dataSaver', e.target.checked);
            });
            
            // Backup settings
            document.getElementById('autoBackupToggle').addEventListener('change', (e) => {
                e.preventDefault();
                saveSettingImmediate('backup', 'autoBackup', e.target.checked);
            });
            
            document.getElementById('backupFrequency').addEventListener('change', (e) => {
                saveSettingImmediate('backup', 'backupFrequency', e.target.value);
            });
            
            document.getElementById('backupLocation').addEventListener('change', (e) => {
                saveSettingImmediate('backup', 'backupLocation', e.target.value);
            });
            
            // Action buttons
            document.getElementById('changePhotoBtn').addEventListener('click', (e) => {
                e.preventDefault();
                photoModal.classList.add('active');
            });
            
            document.getElementById('closePhotoModal').addEventListener('click', (e) => {
                e.preventDefault();
                photoModal.classList.remove('active');
            });
            
            document.getElementById('choosePhotoBtn').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('photoUpload').click();
            });
            
            document.getElementById('takePhotoBtn').addEventListener('click', (e) => {
                e.preventDefault();
                showNotification('Camera feature requires device permissions', 'warning', 1000);
            });
            
            document.getElementById('photoUpload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const photoPreview = document.getElementById('photoPreview');
                        photoPreview.innerHTML = `<img src="${e.target.result}" style="width: 100%; height: 100%; object-fit: cover;">`;
                        showNotification('Profile photo updated', 'success', 1000);
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            document.getElementById('changePasswordBtn').addEventListener('click', (e) => {
                e.preventDefault();
                showConfirmDialog('You will be redirected to change your password. Continue?', () => {
                    showNotification('Password change feature requires backend setup', 'warning', 1000);
                });
            });
            
            document.getElementById('manageBlockedBtn').addEventListener('click', (e) => {
                e.preventDefault();
                showNotification('Blocked users management requires friends module', 'info', 1000);
            });
            
            document.getElementById('changeWallpaperBtn').addEventListener('click', (e) => {
                e.preventDefault();
                showNotification('Wallpaper changer requires chat module', 'info', 1000);
            });
            
            document.getElementById('hideFromUsersBtn').addEventListener('click', (e) => {
                e.preventDefault();
                showNotification('Hide from users requires friends module', 'info', 1000);
            });
            
            document.getElementById('dndAllowContactsBtn').addEventListener('click', (e) => {
                e.preventDefault();
                showNotification('Contact selection requires friends module', 'info', 1000);
            });
            
            document.getElementById('clearChatCacheBtn').addEventListener('click', (e) => {
                e.preventDefault();
                showConfirmDialog('Clear all chat cache? This will remove temporary files.', () => {
                    showNotification('Chat cache cleared', 'success', 1000);
                    loadStorageUsage();
                });
            });
            
            document.getElementById('clearMediaCacheBtn').addEventListener('click', (e) => {
                e.preventDefault();
                showConfirmDialog('Clear all media cache? This will remove downloaded media files.', () => {
                    showNotification('Media cache cleared', 'success', 1000);
                    loadStorageUsage();
                });
            });
            
            document.getElementById('deleteAllDataBtn').addEventListener('click', (e) => {
                e.preventDefault();
                // Verify auth for dangerous operation
                if (!isAuthenticated) {
                    showNotification('Authentication required', 'error', 1000);
                    return;
                }
                
                showConfirmDialog('Delete ALL app data? This cannot be undone and will log you out.', () => {
                    localStorage.clear();
                    showNotification('All data deleted. Redirecting to login...', 'success', 1000);
                    setTimeout(() => {
                        auth.signOut();
                        window.location.href = 'index.html';
                    }, 1500);
                });
            });
            
            document.getElementById('developerOptionsBtn').addEventListener('click', (e) => {
                e.preventDefault();
                showNotification('Developer options require debug mode', 'info', 1000);
            });
            
            document.getElementById('proxySettingsBtn').addEventListener('click', (e) => {
                e.preventDefault();
                showNotification('Proxy configuration requires network module', 'info', 1000);
            });
            
            document.getElementById('connectionTestBtn').addEventListener('click', (e) => {
                e.preventDefault();
                const btn = document.getElementById('connectionTestBtn');
                const originalText = btn.innerHTML;
                
                btn.innerHTML = '<div class="loading-spinner"></div> Testing...';
                btn.disabled = true;
                
                setTimeout(() => {
                    if (isOnline) {
                        showNotification('Connection test successful', 'success', 1000);
                    } else {
                        showNotification('Connection test failed', 'error', 1000);
                    }
                    
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 1500);
            });
            
            document.getElementById('fullBackupBtn').addEventListener('click', (e) => {
                e.preventDefault();
                showConfirmDialog('Create full backup of all data?', () => {
                    const btn = document.getElementById('fullBackupBtn');
                    const originalText = btn.innerHTML;
                    
                    btn.innerHTML = '<div class="loading-spinner"></div> Backing up...';
                    btn.disabled = true;
                    
                    setTimeout(() => {
                        showNotification('Full backup created successfully', 'success', 1000);
                        document.getElementById('lastBackupTime').textContent = new Date().toLocaleString();
                        
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                    }, 1500);
                });
            });
            
            document.getElementById('chatBackupBtn').addEventListener('click', (e) => {
                e.preventDefault();
                showNotification('Chat backup requires chat module', 'info', 1000);
            });
            
            document.getElementById('mediaBackupBtn').addEventListener('click', (e) => {
                e.preventDefault();
                showNotification('Media backup requires media module', 'info', 1000);
            });
            
            document.getElementById('restoreBackupBtn').addEventListener('click', (e) => {
                e.preventDefault();
                showConfirmDialog('Restore from backup? This will overwrite current data.', () => {
                    showNotification('Backup restoration requires backup file', 'warning', 1000);
                });
            });
            
            document.getElementById('clearAllChatsBtn').addEventListener('click', (e) => {
                e.preventDefault();
                showConfirmDialog('Clear ALL chats? This cannot be undone.', () => {
                    showNotification('All chats cleared', 'success', 1000);
                });
            });
            
            document.getElementById('deleteAccountBtn').addEventListener('click', (e) => {
                e.preventDefault();
                // Verify auth for dangerous operation
                if (!isAuthenticated) {
                    showNotification('Authentication required', 'error', 1000);
                    return;
                }
                
                showConfirmDialog('Permanently delete your account? This cannot be undone.', () => {
                    showNotification('Account deletion requires backend confirmation', 'warning', 1000);
                });
            });
            
            document.getElementById('exportDataBtn').addEventListener('click', (e) => {
                e.preventDefault();
                const btn = document.getElementById('exportDataBtn');
                const originalText = btn.innerHTML;
                
                btn.innerHTML = '<div class="loading-spinner"></div> Exporting...';
                btn.disabled = true;
                
                setTimeout(() => {
                    // Export data in background
                    setTimeout(() => {
                        const dataStr = JSON.stringify(currentSettings, null, 2);
                        const dataBlob = new Blob([dataStr], { type: 'application/json' });
                        const downloadUrl = URL.createObjectURL(dataBlob);
                        const a = document.createElement('a');
                        a.href = downloadUrl;
                        a.download = `settings_backup_${Date.now()}.json`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(downloadUrl);
                        
                        showNotification('Data exported successfully', 'success', 1000);
                    }, 0);
                    
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 1500);
            });
            
            // Modal close buttons
            document.getElementById('closeConfirmModal').addEventListener('click', (e) => {
                e.preventDefault();
                confirmModal.classList.remove('active');
            });
            
            document.getElementById('cancelConfirmBtn').addEventListener('click', (e) => {
                e.preventDefault();
                confirmModal.classList.remove('active');
            });
            
            // Listen for settings changes from other tabs
            window.addEventListener('storage', function(event) {
                if (event.key === `settingsUpdated_${currentUser?.uid}`) {
                    // Reload current section
                    loadSectionSettings(currentSection);
                }
                if (event.key === 'appTheme') {
                    applyTheme();
                }
            });
            
            // Before unload warning
            window.addEventListener('beforeunload', function(event) {
                if (unsavedChanges) {
                    event.preventDefault();
                    event.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
                    return event.returnValue;
                }
            });
        }
        
        console.log('Optimized settings system initialized successfully');
    </script>
</body>
</html>