<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
    <link rel="icon" href="../icons/moodchat-192.png">
    <link rel="icon" href="../icons/moodchat-512.png">
    <meta name="theme-color" content="#000000">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings | Chat App</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* All CSS remains exactly the same */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary-color: #0084ff;
            --primary-dark: #0066cc;
            --secondary-color: #f0f2f5;
            --danger-color: #ff3b30;
            --success-color: #34c759;
            --warning-color: #ff9500;
            --text-primary: #050505;
            --text-secondary: #65676b;
            --bg-color: #ffffff;
            --border-color: #dddfe2;
            --card-bg: #ffffff;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.2);
            --sidebar-width: 280px;
            --header-height: 70px;
            --transition: all 0.15s ease;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
        }
        
        /* Sidebar Navigation */
        .settings-sidebar {
            width: var(--sidebar-width);
            background-color: var(--bg-color);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }
        
        .sidebar-header {
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 1px solid var(--border-color);
            height: var(--header-height);
        }
        
        .back-btn {
            background: none;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            color: var(--text-primary);
            transition: var(--transition);
        }
        
        .back-btn:hover {
            background-color: var(--secondary-color);
        }
        
        .sidebar-header h2 {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .nav-category {
            padding: 15px 20px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 10px;
        }
        
        .nav-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            cursor: pointer;
            transition: var(--transition);
            border-left: 4px solid transparent;
        }
        
        .nav-item:hover {
            background-color: var(--secondary-color);
        }
        
        .nav-item.active {
            background-color: rgba(0, 132, 255, 0.1);
            border-left-color: var(--primary-color);
        }
        
        .nav-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 16px;
            color: var(--text-secondary);
        }
        
        .nav-item.active .nav-icon {
            color: var(--primary-color);
        }
        
        .nav-text {
            font-size: 15px;
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .nav-badge {
            margin-left: auto;
            background-color: var(--primary-color);
            color: white;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        /* Main Content Area */
        .settings-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
            background-color: var(--bg-color);
        }
        
        .content-header {
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .content-header h1 {
            font-size: 28px;
            font-weight: 600;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .action-btn:hover {
            background-color: var(--secondary-color);
        }
        
        .action-btn.primary {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .action-btn.primary:hover {
            background-color: var(--primary-dark);
        }
        
        .content-body {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }
        
        /* Settings Sections */
        .settings-section {
            display: none;
            animation: fadeIn 0.15s ease;
        }
        
        .settings-section.active {
            display: block;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
        }
        
        .section-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 30px;
            line-height: 1.5;
        }
        
        /* Settings Cards */
        .settings-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
        }
        
        .card-icon.account { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-icon.privacy { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .card-icon.chat { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .card-icon.friends { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .card-icon.groups { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .card-icon.calls { background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); }
        .card-icon.status { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .card-icon.notifications { background: linear-gradient(135deg, #5ee7df 0%, #b490ca 100%); }
        .card-icon.appearance { background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%); }
        .card-icon.storage { background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%); }
        .card-icon.advanced { background: linear-gradient(135deg, #ffd1ff 0%, #fad0c4 100%); }
        
        /* Settings Items */
        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
        }
        
        .settings-item:last-child {
            border-bottom: none;
        }
        
        .settings-item:hover {
            background-color: rgba(0, 132, 255, 0.02);
        }
        
        .item-label {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex: 1;
        }
        
        .item-title {
            font-weight: 500;
            font-size: 15px;
            color: var(--text-primary);
        }
        
        .item-description {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.4;
        }
        
        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            will-change: transform;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .15s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .15s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        /* Select Dropdown */
        .select-wrapper {
            position: relative;
            min-width: 150px;
        }
        
        .select-wrapper select {
            width: 100%;
            padding: 8px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
            appearance: none;
            outline: none;
        }
        
        .select-wrapper::after {
            content: "â–¾";
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: var(--text-secondary);
        }
        
        /* Radio Buttons */
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .radio-option:hover {
            background-color: var(--secondary-color);
        }
        
        .radio-option.selected {
            border-color: var(--primary-color);
            background-color: rgba(0, 132, 255, 0.1);
        }
        
        .radio-input {
            margin-right: 10px;
        }
        
        .radio-label {
            flex: 1;
        }
        
        .radio-title {
            font-weight: 500;
            font-size: 14px;
            margin-bottom: 3px;
        }
        
        .radio-description {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        /* Color Picker */
        .color-picker {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: var(--transition);
            will-change: transform;
        }
        
        .color-option:hover {
            transform: scale(1.05);
        }
        
        .color-option.selected {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 132, 255, 0.3);
        }
        
        /* Range Slider */
        .range-slider {
            width: 100%;
            margin: 10px 0;
        }
        
        .range-value {
            text-align: center;
            font-weight: 500;
            color: var(--primary-color);
            margin-top: 5px;
        }
        
        /* Friend Privacy Grid */
        .privacy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .privacy-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-color);
        }
        
        .privacy-label {
            font-size: 14px;
            font-weight: 500;
        }
        
        /* Backup Options */
        .backup-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .backup-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .backup-option:hover {
            background-color: var(--secondary-color);
        }
        
        .backup-icon {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    color: white;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}
        
        .backup-info {
            flex: 1;
        }
        
        .backup-title {
            font-weight: 500;
            font-size: 15px;
            margin-bottom: 3px;
        }
        
        .backup-description {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        /* Danger Zone */
        .danger-zone {
            border: 2px solid var(--danger-color);
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
        }
        
        .danger-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .danger-header i {
            color: var(--danger-color);
            font-size: 20px;
        }
        
        .danger-header h3 {
            color: var(--danger-color);
            font-weight: 600;
        }
        
        .danger-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 59, 48, 0.2);
        }
        
        .danger-item:last-child {
            border-bottom: none;
        }
        
        .danger-label h4 {
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .danger-label p {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .danger-btn {
            padding: 8px 20px;
            background-color: var(--danger-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }
        
        .danger-btn:hover {
            background-color: #ff1a1a;
        }
        
        /* Search Input */
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            background-color: var(--bg-color);
            color: var(--text-primary);
        }
        
        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }
        
        /* Category Tabs */
        .category-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .category-tab {
            padding: 10px 20px;
            background-color: var(--secondary-color);
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-secondary);
            transition: var(--transition);
        }
        
        .category-tab.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.15s ease;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-container {
            width: 90%;
            max-width: 500px;
            background-color: var(--bg-color);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            animation: fadeIn 0.15s ease;
            will-change: transform;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            font-size: 18px;
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-secondary);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-close:hover {
            background-color: var(--secondary-color);
        }
        
        .modal-content {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--success-color);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.15s;
            will-change: transform, opacity;
        }
        
        .notification.active {
            transform: translateY(0);
            opacity: 1;
        }
        
        .notification.error {
            background-color: var(--danger-color);
        }
        
        .notification.warning {
            background-color: var(--warning-color);
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .settings-sidebar {
                width: 100%;
                height: auto;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }
            
            .nav-list {
                display: flex;
                overflow-x: auto;
                padding: 10px;
            }
            
            .nav-item {
                flex-direction: column;
                padding: 10px 15px;
                min-width: 80px;
                border-left: none;
                border-bottom: 3px solid transparent;
            }
            
            .nav-item.active {
                border-left: none;
                border-bottom-color: var(--primary-color);
            }
            
            .nav-icon {
                margin-right: 0;
                margin-bottom: 5px;
            }
            
            .nav-text {
                font-size: 12px;
                text-align: center;
            }
            
            .nav-badge {
                position: absolute;
                top: 5px;
                right: 5px;
            }
            
            .content-header {
                padding: 15px;
            }
            
            .content-header h1 {
                font-size: 22px;
            }
            
            .content-body {
                padding: 20px;
            }
            
            .settings-card {
                padding: 20px;
            }
            
            .privacy-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Offline Indicator */
        .offline-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--warning-color);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow);
            animation: slideInRight 0.15s ease;
            display: none;
            will-change: transform;
        }
        
        .offline-indicator.active {
            display: flex;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 132, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Theme Preview */
        .theme-preview {
            width: 100px;
            height: 60px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .theme-preview:hover {
            transform: scale(1.05);
            border-color: var(--primary-color);
        }
        
        .theme-preview.selected {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 132, 255, 0.2);
        }
        
        /* Storage Bar */
        .storage-bar-container {
            margin-top: 10px;
        }
        
        .storage-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .storage-bar {
            height: 8px;
            background-color: var(--secondary-color);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .storage-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), #00f2fe);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        /* Permissions Matrix */
        .permissions-matrix {
            overflow-x: auto;
        }
        
        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .matrix-table th,
        .matrix-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid var(--border-color);
        }
        
        .matrix-table th {
            background-color: var(--secondary-color);
            font-weight: 600;
            font-size: 12px;
        }
        
        .matrix-table td {
            font-size: 13px;
        }
        
        .matrix-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        /* Quick Settings Grid */
        .quick-settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .quick-setting {
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .quick-setting:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }
        
        .quick-setting-label {
            font-weight: 500;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <div class="settings-sidebar">
            <div class="sidebar-header">
                <button class="back-btn" id="backBtn" title="Go Back">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2>Settings</h2>
            </div>
            
            <div class="nav-list">
                <div class="nav-category">Account</div>
                <div class="nav-item active" data-section="profile">
                    <div class="nav-icon">
                        <i class="fas fa-user"></i>
                    </div>
                    <span class="nav-text">Profile</span>
                </div>
                <div class="nav-item" data-section="security">
                    <div class="nav-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <span class="nav-text">Security</span>
                </div>
                <div class="nav-item" data-section="privacy">
                    <div class="nav-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <span class="nav-text">Privacy</span>
                    <span class="nav-badge" id="privacyBadge">New</span>
                </div>
                
                <div class="nav-category">Communication</div>
                <div class="nav-item" data-section="chat">
                    <div class="nav-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <span class="nav-text">Chat</span>
                </div>
                <div class="nav-item" data-section="friends">
                    <div class="nav-icon">
                        <i class="fas fa-user-friends"></i>
                    </div>
                    <span class="nav-text">Friends</span>
                </div>
                <div class="nav-item" data-section="groups">
                    <div class="nav-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <span class="nav-text">Groups</span>
                </div>
                <div class="nav-item" data-section="calls">
                    <div class="nav-icon">
                        <i class="fas fa-phone-alt"></i>
                    </div>
                    <span class="nav-text">Calls</span>
                </div>
                <div class="nav-item" data-section="status">
                    <div class="nav-icon">
                        <i class="fas fa-circle"></i>
                    </div>
                    <span class="nav-text">Status</span>
                </div>
                
                <div class="nav-category">Preferences</div>
                <div class="nav-item" data-section="notifications">
                    <div class="nav-icon">
                        <i class="fas fa-bell"></i>
                    </div>
                    <span class="nav-text">Notifications</span>
                </div>
                <div class="nav-item" data-section="appearance">
                    <div class="nav-icon">
                        <i class="fas fa-palette"></i>
                    </div>
                    <span class="nav-text">Appearance</span>
                </div>
                <div class="nav-item" data-section="storage">
                    <div class="nav-icon">
                        <i class="fas fa-database"></i>
                    </div>
                    <span class="nav-text">Storage</span>
                </div>
                
                <div class="nav-category">Advanced</div>
                <div class="nav-item" data-section="advanced">
                    <div class="nav-icon">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <span class="nav-text">Advanced</span>
                </div>
                <div class="nav-item" data-section="backup">
                    <div class="nav-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <span class="nav-text">Backup & Restore</span>
                </div>
                <div class="nav-item" data-section="danger">
                    <div class="nav-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <span class="nav-text">Danger Zone</span>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="settings-content">
            <div class="content-header">
                <h1 id="sectionTitle">Profile Settings</h1>
                <div class="header-actions">
                    <button class="action-btn" id="saveAllBtn">
                        <i class="fas fa-save"></i>
                        Save All Changes
                    </button>
                    <button class="action-btn" id="resetAllBtn">
                        <i class="fas fa-undo"></i>
                        Reset to Default
                    </button>
                </div>
            </div>
            
            <div class="content-body">
                <!-- Profile Section -->
                <div class="settings-section active" id="profileSection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon account">
                                    <i class="fas fa-user"></i>
                                </div>
                                Personal Information
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Profile Photo</span>
                                <span class="item-description">Your profile picture visible to other users</span>
                            </div>
                            <button class="action-btn" id="changePhotoBtn">
                                <i class="fas fa-camera"></i>
                                Change
                            </button>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Display Name</span>
                                <span class="item-description">Name shown to other users</span>
                            </div>
                            <input type="text" class="search-input" id="displayNameInput" placeholder="Enter your name">
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Username</span>
                                <span class="item-description">Your unique identifier (@username)</span>
                            </div>
                            <input type="text" class="search-input" id="usernameInput" placeholder="@username">
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Bio</span>
                                <span class="item-description">Tell others about yourself</span>
                            </div>
                            <textarea class="search-input" id="bioInput" rows="3" placeholder="Write something about yourself..."></textarea>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Phone Number</span>
                                <span class="item-description">Used for account recovery and friend discovery</span>
                            </div>
                            <input type="tel" class="search-input" id="phoneInput" placeholder="+1234567890">
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Email Address</span>
                                <span class="item-description">Used for notifications and account recovery</span>
                            </div>
                            <input type="email" class="search-input" id="emailInput" placeholder="email@example.com">
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon account">
                                    <i class="fas fa-globe"></i>
                                </div>
                                Public Profile
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Profile Visibility</span>
                                <span class="item-description">Who can see your profile information</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="profileVisibility">
                                    <option value="public">Everyone</option>
                                    <option value="friends">Friends Only</option>
                                    <option value="private">Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Last Seen</span>
                                <span class="item-description">Show when you were last active</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="lastSeenToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Online Status</span>
                                <span class="item-description">Show when you're online</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="onlineStatusToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Profile Photo Visibility</span>
                                <span class="item-description">Who can see your profile photo</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="photoVisibility">
                                    <option value="public">Everyone</option>
                                    <option value="friends">Friends Only</option>
                                    <option value="private">Nobody</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Security Section -->
                <div class="settings-section" id="securitySection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon privacy">
                                    <i class="fas fa-key"></i>
                                </div>
                                Account Security
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Two-Factor Authentication</span>
                                <span class="item-description">Add an extra layer of security to your account</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="twoFactorToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Change Password</span>
                                <span class="item-description">Update your account password regularly</span>
                            </div>
                            <button class="action-btn" id="changePasswordBtn">
                                <i class="fas fa-lock"></i>
                                Change
                            </button>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Login Notifications</span>
                                <span class="item-description">Get notified when someone logs into your account</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="loginNotificationsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Active Sessions</span>
                                <span class="item-description">View and manage devices logged into your account</span>
                            </div>
                            <button class="action-btn" id="viewSessionsBtn">
                                <i class="fas fa-desktop"></i>
                                View All
                            </button>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon privacy">
                                    <i class="fas fa-fingerprint"></i>
                                </div>
                                App Security
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">App Lock</span>
                                <span class="item-description">Require PIN or biometric to open the app</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="appLockToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Screen Capture Protection</span>
                                <span class="item-description">Prevent screenshots in sensitive chats</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="screenCaptureToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Encryption</span>
                                <span class="item-description">End-to-end encryption for all communications</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="encryptionToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Privacy Section -->
                <div class="settings-section" id="privacySection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon privacy">
                                    <i class="fas fa-eye"></i>
                                </div>
                                Privacy Controls
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Who Can Add Me</span>
                                <span class="item-description">Control who can send you friend requests</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="whoCanAddMe">
                                    <option value="everyone">Everyone</option>
                                    <option value="friends_of_friends">Friends of Friends</option>
                                    <option value="nobody">Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Read Receipts</span>
                                <span class="item-description">Let others know when you've read their messages</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="readReceiptsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Typing Indicators</span>
                                <span class="item-description">Show when you're typing a message</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="typingIndicatorsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Message Forwarding</span>
                                <span class="item-description">Allow others to forward your messages</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="messageForwardingToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Contact Discovery</span>
                                <span class="item-description">Allow others to find you by phone number</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="contactDiscoveryToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon privacy">
                                    <i class="fas fa-user-friends"></i>
                                </div>
                                Friend Privacy (Default for New Friends)
                            </div>
                        </div>
                        
                        <div class="privacy-grid">
                            <div class="privacy-item">
                                <span class="privacy-label">Can Message Me</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="canMessageToggle">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="privacy-item">
                                <span class="privacy-label">Can Call Me</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="canCallToggle">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="privacy-item">
                                <span class="privacy-label">Can See My Status</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="canSeeStatusToggle">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="privacy-item">
                                <span class="privacy-label">Can See Profile Photo</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="canSeePhotoToggle">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="privacy-item">
                                <span class="privacy-label">Can See Last Seen</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="canSeeLastSeenToggle">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="privacy-item">
                                <span class="privacy-label">Can Forward Messages</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="canForwardToggle">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="privacy-item">
                                <span class="privacy-label">Can Take Screenshots</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="canScreenshotToggle">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon privacy">
                                    <i class="fas fa-ban"></i>
                                </div>
                                Blocked Users
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Blocked List</span>
                                <span class="item-description">Manage users you've blocked</span>
                            </div>
                            <button class="action-btn" id="manageBlockedBtn">
                                <i class="fas fa-user-slash"></i>
                                Manage
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Chat Section -->
                <div class="settings-section" id="chatSection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon chat">
                                    <i class="fas fa-comment-alt"></i>
                                </div>
                                Chat Settings
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Chat Wallpaper</span>
                                <span class="item-description">Set custom background for chats</span>
                            </div>
                            <button class="action-btn" id="changeWallpaperBtn">
                                <i class="fas fa-image"></i>
                                Change
                            </button>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Enter Key Sends</span>
                                <span class="item-description">Press Enter to send messages instead of new line</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="enterKeySendsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Media Auto-Download</span>
                                <span class="item-description">Automatically download images and videos</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="mediaDownloadSetting">
                                    <option value="wifi">Wi-Fi Only</option>
                                    <option value="always">Always</option>
                                    <option value="never">Never</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Save to Camera Roll</span>
                                <span class="item-description">Automatically save media to your device</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="saveMediaToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Message History</span>
                                <span class="item-description">Keep message history for</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="messageHistorySetting">
                                    <option value="forever">Forever</option>
                                    <option value="30days">30 Days</option>
                                    <option value="7days">7 Days</option>
                                    <option value="24hours">24 Hours</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon chat">
                                    <i class="fas fa-clock"></i>
                                </div>
                                Disappearing Messages
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Default Timer</span>
                                <span class="item-description">Set default timer for new disappearing messages</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="disappearingTimer">
                                    <option value="off">Off</option>
                                    <option value="1hour">1 Hour</option>
                                    <option value="1day">1 Day</option>
                                    <option value="7days">7 Days</option>
                                    <option value="30days">30 Days</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon chat">
                                    <i class="fas fa-robot"></i>
                                </div>
                                AI Features
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Smart Replies</span>
                                <span class="item-description">Suggest quick replies based on messages</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="smartRepliesToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Message Translation</span>
                                <span class="item-description">Automatically translate messages</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="messageTranslationToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Chat Summarization</span>
                                <span class="item-description">Summarize long conversations</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="chatSummarizationToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Spam Detection</span>
                                <span class="item-description">Automatically detect and filter spam</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="spamDetectionToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Friends Section -->
                <div class="settings-section" id="friendsSection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon friends">
                                    <i class="fas fa-search"></i>
                                </div>
                                Friend Discovery
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Discover by Phone Number</span>
                                <span class="item-description">Allow others to find you by your phone number</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="discoverByPhoneToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Discover by Email</span>
                                <span class="item-description">Allow others to find you by your email</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="discoverByEmailToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Nearby Discovery</span>
                                <span class="item-description">Find friends nearby (requires location)</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="nearbyDiscoveryToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">QR Code Scanner</span>
                                <span class="item-description">Allow adding friends via QR codes</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="qrCodeToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Friend Suggestions</span>
                                <span class="item-description">Show friend suggestions based on contacts</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="friendSuggestionsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon friends">
                                    <i class="fas fa-handshake"></i>
                                </div>
                                Friendship Features
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Temporary Friends</span>
                                <span class="item-description">Allow temporary friendships with expiry time</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="temporaryFriendsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Friendship Notes</span>
                                <span class="item-description">Add private notes about your friends</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="friendshipNotesToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Friend Categories</span>
                                <span class="item-description">Organize friends into categories</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="friendCategoriesToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Trust Score</span>
                                <span class="item-description">Display trust score for friends</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="trustScoreToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Friend Analytics</span>
                                <span class="item-description">Show interaction frequency and patterns</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="friendAnalyticsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Groups Section -->
                <div class="settings-section" id="groupsSection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon groups">
                                    <i class="fas fa-users-cog"></i>
                                </div>
                                Group Settings
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Auto-Join Groups</span>
                                <span class="item-description">Automatically join groups you're invited to</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoJoinGroupsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Group Invitations</span>
                                <span class="item-description">Who can invite you to groups</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="groupInvitationsSetting">
                                    <option value="everyone">Everyone</option>
                                    <option value="friends">Friends Only</option>
                                    <option value="nobody">Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Group Privacy</span>
                                <span class="item-description">Who can add you to groups</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="groupPrivacySetting">
                                    <option value="public">Everyone</option>
                                    <option value="private">My Approval Required</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Group Announcements</span>
                                <span class="item-description">Receive announcements from group admins</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="groupAnnouncementsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Auto-Download Group Media</span>
                                <span class="item-description">Automatically download media in groups</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="groupMediaDownloadToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon groups">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                                Group Moderation
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Message Approval Mode</span>
                                <span class="item-description">Require admin approval for messages in your groups</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="messageApprovalToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Keyword Filtering</span>
                                <span class="item-description">Automatically filter messages with keywords</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="keywordFilteringToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Spam Detection</span>
                                <span class="item-description">Automatically detect spam in groups</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="groupSpamDetectionToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Member Warnings</span>
                                <span class="item-description">Send warnings to members who violate rules</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="memberWarningsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon groups">
                                    <i class="fas fa-chart-bar"></i>
                                </div>
                                Group Analytics
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Activity Tracking</span>
                                <span class="item-description">Track group activity and engagement</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="activityTrackingToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Top Contributors</span>
                                <span class="item-description">Show top contributors in groups</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="topContributorsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Message Volume Analytics</span>
                                <span class="item-description">Show message volume statistics</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="messageVolumeToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Calls Section -->
                <div class="settings-section" id="callsSection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon calls">
                                    <i class="fas fa-phone"></i>
                                </div>
                                Call Settings
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Who Can Call Me</span>
                                <span class="item-description">Control who can initiate calls with you</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="whoCanCallMe">
                                    <option value="everyone">Everyone</option>
                                    <option value="friends">Friends Only</option>
                                    <option value="nobody">Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Call Verification</span>
                                <span class="item-description">Verify caller identity before connecting</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="callVerificationToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Ringtone</span>
                                <span class="item-description">Set custom ringtone for incoming calls</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="ringtoneSetting">
                                    <option value="default">Default</option>
                                    <option value="classic">Classic</option>
                                    <option value="modern">Modern</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Vibration</span>
                                <span class="item-description">Vibrate on incoming calls</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="callVibrationToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Auto-Answer</span>
                                <span class="item-description">Automatically answer calls from trusted contacts</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoAnswerToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon calls">
                                    <i class="fas fa-video"></i>
                                </div>
                                Video Call Settings
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Video Quality</span>
                                <span class="item-description">Set default video quality for calls</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="videoQualitySetting">
                                    <option value="auto">Auto (Recommended)</option>
                                    <option value="high">High Quality</option>
                                    <option value="medium">Medium Quality</option>
                                    <option value="low">Low Quality</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Camera Default</span>
                                <span class="item-description">Default camera to use for calls</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="cameraDefaultSetting">
                                    <option value="front">Front Camera</option>
                                    <option value="back">Back Camera</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Noise Cancellation</span>
                                <span class="item-description">Reduce background noise during calls</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="noiseCancellationToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Echo Cancellation</span>
                                <span class="item-description">Reduce echo during calls</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="echoCancellationToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon calls">
                                    <i class="fas fa-broadcast-tower"></i>
                                </div>
                                Call Features
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Live Reactions</span>
                                <span class="item-description">Show reactions during calls</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="liveReactionsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">In-Call Chat</span>
                                <span class="item-description">Enable chat during calls</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="inCallChatToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Shared Whiteboard</span>
                                <span class="item-description">Enable whiteboard during calls</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="sharedWhiteboardToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Shared Notes</span>
                                <span class="item-description">Enable shared notes during calls</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="sharedNotesToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Polls</span>
                                <span class="item-description">Enable polls during calls</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="pollsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Status Section -->
                <div class="settings-section" id="statusSection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon status">
                                    <i class="fas fa-circle"></i>
                                </div>
                                Status Settings
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Who Can View My Status</span>
                                <span class="item-description">Control who can see your status updates</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="whoCanViewStatus">
                                    <option value="everyone">Everyone</option>
                                    <option value="friends">Friends Only</option>
                                    <option value="selected">Selected Friends</option>
                                    <option value="nobody">Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Auto-Expire Status</span>
                                <span class="item-description">Automatically expire status after</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="statusExpireTime">
                                    <option value="24h">24 Hours</option>
                                    <option value="12h">12 Hours</option>
                                    <option value="6h">6 Hours</option>
                                    <option value="1h">1 Hour</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Reply Permissions</span>
                                <span class="item-description">Who can reply to your status</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="statusReplyPermissions">
                                    <option value="everyone">Everyone</option>
                                    <option value="friends">Friends Only</option>
                                    <option value="nobody">Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Download Permissions</span>
                                <span class="item-description">Allow others to download your status media</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="statusDownloadToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Hide from Specific Users</span>
                                <span class="item-description">Hide your status from selected users</span>
                            </div>
                            <button class="action-btn" id="hideFromUsersBtn">
                                <i class="fas fa-user-slash"></i>
                                Manage
                            </button>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon status">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                Status Analytics
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">View Count</span>
                                <span class="item-description">Show how many people viewed your status</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="viewCountToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Viewer List</span>
                                <span class="item-description">Show who viewed your status</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="viewerListToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Engagement Reactions</span>
                                <span class="item-description">Allow reactions to your status</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="statusReactionsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon status">
                                    <i class="fas fa-robot"></i>
                                </div>
                                Status AI Features
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Auto Captions</span>
                                <span class="item-description">Add captions to your status videos</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoCaptionsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">AI Enhancement</span>
                                <span class="item-description">Automatically enhance your status media</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="statusEnhancementToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Status Scheduling</span>
                                <span class="item-description">Schedule status updates for later</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="statusSchedulingToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Notifications Section -->
                <div class="settings-section" id="notificationsSection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon notifications">
                                    <i class="fas fa-bell"></i>
                                </div>
                                Notification Preferences
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Message Notifications</span>
                                <span class="item-description">Get notified for new messages</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="messageNotificationsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Group Notifications</span>
                                <span class="item-description">Get notified for group messages</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="groupNotificationsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Friend Request Notifications</span>
                                <span class="item-description">Get notified for friend requests</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="friendRequestNotificationsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Call Notifications</span>
                                <span class="item-description">Get notified for incoming calls</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="callNotificationsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Status Notifications</span>
                                <span class="item-description">Get notified for status updates</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="statusNotificationsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon notifications">
                                    <i class="fas fa-volume-up"></i>
                                </div>
                                Sound & Vibration
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Notification Sound</span>
                                <span class="item-description">Play sound for notifications</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="notificationSoundToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Vibration</span>
                                <span class="item-description">Vibrate for notifications</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="notificationVibrationToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Popup Notifications</span>
                                <span class="item-description">Show popup notifications</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="popupNotificationsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Notification Light</span>
                                <span class="item-description">Use LED light for notifications</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="notificationLightToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon notifications">
                                    <i class="fas fa-moon"></i>
                                </div>
                                Do Not Disturb
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Do Not Disturb</span>
                                <span class="item-description">Silence notifications during specific hours</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="doNotDisturbToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Schedule</span>
                                <span class="item-description">Set schedule for Do Not Disturb</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="dndSchedule">
                                    <option value="custom">Custom Hours</option>
                                    <option value="night">Night (10PM-7AM)</option>
                                    <option value="work">Work Hours (9AM-5PM)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Allow Calls</span>
                                <span class="item-description">Allow calls during Do Not Disturb</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="dndAllowCallsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Allow Messages from</span>
                                <span class="item-description">Allow messages from specific contacts</span>
                            </div>
                            <button class="action-btn" id="dndAllowContactsBtn">
                                <i class="fas fa-user-check"></i>
                                Select
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Appearance Section -->
                <div class="settings-section" id="appearanceSection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon appearance">
                                    <i class="fas fa-palette"></i>
                                </div>
                                Theme & Colors
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Theme</span>
                                <span class="item-description">Choose your app theme</span>
                            </div>
                            <div class="radio-group">
                                <div class="radio-option" data-theme="light">
                                    <input type="radio" name="theme" id="themeLight" class="radio-input">
                                    <div class="radio-label">
                                        <div class="radio-title">Light</div>
                                        <div class="radio-description">Bright theme for day use</div>
                                    </div>
                                </div>
                                <div class="radio-option" data-theme="dark">
                                    <input type="radio" name="theme" id="themeDark" class="radio-input">
                                    <div class="radio-label">
                                        <div class="radio-title">Dark</div>
                                        <div class="radio-description">Dark theme for night use</div>
                                    </div>
                                </div>
                                <div class="radio-option" data-theme="auto">
                                    <input type="radio" name="theme" id="themeAuto" class="radio-input">
                                    <div class="radio-label">
                                        <div class="radio-title">Auto</div>
                                        <div class="radio-description">Follow system theme</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Accent Color</span>
                                <span class="item-description">Choose your primary color</span>
                            </div>
                            <div class="color-picker">
                                <div class="color-option" data-color="#0084ff" style="background-color: #0084ff;"></div>
                                <div class="color-option" data-color="#34c759" style="background-color: #34c759;"></div>
                                <div class="color-option" data-color="#ff9500" style="background-color: #ff9500;"></div>
                                <div class="color-option" data-color="#ff3b30" style="background-color: #ff3b30;"></div>
                                <div class="color-option" data-color="#af52de" style="background-color: #af52de;"></div>
                                <div class="color-option" data-color="#5856d6" style="background-color: #5856d6;"></div>
                                <div class="color-option" data-color="#00c7be" style="background-color: #00c7be;"></div>
                                <div class="color-option" data-color="#ff2d55" style="background-color: #ff2d55;"></div>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Font Size</span>
                                <span class="item-description">Adjust text size in the app</span>
                            </div>
                            <input type="range" min="12" max="20" value="16" class="range-slider" id="fontSizeSlider">
                            <div class="range-value" id="fontSizeValue">16px</div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Reduce Motion</span>
                                <span class="item-description">Reduce animations and transitions</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="reduceMotionToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon appearance">
                                    <i class="fas fa-language"></i>
                                </div>
                                Language & Region
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Language</span>
                                <span class="item-description">Choose app language</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="languageSetting">
                                    <option value="en">English</option>
                                    <option value="es">EspaÃ±ol</option>
                                    <option value="fr">FranÃ§ais</option>
                                    <option value="de">Deutsch</option>
                                    <option value="zh">ä¸­æ–‡</option>
                                    <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Time Format</span>
                                <span class="item-description">Choose time display format</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="timeFormatSetting">
                                    <option value="12h">12-hour (2:30 PM)</option>
                                    <option value="24h">24-hour (14:30)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Date Format</span>
                                <span class="item-description">Choose date display format</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="dateFormatSetting">
                                    <option value="mm/dd/yyyy">MM/DD/YYYY</option>
                                    <option value="dd/mm/yyyy">DD/MM/YYYY</option>
                                    <option value="yyyy-mm-dd">YYYY-MM-DD</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Storage Section -->
                <div class="settings-section" id="storageSection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon storage">
                                    <i class="fas fa-sd-card"></i>
                                </div>
                                Storage Usage
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Total Storage Used</span>
                                <span class="item-description">Space used by the app</span>
                            </div>
                            <div class="storage-info">
                                <span id="storageUsed">0 MB</span>
                                <span id="storageTotal">/ 1 GB</span>
                            </div>
                            <div class="storage-bar-container">
                                <div class="storage-bar">
                                    <div class="storage-fill" id="storageFill" style="width: 25%;"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Chats</span>
                                <span class="item-description">Space used by chat messages</span>
                            </div>
                            <div class="storage-info">
                                <span id="chatStorage">0 MB</span>
                                <span>25%</span>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Media</span>
                                <span class="item-description">Space used by photos and videos</span>
                            </div>
                            <div class="storage-info">
                                <span id="mediaStorage">0 MB</span>
                                <span>60%</span>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Other</span>
                                <span class="item-description">Space used by other data</span>
                            </div>
                            <div class="storage-info">
                                <span id="otherStorage">0 MB</span>
                                <span>15%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon storage">
                                    <i class="fas fa-trash"></i>
                                </div>
                                Data Management
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Auto-Clear Cache</span>
                                <span class="item-description">Automatically clear cache every</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="autoClearCache">
                                    <option value="never">Never</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Clear Chat Cache</span>
                                <span class="item-description">Clear temporary chat files</span>
                            </div>
                            <button class="action-btn" id="clearChatCacheBtn">
                                <i class="fas fa-broom"></i>
                                Clear Now
                            </button>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Clear Media Cache</span>
                                <span class="item-description">Clear downloaded media files</span>
                            </div>
                            <button class="action-btn" id="clearMediaCacheBtn">
                                <i class="fas fa-trash"></i>
                                Clear Now
                            </button>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Delete All Data</span>
                                <span class="item-description">Delete all app data (cannot be undone)</span>
                            </div>
                            <button class="danger-btn" id="deleteAllDataBtn">
                                <i class="fas fa-exclamation-triangle"></i>
                                Delete All
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Advanced Section -->
                <div class="settings-section" id="advancedSection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon advanced">
                                    <i class="fas fa-tools"></i>
                                </div>
                                Advanced Settings
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Offline Mode</span>
                                <span class="item-description">Enable offline functionality</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="offlineModeToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Intranet Support</span>
                                <span class="item-description">Enable local network communication</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="intranetSupportToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Low Bandwidth Mode</span>
                                <span class="item-description">Reduce data usage</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="lowBandwidthToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Debug Mode</span>
                                <span class="item-description">Enable debugging features</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="debugModeToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Developer Options</span>
                                <span class="item-description">Show developer settings</span>
                            </div>
                            <button class="action-btn" id="developerOptionsBtn">
                                <i class="fas fa-code"></i>
                                Open
                            </button>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon advanced">
                                    <i class="fas fa-network-wired"></i>
                                </div>
                                Network Settings
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Proxy Settings</span>
                                <span class="item-description">Configure network proxy</span>
                            </div>
                            <button class="action-btn" id="proxySettingsBtn">
                                <i class="fas fa-server"></i>
                                Configure
                            </button>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Connection Test</span>
                                <span class="item-description">Test network connection</span>
                            </div>
                            <button class="action-btn" id="connectionTestBtn">
                                <i class="fas fa-wifi"></i>
                                Test
                            </button>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Data Saver</span>
                                <span class="item-description">Optimize data usage</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="dataSaverToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Backup & Restore Section -->
                <div class="settings-section" id="backupSection">
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon backup">
                                    <i class="fas fa-cloud"></i>
                                </div>
                                Backup Settings
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Auto Backup</span>
                                <span class="item-description">Automatically backup your data</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoBackupToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Backup Frequency</span>
                                <span class="item-description">How often to backup data</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="backupFrequency">
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Backup Location</span>
                                <span class="item-description">Where to store backups</span>
                            </div>
                            <div class="select-wrapper">
                                <select id="backupLocation">
                                    <option value="cloud">Cloud Storage</option>
                                    <option value="local">Local Device</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-item">
                            <div class="item-label">
                                <span class="item-title">Last Backup</span>
                                <span class="item-description">When was the last backup created</span>
                            </div>
                            <span id="lastBackupTime">Never</span>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon backup">
                                    <i class="fas fa-download"></i>
                                </div>
                                Backup & Restore Options
                            </div>
                        </div>
                        
                        <div class="backup-options">
                            <div class="backup-option" data-type="full">
                                <div class="backup-icon">
                                    <i class="fas fa-database"></i>
                                </div>
                                <div class="backup-info">
                                    <div class="backup-title">Full Backup</div>
                                    <div class="backup-description">Backup all chats, media, and settings</div>
                                </div>
                                <button class="action-btn" id="fullBackupBtn">Backup Now</button>
                            </div>
                            
                            <div class="backup-option" data-type="chat">
                                <div class="backup-icon">
                                    <i class="fas fa-comments"></i>
                                </div>
                                <div class="backup-info">
                                    <div class="backup-title">Chat Backup</div>
                                    <div class="backup-description">Backup only chat messages</div>
                                </div>
                                <button class="action-btn" id="chatBackupBtn">Backup Now</button>
                            </div>
                            
                            <div class="backup-option" data-type="media">
                                <div class="backup-icon">
                                    <i class="fas fa-images"></i>
                                </div>
                                <div class="backup-info">
                                    <div class="backup-title">Media Backup</div>
                                    <div class="backup-description">Backup photos and videos</div>
                                </div>
                                <button class="action-btn" id="mediaBackupBtn">Backup Now</button>
                            </div>
                            
                            <div class="backup-option" data-type="restore">
                                <div class="backup-icon">
                                    <i class="fas fa-upload"></i>
                                </div>
                                <div class="backup-info">
                                    <div class="backup-title">Restore Backup</div>
                                    <div class="backup-description">Restore from previous backup</div>
                                </div>
                                <button class="action-btn" id="restoreBackupBtn">Restore</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Danger Zone Section -->
                <div class="settings-section" id="dangerSection">
                    <div class="danger-zone">
                        <div class="danger-header">
                            <i class="fas fa-exclamation-triangle"></i>
                            <h3>Danger Zone</h3>
                        </div>
                        
                        <div class="danger-item">
                            <div class="danger-label">
                                <h4>Clear All Chats</h4>
                                <p>Delete all chat messages and media. This cannot be undone.</p>
                            </div>
                            <button class="danger-btn" id="clearAllChatsBtn">Clear All</button>
                        </div>
                        
                        <div class="danger-item">
                            <div class="danger-label">
                                <h4>Delete Account</h4>
                                <p>Permanently delete your account and all data. This cannot be undone.</p>
                            </div>
                            <button class="danger-btn" id="deleteAccountBtn">Delete Account</button>
                        </div>
                        
                        <div class="danger-item">
                            <div class="danger-label">
                                <h4>Export All Data</h4>
                                <p>Export all your data before deleting your account.</p>
                            </div>
                            <button class="action-btn" id="exportDataBtn">
                                <i class="fas fa-file-export"></i>
                                Export
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    <div class="modal-overlay" id="confirmModal">
        <div class="modal-container">
            <div class="modal-header">
                <h3>Confirm Action</h3>
                <button class="modal-close" id="closeConfirmModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-content">
                <p id="confirmMessage">Are you sure you want to proceed?</p>
            </div>
            <div class="modal-footer">
                <button class="action-btn" id="cancelConfirmBtn">Cancel</button>
                <button class="danger-btn" id="proceedConfirmBtn">Proceed</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="photoModal">
        <div class="modal-container">
            <div class="modal-header">
                <h3>Change Profile Photo</h3>
                <button class="modal-close" id="closePhotoModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-content">
                <div style="text-align: center; padding: 20px;">
                    <div id="photoPreview" style="width: 150px; height: 150px; border-radius: 50%; background-color: var(--secondary-color); margin: 0 auto 20px; overflow: hidden; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-user" style="font-size: 60px; color: var(--text-secondary);"></i>
                    </div>
                    <input type="file" id="photoUpload" accept="image/*" style="display: none;">
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button class="action-btn" id="takePhotoBtn">
                            <i class="fas fa-camera"></i>
                            Take Photo
                        </button>
                        <button class="action-btn" id="choosePhotoBtn">
                            <i class="fas fa-image"></i>
                            Choose Photo
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Settings saved successfully</span>
    </div>
    
    <!-- Offline Indicator -->
    <div class="offline-indicator" id="offlineIndicator">
        <i class="fas fa-wifi-slash"></i>
        <span>Offline - Settings saved locally</span>
    </div>

    <script>
        // Fallback settings manager if the imported one fails
        class FallbackSettingsManager {
            constructor() {
                this.settings = {};
                this.subscribers = new Set();
                this.loadFromStorage();
            }
            
            async initializeSettings() {
                this.loadFromStorage();
                return Promise.resolve();
            }
            
            loadFromStorage() {
                try {
                    const saved = localStorage.getItem('appSettings');
                    if (saved) {
                        this.settings = JSON.parse(saved);
                    } else {
                        this.settings = this.getDefaultSettings();
                    }
                } catch (error) {
                    console.error('Error loading settings:', error);
                    this.settings = this.getDefaultSettings();
                }
            }
            
            saveToStorage() {
                try {
                    localStorage.setItem('appSettings', JSON.stringify(this.settings));
                } catch (error) {
                    console.error('Error saving settings:', error);
                }
            }
            
            getDefaultSettings() {
                return {
                    // Profile
                    displayName: '',
                    username: '',
                    bio: '',
                    phone: '',
                    email: '',
                    profileVisibility: 'public',
                    lastSeen: true,
                    onlineStatus: true,
                    photoVisibility: 'friends',
                    
                    // Security
                    twoFactor: false,
                    loginNotifications: true,
                    appLock: false,
                    screenCapture: false,
                    encryption: true,
                    
                    // Privacy
                    whoCanAddMe: 'everyone',
                    readReceipts: true,
                    typingIndicators: true,
                    messageForwarding: true,
                    contactDiscovery: true,
                    canMessage: true,
                    canCall: true,
                    canSeeStatus: true,
                    canSeePhoto: true,
                    canSeeLastSeen: true,
                    canForward: true,
                    canScreenshot: false,
                    
                    // Appearance
                    theme: 'light',
                    accentColor: '#0084ff',
                    fontSize: 16,
                    reduceMotion: false,
                    language: 'en',
                    timeFormat: '12h',
                    dateFormat: 'mm/dd/yyyy',
                    
                    // Chat
                    enterKeySends: false,
                    mediaDownload: 'wifi',
                    saveMedia: false,
                    messageHistory: 'forever',
                    disappearingTimer: 'off',
                    smartReplies: false,
                    messageTranslation: false,
                    chatSummarization: false,
                    spamDetection: true,
                    
                    // Friends
                    discoverByPhone: true,
                    discoverByEmail: true,
                    nearbyDiscovery: false,
                    qrCode: true,
                    friendSuggestions: true,
                    temporaryFriends: false,
                    friendshipNotes: false,
                    friendCategories: false,
                    trustScore: false,
                    friendAnalytics: false,
                    
                    // Groups
                    autoJoin: false,
                    groupInvitations: 'everyone',
                    groupPrivacy: 'public',
                    groupAnnouncements: true,
                    groupMediaDownload: false,
                    messageApproval: false,
                    keywordFiltering: false,
                    groupSpamDetection: true,
                    memberWarnings: true,
                    activityTracking: false,
                    topContributors: false,
                    messageVolume: false,
                    
                    // Calls
                    whoCanCallMe: 'everyone',
                    callVerification: false,
                    ringtone: 'default',
                    callVibration: true,
                    autoAnswer: false,
                    videoQuality: 'auto',
                    cameraDefault: 'front',
                    noiseCancellation: true,
                    echoCancellation: true,
                    liveReactions: true,
                    inCallChat: true,
                    sharedWhiteboard: false,
                    sharedNotes: false,
                    polls: false,
                    
                    // Status
                    whoCanViewStatus: 'everyone',
                    statusExpireTime: '24h',
                    statusReplyPermissions: 'everyone',
                    statusDownload: false,
                    viewCount: true,
                    viewerList: true,
                    statusReactions: true,
                    autoCaptions: false,
                    statusEnhancement: false,
                    statusScheduling: false,
                    
                    // Notifications
                    messageNotifications: true,
                    groupNotifications: true,
                    friendRequestNotifications: true,
                    callNotifications: true,
                    statusNotifications: true,
                    notificationSound: true,
                    notificationVibration: true,
                    popupNotifications: true,
                    notificationLight: false,
                    doNotDisturb: false,
                    dndSchedule: 'custom',
                    dndAllowCalls: true,
                    
                    // Storage
                    autoClearCache: 'never',
                    
                    // Advanced
                    offlineMode: false,
                    intranetSupport: false,
                    lowBandwidth: false,
                    debugMode: false,
                    dataSaver: false,
                    
                    // Backup
                    autoBackup: false,
                    backupFrequency: 'daily',
                    backupLocation: 'cloud'
                };
            }
            
            saveSetting(key, value) {
                this.settings[key] = value;
                this.saveToStorage();
                this.notifySubscribers(key, value);
            }
            
            getSetting(key) {
                return this.settings[key];
            }
            
            getAllSettings() {
                return { ...this.settings };
            }
            
            resetSettings(section) {
                const defaults = this.getDefaultSettings();
                const sectionDefaults = {};
                
                // Reset only settings for the given section
                switch(section) {
                    case 'profile':
                        Object.keys(defaults).forEach(key => {
                            if (key === 'displayName' || key === 'username' || key === 'bio' || 
                                key === 'phone' || key === 'email' || key === 'profileVisibility' || 
                                key === 'lastSeen' || key === 'onlineStatus' || key === 'photoVisibility') {
                                this.settings[key] = defaults[key];
                                sectionDefaults[key] = defaults[key];
                            }
                        });
                        break;
                    case 'security':
                        Object.keys(defaults).forEach(key => {
                            if (key === 'twoFactor' || key === 'loginNotifications' || key === 'appLock' || 
                                key === 'screenCapture' || key === 'encryption') {
                                this.settings[key] = defaults[key];
                                sectionDefaults[key] = defaults[key];
                            }
                        });
                        break;
                    case 'privacy':
                        Object.keys(defaults).forEach(key => {
                            if (key === 'whoCanAddMe' || key === 'readReceipts' || key === 'typingIndicators' || 
                                key === 'messageForwarding' || key === 'contactDiscovery' || 
                                key.startsWith('can')) {
                                this.settings[key] = defaults[key];
                                sectionDefaults[key] = defaults[key];
                            }
                        });
                        break;
                    case 'appearance':
                        Object.keys(defaults).forEach(key => {
                            if (key === 'theme' || key === 'accentColor' || key === 'fontSize' || 
                                key === 'reduceMotion' || key === 'language' || key === 'timeFormat' || 
                                key === 'dateFormat') {
                                this.settings[key] = defaults[key];
                                sectionDefaults[key] = defaults[key];
                            }
                        });
                        break;
                    // Add other sections as needed
                    default:
                        // Reset all settings
                        this.settings = { ...defaults };
                        this.saveToStorage();
                        return;
                }
                
                this.saveToStorage();
                // Notify subscribers for each reset setting
                Object.keys(sectionDefaults).forEach(key => {
                    this.notifySubscribers(key, sectionDefaults[key]);
                });
            }
            
            subscribeToSettings(callback) {
                this.subscribers.add(callback);
                return () => this.subscribers.delete(callback);
            }
            
            unsubscribeFromSettings(callback) {
                this.subscribers.delete(callback);
            }
            
            notifySubscribers(key, value) {
                this.subscribers.forEach(callback => {
                    try {
                        callback(key, value);
                    } catch (error) {
                        console.error('Error in settings subscriber:', error);
                    }
                });
            }
        }
        
        // Global variables
        let currentSection = 'profile';
        let unsavedChanges = false;
        let isOnline = navigator.onLine;
        let settingsManager;
        let currentSubscription = null;
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });
        
        async function initializeApp() {
            try {
                // Try to import settings manager, fallback to local if fails
                try {
                    const module = await import('../js/settingsManager.js');
                    settingsManager = {
                        initializeSettings: module.initializeSettings || (async () => {}),
                        saveSetting: module.saveSetting || (() => {}),
                        getSetting: module.getSetting || (() => null),
                        getAllSettings: module.getAllSettings || (() => ({})),
                        resetSettings: module.resetSettings || (() => {}),
                        subscribeToSettings: module.subscribeToSettings || (() => () => {}),
                        unsubscribeFromSettings: module.unsubscribeFromSettings || (() => {})
                    };
                    await settingsManager.initializeSettings();
                } catch (error) {
                    console.warn('Could not load settings manager from module, using fallback:', error);
                    settingsManager = new FallbackSettingsManager();
                    await settingsManager.initializeSettings();
                }
                
                // Check online status
                updateOnlineStatus();
                
                // Listen for online/offline events
                window.addEventListener('online', handleOnline);
                window.addEventListener('offline', handleOffline);
                
                // Setup event listeners
                setupEventListeners();
                
                // Initialize UI with current settings
                initializeUI();
                
                // Load initial section
                loadSectionSettings('profile');
                
                console.log('Settings page initialized successfully');
            } catch (error) {
                console.error('Error initializing settings page:', error);
                showNotification('Error loading settings', 'error', 2000);
            }
        }
        
        function updateOnlineStatus() {
            isOnline = navigator.onLine;
            
            if (!isOnline) {
                document.getElementById('offlineIndicator').classList.add('active');
                showNotification('You are offline. Settings will be saved locally.', 'warning', 2000);
            } else {
                document.getElementById('offlineIndicator').classList.remove('active');
            }
        }
        
        function handleOnline() {
            isOnline = true;
            document.getElementById('offlineIndicator').classList.remove('active');
            showNotification('Back online', 'success', 1500);
        }
        
        function handleOffline() {
            isOnline = false;
            document.getElementById('offlineIndicator').classList.add('active');
            showNotification('You are offline. Settings saved locally.', 'warning', 2000);
        }
        
        function loadSectionSettings(section) {
            // Clean up previous subscription
            cleanupSubscription();
            
            // Subscribe to settings changes for this section
            currentSubscription = settingsManager.subscribeToSettings((key, value) => {
                // Update UI when settings change
                updateSpecificUI(key, value);
            });
            
            // Update all UI elements for this section
            updateSectionUI(section);
        }
        
        function cleanupSubscription() {
            if (currentSubscription && typeof currentSubscription === 'function') {
                settingsManager.unsubscribeFromSettings(currentSubscription);
                currentSubscription = null;
            }
        }
        
        function updateSectionUI(section) {
            // Update UI elements based on current settings
            switch(section) {
                case 'profile':
                    // Profile settings
                    document.getElementById('displayNameInput').value = settingsManager.getSetting('displayName') || '';
                    document.getElementById('usernameInput').value = settingsManager.getSetting('username') || '';
                    document.getElementById('bioInput').value = settingsManager.getSetting('bio') || '';
                    document.getElementById('phoneInput').value = settingsManager.getSetting('phone') || '';
                    document.getElementById('emailInput').value = settingsManager.getSetting('email') || '';
                    document.getElementById('profileVisibility').value = settingsManager.getSetting('profileVisibility') || 'public';
                    document.getElementById('lastSeenToggle').checked = settingsManager.getSetting('lastSeen') !== false;
                    document.getElementById('onlineStatusToggle').checked = settingsManager.getSetting('onlineStatus') !== false;
                    document.getElementById('photoVisibility').value = settingsManager.getSetting('photoVisibility') || 'friends';
                    break;
                    
                case 'security':
                    // Security settings
                    document.getElementById('twoFactorToggle').checked = settingsManager.getSetting('twoFactor') || false;
                    document.getElementById('loginNotificationsToggle').checked = settingsManager.getSetting('loginNotifications') !== false;
                    document.getElementById('appLockToggle').checked = settingsManager.getSetting('appLock') || false;
                    document.getElementById('screenCaptureToggle').checked = settingsManager.getSetting('screenCapture') || false;
                    document.getElementById('encryptionToggle').checked = settingsManager.getSetting('encryption') !== false;
                    break;
                    
                case 'privacy':
                    // Privacy settings
                    document.getElementById('whoCanAddMe').value = settingsManager.getSetting('whoCanAddMe') || 'everyone';
                    document.getElementById('readReceiptsToggle').checked = settingsManager.getSetting('readReceipts') !== false;
                    document.getElementById('typingIndicatorsToggle').checked = settingsManager.getSetting('typingIndicators') !== false;
                    document.getElementById('messageForwardingToggle').checked = settingsManager.getSetting('messageForwarding') !== false;
                    document.getElementById('contactDiscoveryToggle').checked = settingsManager.getSetting('contactDiscovery') !== false;
                    document.getElementById('canMessageToggle').checked = settingsManager.getSetting('canMessage') !== false;
                    document.getElementById('canCallToggle').checked = settingsManager.getSetting('canCall') !== false;
                    document.getElementById('canSeeStatusToggle').checked = settingsManager.getSetting('canSeeStatus') !== false;
                    document.getElementById('canSeePhotoToggle').checked = settingsManager.getSetting('canSeePhoto') !== false;
                    document.getElementById('canSeeLastSeenToggle').checked = settingsManager.getSetting('canSeeLastSeen') !== false;
                    document.getElementById('canForwardToggle').checked = settingsManager.getSetting('canForward') !== false;
                    document.getElementById('canScreenshotToggle').checked = settingsManager.getSetting('canScreenshot') || false;
                    break;
                    
                case 'appearance':
                    // Appearance settings
                    // Theme
                    const theme = settingsManager.getSetting('theme') || 'light';
                    document.querySelectorAll('.radio-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    const themeOption = document.querySelector(`[data-theme="${theme}"]`);
                    if (themeOption) {
                        themeOption.classList.add('selected');
                        const radioInput = themeOption.querySelector('.radio-input');
                        if (radioInput) radioInput.checked = true;
                    }
                    
                    // Accent color
                    const accentColor = settingsManager.getSetting('accentColor') || '#0084ff';
                    document.querySelectorAll('.color-option').forEach(c => {
                        c.classList.remove('selected');
                    });
                    const colorOption = document.querySelector(`[data-color="${accentColor}"]`);
                    if (colorOption) {
                        colorOption.classList.add('selected');
                    }
                    
                    // Other settings
                    const fontSize = settingsManager.getSetting('fontSize') || 16;
                    document.getElementById('fontSizeSlider').value = fontSize;
                    document.getElementById('fontSizeValue').textContent = `${fontSize}px`;
                    document.getElementById('reduceMotionToggle').checked = settingsManager.getSetting('reduceMotion') || false;
                    document.getElementById('languageSetting').value = settingsManager.getSetting('language') || 'en';
                    document.getElementById('timeFormatSetting').value = settingsManager.getSetting('timeFormat') || '12h';
                    document.getElementById('dateFormatSetting').value = settingsManager.getSetting('dateFormat') || 'mm/dd/yyyy';
                    break;
                    
                case 'notifications':
                    // Notification settings
                    document.getElementById('messageNotificationsToggle').checked = settingsManager.getSetting('messageNotifications') !== false;
                    document.getElementById('groupNotificationsToggle').checked = settingsManager.getSetting('groupNotifications') !== false;
                    document.getElementById('friendRequestNotificationsToggle').checked = settingsManager.getSetting('friendRequestNotifications') !== false;
                    document.getElementById('callNotificationsToggle').checked = settingsManager.getSetting('callNotifications') !== false;
                    document.getElementById('statusNotificationsToggle').checked = settingsManager.getSetting('statusNotifications') !== false;
                    document.getElementById('notificationSoundToggle').checked = settingsManager.getSetting('notificationSound') !== false;
                    document.getElementById('notificationVibrationToggle').checked = settingsManager.getSetting('notificationVibration') !== false;
                    document.getElementById('popupNotificationsToggle').checked = settingsManager.getSetting('popupNotifications') || false;
                    document.getElementById('notificationLightToggle').checked = settingsManager.getSetting('notificationLight') || false;
                    document.getElementById('doNotDisturbToggle').checked = settingsManager.getSetting('doNotDisturb') || false;
                    document.getElementById('dndSchedule').value = settingsManager.getSetting('dndSchedule') || 'custom';
                    document.getElementById('dndAllowCallsToggle').checked = settingsManager.getSetting('dndAllowCalls') || false;
                    break;
                    
                case 'chat':
                    // Chat settings
                    document.getElementById('enterKeySendsToggle').checked = settingsManager.getSetting('enterKeySends') || false;
                    document.getElementById('mediaDownloadSetting').value = settingsManager.getSetting('mediaDownload') || 'wifi';
                    document.getElementById('saveMediaToggle').checked = settingsManager.getSetting('saveMedia') || false;
                    document.getElementById('messageHistorySetting').value = settingsManager.getSetting('messageHistory') || 'forever';
                    document.getElementById('disappearingTimer').value = settingsManager.getSetting('disappearingTimer') || 'off';
                    document.getElementById('smartRepliesToggle').checked = settingsManager.getSetting('smartReplies') || false;
                    document.getElementById('messageTranslationToggle').checked = settingsManager.getSetting('messageTranslation') || false;
                    document.getElementById('chatSummarizationToggle').checked = settingsManager.getSetting('chatSummarization') || false;
                    document.getElementById('spamDetectionToggle').checked = settingsManager.getSetting('spamDetection') || false;
                    break;
                    
                case 'friends':
                    // Friends settings
                    document.getElementById('discoverByPhoneToggle').checked = settingsManager.getSetting('discoverByPhone') || false;
                    document.getElementById('discoverByEmailToggle').checked = settingsManager.getSetting('discoverByEmail') || false;
                    document.getElementById('nearbyDiscoveryToggle').checked = settingsManager.getSetting('nearbyDiscovery') || false;
                    document.getElementById('qrCodeToggle').checked = settingsManager.getSetting('qrCode') || false;
                    document.getElementById('friendSuggestionsToggle').checked = settingsManager.getSetting('friendSuggestions') || false;
                    document.getElementById('temporaryFriendsToggle').checked = settingsManager.getSetting('temporaryFriends') || false;
                    document.getElementById('friendshipNotesToggle').checked = settingsManager.getSetting('friendshipNotes') || false;
                    document.getElementById('friendCategoriesToggle').checked = settingsManager.getSetting('friendCategories') || false;
                    document.getElementById('trustScoreToggle').checked = settingsManager.getSetting('trustScore') || false;
                    document.getElementById('friendAnalyticsToggle').checked = settingsManager.getSetting('friendAnalytics') || false;
                    break;
                    
                case 'groups':
                    // Groups settings
                    document.getElementById('autoJoinGroupsToggle').checked = settingsManager.getSetting('autoJoin') || false;
                    document.getElementById('groupInvitationsSetting').value = settingsManager.getSetting('groupInvitations') || 'everyone';
                    document.getElementById('groupPrivacySetting').value = settingsManager.getSetting('groupPrivacy') || 'public';
                    document.getElementById('groupAnnouncementsToggle').checked = settingsManager.getSetting('groupAnnouncements') || false;
                    document.getElementById('groupMediaDownloadToggle').checked = settingsManager.getSetting('groupMediaDownload') || false;
                    document.getElementById('messageApprovalToggle').checked = settingsManager.getSetting('messageApproval') || false;
                    document.getElementById('keywordFilteringToggle').checked = settingsManager.getSetting('keywordFiltering') || false;
                    document.getElementById('groupSpamDetectionToggle').checked = settingsManager.getSetting('groupSpamDetection') || false;
                    document.getElementById('memberWarningsToggle').checked = settingsManager.getSetting('memberWarnings') || false;
                    document.getElementById('activityTrackingToggle').checked = settingsManager.getSetting('activityTracking') || false;
                    document.getElementById('topContributorsToggle').checked = settingsManager.getSetting('topContributors') || false;
                    document.getElementById('messageVolumeToggle').checked = settingsManager.getSetting('messageVolume') || false;
                    break;
                    
                case 'calls':
                    // Calls settings
                    document.getElementById('whoCanCallMe').value = settingsManager.getSetting('whoCanCallMe') || 'everyone';
                    document.getElementById('callVerificationToggle').checked = settingsManager.getSetting('callVerification') || false;
                    document.getElementById('ringtoneSetting').value = settingsManager.getSetting('ringtone') || 'default';
                    document.getElementById('callVibrationToggle').checked = settingsManager.getSetting('callVibration') || false;
                    document.getElementById('autoAnswerToggle').checked = settingsManager.getSetting('autoAnswer') || false;
                    document.getElementById('videoQualitySetting').value = settingsManager.getSetting('videoQuality') || 'auto';
                    document.getElementById('cameraDefaultSetting').value = settingsManager.getSetting('cameraDefault') || 'front';
                    document.getElementById('noiseCancellationToggle').checked = settingsManager.getSetting('noiseCancellation') || false;
                    document.getElementById('echoCancellationToggle').checked = settingsManager.getSetting('echoCancellation') || false;
                    document.getElementById('liveReactionsToggle').checked = settingsManager.getSetting('liveReactions') || false;
                    document.getElementById('inCallChatToggle').checked = settingsManager.getSetting('inCallChat') || false;
                    document.getElementById('sharedWhiteboardToggle').checked = settingsManager.getSetting('sharedWhiteboard') || false;
                    document.getElementById('sharedNotesToggle').checked = settingsManager.getSetting('sharedNotes') || false;
                    document.getElementById('pollsToggle').checked = settingsManager.getSetting('polls') || false;
                    break;
                    
                case 'status':
                    // Status settings
                    document.getElementById('whoCanViewStatus').value = settingsManager.getSetting('whoCanViewStatus') || 'everyone';
                    document.getElementById('statusExpireTime').value = settingsManager.getSetting('statusExpireTime') || '24h';
                    document.getElementById('statusReplyPermissions').value = settingsManager.getSetting('statusReplyPermissions') || 'everyone';
                    document.getElementById('statusDownloadToggle').checked = settingsManager.getSetting('statusDownload') || false;
                    document.getElementById('viewCountToggle').checked = settingsManager.getSetting('viewCount') || false;
                    document.getElementById('viewerListToggle').checked = settingsManager.getSetting('viewerList') || false;
                    document.getElementById('statusReactionsToggle').checked = settingsManager.getSetting('statusReactions') || false;
                    document.getElementById('autoCaptionsToggle').checked = settingsManager.getSetting('autoCaptions') || false;
                    document.getElementById('statusEnhancementToggle').checked = settingsManager.getSetting('statusEnhancement') || false;
                    document.getElementById('statusSchedulingToggle').checked = settingsManager.getSetting('statusScheduling') || false;
                    break;
                    
                case 'storage':
                    // Storage settings
                    document.getElementById('autoClearCache').value = settingsManager.getSetting('autoClearCache') || 'never';
                    // Update storage display
                    updateStorageDisplay();
                    break;
                    
                case 'advanced':
                    // Advanced settings
                    document.getElementById('offlineModeToggle').checked = settingsManager.getSetting('offlineMode') || false;
                    document.getElementById('intranetSupportToggle').checked = settingsManager.getSetting('intranetSupport') || false;
                    document.getElementById('lowBandwidthToggle').checked = settingsManager.getSetting('lowBandwidth') || false;
                    document.getElementById('debugModeToggle').checked = settingsManager.getSetting('debugMode') || false;
                    document.getElementById('dataSaverToggle').checked = settingsManager.getSetting('dataSaver') || false;
                    break;
                    
                case 'backup':
                    // Backup settings
                    document.getElementById('autoBackupToggle').checked = settingsManager.getSetting('autoBackup') || false;
                    document.getElementById('backupFrequency').value = settingsManager.getSetting('backupFrequency') || 'daily';
                    document.getElementById('backupLocation').value = settingsManager.getSetting('backupLocation') || 'cloud';
                    const lastBackup = localStorage.getItem('lastBackupTime');
                    document.getElementById('lastBackupTime').textContent = lastBackup ? new Date(lastBackup).toLocaleString() : 'Never';
                    break;
                    
                case 'danger':
                    // Danger zone - no specific settings to load
                    break;
                    
                default:
                    console.warn(`Unknown section: ${section}`);
            }
        }
        
        function updateStorageDisplay() {
            // Mock storage data for display
            const storageUsed = 256; // MB
            const storageTotal = 1024; // MB
            const chatStorage = 64; // MB
            const mediaStorage = 154; // MB
            const otherStorage = 38; // MB
            
            document.getElementById('storageUsed').textContent = `${storageUsed} MB`;
            document.getElementById('storageTotal').textContent = `/ ${storageTotal} MB`;
            document.getElementById('storageFill').style.width = `${(storageUsed / storageTotal) * 100}%`;
            document.getElementById('chatStorage').textContent = `${chatStorage} MB`;
            document.getElementById('mediaStorage').textContent = `${mediaStorage} MB`;
            document.getElementById('otherStorage').textContent = `${otherStorage} MB`;
        }
        
        function updateSpecificUI(key, value) {
            // Update specific UI elements when settings change
            switch(key) {
                case 'theme':
                    applyTheme();
                    break;
                case 'accentColor':
                    applyAccentColor();
                    break;
                case 'fontSize':
                    document.getElementById('fontSizeValue').textContent = `${value}px`;
                    break;
            }
        }
        
        function applyTheme() {
            const theme = settingsManager.getSetting('theme') || 'light';
            
            if (theme === 'dark') {
                document.documentElement.style.setProperty('--bg-color', '#1a1a1a');
                document.documentElement.style.setProperty('--text-primary', '#ffffff');
                document.documentElement.style.setProperty('--text-secondary', '#b0b3b8');
                document.documentElement.style.setProperty('--secondary-color', '#2d2d2d');
                document.documentElement.style.setProperty('--border-color', '#3e4042');
                document.documentElement.style.setProperty('--card-bg', '#242526');
            } else {
                document.documentElement.style.setProperty('--bg-color', '#ffffff');
                document.documentElement.style.setProperty('--text-primary', '#050505');
                document.documentElement.style.setProperty('--text-secondary', '#65676b');
                document.documentElement.style.setProperty('--secondary-color', '#f0f2f5');
                document.documentElement.style.setProperty('--border-color', '#dddfe2');
                document.documentElement.style.setProperty('--card-bg', '#ffffff');
            }
        }
        
        function applyAccentColor() {
            const color = settingsManager.getSetting('accentColor') || '#0084ff';
            
            document.documentElement.style.setProperty('--primary-color', color);
            const darkerColor = shadeColor(color, -20);
            document.documentElement.style.setProperty('--primary-dark', darkerColor);
        }
        
        function shadeColor(color, percent) {
            let R = parseInt(color.substring(1,3),16);
            let G = parseInt(color.substring(3,5),16);
            let B = parseInt(color.substring(5,7),16);

            R = parseInt(R * (100 + percent) / 100);
            G = parseInt(G * (100 + percent) / 100);
            B = parseInt(B * (100 + percent) / 100);

            R = (R<255)?R:255;  
            G = (G<255)?G:255;  
            B = (B<255)?B:255;  

            const RR = ((R.toString(16).length==1)?"0"+R.toString(16):R.toString(16));
            const GG = ((G.toString(16).length==1)?"0"+G.toString(16):G.toString(16));
            const BB = ((B.toString(16).length==1)?"0"+B.toString(16):B.toString(16));

            return "#"+RR+GG+BB;
        }
        
        function showNotification(message, type = 'success', duration = 1500) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            if (!notification || !notificationText) return;
            
            notificationText.textContent = message;
            notification.className = 'notification';
            notification.classList.add(type);
            notification.classList.add('active');
            
            setTimeout(() => {
                notification.classList.remove('active');
            }, duration);
        }
        
        function showConfirmDialog(message, onConfirm) {
            const confirmModal = document.getElementById('confirmModal');
            const confirmMessage = document.getElementById('confirmMessage');
            
            if (!confirmModal || !confirmMessage) return;
            
            confirmMessage.textContent = message;
            confirmModal.classList.add('active');
            
            const handleConfirm = () => {
                confirmModal.classList.remove('active');
                onConfirm();
            };
            
            const proceedBtn = document.getElementById('proceedConfirmBtn');
            const cancelBtn = document.getElementById('cancelConfirmBtn');
            
            if (proceedBtn) {
                proceedBtn.onclick = handleConfirm;
            }
            
            if (cancelBtn) {
                cancelBtn.onclick = () => {
                    confirmModal.classList.remove('active');
                };
            }
        }
        
        function initializeUI() {
            // Set initial section title
            document.getElementById('sectionTitle').textContent = 'Profile Settings';
            
            // Apply theme and accent color
            applyTheme();
            applyAccentColor();
            
            // Set up font size slider
            const fontSizeSlider = document.getElementById('fontSizeSlider');
            const fontSizeValue = document.getElementById('fontSizeValue');
            
            if (fontSizeSlider && fontSizeValue) {
                fontSizeSlider.addEventListener('input', function() {
                    fontSizeValue.textContent = `${this.value}px`;
                    settingsManager.saveSetting('fontSize', parseInt(this.value));
                    unsavedChanges = true;
                });
            }
        }
        
        function setupEventListeners() {
            // Navigation
            const backBtn = document.getElementById('backBtn');
            if (backBtn) {
                backBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (unsavedChanges) {
                        showConfirmDialog('You have unsaved changes. Are you sure you want to leave?', () => {
                            window.history.back();
                        });
                    } else {
                        window.history.back();
                    }
                });
            }
            
            // Navigation items - FIXED: Add click event listeners for navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.dataset.section;
                    
                    if (!section) return;
                    
                    // Update navigation
                    document.querySelectorAll('.nav-item').forEach(nav => {
                        nav.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Update sections
                    document.querySelectorAll('.settings-section').forEach(sec => {
                        sec.classList.remove('active');
                    });
                    
                    const sectionElement = document.getElementById(`${section}Section`);
                    if (sectionElement) {
                        sectionElement.classList.add('active');
                        currentSection = section;
                        
                        // Update title
                        updateSectionTitle(section);
                        
                        // Load section settings
                        loadSectionSettings(section);
                    }
                });
            });
            
            // Save All button
            const saveAllBtn = document.getElementById('saveAllBtn');
            if (saveAllBtn) {
                saveAllBtn.addEventListener('click', async (e) => {
                    e.preventDefault();
                    const btn = document.getElementById('saveAllBtn');
                    const originalText = btn.innerHTML;
                    
                    btn.innerHTML = '<i class="fas fa-check"></i> Saved';
                    btn.disabled = true;
                    
                    // Settings are automatically saved via settingsManager
                    unsavedChanges = false;
                    showNotification('All settings saved', 'success', 1500);
                    
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                    }, 1500);
                });
            }
            
            // Reset All button
            const resetAllBtn = document.getElementById('resetAllBtn');
            if (resetAllBtn) {
                resetAllBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    showConfirmDialog('Are you sure you want to reset all settings in this section to default?', () => {
                        // Reset settings for current section
                        settingsManager.resetSettings(currentSection);
                        showNotification(`${currentSection.charAt(0).toUpperCase() + currentSection.slice(1)} settings reset to default`, 'success', 1500);
                        // Reload UI
                        updateSectionUI(currentSection);
                    });
                });
            }
            
            // Setup input listeners for all settings
            setupInputListeners();
            
            // Theme selection
            document.querySelectorAll('.radio-option').forEach(option => {
                option.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('.radio-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    
                    const radioInput = this.querySelector('.radio-input');
                    if (radioInput) {
                        radioInput.checked = true;
                    }
                    
                    const theme = this.dataset.theme;
                    settingsManager.saveSetting('theme', theme);
                    unsavedChanges = true;
                });
            });
            
            // Color selection
            document.querySelectorAll('.color-option').forEach(color => {
                color.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('.color-option').forEach(c => {
                        c.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    
                    const colorValue = this.dataset.color;
                    settingsManager.saveSetting('accentColor', colorValue);
                    unsavedChanges = true;
                });
            });
            
            // Action buttons
            setupActionButton('changePhotoBtn', () => {
                document.getElementById('photoModal').classList.add('active');
            });
            
            setupActionButton('closePhotoModal', () => {
                document.getElementById('photoModal').classList.remove('active');
            });
            
            setupActionButton('choosePhotoBtn', () => {
                document.getElementById('photoUpload').click();
            });
            
            // Photo upload
            const photoUpload = document.getElementById('photoUpload');
            if (photoUpload) {
                photoUpload.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const photoPreview = document.getElementById('photoPreview');
                            if (photoPreview) {
                                photoPreview.innerHTML = `<img src="${e.target.result}" style="width: 100%; height: 100%; object-fit: cover;">`;
                                showNotification('Profile photo updated', 'success', 1500);
                                // Save to localStorage
                                localStorage.setItem('profilePhoto', e.target.result);
                                unsavedChanges = true;
                            }
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
            
            // Other action buttons
            setupActionButton('changePasswordBtn', () => {
                showConfirmDialog('You will be redirected to change your password. Continue?', () => {
                    showNotification('Password change feature requires backend setup', 'warning', 1500);
                });
            });
            
            setupActionButton('manageBlockedBtn', () => {
                showNotification('Blocked users management requires friends module', 'info', 1500);
            });
            
            setupActionButton('clearChatCacheBtn', () => {
                showConfirmDialog('Clear all chat cache? This will remove temporary files.', () => {
                    showNotification('Chat cache cleared', 'success', 1500);
                });
            });
            
            setupActionButton('clearMediaCacheBtn', () => {
                showConfirmDialog('Clear all media cache? This will remove downloaded media files.', () => {
                    showNotification('Media cache cleared', 'success', 1500);
                });
            });
            
            setupActionButton('deleteAllDataBtn', () => {
                showConfirmDialog('Delete ALL app data? This cannot be undone and will log you out.', () => {
                    localStorage.clear();
                    showNotification('All data deleted. Redirecting to login...', 'success', 1500);
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 1500);
                });
            });
            
            setupActionButton('fullBackupBtn', () => {
                showConfirmDialog('Create full backup of all data?', () => {
                    const btn = document.getElementById('fullBackupBtn');
                    const originalText = btn.innerHTML;
                    
                    btn.innerHTML = '<div class="loading-spinner"></div> Backing up...';
                    btn.disabled = true;
                    
                    setTimeout(() => {
                        // Save backup time
                        localStorage.setItem('lastBackupTime', new Date().toISOString());
                        document.getElementById('lastBackupTime').textContent = new Date().toLocaleString();
                        
                        showNotification('Full backup created successfully', 'success', 1500);
                        
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                    }, 1500);
                });
            });
            
            setupActionButton('restoreBackupBtn', () => {
                showConfirmDialog('Restore from backup? This will overwrite current settings.', () => {
                    const backupTime = localStorage.getItem('lastBackupTime');
                    if (backupTime) {
                        showNotification('Backup restored successfully', 'success', 1500);
                    } else {
                        showNotification('No backup found', 'warning', 1500);
                    }
                });
            });
            
            setupActionButton('clearAllChatsBtn', () => {
                showConfirmDialog('Clear ALL chats? This cannot be undone.', () => {
                    showNotification('All chats cleared', 'success', 1500);
                });
            });
            
            setupActionButton('deleteAccountBtn', () => {
                showConfirmDialog('Permanently delete your account? This cannot be undone.', () => {
                    showNotification('Account deletion requires backend confirmation', 'warning', 1500);
                });
            });
            
            setupActionButton('exportDataBtn', () => {
                const btn = document.getElementById('exportDataBtn');
                const originalText = btn.innerHTML;
                
                btn.innerHTML = '<div class="loading-spinner"></div> Exporting...';
                btn.disabled = true;
                
                setTimeout(() => {
                    const dataStr = JSON.stringify(settingsManager.getAllSettings(), null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const downloadUrl = URL.createObjectURL(dataBlob);
                    const a = document.createElement('a');
                    a.href = downloadUrl;
                    a.download = `settings_backup_${Date.now()}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(downloadUrl);
                    
                    showNotification('Data exported successfully', 'success', 1500);
                    
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 1500);
            });
            
            function setupActionButton(buttonId, handler) {
                const button = document.getElementById(buttonId);
                if (button) {
                    button.addEventListener('click', (e) => {
                        e.preventDefault();
                        handler();
                    });
                }
            }
            
            // Modal close buttons
            setupActionButton('closeConfirmModal', () => {
                document.getElementById('confirmModal').classList.remove('active');
            });
            
            setupActionButton('cancelConfirmBtn', () => {
                document.getElementById('confirmModal').classList.remove('active');
            });
            
            // Before unload warning
            window.addEventListener('beforeunload', function(event) {
                if (unsavedChanges) {
                    event.preventDefault();
                    event.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
                    return event.returnValue;
                }
            });
            
            // Clean up subscription when page unloads
            window.addEventListener('unload', function() {
                cleanupSubscription();
            });
        }
        
        function updateSectionTitle(section) {
            const sectionTitles = {
                'profile': 'Profile',
                'security': 'Security',
                'privacy': 'Privacy',
                'chat': 'Chat',
                'friends': 'Friends',
                'groups': 'Groups',
                'calls': 'Calls',
                'status': 'Status',
                'notifications': 'Notifications',
                'appearance': 'Appearance',
                'storage': 'Storage',
                'advanced': 'Advanced',
                'backup': 'Backup & Restore',
                'danger': 'Danger Zone'
            };
            
            const title = sectionTitles[section] || 'Settings';
            document.getElementById('sectionTitle').textContent = `${title} Settings`;
        }
        
        function setupInputListeners() {
            // Profile settings
            setupInputListener('displayNameInput', 'displayName');
            setupInputListener('usernameInput', 'username');
            setupInputListener('bioInput', 'bio');
            setupInputListener('phoneInput', 'phone');
            setupInputListener('emailInput', 'email');
            setupSelectListener('profileVisibility', 'profileVisibility');
            setupToggleListener('lastSeenToggle', 'lastSeen');
            setupToggleListener('onlineStatusToggle', 'onlineStatus');
            setupSelectListener('photoVisibility', 'photoVisibility');
            
            // Security settings
            setupToggleListener('twoFactorToggle', 'twoFactor');
            setupToggleListener('loginNotificationsToggle', 'loginNotifications');
            setupToggleListener('appLockToggle', 'appLock');
            setupToggleListener('screenCaptureToggle', 'screenCapture');
            setupToggleListener('encryptionToggle', 'encryption');
            
            // Privacy settings
            setupSelectListener('whoCanAddMe', 'whoCanAddMe');
            setupToggleListener('readReceiptsToggle', 'readReceipts');
            setupToggleListener('typingIndicatorsToggle', 'typingIndicators');
            setupToggleListener('messageForwardingToggle', 'messageForwarding');
            setupToggleListener('contactDiscoveryToggle', 'contactDiscovery');
            setupToggleListener('canMessageToggle', 'canMessage');
            setupToggleListener('canCallToggle', 'canCall');
            setupToggleListener('canSeeStatusToggle', 'canSeeStatus');
            setupToggleListener('canSeePhotoToggle', 'canSeePhoto');
            setupToggleListener('canSeeLastSeenToggle', 'canSeeLastSeen');
            setupToggleListener('canForwardToggle', 'canForward');
            setupToggleListener('canScreenshotToggle', 'canScreenshot');
            
            // Chat settings
            setupToggleListener('enterKeySendsToggle', 'enterKeySends');
            setupSelectListener('mediaDownloadSetting', 'mediaDownload');
            setupToggleListener('saveMediaToggle', 'saveMedia');
            setupSelectListener('messageHistorySetting', 'messageHistory');
            setupSelectListener('disappearingTimer', 'disappearingTimer');
            setupToggleListener('smartRepliesToggle', 'smartReplies');
            setupToggleListener('messageTranslationToggle', 'messageTranslation');
            setupToggleListener('chatSummarizationToggle', 'chatSummarization');
            setupToggleListener('spamDetectionToggle', 'spamDetection');
            
            // Friends settings
            setupToggleListener('discoverByPhoneToggle', 'discoverByPhone');
            setupToggleListener('discoverByEmailToggle', 'discoverByEmail');
            setupToggleListener('nearbyDiscoveryToggle', 'nearbyDiscovery');
            setupToggleListener('qrCodeToggle', 'qrCode');
            setupToggleListener('friendSuggestionsToggle', 'friendSuggestions');
            setupToggleListener('temporaryFriendsToggle', 'temporaryFriends');
            setupToggleListener('friendshipNotesToggle', 'friendshipNotes');
            setupToggleListener('friendCategoriesToggle', 'friendCategories');
            setupToggleListener('trustScoreToggle', 'trustScore');
            setupToggleListener('friendAnalyticsToggle', 'friendAnalytics');
            
            // Groups settings
            setupToggleListener('autoJoinGroupsToggle', 'autoJoin');
            setupSelectListener('groupInvitationsSetting', 'groupInvitations');
            setupSelectListener('groupPrivacySetting', 'groupPrivacy');
            setupToggleListener('groupAnnouncementsToggle', 'groupAnnouncements');
            setupToggleListener('groupMediaDownloadToggle', 'groupMediaDownload');
            setupToggleListener('messageApprovalToggle', 'messageApproval');
            setupToggleListener('keywordFilteringToggle', 'keywordFiltering');
            setupToggleListener('groupSpamDetectionToggle', 'groupSpamDetection');
            setupToggleListener('memberWarningsToggle', 'memberWarnings');
            setupToggleListener('activityTrackingToggle', 'activityTracking');
            setupToggleListener('topContributorsToggle', 'topContributors');
            setupToggleListener('messageVolumeToggle', 'messageVolume');
            
            // Calls settings
            setupSelectListener('whoCanCallMe', 'whoCanCallMe');
            setupToggleListener('callVerificationToggle', 'callVerification');
            setupSelectListener('ringtoneSetting', 'ringtone');
            setupToggleListener('callVibrationToggle', 'callVibration');
            setupToggleListener('autoAnswerToggle', 'autoAnswer');
            setupSelectListener('videoQualitySetting', 'videoQuality');
            setupSelectListener('cameraDefaultSetting', 'cameraDefault');
            setupToggleListener('noiseCancellationToggle', 'noiseCancellation');
            setupToggleListener('echoCancellationToggle', 'echoCancellation');
            setupToggleListener('liveReactionsToggle', 'liveReactions');
            setupToggleListener('inCallChatToggle', 'inCallChat');
            setupToggleListener('sharedWhiteboardToggle', 'sharedWhiteboard');
            setupToggleListener('sharedNotesToggle', 'sharedNotes');
            setupToggleListener('pollsToggle', 'polls');
            
            // Status settings
            setupSelectListener('whoCanViewStatus', 'whoCanViewStatus');
            setupSelectListener('statusExpireTime', 'statusExpireTime');
            setupSelectListener('statusReplyPermissions', 'statusReplyPermissions');
            setupToggleListener('statusDownloadToggle', 'statusDownload');
            setupToggleListener('viewCountToggle', 'viewCount');
            setupToggleListener('viewerListToggle', 'viewerList');
            setupToggleListener('statusReactionsToggle', 'statusReactions');
            setupToggleListener('autoCaptionsToggle', 'autoCaptions');
            setupToggleListener('statusEnhancementToggle', 'statusEnhancement');
            setupToggleListener('statusSchedulingToggle', 'statusScheduling');
            
            // Notification settings
            setupToggleListener('messageNotificationsToggle', 'messageNotifications');
            setupToggleListener('groupNotificationsToggle', 'groupNotifications');
            setupToggleListener('friendRequestNotificationsToggle', 'friendRequestNotifications');
            setupToggleListener('callNotificationsToggle', 'callNotifications');
            setupToggleListener('statusNotificationsToggle', 'statusNotifications');
            setupToggleListener('notificationSoundToggle', 'notificationSound');
            setupToggleListener('notificationVibrationToggle', 'notificationVibration');
            setupToggleListener('popupNotificationsToggle', 'popupNotifications');
            setupToggleListener('notificationLightToggle', 'notificationLight');
            setupToggleListener('doNotDisturbToggle', 'doNotDisturb');
            setupSelectListener('dndSchedule', 'dndSchedule');
            setupToggleListener('dndAllowCallsToggle', 'dndAllowCalls');
            
            // Appearance settings
            setupToggleListener('reduceMotionToggle', 'reduceMotion');
            setupSelectListener('languageSetting', 'language');
            setupSelectListener('timeFormatSetting', 'timeFormat');
            setupSelectListener('dateFormatSetting', 'dateFormat');
            
            // Storage settings
            setupSelectListener('autoClearCache', 'autoClearCache');
            
            // Advanced settings
            setupToggleListener('offlineModeToggle', 'offlineMode');
            setupToggleListener('intranetSupportToggle', 'intranetSupport');
            setupToggleListener('lowBandwidthToggle', 'lowBandwidth');
            setupToggleListener('debugModeToggle', 'debugMode');
            setupToggleListener('dataSaverToggle', 'dataSaver');
            
            // Backup settings
            setupToggleListener('autoBackupToggle', 'autoBackup');
            setupSelectListener('backupFrequency', 'backupFrequency');
            setupSelectListener('backupLocation', 'backupLocation');
            
            // Helper functions
            function setupInputListener(elementId, key) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.addEventListener('input', (e) => {
                        settingsManager.saveSetting(key, e.target.value);
                        unsavedChanges = true;
                    });
                }
            }
            
            function setupSelectListener(elementId, key) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.addEventListener('change', (e) => {
                        settingsManager.saveSetting(key, e.target.value);
                        unsavedChanges = true;
                    });
                }
            }
            
            function setupToggleListener(elementId, key) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.addEventListener('change', (e) => {
                        settingsManager.saveSetting(key, e.target.checked);
                        unsavedChanges = true;
                    });
                }
            }
        }
        
        console.log('Settings page initialized successfully');
    </script>
</body>
</html>