<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Debug - Uniconnect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getAuth, 
            signInWithEmailAndPassword,
            createUserWithEmailAndPassword
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDHHyGgsSV18BcXrGgzi4C8frzDAE1C1zo",
            authDomain: "uniconnect-ee95c.firebaseapp.com",
            projectId: "uniconnect-ee95c",
            storageBucket: "uniconnect-ee95c.appspot.com",
            messagingSenderId: "1003264444309",
            appId: "1:1003264444309:web:9f0307516e44d21e97d89c"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        window.firebaseApp = {
            app,
            auth,
            authFunctions: {
                signInWithEmailAndPassword,
                createUserWithEmailAndPassword
            }
        };

        console.log('ğŸ”¥ Firebase initialized!');
    </script>

    <style>
        .debug-box {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #3B82F6;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            color: #00ff00;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #00ff00; }
        .error { color: #ff4444; }
        .warning { color: #ffaa00; }
        .info { color: #4488ff; }
    </style>
</head>
<body class="h-full bg-gray-900 text-white">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold text-center text-blue-400 mb-8">ğŸš¨ LOGIN DEBUGGER ğŸš¨</h1>
        
        <!-- Debug Output -->
        <div class="debug-box">
            <div id="debugOutput">
                <div class="info">ğŸ” Debug session started...</div>
                <div class="info">â° Loading Firebase...</div>
            </div>
        </div>

        <!-- Test Controls -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <button onclick="testFirebase()" class="bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-lg font-bold">
                ğŸ§ª Test Firebase Connection
            </button>
            <button onclick="createTestUser()" class="bg-green-600 hover:bg-green-700 text-white p-4 rounded-lg font-bold">
                ğŸ‘¤ Create Test User
            </button>
            <button onclick="checkCurrentUser()" class="bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-lg font-bold">
                ğŸ” Check Current User
            </button>
            <button onclick="clearDebug()" class="bg-gray-600 hover:bg-gray-700 text-white p-4 rounded-lg font-bold">
                ğŸ—‘ï¸ Clear Debug
            </button>
        </div>

        <!-- Login Test Form -->
        <div class="bg-gray-800 p-6 rounded-lg mb-6">
            <h2 class="text-xl font-bold text-white mb-4">ğŸ”‘ Test Login</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Email</label>
                    <input type="email" id="testEmail" value="test@uniconnect.com" 
                           class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Password</label>
                    <input type="password" id="testPassword" value="test123456" 
                           class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white">
                </div>
            </div>
            <button onclick="testLogin()" class="w-full mt-4 bg-yellow-600 hover:bg-yellow-700 text-white p-3 rounded-lg font-bold">
                ğŸš€ Test Login with Above Credentials
            </button>
        </div>

        <!-- Quick Actions -->
        <div class="bg-gray-800 p-6 rounded-lg">
            <h2 class="text-xl font-bold text-white mb-4">âš¡ Quick Actions</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                <button onclick="fillCredentials('test@uniconnect.com', 'test123456')" class="bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded text-sm">
                    Test User 1
                </button>
                <button onclick="fillCredentials('demo@uniconnect.com', 'demo123456')" class="bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded text-sm">
                    Test User 2
                </button>
                <button onclick="fillCredentials('admin@uniconnect.com', 'admin123456')" class="bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded text-sm">
                    Test User 3
                </button>
                <button onclick="fillCredentials('', '')" class="bg-red-600 hover:bg-red-700 text-white p-2 rounded text-sm">
                    Clear Fields
                </button>
            </div>
        </div>
    </div>

    <script>
        const debugOutput = document.getElementById('debugOutput');

        function addDebugMessage(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const messageDiv = document.createElement('div');
            messageDiv.className = type;
            messageDiv.innerHTML = `[${timestamp}] ${message}`;
            debugOutput.appendChild(messageDiv);
            debugOutput.scrollTop = debugOutput.scrollHeight;
        }

        function clearDebug() {
            debugOutput.innerHTML = '<div class="info">ğŸ” Debug session started...</div>';
        }

        function fillCredentials(email, password) {
            document.getElementById('testEmail').value = email;
            document.getElementById('testPassword').value = password;
            addDebugMessage(`ğŸ“ Filled credentials: ${email}`, 'info');
        }

        // Test Firebase Connection
        async function testFirebase() {
            addDebugMessage('ğŸ§ª Testing Firebase connection...', 'info');
            
            try {
                if (!window.firebaseApp) {
                    addDebugMessage('âŒ Firebase app not found!', 'error');
                    return;
                }

                if (!window.firebaseApp.auth) {
                    addDebugMessage('âŒ Firebase auth not found!', 'error');
                    return;
                }

                addDebugMessage('âœ… Firebase app found', 'success');
                addDebugMessage('âœ… Firebase auth found', 'success');
                
                // Test if we can access auth methods
                const auth = window.firebaseApp.auth;
                addDebugMessage(`ğŸ“§ Auth domain: ${auth.config.authDomain}`, 'info');
                addDebugMessage(`ğŸ¢ Project ID: ${auth.config.projectId}`, 'info');
                
                addDebugMessage('ğŸ‰ Firebase is working correctly!', 'success');
                
            } catch (error) {
                addDebugMessage(`âŒ Firebase test failed: ${error.message}`, 'error');
            }
        }

        // Create Test User
        async function createTestUser() {
            const email = document.getElementById('testEmail').value || 'test@uniconnect.com';
            const password = document.getElementById('testPassword').value || 'test123456';
            
            addDebugMessage(`ğŸ‘¤ Creating test user: ${email}`, 'info');
            
            try {
                const userCredential = await window.firebaseApp.authFunctions.createUserWithEmailAndPassword(
                    window.firebaseApp.auth,
                    email,
                    password
                );
                
                addDebugMessage(`âœ… USER CREATED SUCCESSFULLY!`, 'success');
                addDebugMessage(`ğŸ“§ Email: ${userCredential.user.email}`, 'info');
                addDebugMessage(`ğŸ†” UID: ${userCredential.user.uid}`, 'info');
                addDebugMessage(`âœ… Email verified: ${userCredential.user.emailVerified}`, 'info');
                addDebugMessage('ğŸ’¡ You can now try to login with these credentials!', 'success');
                
            } catch (error) {
                addDebugMessage(`âŒ User creation failed: ${error.code}`, 'error');
                addDebugMessage(`ğŸ“ Error message: ${error.message}`, 'error');
                
                if (error.code === 'auth/email-already-in-use') {
                    addDebugMessage('ğŸ’¡ User already exists! Try logging in instead.', 'warning');
                } else if (error.code === 'auth/weak-password') {
                    addDebugMessage('ğŸ’¡ Password is too weak. Use a stronger password.', 'warning');
                } else if (error.code === 'auth/invalid-email') {
                    addDebugMessage('ğŸ’¡ Invalid email format.', 'warning');
                }
            }
        }

        // Test Login
        async function testLogin() {
            const email = document.getElementById('testEmail').value;
            const password = document.getElementById('testPassword').value;
            
            if (!email || !password) {
                addDebugMessage('âŒ Please enter both email and password', 'error');
                return;
            }
            
            addDebugMessage(`ğŸ” Attempting login: ${email}`, 'info');
            
            try {
                const userCredential = await window.firebaseApp.authFunctions.signInWithEmailAndPassword(
                    window.firebaseApp.auth,
                    email,
                    password
                );
                
                addDebugMessage('ğŸ‰ LOGIN SUCCESSFUL!', 'success');
                addDebugMessage(`ğŸ“§ User: ${userCredential.user.email}`, 'info');
                addDebugMessage(`ğŸ†” UID: ${userCredential.user.uid}`, 'info');
                addDebugMessage(`âœ… Email verified: ${userCredential.user.emailVerified}`, 'info');
                addDebugMessage('ğŸš€ Redirecting to chat in 3 seconds...', 'success');
                
                // Store user data
                localStorage.setItem('userEmail', userCredential.user.email);
                localStorage.setItem('userId', userCredential.user.uid);
                
                setTimeout(() => {
                    window.location.href = 'chat.html';
                }, 3000);
                
            } catch (error) {
                addDebugMessage(`âŒ LOGIN FAILED: ${error.code}`, 'error');
                addDebugMessage(`ğŸ“ Error details: ${error.message}`, 'error');
                
                // Specific error handling
                switch (error.code) {
                    case 'auth/user-not-found':
                        addDebugMessage('ğŸ’¡ SOLUTION: No user found with this email. Create a user first!', 'warning');
                        break;
                    case 'auth/wrong-password':
                        addDebugMessage('ğŸ’¡ SOLUTION: Wrong password. Try the correct password or create a new user.', 'warning');
                        break;
                    case 'auth/invalid-credential':
                        addDebugMessage('ğŸ’¡ SOLUTION: Invalid credentials. User might not exist or password is wrong.', 'warning');
                        break;
                    case 'auth/too-many-requests':
                        addDebugMessage('ğŸ’¡ SOLUTION: Too many attempts. Wait a few minutes.', 'warning');
                        break;
                    default:
                        addDebugMessage('ğŸ’¡ Check if the user exists in Firebase Console.', 'warning');
                }
            }
        }

        // Check Current User
        async function checkCurrentUser() {
            addDebugMessage('ğŸ” Checking for currently logged in user...', 'info');
            
            try {
                const auth = window.firebaseApp.auth;
                const user = auth.currentUser;
                
                if (user) {
                    addDebugMessage('âœ… User is currently logged in:', 'success');
                    addDebugMessage(`ğŸ“§ Email: ${user.email}`, 'info');
                    addDebugMessage(`ğŸ†” UID: ${user.uid}`, 'info');
                    addDebugMessage(`âœ… Email verified: ${user.emailVerified}`, 'info');
                } else {
                    addDebugMessage('âŒ No user is currently logged in', 'warning');
                }
            } catch (error) {
                addDebugMessage(`âŒ Error checking current user: ${error.message}`, 'error');
            }
        }

        // Auto-test on load
        setTimeout(() => {
            addDebugMessage('ğŸ”„ Auto-testing Firebase...', 'info');
            testFirebase();
        }, 1000);
    </script>
</body>
</html>