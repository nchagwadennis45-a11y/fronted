<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>kynecta - Marketplace</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --accent: #06d6a0;
            --background: #f8fafc;
            --surface: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
        }
        
        [data-theme="dark"] {
            --primary: #818cf8;
            --primary-dark: #6366f1;
            --secondary: #a78bfa;
            --accent: #34d399;
            --background: #0f172a;
            --surface: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
        }

        /* Mood Themes */
        [data-mood="happy"] {
            --primary: #f59e0b;
            --primary-dark: #d97706;
            --secondary: #fbbf24;
            --accent: #10b981;
        }
        
        [data-mood="calm"] {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --secondary: #60a5fa;
            --accent: #06b6d4;
        }
        
        [data-mood="energetic"] {
            --primary: #ef4444;
            --primary-dark: #dc2626;
            --secondary: #f87171;
            --accent: #f59e0b;
        }
        
        [data-mood="creative"] {
            --primary: #8b5cf6;
            --primary-dark: #7c3aed;
            --secondary: #a78bfa;
            --accent: #ec4899;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }
        
        .glass-card {
            background: var(--surface);
            border: 1px solid var(--border);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border-radius: 12px;
        }
        
        .hover-lift {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            z-index: 1000;
            max-width: 300px;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text-primary);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: var(--surface);
            border-radius: 1rem;
            padding: 1.5rem;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
            color: var(--text-primary);
        }
        
        .modal.active .modal-content {
            transform: scale(1);
        }
        
        .tab-button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            color: var(--text-secondary);
        }
        
        .tab-button.active {
            background: var(--primary);
            color: white;
        }
        
        .content-area {
            display: none;
        }
        
        .content-area.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .hot-deal-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ef4444;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: bold;
            z-index: 10;
        }
        
        .discount-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #10b981;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: bold;
            z-index: 10;
        }
        
        .image-upload-area {
            border: 2px dashed var(--border);
            border-radius: 0.75rem;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .image-upload-area.dragover {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.05);
        }
        
        .image-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .image-preview-item {
            position: relative;
            border-radius: 0.5rem;
            overflow: hidden;
        }
        
        .image-preview-item img {
            width: 100%;
            height: 100px;
            object-fit: cover;
        }
        
        .image-preview-item .remove {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.75rem;
        }
        
        .verified-badge {
            display: inline-flex;
            align-items: center;
            background: var(--accent);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }
        
        .countdown-timer {
            font-family: monospace;
            font-weight: bold;
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
            padding: 0.5rem;
            border-radius: 0.5rem;
            display: inline-block;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--surface);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding: 0.75rem 0;
            z-index: 100;
        }
        
        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-secondary);
            font-size: 0.75rem;
        }
        
        .bottom-nav-item.active {
            color: var(--primary);
        }
        
        .bottom-nav-item i {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }
        
        .product-card {
            transition: all 0.3s ease;
        }
        
        .product-card:hover .secondary-image {
            opacity: 1;
        }
        
        .secondary-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .quick-actions {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .product-card:hover .quick-actions {
            opacity: 1;
        }
        
        .quick-action-btn {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }
        
        .quick-action-btn:hover {
            background: white;
            transform: scale(1.1);
        }
        
        .quick-action-btn.active {
            color: #ef4444;
        }
        
        .carousel {
            position: relative;
            overflow: hidden;
            border-radius: 1rem;
        }
        
        .carousel-inner {
            display: flex;
            transition: transform 0.5s ease;
        }
        
        .carousel-item {
            min-width: 100%;
            position: relative;
        }
        
        .carousel-item img {
            width: 100%;
            height: 300px;
            object-fit: cover;
        }
        
        .carousel-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.7));
            color: white;
            padding: 1.5rem;
        }
        
        .carousel-control {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
        }
        
        .carousel-control.prev {
            left: 1rem;
        }
        
        .carousel-control.next {
            right: 1rem;
        }
        
        .theme-toggle {
            position: relative;
            width: 60px;
            height: 30px;
            background: var(--border);
            border-radius: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 0 5px;
            transition: background 0.3s ease;
        }
        
        .theme-toggle.active {
            background: var(--primary);
        }
        
        .theme-toggle-handle {
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }
        
        .theme-toggle.active .theme-toggle-handle {
            transform: translateX(30px);
        }
        
        .suggestion-tag {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
        }
        
        .list-view .product-card {
            display: flex;
            gap: 1rem;
        }
        
        .list-view .product-image {
            width: 150px;
            height: 150px;
            flex-shrink: 0;
        }
        
        .list-view .product-details {
            flex: 1;
        }
        
        .loading-spinner {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 2px solid #3B82F6;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Jumia-inspired styles */
        .jumia-nav {
            background: #f68b1e;
            color: white;
        }
        
        .jumia-search {
            background: white;
            border-radius: 4px;
            padding: 8px 12px;
        }
        
        .jumia-category-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            padding: 15px;
        }
        
        .jumia-category-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .jumia-category-item:hover {
            transform: translateY(-5px);
        }
        
        .jumia-category-icon {
            width: 50px;
            height: 50px;
            background: #f5f5f5;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
        }
        
        .jumia-category-name {
            font-size: 12px;
            color: #333;
        }
        
        .jumia-product-card {
            background: white;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .jumia-product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .jumia-product-image {
            width: 100%;
            height: 150px;
            object-fit: contain;
            margin-bottom: 10px;
        }
        
        .jumia-product-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
            height: 40px;
            overflow: hidden;
        }
        
        .jumia-product-price {
            font-size: 16px;
            font-weight: bold;
            color: #f68b1e;
            margin-bottom: 5px;
        }
        
        .jumia-product-original-price {
            font-size: 12px;
            color: #999;
            text-decoration: line-through;
            margin-bottom: 5px;
        }
        
        .jumia-product-discount {
            font-size: 12px;
            color: #f68b1e;
            font-weight: bold;
        }
        
        .jumia-rating {
            display: flex;
            align-items: center;
            font-size: 12px;
            color: #999;
        }
        
        .jumia-express-badge {
            background: #f68b1e;
            color: white;
            font-size: 10px;
            padding: 2px 5px;
            border-radius: 3px;
            display: inline-block;
            margin-bottom: 5px;
        }
        
        /* Dashboard styles */
        .dashboard-section {
            display: none;
        }
        
        .dashboard-section.active {
            display: block;
            animation: slideIn 0.3s ease;
        }
        
        .seller-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }
        
        .seller-card:hover {
            transform: translateY(-5px);
        }
        
        /* Mobile responsive styles */
        .mobile-menu {
            position: fixed;
            top: 0;
            right: -100%;
            width: 80%;
            max-width: 300px;
            height: 100vh;
            background: var(--surface);
            z-index: 1000;
            transition: right 0.3s ease;
            padding: 1.5rem;
            overflow-y: auto;
        }
        
        .mobile-menu.active {
            right: 0;
        }
        
        .mobile-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .mobile-menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .hamburger-menu {
            display: none;
            flex-direction: column;
            justify-content: space-between;
            width: 24px;
            height: 18px;
            cursor: pointer;
        }
        
        .hamburger-menu span {
            display: block;
            height: 2px;
            width: 100%;
            background: var(--text-primary);
            transition: all 0.3s ease;
        }
        
        /* Improved mobile styles */
        @media (max-width: 768px) {
            .hamburger-menu {
                display: flex;
            }
            
            .desktop-nav {
                display: none;
            }
            
            .list-view .product-card {
                flex-direction: column;
            }
            
            .list-view .product-image {
                width: 100%;
                height: 200px;
            }
            
            .carousel-item img {
                height: 200px;
            }
            
            .carousel-caption {
                padding: 1rem;
            }
            
            .carousel-caption h2 {
                font-size: 1.25rem;
            }
            
            .carousel-caption p {
                font-size: 0.875rem;
            }
            
            .modal-content {
                padding: 1rem;
            }
            
            /* Improved mobile layout for better visibility */
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }
            
            .stats-grid .glass-card {
                padding: 0.75rem;
            }
            
            .stats-grid .glass-card div:first-child {
                font-size: 1.125rem;
            }
            
            .stats-grid .glass-card div:last-child {
                font-size: 0.75rem;
            }
            
            .tab-buttons-container {
                overflow-x: auto;
                padding-bottom: 0.5rem;
                margin-bottom: 1rem;
            }
            
            .tab-buttons-scroll {
                display: flex;
                flex-wrap: nowrap;
                gap: 0.5rem;
            }
            
            .tab-button {
                white-space: nowrap;
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }
            
            .filter-controls {
                flex-direction: column;
                gap: 1rem;
            }
            
            .filter-controls > div {
                width: 100%;
            }
            
            .filter-buttons {
                display: flex;
                gap: 0.5rem;
                width: 100%;
            }
            
            .filter-buttons button {
                flex: 1;
            }
            
            .product-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }
            
            .product-card .product-details {
                padding: 0.75rem;
            }
            
            .product-card .product-details h3 {
                font-size: 0.875rem;
            }
            
            .product-card .product-details .price {
                font-size: 1rem;
            }
            
            .product-card .product-details .seller-info {
                font-size: 0.75rem;
            }
            
            .product-card .product-details .description {
                font-size: 0.75rem;
                margin-bottom: 0.5rem;
            }
            
            .product-card .product-details .rating {
                font-size: 0.75rem;
            }
            
            .product-card .product-details .date {
                font-size: 0.75rem;
            }
            
            .product-actions {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .product-actions button {
                width: 100%;
                padding: 0.5rem;
                font-size: 0.875rem;
            }
            
            .mobile-search-container {
                padding: 0.75rem 1rem;
            }
            
            .mobile-user-info {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                margin-top: 0.5rem;
            }
            
            .mobile-user-info img {
                width: 32px;
                height: 32px;
            }
            
            .mobile-user-details {
                display: flex;
                flex-direction: column;
            }
            
            .mobile-user-details .name {
                font-size: 0.875rem;
                font-weight: 600;
            }
            
            .mobile-user-details .status {
                font-size: 0.75rem;
                color: var(--text-secondary);
            }
            
            /* Jumia-style mobile improvements */
            .jumia-category-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 8px;
                padding: 10px;
            }
            
            .jumia-category-icon {
                width: 40px;
                height: 40px;
            }
            
            .jumia-category-name {
                font-size: 10px;
            }
            
            .jumia-product-card {
                padding: 8px;
            }
            
            .jumia-product-image {
                height: 120px;
            }
            
            .jumia-product-name {
                font-size: 12px;
                height: 32px;
            }
            
            .jumia-product-price {
                font-size: 14px;
            }
        }
        
        /* Responsive text sizes */
        .responsive-text {
            font-size: clamp(1rem, 4vw, 1.5rem);
        }
        
        .responsive-heading {
            font-size: clamp(1.5rem, 6vw, 2.5rem);
        }
        
        .responsive-subheading {
            font-size: clamp(1rem, 3vw, 1.25rem);
        }
        
        /* Better mobile layout */
        @media (max-width: 767px) {
            .mobile-padding {
                padding: 1rem;
            }
            
            .mobile-margin {
                margin-bottom: 1.5rem;
            }
            
            .mobile-text-center {
                text-align: center;
            }
            
            .mobile-stack {
                flex-direction: column;
            }
            
            .mobile-space-y > * + * {
                margin-top: 1rem;
            }
        }
        
        /* Additional mobile optimizations */
        @media (max-width: 480px) {
            .product-grid {
                grid-template-columns: 1fr;
            }
            
            .carousel-item img {
                height: 150px;
            }
            
            .carousel-caption {
                padding: 0.75rem;
            }
            
            .carousel-caption h2 {
                font-size: 1.125rem;
            }
            
            .carousel-caption p {
                font-size: 0.75rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .jumia-category-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Mood selector styles */
        .mood-selector {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .mood-option {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .mood-option.active {
            border-color: var(--text-primary);
            transform: scale(1.1);
        }

        .mood-happy {
            background-color: #f59e0b;
        }

        .mood-calm {
            background-color: #3b82f6;
        }

        .mood-energetic {
            background-color: #ef4444;
        }

        .mood-creative {
            background-color: #8b5cf6;
        }

        /* Professional category grid */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .category-card {
            background: var(--surface);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid var(--border);
            cursor: pointer;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }

        .category-icon {
            width: 60px;
            height: 60px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            color: white;
            font-size: 1.5rem;
        }

        .category-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .category-count {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
    </style>
</head>
<body class="min-h-screen pb-16 overflow-x-hidden">
    <!-- Mobile Menu Overlay -->
    <div id="mobileMenuOverlay" class="mobile-menu-overlay"></div>
    
    <!-- Mobile Menu -->
    <div id="mobileMenu" class="mobile-menu">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold">Menu</h2>
            <button id="closeMobileMenu" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        
        <div class="space-y-4">
            <a href="home.html" class="block py-2 text-gray-700 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-white font-medium transition">Home</a>
            <a href="#" id="mobileDiscoverLink" class="block py-2 text-gray-700 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-white font-medium transition">Discover</a>
            <a href="#" id="mobileCategoriesLink" class="block py-2 text-gray-700 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-white font-medium transition">Categories</a>
            <a href="#" id="mobileSellersLink" class="block py-2 text-gray-700 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-white font-medium transition">Sellers</a>
            
            <div class="pt-4 border-t border-gray-200 dark:border-slate-600">
                <div class="flex items-center space-x-3 mb-4">
                    <img id="mobileUserAvatar" src="https://ui-avatars.com/api/?name=User&background=6366f1&color=fff&size=40" alt="User" class="w-10 h-10 rounded-full object-cover">
                    <div>
                        <p id="mobileUserName" class="text-sm font-medium text-gray-900 dark:text-white">Loading...</p>
                        <p id="mobileUserStatus" class="text-xs text-gray-500 dark:text-gray-400">Student</p>
                    </div>
                </div>
                
                <div class="space-y-2">
                    <a href="profile.html" class="block py-2 text-gray-700 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-white">Profile</a>
                    <a href="chat.html" class="block py-2 text-gray-700 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-white">Messages</a>
                    <a href="games.html" class="block py-2 text-gray-700 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-white">Games</a>
                    <a href="payment.html" class="block py-2 text-gray-700 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-white">Payment</a>
                    <button id="mobileLogoutBtn" class="block w-full text-left py-2 text-red-600 hover:text-red-800">Logout</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b dark:bg-slate-800 dark:border-slate-700 sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-2">
                    <div class="bg-indigo-600 p-2 rounded-lg">
                        <i class="fas fa-store text-white text-xl"></i>
                    </div>
                    <h1 class="text-xl font-bold text-gray-900 dark:text-white">kynecta Marketplace</h1>
                </div>
                
                <div class="hidden md:flex space-x-6 desktop-nav">
                    <a href="home.html" class="nav-link">Home</a>
                    <a href="#" class="nav-link active" data-section="home">Marketplace</a>
                    <a href="#" class="nav-link" data-section="discover">Discover</a>
                    <a href="#" class="nav-link" data-section="categories">Categories</a>
                    <a href="#" class="nav-link" data-section="sellers">Sellers</a>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="relative hidden md:block">
                        <input type="text" id="searchInput" placeholder="Search products..." class="pl-10 pr-4 py-2 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent w-64">
                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        <div id="searchSuggestions" class="absolute top-full left-0 right-0 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-lg mt-1 shadow-lg z-10 hidden">
                            <!-- Search suggestions will appear here -->
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-2">
                        <!-- Mood Selector -->
                        <div class="mood-selector hidden md:flex">
                            <div class="mood-option mood-happy active" data-mood="happy" title="Happy"></div>
                            <div class="mood-option mood-calm" data-mood="calm" title="Calm"></div>
                            <div class="mood-option mood-energetic" data-mood="energetic" title="Energetic"></div>
                            <div class="mood-option mood-creative" data-mood="creative" title="Creative"></div>
                        </div>
                        
                        <div class="theme-toggle" id="themeToggle">
                            <div class="theme-toggle-handle"></div>
                        </div>
                        
                        <button id="createListingBtn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition flex items-center space-x-2">
                            <i class="fas fa-plus"></i>
                            <span class="hidden sm:inline">List Item</span>
                        </button>
                        
                        <div class="relative">
                            <button id="cartBtn" class="p-2 text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white rounded-full hover:bg-gray-100 dark:hover:bg-slate-700 transition">
                                <i class="fas fa-shopping-cart"></i>
                            </button>
                            <span id="cartCount" class="absolute -top-1 -right-1 bg-indigo-600 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center hidden">0</span>
                        </div>
                        
                        <div class="relative">
                            <button id="notificationBtn" class="p-2 text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white rounded-full hover:bg-gray-100 dark:hover:bg-slate-700 transition">
                                <i class="far fa-bell"></i>
                            </button>
                            <span id="notificationCount" class="absolute -top-1 -right-1 bg-indigo-600 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center hidden">0</span>
                        </div>
                        
                        <div class="hidden md:flex items-center space-x-2 ml-2">
                            <img id="userAvatar" src="https://ui-avatars.com/api/?name=User&background=6366f1&color=fff&size=40" alt="User" class="w-10 h-10 rounded-full object-cover">
                            <div>
                                <p id="userName" class="text-sm font-medium text-gray-900 dark:text-white">Loading...</p>
                                <p id="userStatus" class="text-xs text-gray-500 dark:text-gray-400">Student</p>
                            </div>
                        </div>
                        
                        <!-- Mobile hamburger menu -->
                        <div class="md:hidden">
                            <div class="hamburger-menu" id="hamburgerMenu">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Search Bar -->
            <div class="md:hidden pb-4 mobile-search-container">
                <div class="relative">
                    <input type="text" id="mobileSearchInput" placeholder="Search products..." class="w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                </div>
                
                <!-- Mobile User Info -->
                <div class="mobile-user-info">
                    <img id="mobileNavUserAvatar" src="https://ui-avatars.com/api/?name=User&background=6366f1&color=fff&size=32" alt="User" class="w-8 h-8 rounded-full object-cover">
                    <div class="mobile-user-details">
                        <p id="mobileNavUserName" class="name">Loading...</p>
                        <p id="mobileNavUserStatus" class="status">Student</p>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-4">
        <!-- Home Dashboard -->
        <div id="homeDashboard" class="dashboard-section active">
            <!-- Hero Section with Carousel -->
            <section class="mb-6">
                <div class="carousel rounded-xl overflow-hidden">
                    <div class="carousel-inner">
                        <div class="carousel-item">
                            <img src="https://images.unsplash.com/photo-1563013544-824ae1b704d3?ixlib=rb-1.2.1&auto=format&fit=crop&w=1200&q=80" alt="Marketplace Banner" class="w-full h-auto">
                            <div class="carousel-caption">
                                <h2 class="responsive-heading font-bold">Welcome to kynecta Marketplace</h2>
                                <p class="responsive-subheading">Buy and sell within your community</p>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <img src="https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?ixlib=rb-1.2.1&auto=format&fit=crop&w=1200&q=80" alt="Hot Deals" class="w-full h-auto">
                            <div class="carousel-caption">
                                <h2 class="responsive-heading font-bold">Hot Deals</h2>
                                <p class="responsive-subheading">Check out our trending items with special discounts</p>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <img src="https://images.unsplash.com/photo-1560472354-b33ff0c44a43?ixlib=rb-1.2.1&auto=format&fit=crop&w=1200&q=80" alt="Flash Sale" class="w-full h-auto">
                            <div class="carousel-caption">
                                <h2 class="responsive-heading font-bold">Flash Sale</h2>
                                <p class="responsive-subheading">Limited time offers with countdown timer</p>
                                <div class="countdown-timer mt-2" id="flashSaleTimer">24:00:00</div>
                            </div>
                        </div>
                    </div>
                    <button class="carousel-control prev">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="carousel-control next">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </section>

            <!-- Stats Section -->
            <section class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6 stats-grid">
                <div class="glass-card p-4 text-center">
                    <div class="text-indigo-600 text-xl font-bold mb-1" id="activeListingsCount">0</div>
                    <div class="text-gray-600 dark:text-gray-400 text-sm">Active Listings</div>
                </div>
                <div class="glass-card p-4 text-center">
                    <div class="text-indigo-600 text-xl font-bold mb-1" id="totalUsersCount">0</div>
                    <div class="text-gray-600 dark:text-gray-400 text-sm">Users</div>
                </div>
                <div class="glass-card p-4 text-center">
                    <div class="text-indigo-600 text-xl font-bold mb-1" id="successfulSalesCount">0</div>
                    <div class="text-gray-600 dark:text-gray-400 text-sm">Successful Sales</div>
                </div>
                <div class="glass-card p-4 text-center">
                    <div class="text-indigo-600 text-xl font-bold mb-1" id="averageRatingCount">0.0</div>
                    <div class="text-gray-600 dark:text-gray-400 text-sm">Avg. Rating</div>
                </div>
            </section>

            <!-- Categories Section (Professional Style) -->
            <section class="mb-6">
                <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Categories</h2>
                <div class="category-grid">
                    <div class="category-card" data-category="electronics">
                        <div class="category-icon">
                            <i class="fas fa-laptop"></i>
                        </div>
                        <h3 class="category-name">Electronics</h3>
                        <p class="category-count">245 items</p>
                    </div>
                    
                    <div class="category-card" data-category="phones">
                        <div class="category-icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <h3 class="category-name">Phones & Tablets</h3>
                        <p class="category-count">189 items</p>
                    </div>
                    
                    <div class="category-card" data-category="fashion">
                        <div class="category-icon">
                            <i class="fas fa-tshirt"></i>
                        </div>
                        <h3 class="category-name">Fashion</h3>
                        <p class="category-count">312 items</p>
                    </div>
                    
                    <div class="category-card" data-category="home">
                        <div class="category-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <h3 class="category-name">Home & Office</h3>
                        <p class="category-count">156 items</p>
                    </div>
                    
                    <div class="category-card" data-category="books">
                        <div class="category-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <h3 class="category-name">Books & Media</h3>
                        <p class="category-count">98 items</p>
                    </div>
                    
                    <div class="category-card" data-category="sports">
                        <div class="category-icon">
                            <i class="fas fa-basketball-ball"></i>
                        </div>
                        <h3 class="category-name">Sports</h3>
                        <p class="category-count">76 items</p>
                    </div>
                </div>
            </section>

            <!-- Flash Sales Section (Jumia Style) -->
            <section class="mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-gray-900 dark:text-white">Flash Sales</h2>
                    <a href="#" class="text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 font-medium">See All</a>
                </div>
                <div class="flex items-center mb-4">
                    <span class="text-sm text-gray-600 dark:text-gray-400 mr-2">Ends in:</span>
                    <div class="countdown-timer" id="flashSaleCountdown">06h : 19m : 55s</div>
                </div>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 product-grid" id="flashSalesContainer">
                    <!-- Flash sale items will be loaded here -->
                    <div class="col-span-full text-center py-4">
                        <div class="loading-spinner mx-auto mb-2" style="width: 30px; height: 30px;"></div>
                        <p class="text-gray-500 dark:text-gray-400">Loading flash sales...</p>
                    </div>
                </div>
            </section>

            <!-- Trending Items Section -->
            <section class="mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-gray-900 dark:text-white">Trending Items</h2>
                    <a href="#" class="text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 font-medium">View All</a>
                </div>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 product-grid" id="trendingItemsContainer">
                    <div class="col-span-full text-center py-4">
                        <div class="loading-spinner mx-auto mb-2" style="width: 30px; height: 30px;"></div>
                        <p class="text-gray-500 dark:text-gray-400">Loading trending items...</p>
                    </div>
                </div>
            </section>

            <!-- Recommended For You -->
            <section class="mb-6">
                <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Recommended For You</h2>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 product-grid" id="recommendedContainer">
                    <div class="col-span-full text-center py-4">
                        <div class="loading-spinner mx-auto mb-2" style="width: 30px; height: 30px;"></div>
                        <p class="text-gray-500 dark:text-gray-400">Loading recommendations...</p>
                    </div>
                </div>
            </section>

            <!-- Recently Viewed (Jumia Style) -->
            <section class="mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-gray-900 dark:text-white">Recently Viewed</h2>
                    <button id="clearRecentlyViewed" class="text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 font-medium">Clear All</button>
                </div>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 product-grid" id="recentlyViewedContainer">
                    <!-- Recently viewed items will be loaded here -->
                    <div class="col-span-full text-center py-4">
                        <p class="text-gray-500 dark:text-gray-400">No recently viewed items</p>
                    </div>
                </div>
            </section>

            <!-- All Listings Section -->
            <section class="mb-8">
                <div class="flex flex-wrap justify-between items-center mb-6">
                    <div class="tab-buttons-container">
                        <div class="tab-buttons-scroll">
                            <button class="tab-button active" data-category="all">All Listings</button>
                            <button class="tab-button" data-category="electronics">Electronics</button>
                            <button class="tab-button" data-category="textbooks">Textbooks</button>
                            <button class="tab-button" data-category="furniture">Furniture</button>
                            <button class="tab-button" data-category="clothing">Clothing</button>
                            <button class="tab-button" data-category="services">Services</button>
                        </div>
                    </div>

                    <div class="flex items-center space-x-4 mt-4 md:mt-0">
                        <div class="flex items-center space-x-2">
                            <button id="gridViewBtn" class="p-2 border border-gray-300 dark:border-slate-600 rounded-lg text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white bg-indigo-50 dark:bg-indigo-900/20">
                                <i class="fas fa-th-large"></i>
                            </button>
                            <button id="listViewBtn" class="p-2 border border-gray-300 dark:border-slate-600 rounded-lg text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                        
                        <select id="sortFilter" class="border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                            <option value="price-low">Price: Low to High</option>
                            <option value="price-high">Price: High to Low</option>
                            <option value="popular">Most Popular</option>
                        </select>
                    </div>
                </div>

                <!-- Filters -->
                <div class="glass-card p-4 mb-6">
                    <div class="flex flex-col md:flex-row flex-wrap gap-4 items-start md:items-center filter-controls">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Price Range</label>
                            <div class="flex items-center space-x-2">
                                <input type="number" id="minPrice" placeholder="Min" class="w-20 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white rounded-lg px-3 py-1 focus:outline-none focus:ring-1 focus:ring-indigo-500">
                                <span class="text-gray-500">-</span>
                                <input type="number" id="maxPrice" placeholder="Max" class="w-20 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white rounded-lg px-3 py-1 focus:outline-none focus:ring-1 focus:ring-indigo-500">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Seller Rating</label>
                            <select id="sellerRatingFilter" class="border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white rounded-lg px-3 py-1 focus:outline-none focus:ring-1 focus:ring-indigo-500">
                                <option value="any">Any Rating</option>
                                <option value="4.5">4.5+ Stars</option>
                                <option value="4.0">4.0+ Stars</option>
                                <option value="3.5">3.5+ Stars</option>
                                <option value="3.0">3.0+ Stars</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Location</label>
                            <select id="locationFilter" class="border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white rounded-lg px-3 py-1 focus:outline-none focus:ring-1 focus:ring-indigo-500">
                                <option value="any">Any Location</option>
                                <option value="campus">On Campus</option>
                                <option value="downtown">Downtown</option>
                                <option value="suburbs">Suburbs</option>
                            </select>
                        </div>
                        
                        <div class="filter-buttons">
                            <button id="applyFilters" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition">Apply Filters</button>
                            <button id="clearFilters" class="bg-gray-300 dark:bg-slate-600 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg font-semibold hover:bg-gray-400 dark:hover:bg-slate-500 transition">Clear</button>
                        </div>
                    </div>
                </div>

                <!-- Product Grid/List -->
                <div id="listingsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 product-grid">
                    <div class="col-span-full text-center py-12">
                        <div class="loading-spinner mx-auto mb-4" style="width: 40px; height: 40px;"></div>
                        <p class="text-gray-500 dark:text-gray-400">Loading listings...</p>
                    </div>
                </div>

                <!-- Load More Button -->
                <div class="text-center mt-8">
                    <button id="loadMoreBtn" class="bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-300 px-6 py-3 rounded-lg font-semibold hover:bg-gray-50 dark:hover:bg-slate-700 transition hidden">
                        Load More Listings
                    </button>
                </div>
            </section>
        </div>

        <!-- Discover Dashboard -->
        <div id="discoverDashboard" class="dashboard-section">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Discover</h2>
                <div class="flex space-x-4">
                    <button id="refreshDiscover" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <div class="glass-card p-6 text-center cursor-pointer hover-lift" id="hotDealsCard">
                    <i class="fas fa-fire text-4xl text-red-500 mb-4"></i>
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Hot Deals</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-4">Discover the most popular items with special discounts</p>
                    <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition w-full">
                        Explore Hot Deals
                    </button>
                </div>
                
                <div class="glass-card p-6 text-center cursor-pointer hover-lift" id="topRatedCard">
                    <i class="fas fa-star text-4xl text-yellow-500 mb-4"></i>
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Top Rated</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-4">Find items with the highest ratings from our community</p>
                    <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition w-full">
                        View Top Rated
                    </button>
                </div>
                
                <div class="glass-card p-6 text-center cursor-pointer hover-lift" id="justAddedCard">
                    <i class="fas fa-bolt text-4xl text-purple-500 mb-4"></i>
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Just Added</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-4">Check out the newest listings in our marketplace</p>
                    <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition w-full">
                        See New Listings
                    </button>
                </div>
            </div>

            <div class="mb-8">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Featured Collections</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="glass-card p-4 text-center cursor-pointer hover-lift" data-category="electronics">
                        <img src="https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="Electronics" class="w-full h-32 object-cover rounded-lg mb-3">
                        <h4 class="font-semibold text-gray-900 dark:text-white">Electronics</h4>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Latest gadgets and devices</p>
                    </div>
                    
                    <div class="glass-card p-4 text-center cursor-pointer hover-lift" data-category="fashion">
                        <img src="https://images.unsplash.com/photo-1548036328-c9fa89d128fa?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="Fashion" class="w-full h-32 object-cover rounded-lg mb-3">
                        <h4 class="font-semibold text-gray-900 dark:text-white">Fashion</h4>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Trendy clothes and accessories</p>
                    </div>
                    
                    <div class="glass-card p-4 text-center cursor-pointer hover-lift" data-category="home">
                        <img src="https://images.unsplash.com/photo-1586023492125-27b2c045efd7?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="Home" class="w-full h-32 object-cover rounded-lg mb-3">
                        <h4 class="font-semibold text-gray-900 dark:text-white">Home & Living</h4>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Furniture and home essentials</p>
                    </div>
                    
                    <div class="glass-card p-4 text-center cursor-pointer hover-lift" data-category="books">
                        <img src="https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="Books" class="w-full h-32 object-cover rounded-lg mb-3">
                        <h4 class="font-semibold text-gray-900 dark:text-white">Books & Media</h4>
                        <p class="text-sm text-gray-600 dark:text-gray-400">Textbooks and entertainment</p>
                    </div>
                </div>
            </div>

            <div>
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Discover New Items</h3>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 product-grid" id="discoverItemsContainer">
                    <div class="col-span-full text-center py-8">
                        <div class="loading-spinner mx-auto mb-4" style="width: 40px; height: 40px;"></div>
                        <p class="text-gray-500 dark:text-gray-400">Loading discovery items...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Categories Dashboard -->
        <div id="categoriesDashboard" class="dashboard-section">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">All Categories</h2>
                <div class="relative">
                    <input type="text" id="categorySearch" placeholder="Search categories..." class="pl-10 pr-4 py-2 border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent w-64">
                    <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                </div>
            </div>

            <div class="category-grid mb-8">
                <div class="category-card" data-category="electronics">
                    <div class="category-icon">
                        <i class="fas fa-laptop"></i>
                    </div>
                    <h3 class="category-name">Electronics</h3>
                    <p class="category-count">245 items</p>
                </div>
                
                <div class="category-card" data-category="phones">
                    <div class="category-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <h3 class="category-name">Phones & Tablets</h3>
                    <p class="category-count">189 items</p>
                </div>
                
                <div class="category-card" data-category="fashion">
                    <div class="category-icon">
                        <i class="fas fa-tshirt"></i>
                    </div>
                    <h3 class="category-name">Fashion</h3>
                    <p class="category-count">312 items</p>
                </div>
                
                <div class="category-card" data-category="home">
                    <div class="category-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <h3 class="category-name">Home & Office</h3>
                    <p class="category-count">156 items</p>
                </div>
                
                <div class="category-card" data-category="health">
                    <div class="category-icon">
                        <i class="fas fa-heartbeat"></i>
                    </div>
                    <h3 class="category-name">Health & Beauty</h3>
                    <p class="category-count">98 items</p>
                </div>
                
                <div class="category-card" data-category="sports">
                    <div class="category-icon">
                        <i class="fas fa-basketball-ball"></i>
                    </div>
                    <h3 class="category-name">Sports</h3>
                    <p class="category-count">76 items</p>
                </div>
                
                <div class="category-card" data-category="books">
                    <div class="category-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <h3 class="category-name">Books & Media</h3>
                    <p class="category-count">134 items</p>
                </div>
                
                <div class="category-card" data-category="gaming">
                    <div class="category-icon">
                        <i class="fas fa-gamepad"></i>
                    </div>
                    <h3 class="category-name">Gaming</h3>
                    <p class="category-count">87 items</p>
                </div>
                
                <div class="category-card" data-category="automotive">
                    <div class="category-icon">
                        <i class="fas fa-car"></i>
                    </div>
                    <h3 class="category-name">Automotive</h3>
                    <p class="category-count">54 items</p>
                </div>
                
                <div class="category-card" data-category="pets">
                    <div class="category-icon">
                        <i class="fas fa-paw"></i>
                    </div>
                    <h3 class="category-name">Pets</h3>
                    <p class="category-count">43 items</p>
                </div>
                
                <div class="category-card" data-category="baby">
                    <div class="category-icon">
                        <i class="fas fa-baby"></i>
                    </div>
                    <h3 class="category-name">Baby Products</h3>
                    <p class="category-count">32 items</p>
                </div>
                
                <div class="category-card" data-category="grocery">
                    <div class="category-icon">
                        <i class="fas fa-shopping-basket"></i>
                    </div>
                    <h3 class="category-name">Grocery</h3>
                    <p class="category-count">67 items</p>
                </div>
            </div>

            <div>
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Popular in Categories</h3>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 product-grid" id="categoryItemsContainer">
                    <div class="col-span-full text-center py-8">
                        <div class="loading-spinner mx-auto mb-4" style="width: 40px; height: 40px;"></div>
                        <p class="text-gray-500 dark:text-gray-400">Select a category to view items</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sellers Dashboard -->
        <div id="sellersDashboard" class="dashboard-section">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Top Sellers</h2>
                <div class="flex space-x-4">
                    <button id="refreshSellers" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8" id="sellersContainer">
                <div class="col-span-full text-center py-8">
                    <div class="loading-spinner mx-auto mb-4" style="width: 40px; height: 40px;"></div>
                    <p class="text-gray-500 dark:text-gray-400">Loading sellers...</p>
                </div>
            </div>

            <div>
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Seller Statistics</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                    <div class="glass-card p-4 text-center">
                        <div class="text-indigo-600 text-xl font-bold mb-1" id="totalSellersCount">0</div>
                        <div class="text-gray-600 dark:text-gray-400 text-sm">Total Sellers</div>
                    </div>
                    <div class="glass-card p-4 text-center">
                        <div class="text-indigo-600 text-xl font-bold mb-1" id="verifiedSellersCount">0</div>
                        <div class="text-gray-600 dark:text-gray-400 text-sm">Verified Sellers</div>
                    </div>
                    <div class="glass-card p-4 text-center">
                        <div class="text-indigo-600 text-xl font-bold mb-1" id="activeSellersCount">0</div>
                        <div class="text-gray-600 dark:text-gray-400 text-sm">Active Sellers</div>
                    </div>
                    <div class="glass-card p-4 text-center">
                        <div class="text-indigo-600 text-xl font-bold mb-1" id="topRatedSellersCount">0</div>
                        <div class="text-gray-600 dark:text-gray-400 text-sm">Top Rated Sellers</div>
                    </div>
                </div>
            </div>

            <div>
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Recently Joined Sellers</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="recentSellersContainer">
                    <div class="col-span-full text-center py-8">
                        <p class="text-gray-500 dark:text-gray-400">No recent sellers to display</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation (Jumia Style) -->
    <div class="bottom-nav md:hidden">
        <a href="home.html" class="bottom-nav-item">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="#" class="bottom-nav-item" data-section="categories">
            <i class="fas fa-th-large"></i>
            <span>Categories</span>
        </a>
        <a href="#" class="bottom-nav-item" data-section="discover">
            <i class="fas fa-compass"></i>
            <span>Discover</span>
        </a>
        <a href="#" class="bottom-nav-item" data-section="sellers">
            <i class="fas fa-store"></i>
            <span>Sellers</span>
        </a>
        <a href="profile.html" class="bottom-nav-item">
            <i class="fas fa-user"></i>
            <span>Account</span>
        </a>
    </div>

    <!-- Create Listing Modal -->
    <div id="createListingModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Create New Listing</h2>
                <button id="closeCreateModal" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="createListingForm">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Product Title *</label>
                    <input type="text" id="listingTitle" class="w-full border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="e.g. Calculus Textbook 8th Edition" required>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Description *</label>
                    <textarea rows="4" id="listingDescription" class="w-full border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Describe your item..." required></textarea>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Price ($) *</label>
                        <input type="number" id="listingPrice" class="w-full border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="0.00" min="0" step="0.01" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Category *</label>
                        <select id="listingCategory" class="w-full border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="electronics">Electronics</option>
                            <option value="textbooks">Textbooks</option>
                            <option value="furniture">Furniture</option>
                            <option value="clothing">Clothing</option>
                            <option value="services">Services</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Condition *</label>
                    <div class="flex flex-wrap gap-4">
                        <label class="flex items-center">
                            <input type="radio" name="condition" value="new" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500" checked>
                            <span class="ml-2 text-gray-700 dark:text-gray-300">New</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="condition" value="like-new" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500">
                            <span class="ml-2 text-gray-700 dark:text-gray-300">Like New</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="condition" value="good" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500">
                            <span class="ml-2 text-gray-700 dark:text-gray-300">Good</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="condition" value="fair" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500">
                            <span class="ml-2 text-gray-700 dark:text-gray-300">Fair</span>
                        </label>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tags</label>
                    <input type="text" id="listingTags" class="w-full border border-gray-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent" placeholder="Add tags (comma separated)">
                    <div id="tagSuggestions" class="mt-2">
                        <!-- Tag suggestions will appear here -->
                    </div>
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Product Images</label>
                    <div class="image-upload-area" id="imageUploadArea">
                        <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                        <p class="text-gray-600 dark:text-gray-400 mb-2">Drag & drop images here or click to browse</p>
                        <button type="button" id="browseImagesBtn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition">Browse Files</button>
                        <input type="file" id="listingImages" multiple accept="image/*" class="hidden">
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">JPEG, PNG up to 5MB each. Max 8 images.</p>
                    </div>
                    <div id="imagePreview" class="image-preview mt-4">
                        <!-- Image previews will appear here -->
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row justify-end space-y-4 sm:space-y-0 sm:space-x-4">
                    <button type="button" id="cancelCreateListing" class="bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-300 px-6 py-3 rounded-lg font-semibold hover:bg-gray-50 dark:hover:bg-slate-700 transition">Cancel</button>
                    <button type="submit" class="bg-indigo-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-indigo-700 transition flex items-center justify-center space-x-2">
                        <i class="fas fa-plus"></i>
                        <span id="createListingBtnText">Create Listing</span>
                        <div id="createListingSpinner" class="loading-spinner hidden"></div>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Cart Modal -->
    <div id="cartModal" class="modal">
        <div class="modal-content max-w-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Your Cart</h2>
                <button id="closeCartModal" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="cartContent">
                <div class="text-center py-12">
                    <i class="fas fa-shopping-cart text-4xl text-gray-400 mb-4"></i>
                    <h3 class="text-xl font-bold text-gray-700 dark:text-gray-300 mb-2">Your cart is empty</h3>
                    <p class="text-gray-500 dark:text-gray-400">Add some items to get started</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div id="notificationsModal" class="modal">
        <div class="modal-content max-w-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Notifications</h2>
                <button id="closeNotificationsModal" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="notificationsContent">
                <div class="text-center py-12">
                    <i class="far fa-bell text-4xl text-gray-400 mb-4"></i>
                    <h3 class="text-xl font-bold text-gray-700 dark:text-gray-300 mb-2">No notifications</h3>
                    <p class="text-gray-500 dark:text-gray-400">You're all caught up!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- More Categories Modal -->
    <div id="moreCategoriesModal" class="modal">
        <div class="modal-content max-w-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">All Categories</h2>
                <button id="closeMoreCategoriesModal" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4" id="moreCategoriesContent">
                <!-- More categories will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notificationToast" class="notification">
        <div class="flex justify-between items-start">
            <div>
                <div id="notificationToastTitle" class="font-semibold"></div>
                <div id="notificationToastMessage" class="text-sm mt-1"></div>
            </div>
            <button id="closeNotificationToast" class="text-gray-500 hover:text-gray-700 ml-4">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDHHyGgsSV18BcXrGgzi4C8frzDAE1C1zo",
            authDomain: "uniconnect-ee95c.firebaseapp.com",
            projectId: "uniconnect-ee95c",
            storageBucket: "uniconnect-ee95c.firebasestorage.app",
            messagingSenderId: "1003264444309",
            appId: "1:1003264444309:web:9f0307516e44d21e97d89c"
        };

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            console.log(" Firebase initialized successfully");
        } catch (error) {
            console.error(" Firebase initialization error:", error);
        }

        // Firebase services
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Global variables
        let currentUser = null;
        let userData = null;
        let selectedImages = [];
        let currentView = 'grid';
        let currentCategory = 'all';
        let currentSort = 'newest';
        let allListings = [];
        let filteredListings = [];
        let displayedCount = 0;
        const listingsPerPage = 12;
        let lastVisible = null;
        let hasMoreListings = true;
        let currentDashboard = 'home';
        let currentMood = 'happy';

        // DOM Elements
        const homeDashboard = document.getElementById('homeDashboard');
        const discoverDashboard = document.getElementById('discoverDashboard');
        const categoriesDashboard = document.getElementById('categoriesDashboard');
        const sellersDashboard = document.getElementById('sellersDashboard');
        const listingsContainer = document.getElementById('listingsContainer');
        const trendingItemsContainer = document.getElementById('trendingItemsContainer');
        const recommendedContainer = document.getElementById('recommendedContainer');
        const flashSalesContainer = document.getElementById('flashSalesContainer');
        const recentlyViewedContainer = document.getElementById('recentlyViewedContainer');
        const discoverItemsContainer = document.getElementById('discoverItemsContainer');
        const categoryItemsContainer = document.getElementById('categoryItemsContainer');
        const sellersContainer = document.getElementById('sellersContainer');
        const recentSellersContainer = document.getElementById('recentSellersContainer');
        const createListingBtn = document.getElementById('createListingBtn');
        const createListingModal = document.getElementById('createListingModal');
        const closeCreateModal = document.getElementById('closeCreateModal');
        const cancelCreateListing = document.getElementById('cancelCreateListing');
        const createListingForm = document.getElementById('createListingForm');
        const browseImagesBtn = document.getElementById('browseImagesBtn');
        const listingImages = document.getElementById('listingImages');
        const imagePreview = document.getElementById('imagePreview');
        const imageUploadArea = document.getElementById('imageUploadArea');
        const searchInput = document.getElementById('searchInput');
        const mobileSearchInput = document.getElementById('mobileSearchInput');
        const searchSuggestions = document.getElementById('searchSuggestions');
        const gridViewBtn = document.getElementById('gridViewBtn');
        const listViewBtn = document.getElementById('listViewBtn');
        const sortFilter = document.getElementById('sortFilter');
        const minPrice = document.getElementById('minPrice');
        const maxPrice = document.getElementById('maxPrice');
        const sellerRatingFilter = document.getElementById('sellerRatingFilter');
        const locationFilter = document.getElementById('locationFilter');
        const applyFilters = document.getElementById('applyFilters');
        const clearFilters = document.getElementById('clearFilters');
        const loadMoreBtn = document.getElementById('loadMoreBtn');
        const themeToggle = document.getElementById('themeToggle');
        const userAvatar = document.getElementById('userAvatar');
        const mobileUserAvatar = document.getElementById('mobileUserAvatar');
        const mobileNavUserAvatar = document.getElementById('mobileNavUserAvatar');
        const userName = document.getElementById('userName');
        const mobileUserName = document.getElementById('mobileUserName');
        const mobileNavUserName = document.getElementById('mobileNavUserName');
        const userStatus = document.getElementById('userStatus');
        const mobileUserStatus = document.getElementById('mobileUserStatus');
        const mobileNavUserStatus = document.getElementById('mobileNavUserStatus');
        const activeListingsCount = document.getElementById('activeListingsCount');
        const totalUsersCount = document.getElementById('totalUsersCount');
        const successfulSalesCount = document.getElementById('successfulSalesCount');
        const averageRatingCount = document.getElementById('averageRatingCount');
        const totalSellersCount = document.getElementById('totalSellersCount');
        const verifiedSellersCount = document.getElementById('verifiedSellersCount');
        const activeSellersCount = document.getElementById('activeSellersCount');
        const topRatedSellersCount = document.getElementById('topRatedSellersCount');
        const flashSaleTimer = document.getElementById('flashSaleTimer');
        const flashSaleCountdown = document.getElementById('flashSaleCountdown');
        const tagSuggestions = document.getElementById('tagSuggestions');
        const listingTitle = document.getElementById('listingTitle');
        const listingTags = document.getElementById('listingTags');
        const cartBtn = document.getElementById('cartBtn');
        const cartModal = document.getElementById('cartModal');
        const closeCartModal = document.getElementById('closeCartModal');
        const cartContent = document.getElementById('cartContent');
        const cartCount = document.getElementById('cartCount');
        const notificationBtn = document.getElementById('notificationBtn');
        const notificationsModal = document.getElementById('notificationsModal');
        const closeNotificationsModal = document.getElementById('closeNotificationsModal');
        const notificationsContent = document.getElementById('notificationsContent');
        const notificationCount = document.getElementById('notificationCount');
        const notificationToast = document.getElementById('notificationToast');
        const closeNotificationToast = document.getElementById('closeNotificationToast');
        const notificationToastTitle = document.getElementById('notificationToastTitle');
        const notificationToastMessage = document.getElementById('notificationToastMessage');
        const createListingBtnText = document.getElementById('createListingBtnText');
        const createListingSpinner = document.getElementById('createListingSpinner');
        const hamburgerMenu = document.getElementById('hamburgerMenu');
        const mobileMenu = document.getElementById('mobileMenu');
        const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
        const closeMobileMenu = document.getElementById('closeMobileMenu');
        const mobileLogoutBtn = document.getElementById('mobileLogoutBtn');
        const clearRecentlyViewed = document.getElementById('clearRecentlyViewed');
        const moreCategories = document.getElementById('moreCategories');
        const moreCategoriesModal = document.getElementById('moreCategoriesModal');
        const closeMoreCategoriesModal = document.getElementById('closeMoreCategoriesModal');
        const moreCategoriesContent = document.getElementById('moreCategoriesContent');
        const refreshDiscover = document.getElementById('refreshDiscover');
        const refreshSellers = document.getElementById('refreshSellers');
        const categorySearch = document.getElementById('categorySearch');
        const hotDealsCard = document.getElementById('hotDealsCard');
        const topRatedCard = document.getElementById('topRatedCard');
        const justAddedCard = document.getElementById('justAddedCard');

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log(' kynecta Marketplace loaded');
            
            // Check authentication
            auth.onAuthStateChanged(handleAuthStateChange);
            
            // Setup event listeners
            setupEventListeners();
            
            // Initialize carousel
            initCarousel();
            
            // Initialize theme
            initTheme();
            
            // Initialize mood
            initMood();
            
            // Start flash sale timer
            startFlashSaleTimer();
            startFlashSaleCountdown();
        });

        // Handle authentication state changes
        async function handleAuthStateChange(user) {
            if (user) {
                currentUser = user;
                console.log(' User authenticated:', user.uid);
                await loadUserData(user.uid);
                await loadMarketplaceData();
                updateUserUI();
                loadCartCount();
                loadNotificationCount();
            } else {
                console.log(' No user signed in');
                window.location.href = 'index.html';
            }
        }

        // Load current user's data from Firestore
        async function loadUserData(uid) {
            try {
                const userDoc = await db.collection('users').doc(uid).get();
                if (userDoc.exists) {
                    userData = userDoc.data();
                    console.log(' User data loaded:', userData);
                } else {
                    // Create user document if it doesn't exist
                    userData = {
                        name: currentUser.displayName || 'User',
                        email: currentUser.email,
                        avatar: currentUser.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(currentUser.displayName || 'User')}&background=6366f1&color=fff&size=150`,
                        status: 'student',
                        university: 'Unknown University',
                        joined: new Date(),
                        rating: 5.0,
                        listings: 0,
                        sales: 0,
                        verified: false
                    };
                    await db.collection('users').doc(uid).set(userData);
                }
            } catch (error) {
                console.error(' Error loading user data:', error);
                showToast('Error loading user data', 'error');
            }
        }

        // Load marketplace data
        async function loadMarketplaceData() {
            try {
                await loadStats();
                await loadListings();
                await loadTrendingItems();
                await loadRecommendedItems();
                await loadFlashSales();
                await loadRecentlyViewed();
                await loadMoreCategories();
                await loadDiscoverItems();
                await loadSellers();
            } catch (error) {
                console.error(' Error loading marketplace data:', error);
                showToast('Error loading marketplace data', 'error');
            }
        }

        // Load marketplace stats
        async function loadStats() {
            try {
                // Active listings count
                const activeListingsQuery = await db.collection('listings')
                    .where('status', '==', 'active')
                    .get();
                activeListingsCount.textContent = activeListingsQuery.size;
                
                // Total users count
                const usersQuery = await db.collection('users').get();
                totalUsersCount.textContent = usersQuery.size;
                
                // Successful sales count
                const salesQuery = await db.collection('transactions')
                    .where('status', '==', 'completed')
                    .get();
                successfulSalesCount.textContent = salesQuery.size;
                
                // Average rating (calculate from users)
                let totalRating = 0;
                let userCount = 0;
                usersQuery.forEach(doc => {
                    const user = doc.data();
                    if (user.rating) {
                        totalRating += user.rating;
                        userCount++;
                    }
                });
                const avgRating = userCount > 0 ? (totalRating / userCount).toFixed(1) : '0.0';
                averageRatingCount.textContent = avgRating;
                
                // Seller stats
                const sellersQuery = await db.collection('users')
                    .where('listings', '>', 0)
                    .get();
                
                totalSellersCount.textContent = sellersQuery.size;
                
                let verifiedCount = 0;
                let activeCount = 0;
                let topRatedCount = 0;
                
                sellersQuery.forEach(doc => {
                    const seller = doc.data();
                    if (seller.verified) verifiedCount++;
                    if (seller.listings > 0) activeCount++;
                    if (seller.rating >= 4.5) topRatedCount++;
                });
                
                verifiedSellersCount.textContent = verifiedCount;
                activeSellersCount.textContent = activeCount;
                topRatedSellersCount.textContent = topRatedCount;
                
            } catch (error) {
                console.error(' Error loading stats:', error);
            }
        }

        // Load listings from Firestore
        async function loadListings() {
            try {
                listingsContainer.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="loading-spinner mx-auto mb-4" style="width: 40px; height: 40px;"></div>
                        <p class="text-gray-500 dark:text-gray-400">Loading listings...</p>
                    </div>
                `;

                const query = db.collection('listings')
                    .where('status', '==', 'active')
                    .orderBy('createdAt', 'desc')
                    .limit(listingsPerPage);

                const querySnapshot = await query.get();
                
                allListings = [];
                querySnapshot.forEach(doc => {
                    const listing = doc.data();
                    listing.id = doc.id;
                    allListings.push(listing);
                });

                lastVisible = querySnapshot.docs[querySnapshot.docs.length - 1];
                hasMoreListings = querySnapshot.docs.length === listingsPerPage;

                console.log(` Loaded ${allListings.length} listings`);
                
                filteredListings = [...allListings];
                displayedCount = 0;
                displayListings();

            } catch (error) {
                console.error(' Error loading listings:', error);
                listingsContainer.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
                        <h3 class="text-xl font-bold text-gray-700 dark:text-gray-300 mb-2">Error Loading Listings</h3>
                        <p class="text-gray-500 dark:text-gray-400">Please try refreshing the page</p>
                    </div>
                `;
            }
        }

        // Load flash sales
        async function loadFlashSales() {
            try {
                const querySnapshot = await db.collection('listings')
                    .where('status', '==', 'active')
                    .where('isFlashSale', '==', true)
                    .limit(4)
                    .get();

                flashSalesContainer.innerHTML = '';

                if (querySnapshot.empty) {
                    flashSalesContainer.innerHTML = `
                        <div class="col-span-full text-center py-8">
                            <i class="fas fa-bolt text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-500 dark:text-gray-400">No flash sales at the moment</p>
                        </div>
                    `;
                    return;
                }

                querySnapshot.forEach(doc => {
                    const listing = doc.data();
                    listing.id = doc.id;
                    const productCard = createJumiaProductCard(listing);
                    flashSalesContainer.appendChild(productCard);
                });

            } catch (error) {
                console.error(' Error loading flash sales:', error);
                flashSalesContainer.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
                        <p class="text-gray-500 dark:text-gray-400">Error loading flash sales</p>
                    </div>
                `;
            }
        }

        // Load recently viewed items
        async function loadRecentlyViewed() {
            try {
                if (!currentUser) return;
                
                const querySnapshot = await db.collection('recentlyViewed')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('viewedAt', 'desc')
                    .limit(4)
                    .get();

                recentlyViewedContainer.innerHTML = '';

                if (querySnapshot.empty) {
                    recentlyViewedContainer.innerHTML = `
                        <div class="col-span-full text-center py-8">
                            <p class="text-gray-500 dark:text-gray-400">No recently viewed items</p>
                        </div>
                    `;
                    return;
                }

                const listingIds = [];
                querySnapshot.forEach(doc => {
                    listingIds.push(doc.data().listingId);
                });

                // Fetch the actual listings
                const listingsPromises = listingIds.map(id => 
                    db.collection('listings').doc(id).get()
                );
                
                const listingsSnapshots = await Promise.all(listingsPromises);
                
                listingsSnapshots.forEach(doc => {
                    if (doc.exists) {
                        const listing = doc.data();
                        listing.id = doc.id;
                        const productCard = createJumiaProductCard(listing);
                        recentlyViewedContainer.appendChild(productCard);
                    }
                });

            } catch (error) {
                console.error(' Error loading recently viewed:', error);
                recentlyViewedContainer.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
                        <p class="text-gray-500 dark:text-gray-400">Error loading recently viewed</p>
                    </div>
                `;
            }
        }

        // Load more categories
        async function loadMoreCategories() {
            try {
                const categories = [
                    { name: 'Baby Products', icon: 'fas fa-baby', category: 'baby' },
                    { name: 'Sporting Goods', icon: 'fas fa-basketball-ball', category: 'sports' },
                    { name: 'Supermarket', icon: 'fas fa-shopping-basket', category: 'supermarket' },
                    { name: 'Automotive', icon: 'fas fa-car', category: 'automotive' },
                    { name: 'Books & Media', icon: 'fas fa-book', category: 'books' },
                    { name: 'Pets', icon: 'fas fa-paw', category: 'pets' }
                ];

                moreCategoriesContent.innerHTML = '';
                
                categories.forEach(cat => {
                    const categoryItem = document.createElement('div');
                    categoryItem.className = 'jumia-category-item';
                    categoryItem.setAttribute('data-category', cat.category);
                    
                    categoryItem.innerHTML = `
                        <div class="jumia-category-icon">
                            <i class="${cat.icon} text-indigo-600"></i>
                        </div>
                        <span class="jumia-category-name">${cat.name}</span>
                    `;
                    
                    categoryItem.addEventListener('click', () => {
                        filterByCategory(cat.category);
                        closeMoreCategoriesModalFunc();
                    });
                    
                    moreCategoriesContent.appendChild(categoryItem);
                });
            } catch (error) {
                console.error(' Error loading more categories:', error);
            }
        }

        // Load discover items
        async function loadDiscoverItems() {
            try {
                // Get random listings for discovery
                const querySnapshot = await db.collection('listings')
                    .where('status', '==', 'active')
                    .limit(8)
                    .get();

                discoverItemsContainer.innerHTML = '';

                if (querySnapshot.empty) {
                    discoverItemsContainer.innerHTML = `
                        <div class="col-span-full text-center py-8">
                            <i class="fas fa-compass text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-500 dark:text-gray-400">No items to discover yet</p>
                        </div>
                    `;
                    return;
                }

                const listings = [];
                querySnapshot.forEach(doc => {
                    const listing = doc.data();
                    listing.id = doc.id;
                    listings.push(listing);
                });

                // Shuffle array for random discovery
                const shuffled = listings.sort(() => 0.5 - Math.random());
                shuffled.forEach(listing => {
                    const productCard = createJumiaProductCard(listing);
                    discoverItemsContainer.appendChild(productCard);
                });

            } catch (error) {
                console.error(' Error loading discover items:', error);
                discoverItemsContainer.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
                        <p class="text-gray-500 dark:text-gray-400">Error loading discovery items</p>
                    </div>
                `;
            }
        }

        // Load sellers
        async function loadSellers() {
            try {
                const querySnapshot = await db.collection('users')
                    .where('listings', '>', 0)
                    .orderBy('listings', 'desc')
                    .limit(6)
                    .get();

                sellersContainer.innerHTML = '';
                recentSellersContainer.innerHTML = '';

                if (querySnapshot.empty) {
                    sellersContainer.innerHTML = `
                        <div class="col-span-full text-center py-8">
                            <i class="fas fa-store text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-500 dark:text-gray-400">No sellers found</p>
                        </div>
                    `;
                    return;
                }

                querySnapshot.forEach(doc => {
                    const seller = doc.data();
                    seller.id = doc.id;
                    const sellerCard = createSellerCard(seller);
                    sellersContainer.appendChild(sellerCard);
                    
                    // Also add to recent sellers (for demo)
                    const recentSellerCard = createSellerCard(seller);
                    recentSellersContainer.appendChild(recentSellerCard);
                });

            } catch (error) {
                console.error(' Error loading sellers:', error);
                sellersContainer.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
                        <p class="text-gray-500 dark:text-gray-400">Error loading sellers</p>
                    </div>
                `;
            }
        }

        // Load more listings
        async function loadMoreListings() {
            if (!hasMoreListings) return;

            loadMoreBtn.disabled = true;
            loadMoreBtn.innerHTML = '<div class="loading-spinner mx-auto"></div>';

            try {
                const query = db.collection('listings')
                    .where('status', '==', 'active')
                    .orderBy('createdAt', 'desc')
                    .startAfter(lastVisible)
                    .limit(listingsPerPage);

                const querySnapshot = await query.get();
                
                const newListings = [];
                querySnapshot.forEach(doc => {
                    const listing = doc.data();
                    listing.id = doc.id;
                    newListings.push(listing);
                });

                allListings = [...allListings, ...newListings];
                lastVisible = querySnapshot.docs[querySnapshot.docs.length - 1];
                hasMoreListings = querySnapshot.docs.length === listingsPerPage;

                filteredListings = [...allListings];
                displayListings(true);

            } catch (error) {
                console.error(' Error loading more listings:', error);
                showToast('Error loading more listings', 'error');
            }

            loadMoreBtn.disabled = false;
            loadMoreBtn.textContent = 'Load More Listings';
        }

        // Load trending items (most viewed listings)
        async function loadTrendingItems() {
            try {
                const querySnapshot = await db.collection('listings')
                    .where('status', '==', 'active')
                    .orderBy('views', 'desc')
                    .limit(4)
                    .get();

                trendingItemsContainer.innerHTML = '';

                if (querySnapshot.empty) {
                    trendingItemsContainer.innerHTML = `
                        <div class="col-span-full text-center py-8">
                            <i class="fas fa-chart-line text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-500 dark:text-gray-400">No trending items yet</p>
                        </div>
                    `;
                    return;
                }

                querySnapshot.forEach(doc => {
                    const listing = doc.data();
                    listing.id = doc.id;
                    const productCard = createJumiaProductCard(listing);
                    trendingItemsContainer.appendChild(productCard);
                });

            } catch (error) {
                console.error(' Error loading trending items:', error);
                trendingItemsContainer.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
                        <p class="text-gray-500 dark:text-gray-400">Error loading trending items</p>
                    </div>
                `;
            }
        }

        // Load recommended items (based on user preferences)
        async function loadRecommendedItems() {
            try {
                // For now, show random active listings
                const querySnapshot = await db.collection('listings')
                    .where('status', '==', 'active')
                    .limit(4)
                    .get();

                recommendedContainer.innerHTML = '';

                if (querySnapshot.empty) {
                    recommendedContainer.innerHTML = `
                        <div class="col-span-full text-center py-8">
                            <i class="fas fa-star text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-500 dark:text-gray-400">No recommendations available</p>
                        </div>
                    `;
                    return;
                }

                const listings = [];
                querySnapshot.forEach(doc => {
                    const listing = doc.data();
                    listing.id = doc.id;
                    listings.push(listing);
                });

                // Shuffle array for random recommendations
                const shuffled = listings.sort(() => 0.5 - Math.random());
                shuffled.slice(0, 4).forEach(listing => {
                    const productCard = createJumiaProductCard(listing);
                    recommendedContainer.appendChild(productCard);
                });

            } catch (error) {
                console.error(' Error loading recommended items:', error);
                recommendedContainer.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
                        <p class="text-gray-500 dark:text-gray-400">Error loading recommendations</p>
                    </div>
                `;
            }
        }

        // Display listings in the container
        function displayListings(append = false) {
            const listingsToShow = filteredListings.slice(displayedCount, displayedCount + listingsPerPage);
            
            if (!append) {
                listingsContainer.innerHTML = '';
            }
            
            if (listingsToShow.length === 0 && !append) {
                listingsContainer.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-search text-4xl text-gray-400 mb-4"></i>
                        <h3 class="text-xl font-bold text-gray-700 dark:text-gray-300 mb-2">No listings found</h3>
                        <p class="text-gray-500 dark:text-gray-400">Try adjusting your filters or search terms</p>
                    </div>
                `;
                loadMoreBtn.classList.add('hidden');
                return;
            }
            
            listingsToShow.forEach(listing => {
                const productCard = createProductCard(listing);
                listingsContainer.appendChild(productCard);
            });
            
            displayedCount += listingsToShow.length;
            
            // Show/hide load more button
            if (displayedCount >= filteredListings.length || !hasMoreListings) {
                loadMoreBtn.classList.add('hidden');
            } else {
                loadMoreBtn.classList.remove('hidden');
            }
        }

        // Create product card HTML (Jumia style)
        function createJumiaProductCard(listing) {
            const imageUrl = listing.images && listing.images.length > 0 
                ? listing.images[0] 
                : 'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80';
            
            // Calculate discount if original price exists
            const originalPrice = listing.originalPrice || listing.price * 1.5;
            const discount = Math.round(((originalPrice - listing.price) / originalPrice) * 100);
            
            const card = document.createElement('div');
            card.className = 'jumia-product-card fade-in';
            card.setAttribute('data-listing-id', listing.id);
            
            card.innerHTML = `
                ${listing.isFlashSale ? '<div class="jumia-express-badge">FLASH SALE</div>' : ''}
                <img src="${imageUrl}" alt="${listing.title}" class="jumia-product-image">
                <h3 class="jumia-product-name">${listing.title}</h3>
                <div class="jumia-product-price">$${listing.price.toFixed(2)}</div>
                <div class="flex justify-between items-center">
                    <div class="jumia-product-original-price">$${originalPrice.toFixed(2)}</div>
                    <div class="jumia-product-discount">-${discount}%</div>
                </div>
                <div class="jumia-rating">
                    <i class="fas fa-star text-yellow-400 mr-1"></i>
                    <span>${listing.rating || '4.5'}</span>
                    <span class="mx-1"></span>
                    <span>${listing.reviewCount || '0'} reviews</span>
                </div>
                ${listing.isExpress ? '<div class="jumia-express-badge mt-2">EXPRESS</div>' : ''}
            `;
            
            // Add click event to view listing
            card.addEventListener('click', () => {
                viewListing(listing.id);
            });
            
            return card;
        }

        // Create product card HTML (original style)
        function createProductCard(listing, isSmall = false) {
            const listingDate = listing.createdAt ? new Date(listing.createdAt.seconds * 1000).toLocaleDateString() : 'Recently';
            const imageUrl = listing.images && listing.images.length > 0 
                ? listing.images[0] 
                : 'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80';
            
            const card = document.createElement('div');
            card.className = `product-card glass-card rounded-xl overflow-hidden hover-lift fade-in ${currentView === 'list' ? 'list-view' : ''}`;
            card.setAttribute('data-listing-id', listing.id);
            
            card.innerHTML = `
                <div class="relative ${isSmall ? 'h-40' : 'h-48'} overflow-hidden">
                    <img src="${imageUrl}" alt="${listing.title}" class="w-full h-full object-cover primary-image">
                    
                    ${listing.isHotDeal ? `<div class="hot-deal-badge">HOT DEAL</div>` : ''}
                    
                    <div class="quick-actions">
                        <button class="quick-action-btn favorite-btn" data-listing-id="${listing.id}">
                            <i class="far fa-heart"></i>
                        </button>
                        <button class="quick-action-btn view-btn" data-listing-id="${listing.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div class="p-4 product-details">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-semibold text-gray-900 dark:text-white line-clamp-2 flex-1">${listing.title}</h3>
                        <span class="text-indigo-600 dark:text-indigo-400 font-bold ml-2 price">$${listing.price.toFixed(2)}</span>
                    </div>
                    
                    <div class="flex items-center mb-2 seller-info">
                        <img src="${listing.sellerAvatar || 'https://ui-avatars.com/api/?name=Seller&background=6366f1&color=fff&size=32'}" 
                             alt="${listing.sellerName}" 
                             class="w-6 h-6 rounded-full object-cover mr-2">
                        <span class="text-sm text-gray-600 dark:text-gray-400">${listing.sellerName}</span>
                        ${listing.sellerVerified ? '<span class="verified-badge"><i class="fas fa-check mr-1"></i>Verified</span>' : ''}
                    </div>
                    
                    <p class="text-gray-600 dark:text-gray-400 text-sm mb-4 line-clamp-2 description">${listing.description || 'No description available'}</p>
                    
                    <div class="flex justify-between items-center">
                        <div class="flex items-center space-x-1 rating">
                            <i class="fas fa-star text-yellow-400 text-sm"></i>
                            <span class="text-sm text-gray-600 dark:text-gray-400">${listing.rating || '4.5'}</span>
                            <span class="text-sm text-gray-400 dark:text-gray-500">(${listing.reviewCount || '0'})</span>
                        </div>
                        <span class="text-xs text-gray-500 dark:text-gray-400 date">${listingDate}</span>
                    </div>
                    
                    ${!isSmall ? `
                        <div class="flex justify-between mt-4 product-actions">
                            <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition flex-1 mr-2 contact-seller-btn" data-listing-id="${listing.id}">
                                Contact
                            </button>
                            <button class="bg-gray-200 dark:bg-slate-600 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-slate-500 transition add-to-cart-btn" data-listing-id="${listing.id}">
                                <i class="fas fa-shopping-cart"></i>
                            </button>
                        </div>
                    ` : ''}
                </div>
            `;
            
            // Add event listeners
            setTimeout(() => {
                const favoriteBtn = card.querySelector('.favorite-btn');
                const viewBtn = card.querySelector('.view-btn');
                const contactBtn = card.querySelector('.contact-seller-btn');
                const cartBtn = card.querySelector('.add-to-cart-btn');
                
                if (favoriteBtn) favoriteBtn.addEventListener('click', () => toggleFavorite(listing.id));
                if (viewBtn) viewBtn.addEventListener('click', () => viewListing(listing.id));
                if (contactBtn) contactBtn.addEventListener('click', () => contactSeller(listing.id));
                if (cartBtn) cartBtn.addEventListener('click', () => addToCart(listing.id));
            }, 100);
            
            return card;
        }

        // Create seller card
        function createSellerCard(seller) {
            const card = document.createElement('div');
            card.className = 'seller-card fade-in';
            
            card.innerHTML = `
                <div class="flex items-center mb-4">
                    <img src="${seller.avatar || 'https://ui-avatars.com/api/?name=Seller&background=6366f1&color=fff&size=100'}" 
                         alt="${seller.name}" 
                         class="w-16 h-16 rounded-full object-cover mr-4">
                    <div>
                        <h3 class="font-semibold text-gray-900 dark:text-white">${seller.name}</h3>
                        <div class="flex items-center mt-1">
                            <div class="flex items-center">
                                <i class="fas fa-star text-yellow-400 mr-1"></i>
                                <span class="text-sm text-gray-600 dark:text-gray-400">${seller.rating || '5.0'}</span>
                            </div>
                            <span class="mx-2 text-gray-300"></span>
                            <span class="text-sm text-gray-600 dark:text-gray-400">${seller.listings || 0} listings</span>
                        </div>
                    </div>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-600 dark:text-gray-400">${seller.sales || 0} sales</span>
                    ${seller.verified ? '<span class="verified-badge"><i class="fas fa-check mr-1"></i>Verified</span>' : ''}
                </div>
                <button class="w-full bg-indigo-600 text-white py-2 rounded-lg font-semibold hover:bg-indigo-700 transition mt-4 view-seller-btn" data-seller-id="${seller.id}">
                    View Store
                </button>
            `;
            
            // Add event listener for view seller button
            const viewSellerBtn = card.querySelector('.view-seller-btn');
            if (viewSellerBtn) {
                viewSellerBtn.addEventListener('click', () => {
                    viewSeller(seller.id);
                });
            }
            
            return card;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-link, .bottom-nav-item[data-section]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    switchDashboard(section);
                    
                    // Update active states
                    document.querySelectorAll('.nav-link, .bottom-nav-item[data-section]').forEach(item => {
                        item.classList.remove('active');
                    });
                    this.classList.add('active');
                });
            });

            // Create listing modal
            createListingBtn.addEventListener('click', openCreateListingModal);
            closeCreateModal.addEventListener('click', closeCreateListingModal);
            cancelCreateListing.addEventListener('click', closeCreateListingModal);
            createListingForm.addEventListener('submit', handleCreateListing);
            
            // Image upload
            browseImagesBtn.addEventListener('click', () => listingImages.click());
            listingImages.addEventListener('change', handleImageSelection);
            
            imageUploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('dragover');
            });
            
            imageUploadArea.addEventListener('dragleave', function() {
                this.classList.remove('dragover');
            });
            
            imageUploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
                listingImages.files = e.dataTransfer.files;
                handleImageSelection({ target: listingImages });
            });
            
            // Search
            searchInput.addEventListener('input', debounce(handleSearch, 300));
            mobileSearchInput.addEventListener('input', debounce(handleSearch, 300));
            categorySearch.addEventListener('input', debounce(handleCategorySearch, 300));
            
            // View toggle
            gridViewBtn.addEventListener('click', () => switchView('grid'));
            listViewBtn.addEventListener('click', () => switchView('list'));
            
            // Sorting and filtering
            sortFilter.addEventListener('change', function() {
                currentSort = this.value;
                filterAndDisplayListings();
            });
            
            applyFilters.addEventListener('click', filterAndDisplayListings);
            clearFilters.addEventListener('click', clearAllFilters);
            
            // Load more
            loadMoreBtn.addEventListener('click', loadMoreListings);
            
            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);
            
            // Mood selector
            document.querySelectorAll('.mood-option').forEach(option => {
                option.addEventListener('click', function() {
                    const mood = this.getAttribute('data-mood');
                    setMood(mood);
                });
            });
            
            // Category tabs
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.tab-button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                    currentCategory = this.getAttribute('data-category');
                    filterAndDisplayListings();
                });
            });
            
            // Cart and notifications
            cartBtn.addEventListener('click', openCartModal);
            closeCartModal.addEventListener('click', closeCartModalFunc);
            notificationBtn.addEventListener('click', openNotificationsModal);
            closeNotificationsModal.addEventListener('click', closeNotificationsModalFunc);
            closeNotificationToast.addEventListener('click', () => {
                notificationToast.classList.remove('show');
            });
            
            // Mobile menu
            hamburgerMenu.addEventListener('click', openMobileMenu);
            closeMobileMenu.addEventListener('click', closeMobileMenuFunc);
            mobileMenuOverlay.addEventListener('click', closeMobileMenuFunc);
            mobileLogoutBtn.addEventListener('click', handleLogout);
            
            // Clear recently viewed
            clearRecentlyViewed.addEventListener('click', clearRecentlyViewedItems);
            
            // Category items
            document.querySelectorAll('.category-card, .jumia-category-item[data-category]').forEach(item => {
                item.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    filterByCategory(category);
                });
            });
            
            // More categories
            moreCategories.addEventListener('click', openMoreCategoriesModal);
            closeMoreCategoriesModal.addEventListener('click', closeMoreCategoriesModalFunc);
            
            // Refresh buttons
            refreshDiscover.addEventListener('click', loadDiscoverItems);
            refreshSellers.addEventListener('click', loadSellers);
            
            // Discover cards
            hotDealsCard.addEventListener('click', () => {
                filterByCategory('electronics');
                switchDashboard('home');
            });
            
            topRatedCard.addEventListener('click', () => {
                sortFilter.value = 'popular';
                currentSort = 'popular';
                filterAndDisplayListings();
                switchDashboard('home');
            });
            
            justAddedCard.addEventListener('click', () => {
                sortFilter.value = 'newest';
                currentSort = 'newest';
                filterAndDisplayListings();
                switchDashboard('home');
            });
            
            // Featured collections
            document.querySelectorAll('.glass-card[data-category]').forEach(card => {
                card.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    filterByCategory(category);
                    switchDashboard('home');
                });
            });
            
            // Close modals when clicking outside
            document.addEventListener('click', function(e) {
                if (e.target === createListingModal) closeCreateListingModal();
                if (e.target === cartModal) closeCartModalFunc();
                if (e.target === notificationsModal) closeNotificationsModalFunc();
                if (e.target === moreCategoriesModal) closeMoreCategoriesModalFunc();
            });
        }

        // Switch dashboard
        function switchDashboard(section) {
            // Hide all dashboards
            document.querySelectorAll('.dashboard-section').forEach(dashboard => {
                dashboard.classList.remove('active');
            });
            
            // Show selected dashboard
            document.getElementById(`${section}Dashboard`).classList.add('active');
            currentDashboard = section;
            
            // Load specific data if needed
            if (section === 'discover') {
                loadDiscoverItems();
            } else if (section === 'sellers') {
                loadSellers();
            }
        }

        // Handle category search
        function handleCategorySearch() {
            const searchTerm = categorySearch.value.toLowerCase().trim();
            
            document.querySelectorAll('.category-card, .jumia-category-item').forEach(item => {
                const categoryName = item.querySelector('.category-name, .jumia-category-name').textContent.toLowerCase();
                if (categoryName.includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Filter by category
        function filterByCategory(category) {
            // Update active tab
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-category') === category) {
                    btn.classList.add('active');
                }
            });
            
            currentCategory = category;
            filterAndDisplayListings();
            
            // Scroll to listings section
            document.getElementById('listingsContainer').scrollIntoView({ behavior: 'smooth' });
        }

        // Open more categories modal
        function openMoreCategoriesModal() {
            moreCategoriesModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Close more categories modal
        function closeMoreCategoriesModalFunc() {
            moreCategoriesModal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Clear recently viewed items
        async function clearRecentlyViewedItems() {
            if (!currentUser) return;
            
            try {
                const querySnapshot = await db.collection('recentlyViewed')
                    .where('userId', '==', currentUser.uid)
                    .get();
                
                const batch = db.batch();
                querySnapshot.forEach(doc => {
                    batch.delete(doc.ref);
                });
                
                await batch.commit();
                showToast('Recently viewed cleared', 'success');
                loadRecentlyViewed();
            } catch (error) {
                console.error(' Error clearing recently viewed:', error);
                showToast('Error clearing recently viewed', 'error');
            }
        }

        // Mobile menu functions
        function openMobileMenu() {
            mobileMenu.classList.add('active');
            mobileMenuOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeMobileMenuFunc() {
            mobileMenu.classList.remove('active');
            mobileMenuOverlay.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Logout function
        function handleLogout() {
            auth.signOut().then(() => {
                closeMobileMenuFunc();
                showToast('Logged out successfully', 'success');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1000);
            }).catch((error) => {
                console.error('Logout error:', error);
                showToast('Error logging out', 'error');
            });
        }

        // Filter and display listings based on current filters
        function filterAndDisplayListings() {
            // Apply category filter
            if (currentCategory === 'all') {
                filteredListings = [...allListings];
            } else {
                filteredListings = allListings.filter(listing => listing.category === currentCategory);
            }
            
            // Apply price filter
            const minPriceValue = parseFloat(minPrice.value) || 0;
            const maxPriceValue = parseFloat(maxPrice.value) || Infinity;
            
            filteredListings = filteredListings.filter(listing => {
                return listing.price >= minPriceValue && listing.price <= maxPriceValue;
            });
            
            // Apply sort
            switch (currentSort) {
                case 'newest':
                    filteredListings.sort((a, b) => b.createdAt - a.createdAt);
                    break;
                case 'oldest':
                    filteredListings.sort((a, b) => a.createdAt - b.createdAt);
                    break;
                case 'price-low':
                    filteredListings.sort((a, b) => a.price - b.price);
                    break;
                case 'price-high':
                    filteredListings.sort((a, b) => b.price - a.price);
                    break;
                case 'popular':
                    filteredListings.sort((a, b) => (b.views || 0) - (a.views || 0));
                    break;
            }
            
            displayedCount = 0;
            displayListings();
        }

        // Clear all filters
        function clearAllFilters() {
            minPrice.value = '';
            maxPrice.value = '';
            sellerRatingFilter.value = 'any';
            locationFilter.value = 'any';
            filterAndDisplayListings();
        }

        // Switch between grid and list view
        function switchView(view) {
            currentView = view;
            
            if (view === 'grid') {
                gridViewBtn.classList.add('bg-indigo-50', 'dark:bg-indigo-900/20');
                listViewBtn.classList.remove('bg-indigo-50', 'dark:bg-indigo-900/20');
                listingsContainer.classList.remove('grid-cols-1');
                listingsContainer.classList.add('grid-cols-1', 'sm:grid-cols-2', 'lg:grid-cols-3', 'xl:grid-cols-4');
            } else {
                listViewBtn.classList.add('bg-indigo-50', 'dark:bg-indigo-900/20');
                gridViewBtn.classList.remove('bg-indigo-50', 'dark:bg-indigo-900/20');
                listingsContainer.classList.remove('grid-cols-1', 'sm:grid-cols-2', 'lg:grid-cols-3', 'xl:grid-cols-4');
                listingsContainer.classList.add('grid-cols-1');
            }
            
            displayListings();
        }

        // Handle search
        function handleSearch() {
            const searchTerm = searchInput.value.toLowerCase().trim() || mobileSearchInput.value.toLowerCase().trim();
            
            if (searchTerm.length === 0) {
                searchSuggestions.classList.add('hidden');
                filterAndDisplayListings();
                return;
            }
            
            // Filter listings by search term
            const searchResults = allListings.filter(listing => 
                listing.title.toLowerCase().includes(searchTerm) ||
                listing.description.toLowerCase().includes(searchTerm) ||
                (listing.tags && listing.tags.some(tag => tag.toLowerCase().includes(searchTerm)))
            );
            
            filteredListings = searchResults;
            displayedCount = 0;
            displayListings();
        }

        // Open create listing modal
        function openCreateListingModal() {
            if (!currentUser) {
                showToast('Please log in to create a listing', 'warning');
                return;
            }
            
            createListingModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Close create listing modal
        function closeCreateListingModal() {
            createListingModal.classList.remove('active');
            document.body.style.overflow = 'auto';
            createListingForm.reset();
            imagePreview.innerHTML = '';
            selectedImages = [];
        }

        // Handle image selection
        function handleImageSelection(e) {
            const files = e.target.files;
            if (!files || files.length === 0) return;
            
            imagePreview.innerHTML = '';
            const fileArray = Array.from(files).slice(0, 8);
            
            fileArray.forEach(file => {
                if (!file.type.startsWith('image/')) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'image-preview-item';
                    
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    
                    const removeBtn = document.createElement('div');
                    removeBtn.className = 'remove';
                    removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                    removeBtn.addEventListener('click', function() {
                        previewItem.remove();
                    });
                    
                    previewItem.appendChild(img);
                    previewItem.appendChild(removeBtn);
                    imagePreview.appendChild(previewItem);
                };
                reader.readAsDataURL(file);
            });
        }

        // Handle create listing form submission
        async function handleCreateListing(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showToast('Please log in to create a listing', 'warning');
                return;
            }
            
            const title = document.getElementById('listingTitle').value;
            const description = document.getElementById('listingDescription').value;
            const price = parseFloat(document.getElementById('listingPrice').value);
            const category = document.getElementById('listingCategory').value;
            const condition = document.querySelector('input[name="condition"]:checked').value;
            const tags = document.getElementById('listingTags').value
                ? document.getElementById('listingTags').value.split(',').map(tag => tag.trim()).filter(tag => tag)
                : [];
            
            if (!title || !description || isNaN(price)) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            // Set loading state
            createListingBtnText.textContent = 'Creating...';
            createListingSpinner.classList.remove('hidden');
            
            try {
                // Upload images if any
                let imageUrls = [];
                const files = listingImages.files;
                
                if (files && files.length > 0) {
                    for (const file of files) {
                        if (!file.type.startsWith('image/')) continue;
                        
                        const storageRef = storage.ref().child(`marketplace/${currentUser.uid}/${Date.now()}_${file.name}`);
                        const snapshot = await storageRef.put(file);
                        const url = await snapshot.ref.getDownloadURL();
                        imageUrls.push(url);
                    }
                }
                
                // Create listing in Firestore
                const listingData = {
                    title,
                    description,
                    price,
                    category,
                    condition,
                    tags,
                    images: imageUrls,
                    sellerId: currentUser.uid,
                    sellerName: userData.name,
                    sellerAvatar: userData.avatar,
                    sellerVerified: userData.verified || false,
                    status: 'active',
                    views: 0,
                    createdAt: new Date(),
                    updatedAt: new Date()
                };
                
                await db.collection('listings').add(listingData);
                
                showToast('Listing created successfully!', 'success');
                closeCreateListingModal();
                
                // Refresh listings
                loadMarketplaceData();
                
            } catch (error) {
                console.error(' Error creating listing:', error);
                showToast('Error creating listing', 'error');
            } finally {
                createListingBtnText.textContent = 'Create Listing';
                createListingSpinner.classList.add('hidden');
            }
        }

        // Toggle favorite
        async function toggleFavorite(listingId) {
            if (!currentUser) {
                showToast('Please log in to add favorites', 'warning');
                return;
            }
            
            try {
                const favoriteRef = db.collection('favorites')
                    .where('userId', '==', currentUser.uid)
                    .where('listingId', '==', listingId);
                
                const snapshot = await favoriteRef.get();
                
                if (snapshot.empty) {
                    await db.collection('favorites').add({
                        userId: currentUser.uid,
                        listingId: listingId,
                        addedAt: new Date()
                    });
                    showToast('Added to favorites', 'success');
                } else {
                    const doc = snapshot.docs[0];
                    await db.collection('favorites').doc(doc.id).delete();
                    showToast('Removed from favorites', 'info');
                }
            } catch (error) {
                console.error(' Error toggling favorite:', error);
                showToast('Error updating favorites', 'error');
            }
        }

        // View listing details
        async function viewListing(listingId) {
            try {
                // Record view in recently viewed
                if (currentUser) {
                    await db.collection('recentlyViewed').add({
                        userId: currentUser.uid,
                        listingId: listingId,
                        viewedAt: new Date()
                    });
                }
                
                // Increment view count
                await db.collection('listings').doc(listingId).update({
                    views: firebase.firestore.FieldValue.increment(1)
                });
                
                // Show listing details
                const listingDoc = await db.collection('listings').doc(listingId).get();
                if (listingDoc.exists) {
                    const listing = listingDoc.data();
                    showListingDetails(listing);
                }
                
            } catch (error) {
                console.error(' Error viewing listing:', error);
                showToast('Error viewing listing', 'error');
            }
        }

        // Show listing details
        function showListingDetails(listing) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content max-w-3xl">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">${listing.title}</h2>
                        <button class="close-listing-details text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <img src="${listing.images && listing.images.length > 0 ? listing.images[0] : 'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80'}" 
                                 alt="${listing.title}" 
                                 class="w-full h-64 object-cover rounded-lg">
                        </div>
                        <div>
                            <div class="mb-4">
                                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">$${listing.price.toFixed(2)}</h3>
                                <p class="text-gray-600 dark:text-gray-400">${listing.description}</p>
                            </div>
                            <div class="mb-4">
                                <h4 class="font-semibold text-gray-900 dark:text-white mb-2">Seller Information</h4>
                                <div class="flex items-center">
                                    <img src="${listing.sellerAvatar || 'https://ui-avatars.com/api/?name=Seller&background=6366f1&color=fff&size=32'}" 
                                         alt="${listing.sellerName}" 
                                         class="w-8 h-8 rounded-full object-cover mr-2">
                                    <span class="text-gray-600 dark:text-gray-400">${listing.sellerName}</span>
                                    ${listing.sellerVerified ? '<span class="verified-badge ml-2"><i class="fas fa-check mr-1"></i>Verified</span>' : ''}
                                </div>
                            </div>
                            <div class="flex space-x-4">
                                <button class="bg-indigo-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-indigo-700 transition flex-1">
                                    Contact Seller
                                </button>
                                <button class="add-to-cart-details bg-gray-200 dark:bg-slate-600 text-gray-700 dark:text-gray-300 px-6 py-3 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-slate-500 transition" data-listing-id="${listing.id}">
                                    <i class="fas fa-shopping-cart mr-2"></i>Add to Cart
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add event listeners
            const closeBtn = modal.querySelector('.close-listing-details');
            const addToCartBtn = modal.querySelector('.add-to-cart-details');
            
            closeBtn.addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            addToCartBtn.addEventListener('click', () => {
                addToCart(listing.id);
                document.body.removeChild(modal);
            });
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }

        // View seller
        function viewSeller(sellerId) {
            showToast(`Viewing seller ${sellerId}`, 'info');
            // In a full implementation, this would show seller details and their listings
        }

        // Contact seller
        function contactSeller(listingId) {
            showToast('Contacting seller...', 'info');
            // In a full implementation, this would open a chat with the seller
        }

        // Add to cart
        async function addToCart(listingId) {
            if (!currentUser) {
                showToast('Please log in to add items to cart', 'warning');
                return;
            }
            
            try {
                const listingDoc = await db.collection('listings').doc(listingId).get();
                if (!listingDoc.exists) {
                    showToast('Listing not found', 'error');
                    return;
                }
                
                const listing = listingDoc.data();
                
                // Add to cart in Firestore
                await db.collection('cart').add({
                    userId: currentUser.uid,
                    listingId: listingId,
                    title: listing.title,
                    price: listing.price,
                    image: listing.images && listing.images.length > 0 ? listing.images[0] : '',
                    sellerId: listing.sellerId,
                    addedAt: new Date()
                });
                
                showToast('Added to cart!', 'success');
                loadCartCount();
                
            } catch (error) {
                console.error(' Error adding to cart:', error);
                showToast('Error adding to cart', 'error');
            }
        }

        // Load cart count
        async function loadCartCount() {
            if (!currentUser) return;
            
            try {
                const cartQuery = await db.collection('cart')
                    .where('userId', '==', currentUser.uid)
                    .get();
                
                const count = cartQuery.size;
                if (count > 0) {
                    cartCount.textContent = count;
                    cartCount.classList.remove('hidden');
                } else {
                    cartCount.classList.add('hidden');
                }
            } catch (error) {
                console.error(' Error loading cart count:', error);
            }
        }

        // Load notification count
        async function loadNotificationCount() {
            if (!currentUser) return;
            
            try {
                const notificationsQuery = await db.collection('notifications')
                    .where('userId', '==', currentUser.uid)
                    .where('read', '==', false)
                    .get();
                
                const count = notificationsQuery.size;
                if (count > 0) {
                    notificationCount.textContent = count;
                    notificationCount.classList.remove('hidden');
                } else {
                    notificationCount.classList.add('hidden');
                }
            } catch (error) {
                console.error(' Error loading notification count:', error);
            }
        }

        // Open cart modal
        async function openCartModal() {
            if (!currentUser) {
                showToast('Please log in to view cart', 'warning');
                return;
            }
            
            try {
                const cartQuery = await db.collection('cart')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('addedAt', 'desc')
                    .get();
                
                if (cartQuery.empty) {
                    cartContent.innerHTML = `
                        <div class="text-center py-12">
                            <i class="fas fa-shopping-cart text-4xl text-gray-400 mb-4"></i>
                            <h3 class="text-xl font-bold text-gray-700 dark:text-gray-300 mb-2">Your cart is empty</h3>
                            <p class="text-gray-500 dark:text-gray-400">Add some items to get started</p>
                        </div>
                    `;
                } else {
                    let cartHTML = '<div class="space-y-4">';
                    let total = 0;
                    
                    cartQuery.forEach(doc => {
                        const item = doc.data();
                        total += item.price;
                        
                        cartHTML += `
                            <div class="flex items-center space-x-4 p-4 border border-gray-200 dark:border-slate-600 rounded-lg">
                                <img src="${item.image || 'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80'}" 
                                     alt="${item.title}" 
                                     class="w-16 h-16 object-cover rounded">
                                <div class="flex-1">
                                    <h4 class="font-semibold text-gray-900 dark:text-white">${item.title}</h4>
                                    <p class="text-indigo-600 dark:text-indigo-400 font-bold">$${item.price.toFixed(2)}</p>
                                </div>
                                <button class="remove-from-cart text-red-500 hover:text-red-700" data-id="${doc.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `;
                    });
                    
                    cartHTML += `
                        <div class="border-t border-gray-200 dark:border-slate-600 pt-4">
                            <div class="flex justify-between items-center mb-4">
                                <span class="text-lg font-bold text-gray-900 dark:text-white">Total:</span>
                                <span class="text-lg font-bold text-indigo-600 dark:text-indigo-400">$${total.toFixed(2)}</span>
                            </div>
                            <button class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition">
                                Checkout
                            </button>
                        </div>
                    </div>
                    `;
                    
                    cartContent.innerHTML = cartHTML;
                    
                    // Add event listeners for remove buttons
                    cartContent.querySelectorAll('.remove-from-cart').forEach(btn => {
                        btn.addEventListener('click', async (e) => {
                            const itemId = e.currentTarget.getAttribute('data-id');
                            await removeFromCart(itemId);
                        });
                    });
                }
                
                cartModal.classList.add('active');
                document.body.style.overflow = 'hidden';
                
            } catch (error) {
                console.error(' Error loading cart:', error);
                showToast('Error loading cart', 'error');
            }
        }

        // Close cart modal
        function closeCartModalFunc() {
            cartModal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Remove from cart
        async function removeFromCart(itemId) {
            try {
                await db.collection('cart').doc(itemId).delete();
                showToast('Item removed from cart', 'success');
                loadCartCount();
                openCartModal(); // Refresh cart modal
            } catch (error) {
                console.error(' Error removing from cart:', error);
                showToast('Error removing item from cart', 'error');
            }
        }

        // Open notifications modal
        async function openNotificationsModal() {
            if (!currentUser) {
                showToast('Please log in to view notifications', 'warning');
                return;
            }
            
            try {
                const notificationsQuery = await db.collection('notifications')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('createdAt', 'desc')
                    .limit(10)
                    .get();
                
                if (notificationsQuery.empty) {
                    notificationsContent.innerHTML = `
                        <div class="text-center py-12">
                            <i class="far fa-bell text-4xl text-gray-400 mb-4"></i>
                            <h3 class="text-xl font-bold text-gray-700 dark:text-gray-300 mb-2">No notifications</h3>
                            <p class="text-gray-500 dark:text-gray-400">You're all caught up!</p>
                        </div>
                    `;
                } else {
                    let notificationsHTML = '<div class="space-y-4">';
                    
                    notificationsQuery.forEach(doc => {
                        const notification = doc.data();
                        const timeAgo = formatTimeAgo(notification.createdAt);
                        
                        notificationsHTML += `
                            <div class="p-4 border border-gray-200 dark:border-slate-600 rounded-lg ${notification.read ? 'bg-gray-50 dark:bg-slate-800' : 'bg-white dark:bg-slate-700'}">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h4 class="font-semibold text-gray-900 dark:text-white">${notification.title}</h4>
                                        <p class="text-gray-600 dark:text-gray-400 mt-1">${notification.message}</p>
                                    </div>
                                    <span class="text-xs text-gray-500 dark:text-gray-400">${timeAgo}</span>
                                </div>
                            </div>
                        `;
                    });
                    
                    notificationsHTML += '</div>';
                    notificationsContent.innerHTML = notificationsHTML;
                }
                
                notificationsModal.classList.add('active');
                document.body.style.overflow = 'hidden';
                
            } catch (error) {
                console.error(' Error loading notifications:', error);
                showToast('Error loading notifications', 'error');
            }
        }

        // Close notifications modal
        function closeNotificationsModalFunc() {
            notificationsModal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Update user UI
        function updateUserUI() {
            if (userData) {
                userAvatar.src = userData.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(userData.name || 'User')}&background=6366f1&color=fff&size=40`;
                mobileUserAvatar.src = userData.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(userData.name || 'User')}&background=6366f1&color=fff&size=40`;
                mobileNavUserAvatar.src = userData.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(userData.name || 'User')}&background=6366f1&color=fff&size=32`;
                userName.textContent = userData.name || 'User';
                mobileUserName.textContent = userData.name || 'User';
                mobileNavUserName.textContent = userData.name || 'User';
                userStatus.textContent = userData.status || 'Student';
                mobileUserStatus.textContent = userData.status || 'Student';
                mobileNavUserStatus.textContent = userData.status || 'Student';
            }
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            notificationToastTitle.textContent = type.charAt(0).toUpperCase() + type.slice(1);
            notificationToastMessage.textContent = message;
            
            // Set color based on type
            if (type === 'error') {
                notificationToast.style.borderLeft = '4px solid #ef4444';
            } else if (type === 'success') {
                notificationToast.style.borderLeft = '4px solid #10b981';
            } else if (type === 'warning') {
                notificationToast.style.borderLeft = '4px solid #f59e0b';
            } else {
                notificationToast.style.borderLeft = '4px solid #3b82f6';
            }
            
            notificationToast.classList.add('show');
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                notificationToast.classList.remove('show');
            }, 5000);
        }

        // Initialize carousel
        function initCarousel() {
            const carouselInner = document.querySelector('.carousel-inner');
            const carouselItems = document.querySelectorAll('.carousel-item');
            const prevButton = document.querySelector('.carousel-control.prev');
            const nextButton = document.querySelector('.carousel-control.next');
            
            let currentIndex = 0;
            const totalItems = carouselItems.length;
            
            function updateCarousel() {
                carouselInner.style.transform = `translateX(-${currentIndex * 100}%)`;
            }
            
            if (prevButton) {
                prevButton.addEventListener('click', function() {
                    currentIndex = (currentIndex - 1 + totalItems) % totalItems;
                    updateCarousel();
                });
            }
            
            if (nextButton) {
                nextButton.addEventListener('click', function() {
                    currentIndex = (currentIndex + 1) % totalItems;
                    updateCarousel();
                });
            }
            
            // Auto-advance carousel
            setInterval(function() {
                currentIndex = (currentIndex + 1) % totalItems;
                updateCarousel();
            }, 5000);
        }

        // Initialize theme
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            setTheme(savedTheme);
        }

        // Toggle theme
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            setTheme(newTheme);
        }

        // Set theme
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            
            if (theme === 'dark') {
                themeToggle.classList.add('active');
            } else {
                themeToggle.classList.remove('active');
            }
        }

        // Initialize mood
        function initMood() {
            const savedMood = localStorage.getItem('mood') || 'happy';
            setMood(savedMood);
        }

        // Set mood
        function setMood(mood) {
            currentMood = mood;
            document.documentElement.setAttribute('data-mood', mood);
            localStorage.setItem('mood', mood);
            
            // Update active state
            document.querySelectorAll('.mood-option').forEach(option => {
                option.classList.remove('active');
                if (option.getAttribute('data-mood') === mood) {
                    option.classList.add('active');
                }
            });
        }

        // Start flash sale timer
        function startFlashSaleTimer() {
            let timeLeft = 24 * 60 * 60; // 24 hours in seconds
            
            function updateTimer() {
                const hours = Math.floor(timeLeft / 3600);
                const minutes = Math.floor((timeLeft % 3600) / 60);
                const seconds = timeLeft % 60;
                
                flashSaleTimer.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft > 0) {
                    timeLeft--;
                } else {
                    timeLeft = 24 * 60 * 60;
                }
            }
            
            updateTimer();
            setInterval(updateTimer, 1000);
        }

        // Start flash sale countdown (Jumia style)
        function startFlashSaleCountdown() {
            let timeLeft = 6 * 60 * 60 + 19 * 60 + 55; // 6 hours, 19 minutes, 55 seconds
            
            function updateCountdown() {
                const hours = Math.floor(timeLeft / 3600);
                const minutes = Math.floor((timeLeft % 3600) / 60);
                const seconds = timeLeft % 60;
                
                flashSaleCountdown.textContent = `${hours.toString().padStart(2, '0')}h : ${minutes.toString().padStart(2, '0')}m : ${seconds.toString().padStart(2, '0')}s`;
                
                if (timeLeft > 0) {
                    timeLeft--;
                } else {
                    timeLeft = 6 * 60 * 60 + 19 * 60 + 55;
                }
            }
            
            updateCountdown();
            setInterval(updateCountdown, 1000);
        }

        // Format time ago
        function formatTimeAgo(timestamp) {
            const now = new Date();
            const time = timestamp.toDate();
            const diffMs = now - time;
            const diffMins = Math.floor(diffMs / (1000 * 60));
            const diffHrs = Math.floor(diffMs / (1000 * 60 * 60));
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHrs < 24) return `${diffHrs}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return time.toLocaleDateString();
        }

        // Debounce function for search
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html>