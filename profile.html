<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - ConnectSphere</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <style>
        .glass-effect {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        .primary-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .cyber-gradient {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        .neon-glow {
            box-shadow: 0 0 20px rgba(79, 172, 254, 0.4);
        }
        
        /* Enhanced Connection Status */
        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 0.85rem;
            z-index: 1000;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid;
        }
        .connection-status.connected {
            background: rgba(34, 197, 94, 0.15);
            color: #4ade80;
            border-color: rgba(34, 197, 94, 0.4);
        }

        /* Modern Profile Styles */
        .profile-cover {
            height: 280px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            border-radius: 20px 20px 0 0;
            overflow: hidden;
        }
        .profile-avatar {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.3);
            position: absolute;
            bottom: -70px;
            left: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
            background-size: cover;
            background-position: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        /* Enhanced Stats */
        .profile-stats {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            text-align: center;
        }
        .stat-item {
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 15px;
        }
        .stat-item:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateY(-5px);
        }
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Modern Tabs */
        .profile-tabs {
            display: flex;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 25px;
            overflow-x: auto;
        }
        .profile-tab {
            padding: 18px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
            position: relative;
            color: #93C5FD;
            font-weight: 500;
        }
        .profile-tab.active {
            border-bottom: 3px solid #667eea;
            color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), transparent);
        }

        /* Enhanced Buttons */
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 15px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }

        /* Enhanced Cards */
        .feature-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .feature-card:hover {
            transform: translateY(-8px);
            border-color: rgba(102, 126, 234, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        /* Loading Spinner */
        .loading-spinner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(102, 126, 234, 0.3);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Enhanced Social Icons */
        .social-media-icons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        .social-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        .social-icon:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
        }

        /* Unique Features Styling */
        .mood-selector {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .mood-option {
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            border: 1px solid transparent;
        }
        .mood-option:hover, .mood-option.active {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        .skill-tag {
            display: inline-block;
            background: rgba(102, 126, 234, 0.2);
            color: #93C5FD;
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px;
            font-size: 0.9rem;
            border: 1px solid rgba(102, 126, 234, 0.3);
        }
        .online-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #10B981;
            position: absolute;
            bottom: 10px;
            right: 10px;
            border: 2px solid white;
        }
        .interest-bubble {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            margin: 5px;
            display: inline-block;
            font-size: 0.9rem;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
    </style>
</head>
<body class="h-full bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 text-white">
    <!-- Connection Status -->
    <div class="connection-status connecting" id="connectionStatus">
        <i class="fas fa-circle-notch fa-spin mr-2"></i>
        <span id="connectionText">Connecting...</span>
    </div>

    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="glass-effect rounded-2xl p-8 border border-blue-700 flex items-center space-x-4">
            <div class="spinner"></div>
            <span class="text-blue-300 text-lg">Loading your profile...</span>
        </div>
    </div>

    <!-- Image Cropper Modal -->
    <div class="fixed inset-0 bg-black bg-opacity-80 hidden items-center justify-center z-50" id="cropperModal">
        <div class="bg-gray-800 rounded-2xl p-6 max-w-2xl w-full mx-4">
            <h3 class="text-xl font-bold text-blue-300 mb-4 text-center" id="cropperTitle">Crop Image</h3>
            <img id="cropperImage" class="w-full max-h-96 object-contain mb-4">
            <div class="flex justify-center space-x-4">
                <button id="cancelCrop" class="px-6 py-2 glass-effect text-blue-400 rounded-xl hover:bg-blue-800/30 transition">
                    Cancel
                </button>
                <button id="applyCrop" class="px-6 py-2 primary-gradient text-white rounded-xl hover:scale-105 transition">
                    Apply Crop
                </button>
            </div>
        </div>
    </div>

    <!-- Profile Layout -->
    <div class="flex h-full" id="profileLayout">
        <!-- Navigation Sidebar -->
        <div class="w-20 lg:w-64 glass-effect border-r border-blue-800 flex flex-col">
            <div class="p-4">
                <a href="integration.html" class="flex items-center space-x-3">
                    <div class="w-10 h-10 cyber-gradient rounded-2xl flex items-center justify-center neon-glow">
                        <i class="fas fa-brain text-white"></i>
                    </div>
                    <span class="hidden lg:block text-xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400">
                        ConnectSphere
                    </span>
                </a>
            </div>

            <nav class="flex-1 px-2 lg:px-4 space-y-2">
                <a href="home.html" class="flex items-center space-x-3 p-3 rounded-xl text-blue-300 hover:bg-blue-900/30 hover:text-cyan-400 transition">
                    <i class="fas fa-home w-6"></i>
                    <span class="hidden lg:block">Feed</span>
                </a>
                <a href="chat.html" class="flex items-center space-x-3 p-3 rounded-xl text-blue-300 hover:bg-blue-900/30 hover:text-cyan-400 transition">
                    <i class="fas fa-comment-dots w-6"></i>
                    <span class="hidden lg:block">Chat</span>
                </a>
                <a href="notifications.html" class="flex items-center space-x-3 p-3 rounded-xl text-blue-300 hover:bg-blue-900/30 hover:text-cyan-400 transition">
                    <i class="fas fa-bell w-6"></i>
                    <span class="hidden lg:block">Notifications</span>
                </a>
                <a href="profile.html" class="flex items-center space-x-3 p-3 rounded-xl bg-blue-900/30 text-cyan-400 border border-cyan-500/50">
                    <i class="fas fa-user-astronaut w-6"></i>
                    <span class="hidden lg:block">Profile</span>
                </a>
            </nav>

            <!-- Quick User Info -->
            <div class="p-4 border-t border-blue-800">
                <div class="hidden lg:flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold text-sm" id="sidebarAvatar">
                        <!-- Dynamically filled -->
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="font-semibold text-white truncate" id="sidebarName"></div>
                        <div class="text-blue-300 text-sm truncate" id="sidebarUsername"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Profile Area -->
        <div class="flex-1 flex flex-col overflow-y-auto">
            <!-- Profile Header -->
            <div class="glass-effect border-b border-blue-800 px-6 py-4">
                <div class="flex items-center justify-between">
                    <h1 class="text-2xl font-bold text-blue-300">My Profile</h1>
                    <div class="flex items-center space-x-4">
                        <a href="notifications.html" class="px-4 py-2 glass-effect text-blue-400 rounded-2xl hover:bg-blue-800/30 border border-blue-700 transition relative">
                            <i class="fas fa-bell mr-2"></i>
                            Notifications
                            <span class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center hidden" id="notificationBadge">0</span>
                        </a>
                        <a href="settings.html" class="px-4 py-2 glass-effect text-blue-400 rounded-2xl hover:bg-blue-800/30 border border-blue-700 transition">
                            <i class="fas fa-cog mr-2"></i>
                            Settings
                        </a>
                        <button id="logoutBtn" class="px-4 py-2 primary-gradient text-white rounded-2xl hover:scale-105 font-medium transition">
                            <i class="fas fa-sign-out-alt mr-2"></i>
                            Logout
                        </button>
                    </div>
                </div>
            </div>

            <!-- Profile Content -->
            <div class="flex-1 overflow-y-auto p-6">
                <!-- Profile Card -->
                <div class="glass-effect rounded-2xl border border-blue-700 overflow-hidden mb-6">
                    <!-- Profile Cover -->
                    <div class="profile-cover" id="profileCover">
                        <button class="edit-cover-btn absolute top-6 right-6 glass-effect text-blue-400 rounded-xl px-4 py-2 hover:bg-blue-800/30 transition">
                            <i class="fas fa-camera mr-2"></i>
                            Edit Cover
                        </button>
                        <input type="file" id="coverInput" class="hidden" accept="image/*">
                    </div>
                    
                    <!-- Profile Avatar -->
                    <div class="profile-avatar" id="profileAvatar">
                        <div id="avatarIcon"></div>
                        <div class="online-status" id="onlineStatus"></div>
                        <button class="edit-avatar-btn absolute bottom-3 right-3 w-8 h-8 bg-black/50 rounded-full flex items-center justify-center text-white hover:bg-black/70 transition">
                            <i class="fas fa-camera text-xs"></i>
                        </button>
                        <input type="file" id="avatarInput" class="hidden" accept="image/*">
                    </div>
                    
                    <!-- Profile Info -->
                    <div class="profile-info pt-20 px-6">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center flex-wrap gap-4 mb-4">
                                    <h1 class="text-3xl font-bold text-white" id="profileName">Loading...</h1>
                                    <div class="mood-selector inline-flex items-center space-x-2 glass-effect px-3 py-1 rounded-full" id="currentMood">
                                        <i class="fas fa-smile text-yellow-400"></i>
                                        <span class="text-blue-300 text-sm">Set your mood</span>
                                    </div>
                                </div>
                                <p class="text-blue-300 text-lg mb-2" id="profileUsername">@username</p>
                                <p class="text-blue-300 mb-2" id="profileTitle">Your title appears here</p>
                                <p class="text-blue-200 mt-2 leading-relaxed" id="profileBio">Your bio will appear here</p>
                                
                                <!-- Skills & Interests -->
                                <div class="mt-4" id="skillsInterests">
                                    <div class="flex flex-wrap gap-2 mb-3" id="skillsContainer"></div>
                                    <div class="flex flex-wrap gap-2" id="interestsContainer"></div>
                                </div>
                                
                                <!-- Social Media Links -->
                                <div class="social-media-icons" id="socialMediaIcons">
                                    <!-- Dynamically filled -->
                                </div>
                            </div>
                            
                            <div class="flex space-x-3 ml-6">
                                <button id="editProfileBtn" class="px-4 py-2 glass-effect text-blue-400 rounded-xl hover:bg-blue-800/30 border border-blue-700 transition">
                                    <i class="fas fa-edit mr-2"></i>
                                    Edit Profile
                                </button>
                                <button id="shareProfileBtn" class="px-4 py-2 glass-effect text-blue-400 rounded-xl hover:bg-blue-800/30 border border-blue-700 transition">
                                    <i class="fas fa-share-alt mr-2"></i>
                                    Share Profile
                                </button>
                            </div>
                        </div>
                        
                        <!-- Profile Stats -->
                        <div class="profile-stats">
                            <div class="stat-item">
                                <div class="stat-value" id="postsCount">0</div>
                                <div class="stat-label">Posts</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="connectionsCount">0</div>
                                <div class="stat-label">Connections</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="communitiesCount">0</div>
                                <div class="stat-label">Communities</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="reputationScore">0</div>
                                <div class="stat-label">Reputation</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Profile Tabs -->
                <div class="glass-effect rounded-2xl border border-blue-700 overflow-hidden">
                    <div class="profile-tabs">
                        <div class="profile-tab active" data-tab="activity">
                            <i class="fas fa-stream mr-2"></i>
                            Activity
                        </div>
                        <div class="profile-tab" data-tab="communities">
                            <i class="fas fa-users mr-2"></i>
                            Communities
                        </div>
                        <div class="profile-tab" data-tab="skills">
                            <i class="fas fa-tools mr-2"></i>
                            Skills
                        </div>
                        <div class="profile-tab" data-tab="achievements">
                            <i class="fas fa-trophy mr-2"></i>
                            Achievements
                        </div>
                        <div class="profile-tab" data-tab="analytics">
                            <i class="fas fa-chart-bar mr-2"></i>
                            Analytics
                        </div>
                    </div>
                    
                    <!-- Tab Content -->
                    <div class="p-6">
                        <!-- Activity Tab -->
                        <div class="tab-content active" id="activityTab">
                            <div class="text-center py-8" id="activityContent">
                                <i class="fas fa-circle-notch fa-spin text-4xl text-blue-400 mb-4"></i>
                                <p class="text-blue-300">Loading your activity...</p>
                            </div>
                        </div>
                        
                        <!-- Communities Tab -->
                        <div class="tab-content hidden" id="communitiesTab">
                            <div class="text-center py-8" id="communitiesContent">
                                <i class="fas fa-circle-notch fa-spin text-4xl text-blue-400 mb-4"></i>
                                <p class="text-blue-300">Loading your communities...</p>
                            </div>
                        </div>
                        
                        <!-- Skills Tab -->
                        <div class="tab-content hidden" id="skillsTab">
                            <div class="text-center py-8" id="skillsContent">
                                <i class="fas fa-circle-notch fa-spin text-4xl text-blue-400 mb-4"></i>
                                <p class="text-blue-300">Loading your skills...</p>
                            </div>
                        </div>
                        
                        <!-- Achievements Tab -->
                        <div class="tab-content hidden" id="achievementsTab">
                            <div class="text-center py-8" id="achievementsContent">
                                <i class="fas fa-circle-notch fa-spin text-4xl text-blue-400 mb-4"></i>
                                <p class="text-blue-300">Loading your achievements...</p>
                            </div>
                        </div>
                        
                        <!-- Analytics Tab -->
                        <div class="tab-content hidden" id="analyticsTab">
                            <div class="text-center py-8" id="analyticsContent">
                                <i class="fas fa-circle-notch fa-spin text-4xl text-blue-400 mb-4"></i>
                                <p class="text-blue-300">Loading your analytics...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script>
        // Firebase configuration - Same as login page
        const firebaseConfig = {
            apiKey: "AIzaSyDHHyGgsSV18BcXrGgzi4C8frzDAE1C1zo",
            authDomain: "uniconnect-ee95c.firebaseapp.com",
            projectId: "uniconnect-ee95c",
            storageBucket: "uniconnect-ee95c.appspot.com",
            messagingSenderId: "1003264444309",
            appId: "1:1003264444309:web:9f0307516e44d21e97d89c"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        
        // Initialize Firebase services
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();
        
        // Cloudinary configuration (you'll need to set this up)
        const cloudinaryConfig = {
            cloudName: "your-cloudinary-cloud-name",
            uploadPreset: "your-upload-preset"
        };
    </script>
    
    <!-- Profile JavaScript -->
    <script>
        class ProfileManager {
            constructor() {
                this.currentUser = null;
                this.userData = null;
                this.cropper = null;
                this.currentImageType = null;
                this.initialize();
            }

            async initialize() {
                this.showLoading();
                await this.checkAuthentication();
                this.setupEventListeners();
            }

            async checkAuthentication() {
                return new Promise((resolve) => {
                    auth.onAuthStateChanged(async (user) => {
                        if (user) {
                            this.currentUser = user;
                            console.log('User authenticated:', user.uid);
                            await this.loadUserProfile(user.uid);
                            this.updateConnectionStatus('connected');
                            this.hideLoading();
                        } else {
                            console.log('No user found, redirecting to login...');
                            window.location.href = 'login.html';
                        }
                        resolve();
                    });
                });
            }

            async loadUserProfile(uid) {
                try {
                    // Try to get user data from Firestore
                    const userDoc = await db.collection('users').doc(uid).get();
                    
                    if (userDoc.exists) {
                        this.userData = userDoc.data();
                        console.log('User data loaded from Firestore:', this.userData);
                    } else {
                        // Create default user data structure
                        this.userData = this.createDefaultUserData();
                        await this.saveUserProfile();
                    }
                    
                    this.updateProfileUI();
                    
                } catch (error) {
                    console.error('Error loading user profile:', error);
                    // Fallback to default data
                    this.userData = this.createDefaultUserData();
                    this.updateProfileUI();
                }
            }

            createDefaultUserData() {
                const email = this.currentUser.email;
                const username = email.split('@')[0];
                const displayName = this.currentUser.displayName || username;
                
                return {
                    uid: this.currentUser.uid,
                    email: email,
                    username: username,
                    displayName: displayName,
                    title: 'New ConnectSphere Member',
                    bio: 'Welcome to my profile! I just joined ConnectSphere.',
                    avatarUrl: null,
                    coverUrl: null,
                    skills: ['Communication', 'Teamwork'],
                    interests: ['Technology', 'Learning', 'Networking'],
                    socialLinks: {},
                    stats: {
                        posts: 0,
                        connections: 0,
                        communities: 0,
                        reputation: 100
                    },
                    mood: 'happy',
                    isOnline: true,
                    lastActive: new Date(),
                    createdAt: new Date(),
                    updatedAt: new Date()
                };
            }

            async saveUserProfile() {
                try {
                    await db.collection('users').doc(this.currentUser.uid).set(this.userData, { merge: true });
                    console.log('Profile saved successfully');
                } catch (error) {
                    console.error('Error saving profile:', error);
                }
            }

            updateProfileUI() {
                if (!this.userData) return;

                // Basic Info
                document.getElementById('profileName').textContent = this.userData.displayName;
                document.getElementById('profileUsername').textContent = `@${this.userData.username}`;
                document.getElementById('profileTitle').textContent = this.userData.title;
                document.getElementById('profileBio').textContent = this.userData.bio;

                // Sidebar Info
                document.getElementById('sidebarName').textContent = this.userData.displayName;
                document.getElementById('sidebarUsername').textContent = `@${this.userData.username}`;
                document.getElementById('sidebarAvatar').textContent = this.getInitials(this.userData.displayName);

                // Avatar
                const avatarIcon = document.getElementById('avatarIcon');
                if (this.userData.avatarUrl) {
                    document.getElementById('profileAvatar').style.backgroundImage = `url(${this.userData.avatarUrl})`;
                    avatarIcon.style.display = 'none';
                } else {
                    avatarIcon.textContent = this.getInitials(this.userData.displayName);
                    avatarIcon.style.display = 'flex';
                }

                // Online Status
                document.getElementById('onlineStatus').style.background = this.userData.isOnline ? '#10B981' : '#6B7280';

                // Stats
                document.getElementById('postsCount').textContent = this.userData.stats.posts;
                document.getElementById('connectionsCount').textContent = this.userData.stats.connections;
                document.getElementById('communitiesCount').textContent = this.userData.stats.communities;
                document.getElementById('reputationScore').textContent = this.userData.stats.reputation;

                // Skills & Interests
                this.updateSkillsAndInterests();

                // Mood
                this.updateMoodDisplay();

                // Social Links
                this.updateSocialLinks();
            }

            getInitials(name) {
                return name.split(' ').map(n => n[0]).join('').toUpperCase();
            }

            updateSkillsAndInterests() {
                const skillsContainer = document.getElementById('skillsContainer');
                const interestsContainer = document.getElementById('interestsContainer');

                skillsContainer.innerHTML = this.userData.skills.map(skill => 
                    `<span class="skill-tag">${skill}</span>`
                ).join('');

                interestsContainer.innerHTML = this.userData.interests.map(interest =>
                    `<span class="interest-bubble">${interest}</span>`
                ).join('');
            }

            updateMoodDisplay() {
                const moodElement = document.getElementById('currentMood');
                const moods = {
                    happy: { icon: 'fa-smile', color: 'text-yellow-400', label: 'Happy' },
                    productive: { icon: 'fa-rocket', color: 'text-green-400', label: 'Productive' },
                    creative: { icon: 'fa-palette', color: 'text-purple-400', label: 'Creative' },
                    focused: { icon: 'fa-bullseye', color: 'text-blue-400', label: 'Focused' },
                    relaxed: { icon: 'fa-couch', color: 'text-indigo-400', label: 'Relaxed' }
                };

                const currentMood = moods[this.userData.mood] || moods.happy;
                moodElement.innerHTML = `
                    <i class="fas ${currentMood.icon} ${currentMood.color}"></i>
                    <span class="text-blue-300 text-sm">${currentMood.label}</span>
                `;
            }

            updateSocialLinks() {
                const socialIcons = document.getElementById('socialMediaIcons');
                const platforms = {
                    twitter: { icon: 'fab fa-twitter', color: 'bg-blue-400' },
                    github: { icon: 'fab fa-github', color: 'bg-gray-700' },
                    linkedin: { icon: 'fab fa-linkedin-in', color: 'bg-blue-600' },
                    portfolio: { icon: 'fas fa-globe', color: 'bg-green-500' }
                };

                let html = '';
                Object.entries(this.userData.socialLinks || {}).forEach(([platform, url]) => {
                    if (platforms[platform]) {
                        html += `
                            <a href="${url}" target="_blank" class="social-icon ${platforms[platform].color}">
                                <i class="${platforms[platform].icon}"></i>
                            </a>
                        `;
                    }
                });

                // Add button to manage social links
                html += `
                    <button class="social-icon bg-gradient-to-r from-cyan-400 to-blue-500" onclick="profileManager.manageSocialLinks()">
                        <i class="fas fa-plus"></i>
                    </button>
                `;

                socialIcons.innerHTML = html;
            }

            setupEventListeners() {
                // Logout
                document.getElementById('logoutBtn').addEventListener('click', () => this.logout());

                // Tabs
                document.querySelectorAll('.profile-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabId = e.currentTarget.getAttribute('data-tab');
                        this.switchTab(tabId);
                    });
                });

                // Edit buttons
                document.getElementById('editProfileBtn').addEventListener('click', () => this.editProfile());
                document.getElementById('shareProfileBtn').addEventListener('click', () => this.shareProfile());
                document.getElementById('editCoverBtn').addEventListener('click', () => document.getElementById('coverInput').click());
                document.getElementById('editAvatarBtn').addEventListener('click', () => document.getElementById('avatarInput').click());

                // File inputs
                document.getElementById('coverInput').addEventListener('change', (e) => this.handleImageUpload(e, 'cover'));
                document.getElementById('avatarInput').addEventListener('change', (e) => this.handleImageUpload(e, 'avatar'));

                // Mood selector
                document.getElementById('currentMood').addEventListener('click', () => this.showMoodSelector());
            }

            async handleImageUpload(event, type) {
                const file = event.target.files[0];
                if (!file) return;

                // In a real implementation, you would:
                // 1. Upload to Cloudinary
                // 2. Get the URL back
                // 3. Update user data in Firestore
                // 4. Update UI

                this.showToast(`${type === 'avatar' ? 'Profile picture' : 'Cover photo'} upload feature coming soon!`, 'info');
                
                // For now, we'll create a local URL for demo
                const imageUrl = URL.createObjectURL(file);
                
                if (type === 'avatar') {
                    this.userData.avatarUrl = imageUrl;
                    document.getElementById('profileAvatar').style.backgroundImage = `url(${imageUrl})`;
                    document.getElementById('avatarIcon').style.display = 'none';
                } else {
                    this.userData.coverUrl = imageUrl;
                    document.getElementById('profileCover').style.backgroundImage = `url(${imageUrl})`;
                    document.getElementById('profileCover').style.backgroundSize = 'cover';
                }

                await this.saveUserProfile();
                this.showToast(`${type === 'avatar' ? 'Profile picture' : 'Cover photo'} updated!`, 'success');
            }

            switchTab(tabId) {
                // Update active tab
                document.querySelectorAll('.profile-tab').forEach(tab => {
                    tab.classList.toggle('active', tab.getAttribute('data-tab') === tabId);
                });

                // Show/hide tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.toggle('hidden', content.id !== `${tabId}Tab`);
                });

                // Load tab data
                this.loadTabData(tabId);
            }

            async loadTabData(tabId) {
                const contentElement = document.getElementById(`${tabId}Content`);
                
                switch(tabId) {
                    case 'activity':
                        contentElement.innerHTML = this.getActivityContent();
                        break;
                    case 'communities':
                        contentElement.innerHTML = this.getCommunitiesContent();
                        break;
                    case 'skills':
                        contentElement.innerHTML = this.getSkillsContent();
                        break;
                    case 'achievements':
                        contentElement.innerHTML = this.getAchievementsContent();
                        break;
                    case 'analytics':
                        contentElement.innerHTML = this.getAnalyticsContent();
                        break;
                }
            }

            getActivityContent() {
                return `
                    <div class="space-y-4">
                        <div class="feature-card">
                            <h3 class="text-lg font-bold text-blue-300 mb-3">Recent Activity</h3>
                            <div class="space-y-3">
                                <div class="flex items-center space-x-3 p-3 bg-blue-900/20 rounded-xl">
                                    <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center">
                                        <i class="fas fa-user-plus text-white"></i>
                                    </div>
                                    <div>
                                        <p class="text-white">You joined ConnectSphere</p>
                                        <p class="text-blue-300 text-sm">Just now</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            getCommunitiesContent() {
                return `
                    <div class="text-center py-8">
                        <i class="fas fa-users text-4xl text-blue-400 mb-4"></i>
                        <h3 class="text-xl font-bold text-white mb-2">Join Communities</h3>
                        <p class="text-blue-300 mb-4">Discover and join communities that match your interests</p>
                        <button class="btn-primary">Explore Communities</button>
                    </div>
                `;
            }

            getSkillsContent() {
                return `
                    <div class="space-y-4">
                        <div class="feature-card">
                            <h3 class="text-lg font-bold text-blue-300 mb-3">Your Skills</h3>
                            <div class="flex flex-wrap gap-2 mb-4" id="editableSkills">
                                ${this.userData.skills.map(skill => `
                                    <span class="skill-tag cursor-pointer hover:bg-blue-600/30" onclick="profileManager.editSkill('${skill}')">
                                        ${skill} <i class="fas fa-times ml-1 text-xs"></i>
                                    </span>
                                `).join('')}
                            </div>
                            <div class="flex space-x-2">
                                <input type="text" id="newSkillInput" placeholder="Add a skill..." class="flex-1 glass-effect border border-blue-700 rounded-xl px-3 py-2 text-white">
                                <button class="btn-primary" onclick="profileManager.addSkill()">Add</button>
                            </div>
                        </div>
                    </div>
                `;
            }

            getAchievementsContent() {
                return `
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="feature-card text-center">
                            <div class="w-16 h-16 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-star text-white text-xl"></i>
                            </div>
                            <h4 class="font-bold text-white mb-2">Welcome!</h4>
                            <p class="text-blue-300 text-sm">You joined ConnectSphere</p>
                        </div>
                    </div>
                `;
            }

            getAnalyticsContent() {
                return `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="feature-card">
                            <h4 class="font-bold text-white mb-4">Profile Views</h4>
                            <div class="text-center py-8">
                                <div class="text-3xl font-bold text-blue-400 mb-2">0</div>
                                <p class="text-blue-300">Total profile views</p>
                            </div>
                        </div>
                        <div class="feature-card">
                            <h4 class="font-bold text-white mb-4">Engagement</h4>
                            <div class="text-center py-8">
                                <div class="text-3xl font-bold text-green-400 mb-2">0%</div>
                                <p class="text-blue-300">Engagement rate</p>
                            </div>
                        </div>
                    </div>
                `;
            }

            async addSkill() {
                const input = document.getElementById('newSkillInput');
                const skill = input.value.trim();
                
                if (skill && !this.userData.skills.includes(skill)) {
                    this.userData.skills.push(skill);
                    await this.saveUserProfile();
                    this.updateSkillsAndInterests();
                    input.value = '';
                    this.showToast('Skill added successfully!', 'success');
                }
            }

            async editSkill(skill) {
                if (confirm(`Remove skill "${skill}"?`)) {
                    this.userData.skills = this.userData.skills.filter(s => s !== skill);
                    await this.saveUserProfile();
                    this.updateSkillsAndInterests();
                    this.showToast('Skill removed!', 'success');
                }
            }

            showMoodSelector() {
                const moods = [
                    { id: 'happy', icon: 'fa-smile', label: 'Happy', color: 'text-yellow-400' },
                    { id: 'productive', icon: 'fa-rocket', label: 'Productive', color: 'text-green-400' },
                    { id: 'creative', icon: 'fa-palette', label: 'Creative', color: 'text-purple-400' },
                    { id: 'focused', icon: 'fa-bullseye', label: 'Focused', color: 'text-blue-400' },
                    { id: 'relaxed', icon: 'fa-couch', label: 'Relaxed', color: 'text-indigo-400' }
                ];

                const selector = `
                    <div class="mood-selector">
                        <div class="grid grid-cols-3 gap-2">
                            ${moods.map(mood => `
                                <div class="mood-option text-center p-3 rounded-lg cursor-pointer hover:bg-blue-600/20 transition ${
                                    this.userData.mood === mood.id ? 'bg-blue-600/30 border border-blue-500' : ''
                                }" onclick="profileManager.setMood('${mood.id}')">
                                    <i class="fas ${mood.icon} ${mood.color} text-xl mb-2"></i>
                                    <div class="text-blue-300 text-sm">${mood.label}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;

                // Replace current mood with selector
                document.getElementById('currentMood').innerHTML = selector;
            }

            async setMood(mood) {
                this.userData.mood = mood;
                await this.saveUserProfile();
                this.updateMoodDisplay();
                this.showToast(`Mood set to ${mood}!`, 'success');
            }

            editProfile() {
                this.showToast('Edit profile feature coming soon!', 'info');
            }

            shareProfile() {
                const profileUrl = `${window.location.origin}/profile.html?user=${this.userData.uid}`;
                navigator.clipboard.writeText(profileUrl).then(() => {
                    this.showToast('Profile link copied to clipboard!', 'success');
                });
            }

            manageSocialLinks() {
                this.showToast('Social links manager coming soon!', 'info');
            }

            updateConnectionStatus(status) {
                const statusElement = document.getElementById('connectionStatus');
                statusElement.className = `connection-status ${status}`;
                
                if (status === 'connected') {
                    statusElement.innerHTML = '<i class="fas fa-wifi mr-2"></i><span>Connected to Network</span>';
                }
            }

            showLoading() {
                document.getElementById('loadingSpinner').style.display = 'block';
            }

            hideLoading() {
                document.getElementById('loadingSpinner').style.display = 'none';
            }

            showToast(message, type = 'info') {
                // Create toast element
                const toast = document.createElement('div');
                toast.className = `fixed top-6 left-1/2 transform -translate-x-1/2 glass-effect rounded-2xl px-6 py-4 border ${
                    type === 'success' ? 'border-green-500/30 text-green-400' : 
                    type === 'warning' ? 'border-yellow-500/30 text-yellow-400' : 
                    type === 'error' ? 'border-red-500/30 text-red-400' : 
                    'border-blue-500/30 text-blue-400'
                } z-50`;
                toast.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <i class="fas ${
                            type === 'success' ? 'fa-check-circle' : 
                            type === 'warning' ? 'fa-exclamation-triangle' : 
                            type === 'error' ? 'fa-exclamation-circle' : 
                            'fa-info-circle'
                        }"></i>
                        <span class="font-medium">${message}</span>
                    </div>
                `;
                
                document.body.appendChild(toast);
                
                // Remove toast after 4 seconds
                setTimeout(() => {
                    toast.remove();
                }, 4000);
            }

            async logout() {
                try {
                    this.showLoading();
                    await auth.signOut();
                    // Clear local storage
                    localStorage.removeItem('userEmail');
                    localStorage.removeItem('userId');
                    localStorage.removeItem('userDisplayName');
                    window.location.href = 'login.html';
                } catch (error) {
                    console.error('Logout error:', error);
                    this.hideLoading();
                    this.showToast('Error logging out. Please try again.', 'error');
                }
            }
        }

        // Initialize profile manager when DOM is loaded
        let profileManager;
        document.addEventListener('DOMContentLoaded', () => {
            profileManager = new ProfileManager();
        });
    </script>
</body>
</html>