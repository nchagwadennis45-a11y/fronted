<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kynecta - Advanced Mood-Based Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-messaging-compat.js"></script>
    
    <!-- Add this in head section after tailwind CDN -->
    <meta name="ignore-tailwind-cdn-warning" content="true">
    <script>
        // Suppress Tailwind CDN warning
        window.tailwindConfig = { ignoreCDNWarning: true };
    </script>
    
    <style>
        :root {
            --kynecta-primary: #7C3AED;
            --kynecta-secondary: #10B981;
            --kynecta-accent: #F59E0B;
            --kynecta-dark: #1F2937;
            --kynecta-light: #F9FAFB;
            --kynecta-border: #E5E7EB;
        }

        [data-theme="dark"] {
            --kynecta-primary: #8B5CF6;
            --kynecta-secondary: #34D399;
            --kynecta-accent: #FBBF24;
            --kynecta-dark: #F9FAFB;
            --kynecta-light: #111827;
            --kynecta-border: #374151;
        }

        body {
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            background-color: var(--kynecta-light);
            color: var(--kynecta-dark);
            height: 100vh;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .kynecta-header {
            background: linear-gradient(135deg, var(--kynecta-primary), var(--kynecta-secondary));
            color: white;
        }

        .message-sent {
            background: linear-gradient(135deg, var(--kynecta-primary), var(--kynecta-secondary));
            color: white;
            margin-left: auto;
            border-radius: 18px 18px 4px 18px;
        }

        .message-received {
            background-color: var(--kynecta-light);
            color: var(--kynecta-dark);
            border: 1px solid var(--kynecta-border);
            border-radius: 18px 18px 18px 4px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .tab-active {
            border-bottom: 3px solid var(--kynecta-primary);
            color: var(--kynecta-primary);
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cccccc;
            border-radius: 3px;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            background: var(--kynecta-light);
            color: var(--kynecta-dark);
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 10000;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            border-left: 4px solid var(--kynecta-primary);
        }
        .toast.show {
            transform: translateX(0);
        }
        .toast.error {
            border-left-color: #EF4444;
        }
        .toast.success {
            border-left-color: #10B981;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: inline-flex;
            align-items: center;
            padding: 8px 12px;
            background: var(--kynecta-light);
            border-radius: 18px;
            font-size: 0.875rem;
            color: var(--kynecta-dark);
        }
        .typing-dots {
            display: flex;
            margin-left: 8px;
        }
        .typing-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background-color: var(--kynecta-dark);
            margin: 0 1px;
            animation: typing 1.4s infinite ease-in-out;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* Dark mode improvements */
        [data-theme="dark"] .message-received {
            background-color: #374151;
            color: #F9FAFB;
        }

        [data-theme="dark"] .bg-white {
            background-color: #1F2937;
        }

        [data-theme="dark"] .bg-gray-50 {
            background-color: #374151;
        }

        [data-theme="dark"] .bg-gray-100 {
            background-color: #4B5563;
        }

        [data-theme="dark"] .text-gray-500 {
            color: #9CA3AF;
        }

        [data-theme="dark"] .text-gray-600 {
            color: #D1D5DB;
        }

        [data-theme="dark"] .border-gray-200 {
            border-color: #374151;
        }

        /* Animation classes */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        .slide-up {
            animation: slideUp 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* New styles for enhanced functionality */
        .message-container {
            display: flex;
            margin-bottom: 16px;
            padding: 0 16px;
        }

        .message-container.sent {
            justify-content: flex-end;
        }

        .message-container.received {
            justify-content: flex-start;
        }

        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            position: relative;
            word-wrap: break-word;
        }

        .message-time {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 4px;
            text-align: right;
        }

        .message-status {
            position: absolute;
            bottom: 4px;
            right: 8px;
            font-size: 0.75rem;
        }

        .date-separator {
            text-align: center;
            margin: 20px 0;
            position: relative;
        }

        .date-separator::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--kynecta-border);
            z-index: 1;
        }

        .date-separator span {
            background: var(--kynecta-light);
            padding: 0 12px;
            position: relative;
            z-index: 2;
            color: var(--kynecta-dark);
            font-size: 0.875rem;
        }

        .scroll-to-bottom {
            position: absolute;
            bottom: 80px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--kynecta-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 10;
            transition: all 0.3s;
        }

        .scroll-to-bottom:hover {
            transform: scale(1.1);
        }

        .upload-progress {
            width: 100%;
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 8px;
        }

        .upload-progress-bar {
            height: 100%;
            background: var(--kynecta-primary);
            transition: width 0.3s;
        }

        .media-preview {
            max-width: 200px;
            border-radius: 12px;
            margin-top: 8px;
        }

        .online-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #10B981;
            position: absolute;
            bottom: 0;
            right: 0;
            border: 2px solid white;
        }

        .contact-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid var(--kynecta-border);
        }

        .contact-item:hover {
            background: var(--kynecta-border);
        }

        .contact-item.active {
            background: rgba(124, 58, 237, 0.1);
        }

        .contact-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            margin-right: 12px;
            position: relative;
        }

        .contact-info {
            flex: 1;
        }

        .contact-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .contact-status {
            font-size: 0.875rem;
            color: #6B7280;
        }

        .last-seen {
            font-size: 0.75rem;
            color: #9CA3AF;
        }

        /* Settings specific styles */
        .settings-section {
            padding: 16px;
            border-bottom: 1px solid var(--kynecta-border);
        }

        .settings-section:last-child {
            border-bottom: none;
        }

        .settings-item {
            display: flex;
            justify-content: between;
            align-items: center;
            padding: 12px 0;
            cursor: pointer;
        }

        .settings-item:not(:last-child) {
            border-bottom: 1px solid var(--kynecta-border);
        }

        .settings-item-content {
            flex: 1;
        }

        .settings-item-title {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .settings-item-description {
            font-size: 0.875rem;
            color: #6B7280;
        }

        .settings-item-action {
            color: #6B7280;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--kynecta-primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }

        /* Status ring */
        .status-ring {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, var(--kynecta-secondary) 0%, var(--kynecta-secondary) var(--progress, 0%), #E5E5E5 var(--progress, 0%), #E5E5E5 100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .status-ring-inner {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--kynecta-light);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Video call container */
        .video-call-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 1000;
            display: none;
        }
        .local-video {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 200px;
            height: 150px;
            border: 2px solid var(--kynecta-primary);
            border-radius: 10px;
        }
        .remote-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .call-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
        }
        .call-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        .call-end {
            background: #EF4444;
            color: white;
        }
        .call-mute {
            background: #6B7280;
            color: white;
        }
        .call-video {
            background: var(--kynecta-primary);
            color: white;
        }

        /* Mood-based backgrounds */
        .mood-happy { 
            background: linear-gradient(135deg, #FFFBEB, #FEF3C7);
            border-left: 4px solid var(--kynecta-accent);
        }
        .mood-calm { 
            background: linear-gradient(135deg, #EFF6FF, #DBEAFE);
            border-left: 4px solid #3B82F6;
        }
        .mood-energetic { 
            background: linear-gradient(135deg, #FEF2F2, #FECACA);
            border-left: 4px solid #EF4444;
        }
        .mood-focused { 
            background: linear-gradient(135deg, #F0FDF4, #DCFCE7);
            border-left: 4px solid #16A34A;
        }
        .mood-creative { 
            background: linear-gradient(135deg, #FAF5FF, #E9D5FF);
            border-left: 4px solid var(--kynecta-primary);
        }

        .mood-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        .mood-happy-indicator { background-color: var(--kynecta-accent); }
        .mood-calm-indicator { background-color: #3B82F6; }
        .mood-energetic-indicator { background-color: #EF4444; }
        .mood-focused-indicator { background-color: #16A34A; }
        .mood-creative-indicator { background-color: var(--kynecta-primary); }

        /* Reaction picker */
        .reaction-picker {
            position: absolute;
            bottom: 100%;
            left: 0;
            background: var(--kynecta-light);
            border: 1px solid var(--kynecta-border);
            border-radius: 24px;
            padding: 8px;
            display: flex;
            gap: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 100;
        }

        .reaction-option {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.2rem;
        }

        .reaction-option:hover {
            transform: scale(1.2);
            background: var(--kynecta-border);
        }

        /* Status creation styles */
        .status-creation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .status-creation-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow: hidden;
        }

        .status-options {
            display: flex;
            padding: 16px;
            gap: 16px;
            border-bottom: 1px solid #e5e7eb;
        }

        .status-option {
            flex: 1;
            text-align: center;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .status-option.active {
            background: #f3f4f6;
            color: var(--kynecta-primary);
        }

        .status-preview {
            padding: 20px;
            text-align: center;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .status-emoji-input {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .status-media-preview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 12px;
        }

        .status-text-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 16px;
        }

        .status-audio-preview {
            width: 100%;
            margin-bottom: 16px;
        }

        .status-video-preview {
            width: 100%;
            max-height: 300px;
            border-radius: 12px;
            margin-bottom: 16px;
        }

        /* Profile photo and cover upload */
        .profile-upload {
            position: relative;
            display: inline-block;
        }

        .profile-upload input {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .profile-cover {
            height: 200px;
            background: linear-gradient(135deg, var(--kynecta-primary), var(--kynecta-secondary));
            position: relative;
            border-radius: 16px 16px 0 0;
        }

        .profile-cover-edit {
            position: absolute;
            bottom: 16px;
            right: 16px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
        }

        .profile-photo-edit {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 6px;
            border-radius: 50%;
            cursor: pointer;
        }

        /* Color picker for notification light */
        .color-picker {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .color-option {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .color-option.active {
            border-color: var(--kynecta-dark);
        }

        /* Video conference styles */
        .video-conference {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 1000;
            display: none;
        }

        .conference-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 10px;
            padding: 20px;
            height: calc(100% - 80px);
        }

        .participant-video {
            background: #333;
            border-radius: 8px;
            position: relative;
        }

        .participant-name {
            position: absolute;
            bottom: 8px;
            left: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.875rem;
        }

        /* Emoji Picker Styles */
        .emoji-picker {
            position: absolute;
            bottom: 100%;
            left: 0;
            background: var(--kynecta-light);
            border: 1px solid var(--kynecta-border);
            border-radius: 16px;
            padding: 12px;
            width: 300px;
            max-height: 300px;
            overflow-y: auto;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 100;
            display: none;
        }

        .emoji-category {
            margin-bottom: 12px;
        }

        .emoji-category-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--kynecta-dark);
            font-size: 0.875rem;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 4px;
        }

        .emoji-option {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.2rem;
        }

        .emoji-option:hover {
            background: var(--kynecta-border);
            transform: scale(1.1);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .chat-list-container {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: 20;
                transition: transform 0.3s;
            }

            .chat-list-container.hidden {
                transform: translateX(-100%);
            }

            .chat-area {
                width: 100%;
            }

            .message-bubble {
                max-width: 85%;
            }
        }

        @media (min-width: 769px) {
            .mobile-only {
                display: none;
            }
        }
    </style>
</head>
<body class="h-full overflow-hidden" data-theme="light">
    <!-- Toast Notifications -->
    <div id="toastContainer"></div>

    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="w-16 h-16 bg-gradient-to-r from-purple-500 to-green-500 rounded-2xl flex items-center justify-center mx-auto mb-4 animate-pulse">
                <span class="text-white text-2xl">ðŸ§ </span>
            </div>
            <h2 class="text-xl font-semibold text-gray-700 mb-2">Kynecta</h2>
            <p class="text-gray-500">Initializing mood-aware chat...</p>
        </div>
    </div>

    <!-- Main Chat App -->
    <div id="chatApp" class="hidden h-full">
        <!-- Bottom Navigation Tabs -->
        <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 flex justify-around py-3 z-30 md:hidden shadow-lg">
            <button class="tab-btn flex flex-col items-center text-purple-600 tab-active" data-tab="chats">
                <i class="fas fa-comments text-xl"></i>
                <span class="text-xs mt-1">Chats</span>
            </button>
            <button class="tab-btn flex flex-col items-center text-gray-500" data-tab="friends">
                <i class="fas fa-user-friends text-xl"></i>
                <span class="text-xs mt-1">Friends</span>
            </button>
            <button class="tab-btn flex flex-col items-center text-gray-500" data-tab="updates">
                <i class="fas fa-bell text-xl"></i>
                <span class="text-xs mt-1">Updates</span>
            </button>
            <button class="tab-btn flex flex-col items-center text-gray-500" data-tab="calls">
                <i class="fas fa-phone text-xl"></i>
                <span class="text-xs mt-1">Calls</span>
            </button>
            <button class="tab-btn flex flex-col items-center text-gray-500" data-tab="tools">
                <i class="fas fa-tools text-xl"></i>
                <span class="text-xs mt-1">Tools</span>
            </button>
        </div>

        <div class="flex h-full pb-16 md:pb-0">
            <!-- Sidebar/Friend List -->
            <div id="chatListContainer" class="chat-list-container w-full md:w-1/3 lg:w-1/4 bg-white flex flex-col border-r border-gray-200">
                <!-- User Profile Header -->
                <div class="kynecta-header p-4 flex justify-between items-center">
                    <div class="flex items-center">
                        <img id="userAvatar" class="w-12 h-12 rounded-2xl bg-white/20 flex items-center justify-center text-white font-semibold mr-3 object-cover border-2 border-white/30" src="" alt="Profile">
                        <div>
                            <span id="userName" class="font-semibold text-white block">Loading...</span>
                            <span id="userMood" class="text-white/80 text-sm">ðŸŸ¢ Online</span>
                        </div>
                    </div>
                    <div class="flex space-x-3 text-white">
                        <i class="fas fa-users text-xl cursor-pointer hover:scale-110 transition-transform" id="newGroupBtn"></i>
                        <i class="fas fa-cog text-xl cursor-pointer hover:scale-110 transition-transform" id="menuBtn"></i>
                        <button id="themeToggle" class="text-xl cursor-pointer hover:scale-110 transition-transform">
                            <i class="fas fa-moon" id="themeIcon"></i>
                        </button>
                    </div>
                </div>

                <!-- Tabs for Desktop -->
                <div class="hidden md:flex bg-white border-b border-gray-200">
                    <button class="tab-btn flex-1 py-4 text-center text-purple-600 tab-active font-semibold" data-tab="chats">
                        <i class="fas fa-comments mr-2"></i>Chats
                    </button>
                    <button class="tab-btn flex-1 py-4 text-center text-gray-500 font-semibold" data-tab="friends">
                        <i class="fas fa-user-friends mr-2"></i>Friends
                    </button>
                    <button class="tab-btn flex-1 py-4 text-center text-gray-500 font-semibold" data-tab="updates">
                        <i class="fas fa-bell mr-2"></i>Updates
                    </button>
                    <button class="tab-btn flex-1 py-4 text-center text-gray-500 font-semibold" data-tab="calls">
                        <i class="fas fa-phone mr-2"></i>Calls
                    </button>
                    <button class="tab-btn flex-1 py-4 text-center text-gray-500 font-semibold" data-tab="tools">
                        <i class="fas fa-tools mr-2"></i>Tools
                    </button>
                </div>

                <!-- Search -->
                <div class="bg-white p-3">
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-search text-gray-400"></i>
                        </div>
                        <input type="text" id="searchInput" class="w-full bg-gray-100 rounded-xl py-3 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:bg-white transition-all" placeholder="Search connections...">
                    </div>
                </div>

                <!-- Tab Content -->
                <div id="tabContent" class="flex-1 overflow-y-auto custom-scrollbar">
                    <!-- Chats Tab -->
                    <div id="chatsTab" class="tab-panel active">
                        <div id="chatList">
                            <div id="noChatsMessage" class="p-8 text-center text-gray-500">
                                <i class="fas fa-comments text-4xl mb-3 text-gray-300 block"></i>
                                <p>No conversations yet</p>
                                <p class="text-sm mt-1">Start a conversation to begin</p>
                            </div>
                        </div>
                    </div>

                    <!-- Friends Tab -->
                    <div id="friendsTab" class="tab-panel hidden">
                        <div class="p-4">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="font-semibold text-lg">Friends</h3>
                                <button id="addFriendBtn" class="bg-purple-600 text-white px-4 py-2 rounded-xl hover:bg-purple-700 transition-colors">
                                    <i class="fas fa-user-plus mr-2"></i>Add Friend
                                </button>
                            </div>
                            
                            <div class="mb-4">
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fas fa-search text-gray-400"></i>
                                    </div>
                                    <input type="text" id="friendSearch" class="w-full bg-gray-100 rounded-xl py-3 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:bg-white transition-all" placeholder="Search friends by name, email, or phone...">
                                </div>
                            </div>
                            
                            <div id="friendsList" class="space-y-2">
                                <!-- Friends will be populated here -->
                            </div>
                            
                            <div id="noFriendsMessage" class="p-8 text-center text-gray-500">
                                <i class="fas fa-user-friends text-4xl mb-3 text-gray-300 block"></i>
                                <p>No friends yet</p>
                                <p class="text-sm mt-1">Add friends to start messaging</p>
                            </div>
                        </div>
                    </div>

                    <!-- Updates Tab -->
                    <div id="updatesTab" class="tab-panel hidden">
                        <div class="p-4">
                            <div class="flex items-center space-x-4 mb-6 cursor-pointer p-3 rounded-2xl hover:bg-gray-50 transition-colors" id="myStatus">
                                <div class="status-ring" style="--progress: 0%">
                                    <div class="status-ring-inner">
                                        <i class="fas fa-plus text-green-500 text-xl"></i>
                                    </div>
                                </div>
                                <div>
                                    <p class="font-semibold">My Status</p>
                                    <p class="text-sm text-gray-500">Tap to share update</p>
                                </div>
                            </div>

                            <h3 class="text-sm font-semibold text-gray-500 mb-3 px-3">Recent Updates</h3>
                            <div id="statusUpdates" class="space-y-3">
                                <!-- Status updates will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Calls Tab -->
                    <div id="callsTab" class="tab-panel hidden">
                        <div class="p-4">
                            <!-- Favorites Section -->
                            <div class="mb-6">
                                <div class="flex justify-between items-center mb-3">
                                    <h3 class="font-semibold">Favorites</h3>
                                    <button class="text-purple-600 text-sm font-semibold" id="manageFavorites">Manage</button>
                                </div>
                                <div id="favoritesList" class="space-y-3">
                                    <div class="flex items-center space-x-3 p-3 rounded-xl bg-gray-50">
                                        <div class="w-12 h-12 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center text-white">
                                            <i class="fas fa-users"></i>
                                        </div>
                                        <div class="flex-1">
                                            <p class="font-medium">Group</p>
                                            <p class="text-sm text-gray-500">Add favorite</p>
                                        </div>
                                        <button class="text-purple-600">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Recent Calls -->
                            <h3 class="font-semibold mb-3">Recent Calls</h3>
                            <div id="recentCalls" class="space-y-4">
                                <!-- Recent calls will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Tools Tab -->
                    <div id="toolsTab" class="tab-panel hidden">
                        <div class="p-4 space-y-4">
                            <!-- Mood Settings -->
                            <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-200">
                                <h3 class="font-semibold mb-3 flex items-center">
                                    <i class="fas fa-smile mr-2 text-purple-500"></i>
                                    Current Mood
                                </h3>
                                <div class="flex flex-wrap gap-2 mb-3">
                                    <button class="mood-option px-3 py-2 rounded-full text-sm border-2 border-gray-200 hover:border-purple-300 transition-colors" data-mood="happy">ðŸ˜Š Happy</button>
                                    <button class="mood-option px-3 py-2 rounded-full text-sm border-2 border-gray-200 hover:border-blue-300 transition-colors" data-mood="calm">ðŸ˜Œ Calm</button>
                                    <button class="mood-option px-3 py-2 rounded-full text-sm border-2 border-gray-200 hover:border-red-300 transition-colors" data-mood="energetic">âš¡ Energetic</button>
                                    <button class="mood-option px-3 py-2 rounded-full text-sm border-2 border-gray-200 hover:border-green-300 transition-colors" data-mood="focused">ðŸŽ¯ Focused</button>
                                    <button class="mood-option px-3 py-2 rounded-full text-sm border-2 border-gray-200 hover:border-purple-300 transition-colors" data-mood="creative">ðŸŽ¨ Creative</button>
                                </div>
                                <p class="text-xs text-gray-500">Your mood influences chat suggestions and themes</p>
                            </div>

                            <!-- Quick Actions -->
                            <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-200">
                                <h3 class="font-semibold mb-3">Quick Actions</h3>
                                <div class="grid grid-cols-2 gap-3">
                                    <button class="p-4 bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl text-center hover:shadow-md transition-all" id="privacyBtn">
                                        <i class="fas fa-shield-alt text-2xl mb-2 block text-purple-600"></i>
                                        <p class="text-sm font-medium">Privacy</p>
                                    </button>
                                    <button class="p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl text-center hover:shadow-md transition-all" id="settingsBtn">
                                        <i class="fas fa-cog text-2xl mb-2 block text-blue-600"></i>
                                        <p class="text-sm font-medium">Settings</p>
                                    </button>
                                    <button class="p-4 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl text-center hover:shadow-md transition-all" id="storageBtn">
                                        <i class="fas fa-database text-2xl mb-2 block text-gray-600"></i>
                                        <p class="text-sm font-medium">Storage</p>
                                    </button>
                                    <button class="p-4 bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl text-center hover:shadow-md transition-all" id="inviteBtn">
                                        <i class="fas fa-user-plus text-2xl mb-2 block text-orange-600"></i>
                                        <p class="text-sm font-medium">Invite</p>
                                    </button>
                                </div>
                            </div>

                            <!-- Business Tools -->
                            <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-200">
                                <h3 class="font-semibold mb-3 flex items-center">
                                    <i class="fas fa-briefcase mr-2 text-purple-500"></i>
                                    Business Tools
                                </h3>
                                <div class="space-y-3">
                                    <button class="w-full p-3 bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl text-left hover:shadow-md transition-all flex items-center justify-between" id="catalogueBtn">
                                        <div>
                                            <p class="font-medium text-purple-700">Catalogue</p>
                                            <p class="text-sm text-purple-600">Manage your product catalogue</p>
                                        </div>
                                        <i class="fas fa-shopping-cart text-purple-500"></i>
                                    </button>
                                    <button class="w-full p-3 bg-gradient-to-r from-green-50 to-teal-50 rounded-xl text-left hover:shadow-md transition-all flex items-center justify-between" id="advertiseBtn">
                                        <div>
                                            <p class="font-medium text-green-700">Advertise</p>
                                            <p class="text-sm text-green-600">Create and manage ads</p>
                                        </div>
                                        <i class="fas fa-bullhorn text-green-500"></i>
                                    </button>
                                    <button class="w-full p-3 bg-gradient-to-r from-orange-50 to-amber-50 rounded-xl text-left hover:shadow-md transition-all flex items-center justify-between" id="labelsBtn">
                                        <div>
                                            <p class="font-medium text-orange-700">Labels</p>
                                            <p class="text-sm text-orange-600">Organize with labels</p>
                                        </div>
                                        <i class="fas fa-tags text-orange-500"></i>
                                    </button>
                                    <button class="w-full p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl text-left hover:shadow-md transition-all flex items-center justify-between" id="greetingBtn">
                                        <div>
                                            <p class="font-medium text-blue-700">Greeting Message</p>
                                            <p class="text-sm text-blue-600">Set up welcome messages</p>
                                        </div>
                                        <i class="fas fa-comment-dots text-blue-500"></i>
                                    </button>
                                    <button class="w-full p-3 bg-gradient-to-r from-red-50 to-pink-50 rounded-xl text-left hover:shadow-md transition-all flex items-center justify-between" id="awayBtn">
                                        <div>
                                            <p class="font-medium text-red-700">Away Message</p>
                                            <p class="text-sm text-red-600">Set up away messages</p>
                                        </div>
                                        <i class="fas fa-clock text-red-500"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- AI Features -->
                            <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-200">
                                <h3 class="font-semibold mb-3 flex items-center">
                                    <i class="fas fa-robot mr-2 text-purple-500"></i>
                                    AI Assistant
                                </h3>
                                <div class="space-y-3">
                                    <button class="w-full p-3 bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl text-left hover:shadow-md transition-all flex items-center justify-between" id="aiSummarize">
                                        <div>
                                            <p class="font-medium text-purple-700">Summarize Conversation</p>
                                            <p class="text-sm text-purple-600">Get AI summary of recent messages</p>
                                        </div>
                                        <i class="fas fa-sparkles text-purple-500"></i>
                                    </button>
                                    <button class="w-full p-3 bg-gradient-to-r from-green-50 to-teal-50 rounded-xl text-left hover:shadow-md transition-all flex items-center justify-between" id="aiReply">
                                        <div>
                                            <p class="font-medium text-green-700">Smart Reply Suggestions</p>
                                            <p class="text-sm text-green-600">Get context-aware reply ideas</p>
                                        </div>
                                        <i class="fas fa-lightbulb text-green-500"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Area -->
            <div class="chat-area flex-1 flex flex-col bg-gray-50">
                <!-- Chat Header -->
                <div id="chatHeader" class="kynecta-header p-4 flex justify-between items-center hidden">
                    <div class="flex items-center">
                        <div class="mobile-only mr-3">
                            <i class="fas fa-arrow-left text-white cursor-pointer hover:scale-110 transition-transform" id="backToChats"></i>
                        </div>
                        <img id="chatAvatar" class="w-12 h-12 rounded-2xl bg-white/20 flex items-center justify-center text-white font-semibold mr-3 object-cover border-2 border-white/30" src="" alt="Chat">
                        <div>
                            <h3 id="chatTitle" class="font-semibold text-white">Select a chat</h3>
                            <p id="chatStatus" class="text-white/80 text-sm flex items-center">
                                <span id="moodIndicator" class="mood-indicator mood-happy-indicator"></span>
                                <span id="statusText">Choose a conversation</span>
                                <span id="typingIndicator" class="typing-indicator hidden ml-2">
                                    typing
                                    <div class="typing-dots">
                                        <div class="typing-dot"></div>
                                        <div class="typing-dot"></div>
                                        <div class="typing-dot"></div>
                                    </div>
                                </span>
                            </p>
                        </div>
                    </div>
                    <div class="flex space-x-3 text-white">
                        <i class="fas fa-video text-xl cursor-pointer hover:scale-110 transition-transform" id="videoCallBtn"></i>
                        <i class="fas fa-phone text-xl cursor-pointer hover:scale-110 transition-transform" id="voiceCallBtn"></i>
                        <i class="fas fa-ellipsis-v text-xl cursor-pointer hover:scale-110 transition-transform" id="chatMenuBtn"></i>
                    </div>
                </div>

                <!-- Messages Area -->
                <div id="messagesContainer" class="flex-1 overflow-y-auto p-4 custom-scrollbar relative">
                    <div id="noMessagesMessage" class="text-center text-gray-500 py-10">
                        <i class="fas fa-comments text-4xl mb-3 text-gray-300 block"></i>
                        <p>No messages yet</p>
                        <p class="text-sm mt-1">Select a chat to start messaging</p>
                    </div>
                    <!-- Messages will be populated from Firebase -->
                    <div id="scrollToBottom" class="scroll-to-bottom hidden">
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>

                <!-- Mood Suggestion -->
                <div id="moodSuggestion" class="hidden mx-4 mb-2 p-4 rounded-2xl bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm font-semibold text-purple-800 flex items-center">
                                <i class="fas fa-smile mr-2"></i>
                                Mood-based Suggestion
                            </p>
                            <p id="suggestionText" class="text-sm text-purple-600 mt-1"></p>
                        </div>
                        <button id="dismissSuggestion" class="text-purple-400 hover:text-purple-600 transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>

                <!-- Input Area -->
                <div id="inputArea" class="bg-white p-4 border-t border-gray-200 hidden">
                    <div class="flex items-center">
                        <div class="flex space-x-2 mr-3">
                            <button class="w-12 h-12 rounded-2xl flex items-center justify-center text-gray-500 hover:bg-purple-50 hover:text-purple-600 transition-all" id="attachBtn">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button class="w-12 h-12 rounded-2xl flex items-center justify-center text-gray-500 hover:bg-purple-50 hover:text-purple-600 transition-all" id="cameraBtn">
                                <i class="fas fa-camera"></i>
                            </button>
                            <button class="w-12 h-12 rounded-2xl flex items-center justify-center text-gray-500 hover:bg-purple-50 hover:text-purple-600 transition-all" id="emojiBtn">
                                <i class="fas fa-smile"></i>
                            </button>
                        </div>
                        <div class="flex-1 relative">
                            <input type="text" id="messageInput" class="w-full bg-gray-100 py-3 px-4 rounded-2xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:bg-white transition-all" placeholder="Type a message..." disabled>
                            <!-- Emoji Picker -->
                            <div id="emojiPicker" class="emoji-picker">
                                <!-- Emoji categories will be populated here -->
                            </div>
                            <!-- Typing Indicator -->
                            <div id="isTyping" class="absolute -top-6 left-0 text-xs text-gray-500 hidden">
                                <span id="typingUsers"></span> is typing...
                            </div>
                        </div>
                        <div class="ml-3">
                            <button id="sendBtn" class="w-12 h-12 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-2xl flex items-center justify-center hover:opacity-90 transition-all shadow-lg" disabled>
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>

                    <!-- File Preview -->
                    <div id="filePreview" class="hidden mt-3 p-3 bg-gray-100 rounded-xl">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas fa-file text-gray-600 mr-3"></i>
                                <div>
                                    <p id="fileName" class="font-medium"></p>
                                    <p id="fileSize" class="text-sm text-gray-500"></p>
                                </div>
                            </div>
                            <div class="upload-progress">
                                <div id="uploadProgressBar" class="upload-progress-bar" style="width: 0%"></div>
                            </div>
                            <button id="removeFile" class="text-gray-500 hover:text-gray-700 ml-3">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Video Conference -->
    <div class="video-conference" id="videoConference">
        <div class="conference-grid" id="conferenceGrid">
            <!-- Participant videos will be added here -->
        </div>
        <div class="call-controls">
            <button class="call-btn call-mute" id="conferenceMuteBtn">
                <i class="fas fa-microphone"></i>
            </button>
            <button class="call-btn call-video" id="conferenceVideoBtn">
                <i class="fas fa-video"></i>
            </button>
            <button class="call-btn call-end" id="conferenceEndBtn">
                <i class="fas fa-phone"></i>
            </button>
        </div>
    </div>

    <!-- Video Call Container -->
    <div class="video-call-container" id="videoCallContainer">
        <video class="remote-video" id="remoteVideo" autoplay></video>
        <video class="local-video" id="localVideo" autoplay muted></video>
        <div class="call-controls">
            <button class="call-btn call-mute" id="muteBtn">
                <i class="fas fa-microphone"></i>
            </button>
            <button class="call-btn call-video" id="videoToggleBtn">
                <i class="fas fa-video"></i>
            </button>
            <button class="call-btn call-end" id="endCallBtn">
                <i class="fas fa-phone"></i>
            </button>
        </div>
    </div>

    <!-- Status Creation Modal -->
    <div id="statusCreation" class="status-creation">
        <div class="status-creation-content">
            <div class="kynecta-header p-4">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Create Status Update</h3>
                    <button id="closeStatusCreation" class="text-white/80 hover:text-white transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="status-options">
                <div class="status-option active" data-type="emoji">
                    <i class="fas fa-smile text-xl mb-2"></i>
                    <p>Emoji</p>
                </div>
                <div class="status-option" data-type="text">
                    <i class="fas fa-font text-xl mb-2"></i>
                    <p>Text</p>
                </div>
                <div class="status-option" data-type="image">
                    <i class="fas fa-image text-xl mb-2"></i>
                    <p>Image</p>
                </div>
                <div class="status-option" data-type="video">
                    <i class="fas fa-video text-xl mb-2"></i>
                    <p>Video</p>
                </div>
                <div class="status-option" data-type="audio">
                    <i class="fas fa-music text-xl mb-2"></i>
                    <p>Audio</p>
                </div>
            </div>
            
            <div class="status-preview">
                <div id="emojiPreview" class="status-emoji-input" contenteditable="true">ðŸ˜Š</div>
                <div id="textPreview" class="hidden">
                    <textarea id="statusTextInput" class="status-text-input" placeholder="What's on your mind?"></textarea>
                </div>
                <div id="imagePreview" class="hidden">
                    <img id="statusImagePreview" class="status-media-preview hidden" alt="Status image preview">
                    <button id="uploadImageBtn" class="bg-purple-600 text-white px-4 py-2 rounded-xl hover:bg-purple-700 transition-colors">
                        <i class="fas fa-upload mr-2"></i>Upload Image
                    </button>
                </div>
                <div id="videoPreview" class="hidden">
                    <video id="statusVideoPreview" class="status-video-preview hidden" controls></video>
                    <button id="uploadVideoBtn" class="bg-purple-600 text-white px-4 py-2 rounded-xl hover:bg-purple-700 transition-colors">
                        <i class="fas fa-upload mr-2"></i>Upload Video (6s max)
                    </button>
                </div>
                <div id="audioPreview" class="hidden">
                    <audio id="statusAudioPreview" class="status-audio-preview hidden" controls></audio>
                    <button id="uploadAudioBtn" class="bg-purple-600 text-white px-4 py-2 rounded-xl hover:bg-purple-700 transition-colors">
                        <i class="fas fa-upload mr-2"></i>Upload Audio (6s max)
                    </button>
                </div>
            </div>
            
            <div class="p-4 border-t border-gray-200">
                <button id="postStatus" class="w-full py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                    Post Status
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Settings</h3>
                    <button id="closeSettings" class="text-white/80 hover:text-white transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar">
                <!-- Profile Section -->
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center space-x-4 mb-4">
                        <div class="profile-upload">
                            <div class="w-16 h-16 rounded-full bg-gradient-to-r from-purple-500 to-green-500 flex items-center justify-center text-white text-xl font-bold">
                                <img id="settingsProfilePic" class="w-full h-full rounded-full object-cover" src="" alt="Profile">
                            </div>
                            <input type="file" id="profilePicUpload" accept="image/*">
                            <div class="profile-photo-edit">
                                <i class="fas fa-camera"></i>
                            </div>
                        </div>
                        <div>
                            <h4 class="font-semibold text-lg" id="settingsUserName">Denis Chacha</h4>
                            <p class="text-gray-500 text-sm">Life without Christ is motion without meaning</p>
                        </div>
                    </div>
                    
                    <div class="settings-item" id="profileSettingsBtn">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Profile</div>
                            <div class="settings-item-description">Edit your profile information</div>
                        </div>
                        <div class="settings-item-action">
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                </div>

                <!-- Account Section -->
                <div class="settings-section">
                    <h4 class="font-semibold mb-4 text-lg text-gray-800">Account</h4>
                    <div class="space-y-1">
                        <div class="settings-item" id="securitySettingsBtn">
                            <div class="settings-item-content">
                                <div class="settings-item-title">Security notifications</div>
                                <div class="settings-item-description">Passkeys, two-step verification</div>
                            </div>
                            <div class="settings-item-action">
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </div>
                        </div>
                        
                        <div class="settings-item" id="privacySettingsBtn">
                            <div class="settings-item-content">
                                <div class="settings-item-title">Privacy</div>
                                <div class="settings-item-description">Block contacts, disappearing messages</div>
                            </div>
                            <div class="settings-item-action">
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </div>
                        </div>
                        
                        <div class="settings-item" id="avatarSettingsBtn">
                            <div class="settings-item-content">
                                <div class="settings-item-title">Avatar</div>
                                <div class="settings-item-description">Create, edit, profile photo</div>
                            </div>
                            <div class="settings-item-action">
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </div>
                        </div>
                        
                        <div class="settings-item" id="favoritesSettingsBtn">
                            <div class="settings-item-content">
                                <div class="settings-item-title">Favorites</div>
                                <div class="settings-item-description">Add, reorder, remove</div>
                            </div>
                            <div class="settings-item-action">
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </div>
                        </div>
                        
                        <div class="settings-item" id="accessibilityBtn">
                            <div class="settings-item-content">
                                <div class="settings-item-title">Accessibility</div>
                                <div class="settings-item-description">Customize for your needs</div>
                            </div>
                            <div class="settings-item-action">
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notifications Section -->
                <div class="settings-section">
                    <h4 class="font-semibold mb-4 text-lg text-gray-800">Notifications</h4>
                    <div class="space-y-1">
                        <div class="settings-item" id="notificationsSettingsBtn">
                            <div class="settings-item-content">
                                <div class="settings-item-title">Notification Settings</div>
                                <div class="settings-item-description">Customize message, group & call notifications</div>
                            </div>
                            <div class="settings-item-action">
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Storage & Data Section -->
                <div class="settings-section">
                    <h4 class="font-semibold mb-4 text-lg text-gray-800">Storage & Data</h4>
                    <div class="space-y-1">
                        <div class="settings-item" id="storageSettingsBtn">
                            <div class="settings-item-content">
                                <div class="settings-item-title">Storage and data</div>
                                <div class="settings-item-description">Network usage, auto-download</div>
                            </div>
                            <div class="settings-item-action">
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- App Language Section -->
                <div class="settings-section">
                    <h4 class="font-semibold mb-4 text-lg text-gray-800">App Language</h4>
                    <div class="space-y-1">
                        <div class="settings-item" id="languageSettingsBtn">
                            <div class="settings-item-content">
                                <div class="settings-item-title">Language</div>
                                <div class="settings-item-description">Choose your preferred language</div>
                            </div>
                            <div class="settings-item-action">
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chats Section -->
                <div class="settings-section">
                    <h4 class="font-semibold mb-4 text-lg text-gray-800">Chats</h4>
                    <div class="space-y-1">
                        <div class="settings-item" id="chatsSettingsBtn">
                            <div class="settings-item-content">
                                <div class="settings-item-title">Chat settings</div>
                                <div class="settings-item-description">Theme, wallpapers, chat history</div>
                            </div>
                            <div class="settings-item-action">
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Help Section -->
                <div class="settings-section">
                    <h4 class="font-semibold mb-4 text-lg text-gray-800">Help & Support</h4>
                    <div class="space-y-1">
                        <div class="settings-item" id="helpCenterBtn">
                            <div class="settings-item-content">
                                <div class="settings-item-title">Help Center</div>
                                <div class="settings-item-description">Get help and tutorials</div>
                            </div>
                            <div class="settings-item-action">
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </div>
                        </div>
                        
                        <div class="settings-item" id="contactUsBtn">
                            <div class="settings-item-content">
                                <div class="settings-item-title">Contact Us</div>
                                <div class="settings-item-description">Reach out for support</div>
                            </div>
                            <div class="settings-item-action">
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </div>
                        </div>
                        
                        <div class="settings-item" id="appInfoBtn">
                            <div class="settings-item-content">
                                <div class="settings-item-title">App Info</div>
                                <div class="settings-item-description">Version and about</div>
                            </div>
                            <div class="settings-item-action">
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Invite Section -->
                <div class="settings-section">
                    <h4 class="font-semibold mb-4 text-lg text-gray-800">Invite</h4>
                    <div class="space-y-1">
                        <div class="settings-item" id="inviteContactBtn">
                            <div class="settings-item-content">
                                <div class="settings-item-title">Invite a Contact</div>
                                <div class="settings-item-description">Share Kynecta with friends</div>
                            </div>
                            <div class="settings-item-action">
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Logout -->
            <div class="p-6 border-t border-gray-200">
                <button id="logoutBtn" class="w-full py-4 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                    Log Out
                </button>
            </div>
        </div>
    </div>

    <!-- Add Friend Modal -->
    <div id="addFriendModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[80vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <h3 class="text-xl font-semibold text-white text-center">Add New Friend</h3>
            </div>
            
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Search by Email, Phone, or Name</label>
                    <input type="text" id="friendSearchInput" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Enter email, phone number, or name">
                </div>
                
                <div id="searchResults" class="mb-4 max-h-40 overflow-y-auto hidden">
                    <!-- Search results will appear here -->
                </div>
                
                <div class="flex space-x-3">
                    <button id="searchFriend" class="flex-1 py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Search
                    </button>
                    <button id="cancelFriend" class="flex-1 py-3 bg-gray-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Friend Search Results Modal -->
    <div id="friendSearchResultsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[80vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <h3 class="text-xl font-semibold text-white text-center">Search Results</h3>
            </div>
            
            <div class="p-6">
                <div id="enhancedSearchResults" class="space-y-3 max-h-60 overflow-y-auto">
                    <!-- Enhanced search results will appear here -->
                </div>
                
                <div class="mt-4">
                    <button id="closeEnhancedSearch" class="w-full py-3 bg-gray-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Friend Modal -->
    <div id="editFriendModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[80vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <h3 class="text-xl font-semibold text-white text-center">Friend Options</h3>
            </div>
            
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Name</label>
                    <input type="text" id="editFriendName" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Enter friend name" readonly>
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                    <input type="text" id="editFriendStatus" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Friend status" readonly>
                </div>
                
                <div class="flex space-x-3">
                    <button id="messageFriend" class="flex-1 py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Message
                    </button>
                    <button id="callFriend" class="flex-1 py-3 bg-blue-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Call
                    </button>
                    <button id="removeFriend" class="flex-1 py-3 bg-red-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Remove
                    </button>
                    <button id="cancelEditFriend" class="flex-1 py-3 bg-gray-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Settings Modal -->
    <div id="profileSettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Profile Settings</h3>
                    <button id="closeProfileSettings" class="text-white/80 hover:text-white transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="mb-6">
                    <div class="profile-cover mb-4">
                        <img id="profileCoverPreview" class="w-full h-full object-cover rounded-t-2xl" src="" alt="Cover">
                        <div class="profile-cover-edit">
                            <i class="fas fa-camera mr-2"></i>Edit Cover
                        </div>
                        <input type="file" id="coverPicUpload" accept="image/*" class="hidden">
                    </div>
                    
                    <div class="flex justify-center -mt-12 mb-4">
                        <div class="profile-upload">
                            <div class="w-24 h-24 rounded-full bg-gradient-to-r from-purple-500 to-green-500 flex items-center justify-center text-white text-xl font-bold border-4 border-white">
                                <img id="profilePicPreview" class="w-full h-full rounded-full object-cover" src="" alt="Profile">
                            </div>
                            <input type="file" id="profilePictureUpload" accept="image/*" class="hidden">
                            <div class="profile-photo-edit">
                                <i class="fas fa-camera"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Display Name</label>
                    <input type="text" id="profileName" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Enter your display name">
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">About</label>
                    <textarea id="profileAbout" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Tell something about yourself" rows="3"></textarea>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="profileEmail" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Enter your email">
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                    <input type="tel" id="profilePhone" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Enter your phone number">
                </div>
                
                <div class="flex space-x-3">
                    <button id="saveProfile" class="flex-1 py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Save Profile
                    </button>
                    <button id="cancelProfile" class="flex-1 py-3 bg-gray-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy Settings Modal -->
    <div id="privacySettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Privacy Settings</h3>
                    <button id="closePrivacySettings" class="text-white/80 hover:text-white transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="mb-6">
                    <h4 class="font-semibold mb-4 text-lg text-gray-800">Who can see my personal info</h4>
                    
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium">Last seen & online</p>
                            </div>
                            <select id="lastSeenPrivacy" class="p-2 border border-gray-300 rounded-lg">
                                <option value="everyone">Everyone</option>
                                <option value="contacts">My contacts</option>
                                <option value="nobody">Nobody</option>
                            </select>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium">Profile photo</p>
                            </div>
                            <select id="profilePhotoPrivacy" class="p-2 border border-gray-300 rounded-lg">
                                <option value="everyone">Everyone</option>
                                <option value="contacts">My contacts</option>
                                <option value="nobody">Nobody</option>
                            </select>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium">About</p>
                            </div>
                            <select id="aboutPrivacy" class="p-2 border border-gray-300 rounded-lg">
                                <option value="everyone">Everyone</option>
                                <option value="contacts">My contacts</option>
                                <option value="nobody">Nobody</option>
                            </select>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium">Status</p>
                            </div>
                            <select id="statusPrivacy" class="p-2 border border-gray-300 rounded-lg">
                                <option value="everyone">Everyone</option>
                                <option value="contacts">My contacts</option>
                                <option value="nobody">Nobody</option>
                            </select>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium">Read receipts</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="readReceiptsPrivacy" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium">Disappearing messages</p>
                            </div>
                            <select id="disappearingMessagesPrivacy" class="p-2 border border-gray-300 rounded-lg">
                                <option value="off">Off</option>
                                <option value="24h">24 hours</option>
                                <option value="7d">7 days</option>
                                <option value="90d">90 days</option>
                            </select>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium">Groups</p>
                            </div>
                            <select id="groupsPrivacy" class="p-2 border border-gray-300 rounded-lg">
                                <option value="everyone">Everyone</option>
                                <option value="contacts">My contacts</option>
                                <option value="nobody">Nobody</option>
                            </select>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium">Calls</p>
                            </div>
                            <select id="callsPrivacy" class="p-2 border border-gray-300 rounded-lg">
                                <option value="everyone">Everyone</option>
                                <option value="contacts">My contacts</option>
                                <option value="nobody">Nobody</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <button id="savePrivacy" class="flex-1 py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Save Privacy Settings
                    </button>
                    <button id="cancelPrivacy" class="flex-1 py-3 bg-gray-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Account Settings Modal -->
    <div id="accountSettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Account Settings</h3>
                    <button id="closeAccountSettings" class="text-white/80 hover:text-white transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="space-y-4">
                    <div class="settings-item" id="securityNotificationsBtn">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Security notifications</div>
                            <div class="settings-item-description">Get alerts about unusual activity</div>
                        </div>
                        <div class="settings-item-action">
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                    
                    <div class="settings-item" id="passkeysBtn">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Passkeys</div>
                            <div class="settings-item-description">Set up passkeys for secure login</div>
                        </div>
                        <div class="settings-item-action">
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                    
                    <div class="settings-item" id="emailAddressBtn">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Email address</div>
                            <div class="settings-item-description">Change your email address</div>
                        </div>
                        <div class="settings-item-action">
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                    
                    <div class="settings-item" id="twoStepVerificationBtn">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Two-step verification</div>
                            <div class="settings-item-description">Add an extra layer of security</div>
                        </div>
                        <div class="settings-item-action">
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                    
                    <div class="settings-item" id="businessPlatformBtn">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Business platform</div>
                            <div class="settings-item-description">Manage your business account</div>
                        </div>
                        <div class="settings-item-action">
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                    
                    <div class="settings-item" id="changeNumberBtn">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Change number</div>
                            <div class="settings-item-description">Transfer your account to a new number</div>
                        </div>
                        <div class="settings-item-action">
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                    
                    <div class="settings-item" id="requestAccountInfoBtn">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Request account info</div>
                            <div class="settings-item-description">Download a report of your account</div>
                        </div>
                        <div class="settings-item-action">
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                    
                    <div class="settings-item" id="deleteAccountBtn">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Delete account</div>
                            <div class="settings-item-description">Permanently delete your account</div>
                        </div>
                        <div class="settings-item-action">
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6">
                    <button id="cancelAccount" class="w-full py-3 bg-gray-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Accessibility Settings Modal -->
    <div id="accessibilitySettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Accessibility Settings</h3>
                    <button id="closeAccessibilitySettings" class="text-white/80 hover:text-white transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Dark Mode</p>
                            <p class="text-sm text-gray-500">Use dark theme</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="darkModeToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Font Size</p>
                            <p class="text-sm text-gray-500">Adjust text size</p>
                        </div>
                        <select id="fontSizeSelect" class="p-2 border border-gray-300 rounded-lg">
                            <option value="small">Small</option>
                            <option value="medium" selected>Medium</option>
                            <option value="large">Large</option>
                            <option value="x-large">Extra Large</option>
                        </select>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">High Contrast</p>
                            <p class="text-sm text-gray-500">Increase color contrast</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="highContrastToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Screen Reader</p>
                            <p class="text-sm text-gray-500">Enable screen reader support</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="screenReaderToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Reduce Animations</p>
                            <p class="text-sm text-gray-500">Minimize motion effects</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="reduceAnimationsToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Text-to-Speech</p>
                            <p class="text-sm text-gray-500">Read messages aloud</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="textToSpeechToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="mt-6">
                    <button id="saveAccessibility" class="w-full py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Save Accessibility Settings
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Settings Modal -->
    <div id="notificationsSettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Notification Settings</h3>
                    <button id="closeNotificationsSettings" class="text-white/80 hover:text-white transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Push Notifications</p>
                            <p class="text-sm text-gray-500">Receive push notifications</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="pushNotificationsToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Message Notifications</p>
                            <p class="text-sm text-gray-500">Notify on new messages</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="messageNotificationsToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Group Notifications</p>
                            <p class="text-sm text-gray-500">Notify on group activities</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="groupNotificationsToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Call Notifications</p>
                            <p class="text-sm text-gray-500">Notify on incoming calls</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="callNotificationsToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Sound</p>
                            <p class="text-sm text-gray-500">Play notification sounds</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="soundToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Vibration</p>
                            <p class="text-sm text-gray-500">Vibrate on notifications</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="vibrationToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Do Not Disturb</p>
                            <p class="text-sm text-gray-500">Silence notifications during set hours</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="doNotDisturbToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div id="doNotDisturbSchedule" class="hidden space-y-2">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium">Start Time</p>
                            </div>
                            <input type="time" id="dndStartTime" class="p-2 border border-gray-300 rounded-lg" value="22:00">
                        </div>
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium">End Time</p>
                            </div>
                            <input type="time" id="dndEndTime" class="p-2 border border-gray-300 rounded-lg" value="07:00">
                        </div>
                    </div>
                </div>
                
                <div class="mt-6">
                    <button id="saveNotifications" class="w-full py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Save Notification Settings
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Storage Settings Modal -->
    <div id="storageSettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Storage & Data Settings</h3>
                    <button id="closeStorageSettings" class="text-white/80 hover:text-white transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Auto-download Media</p>
                            <p class="text-sm text-gray-500">Download media automatically</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoDownloadToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Wi-Fi Only</p>
                            <p class="text-sm text-gray-500">Download media only on Wi-Fi</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="wifiOnlyToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Media Upload Quality</p>
                            <p class="text-sm text-gray-500">Quality for uploaded media</p>
                        </div>
                        <select id="mediaUploadQuality" class="p-2 border border-gray-300 rounded-lg">
                            <option value="auto">Auto</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <p class="font-medium">Storage Usage</p>
                            <p id="storageUsage" class="text-sm text-gray-500">Calculating...</p>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div id="storageProgress" class="bg-purple-600 h-2.5 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                        <button id="clearCache" class="w-full py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors">
                            Clear Cache
                        </button>
                        <button id="manageMedia" class="w-full py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors">
                            Manage Downloaded Media
                        </button>
                    </div>
                </div>
                
                <div class="mt-6">
                    <button id="saveStorage" class="w-full py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Save Storage Settings
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Language Settings Modal -->
    <div id="languageSettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Language Settings</h3>
                    <button id="closeLanguageSettings" class="text-white/80 hover:text-white transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">App Language</p>
                            <p class="text-sm text-gray-500">Choose your preferred language</p>
                        </div>
                        <select id="appLanguageSelect" class="p-2 border border-gray-300 rounded-lg">
                            <option value="en">English</option>
                            <option value="sw">Swahili</option>
                            <option value="fr">French</option>
                            <option value="es">Spanish</option>
                            <option value="de">German</option>
                            <option value="zh">Chinese</option>
                            <option value="ja">Japanese</option>
                            <option value="ru">Russian</option>
                            <option value="ar">Arabic</option>
                        </select>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Auto-detect Language</p>
                            <p class="text-sm text-gray-500">Use device language settings</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoDetectLanguageToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="mt-6">
                    <button id="saveLanguage" class="w-full py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Save Language Settings
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Settings Modal -->
    <div id="chatSettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Chat Settings</h3>
                    <button id="closeChatSettings" class="text-white/80 hover:text-white transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Enter Key Sends</p>
                            <p class="text-sm text-gray-500">Press Enter to send messages</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="enterKeySendsToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Read Receipts</p>
                            <p class="text-sm text-gray-500">Show when messages are read</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="readReceiptsToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Show Last Seen</p>
                            <p class="text-sm text-gray-500">Display when contacts were last online</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="lastSeenToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Media Visibility</p>
                            <p class="text-sm text-gray-500">Show media in gallery</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="mediaVisibilityToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Chat Backup</p>
                            <p class="text-sm text-gray-500">Automatically backup chats</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="chatBackupToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="space-y-2">
                        <button id="changeWallpaper" class="w-full py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors">
                            Change Chat Wallpaper
                        </button>
                        <button id="exportChat" class="w-full py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors">
                            Export Chat History
                        </button>
                        <button id="clearChatHistory" class="w-full py-3 bg-red-100 text-red-700 rounded-xl font-semibold hover:bg-red-200 transition-colors">
                            Clear All Chats
                        </button>
                    </div>
                </div>
                
                <div class="mt-6">
                    <button id="saveChatSettings" class="w-full py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Save Chat Settings
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Favorites Settings Modal -->
    <div id="favoritesSettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Favorites</h3>
                    <button id="closeFavoritesSettings" class="text-white/80 hover:text-white transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div id="favoritesListContent" class="space-y-3">
                    <!-- Favorites will be populated here -->
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-star text-4xl mb-3 text-gray-300 block"></i>
                        <p>No favorites yet</p>
                        <p class="text-sm mt-1">Add contacts or chats to favorites for quick access</p>
                    </div>
                </div>
                
                <div class="mt-6">
                    <button id="addToFavorites" class="w-full py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Add to Favorites
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Center Modal -->
    <div id="helpCenterModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Help Center</h3>
                    <button id="closeHelpCenter" class="text-white/80 hover:text-white transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="space-y-4">
                    <div class="bg-gray-50 p-4 rounded-xl cursor-pointer help-section" data-section="getting-started">
                        <h4 class="font-semibold mb-2">Getting Started</h4>
                        <p class="text-sm text-gray-600">Learn how to use Kynecta's basic features</p>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-xl cursor-pointer help-section" data-section="privacy-security">
                        <h4 class="font-semibold mb-2">Privacy & Security</h4>
                        <p class="text-sm text-gray-600">Understand how we protect your data</p>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-xl cursor-pointer help-section" data-section="troubleshooting">
                        <h4 class="font-semibold mb-2">Troubleshooting</h4>
                        <p class="text-sm text-gray-600">Common issues and solutions</p>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-xl cursor-pointer help-section" data-section="faqs">
                        <h4 class="font-semibold mb-2">FAQs</h4>
                        <p class="text-sm text-gray-600">Frequently asked questions</p>
                    </div>
                </div>
                
                <div class="mt-6 space-y-3">
                    <button id="contactSupport" class="w-full py-3 bg-purple-600 text-white rounded-xl font-semibold hover:bg-purple-700 transition-colors">
                        Contact Support
                    </button>
                    <button id="sendFeedback" class="w-full py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors">
                        Send Feedback
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- App Info Modal -->
    <div id="appInfoModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">App Information</h3>
                    <button id="closeAppInfo" class="text-white/80 hover:text-white transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="space-y-4">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-r from-purple-500 to-green-500 rounded-2xl flex items-center justify-center text-white text-2xl font-bold mx-auto mb-4">
                            K
                        </div>
                        <h3 class="text-xl font-semibold">Kynecta</h3>
                        <p class="text-gray-500">Advanced Mood-Based Chat</p>
                    </div>
                    
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="font-medium">Version</span>
                            <span class="text-gray-500">1.0.0</span>
                        </div>
                        
                        <div class="flex justify-between">
                            <span class="font-medium">Build</span>
                            <span class="text-gray-500">2025.08</span>
                        </div>
                        
                        <div class="flex justify-between">
                            <span class="font-medium">Developer</span>
                            <span class="text-gray-500">Denis Chacha</span>
                        </div>
                        
                        <div class="flex justify-between">
                            <span class="font-medium">Release Date</span>
                            <span class="text-gray-500">November 2025</span>
                        </div>
                    </div>
                    
                    <div class="pt-4 border-t border-gray-200">
                        <h4 class="font-semibold mb-2">Legal</h4>
                        <div class="space-y-2">
                            <button class="w-full text-left text-blue-600 hover:text-blue-800 transition-colors" id="termsOfServiceBtn">
                                Terms of Service
                            </button>
                            <button class="w-full text-left text-blue-600 hover:text-blue-800 transition-colors" id="privacyPolicyBtn">
                                Privacy Policy
                            </button>
                            <button class="w-full text-left text-blue-600 hover:text-blue-800 transition-colors" id="openSourceBtn">
                                Open Source Licenses
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Invite Friends Modal -->
    <div id="inviteFriendsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Invite Friends</h3>
                    <button id="closeInviteFriends" class="text-white/80 hover:text-white transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="text-center mb-6">
                    <div class="w-24 h-24 bg-gradient-to-r from-purple-500 to-green-500 rounded-2xl flex items-center justify-center text-white text-3xl font-bold mx-auto mb-4">
                        <i class="fas fa-share-alt"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">Share Kynecta</h3>
                    <p class="text-gray-500">Invite your friends to join Kynecta</p>
                </div>
                
                <div class="space-y-3">
                    <button id="shareLink" class="w-full py-3 bg-purple-600 text-white rounded-xl font-semibold hover:bg-purple-700 transition-colors flex items-center justify-center">
                        <i class="fas fa-link mr-2"></i> Copy Invite Link
                    </button>
                    
                    <button id="shareQR" class="w-full py-3 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-colors flex items-center justify-center">
                        <i class="fas fa-qrcode mr-2"></i> Share QR Code
                    </button>
                    
                    <button id="shareWhatsApp" class="w-full py-3 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition-colors flex items-center justify-center">
                        <i class="fab fa-whatsapp mr-2"></i> Share via WhatsApp
                    </button>
                    
                    <button id="shareSMS" class="w-full py-3 bg-gray-600 text-white rounded-xl font-semibold hover:bg-gray-700 transition-colors flex items-center justify-center">
                        <i class="fas fa-sms mr-2"></i> Share via SMS
                    </button>
                </div>
                
                <div class="mt-6 p-4 bg-gray-50 rounded-xl">
                    <h4 class="font-semibold mb-2">Your Referral Code</h4>
                    <div class="flex items-center justify-between">
                        <code class="bg-white px-3 py-2 rounded-lg border border-gray-200 font-mono">KYNECTA2025</code>
                        <button id="copyReferralCode" class="text-purple-600 hover:text-purple-800 transition-colors">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reaction Picker (Dynamic) -->
    <div id="reactionPicker" class="reaction-picker hidden">
        <div class="reaction-option" data-reaction="ðŸ‘">ðŸ‘</div>
        <div class="reaction-option" data-reaction="â¤ï¸">â¤ï¸</div>
        <div class="reaction-option" data-reaction="ðŸ˜‚">ðŸ˜‚</div>
        <div class="reaction-option" data-reaction="ðŸ˜®">ðŸ˜®</div>
        <div class="reaction-option" data-reaction="ðŸ˜¢">ðŸ˜¢</div>
        <div class="reaction-option" data-reaction="ðŸŽ‰">ðŸŽ‰</div>
    </div>

    <!-- Group Creation Modal -->
    <div id="createGroupModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Create Group</h3>
                    <button id="closeCreateGroup" class="text-white/80 hover:text-white transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Group Name</label>
                    <input type="text" id="groupName" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Enter group name">
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Group Description</label>
                    <textarea id="groupDescription" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Enter group description" rows="3"></textarea>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Add Participants</label>
                    <div id="groupParticipants" class="border-2 border-gray-200 rounded-xl p-3 max-h-40 overflow-y-auto">
                        <div class="text-gray-500 text-center py-4">Select friends to add to group</div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Group Privacy</label>
                    <select id="groupPrivacy" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors">
                        <option value="public">Public - Anyone can join</option>
                        <option value="private">Private - Invite only</option>
                    </select>
                </div>
                
                <div class="flex space-x-3">
                    <button id="createGroup" class="flex-1 py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Create Group
                    </button>
                    <button id="cancelCreateGroup" class="flex-1 py-3 bg-gray-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Group Join Modal -->
    <div id="joinGroupModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Join Group</h3>
                    <button id="closeJoinGroup" class="text-white/80 hover:text-white transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Group Code or Link</label>
                    <input type="text" id="groupCode" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Enter group code or invite link">
                </div>
                
                <div id="groupPreview" class="mb-4 hidden">
                    <div class="bg-gray-50 p-4 rounded-xl">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-r from-purple-500 to-green-500 flex items-center justify-center text-white">
                                <i class="fas fa-users"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold" id="previewGroupName">Group Name</h4>
                                <p class="text-sm text-gray-500" id="previewGroupMembers">0 members</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <button id="joinGroup" class="flex-1 py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Join Group
                    </button>
                    <button id="cancelJoinGroup" class="flex-1 py-3 bg-gray-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDHHyGgsSV18BcXrGgzi4C8frzDAE1C1zo",
            authDomain: "uniconnect-ee95c.firebaseapp.com",
            projectId: "uniconnect-ee95c",
            storageBucket: "uniconnect-ee95c.firebasestorage.app",
            messagingSenderId: "1003264444309",
            appId: "1:1003264444309:web:9f0307516e44d21e97d89c"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();
        const messaging = firebase.messaging();

        // Cloudinary Configuration
        const cloudinaryConfig = {
            cloudName: 'dhjnxa5rh',
            apiKey: '817591969559894',
            uploadPreset: 'kynecta_uploads'
        };

        // Global Variables
        let currentUser = null;
        let currentUserData = null;
        let currentChat = null;
        let isInCall = false;
        let friends = [];
        let allUsers = [];
        let userSettings = {
            security: {
                notifications: true,
                passkeys: false,
                twoStepVerification: false
            },
            privacy: {
                lastSeen: 'everyone',
                profilePhoto: 'everyone',
                about: 'everyone',
                status: 'everyone',
                readReceipts: true,
                disappearingMessages: 'off',
                groups: 'everyone',
                avatarStickers: true,
                calls: 'everyone',
                contact: 'everyone',
                appLock: false,
                cameraEffects: true
            },
            notifications: {
                conversationTones: true,
                reminders: true,
                vibrate: true,
                notificationLight: true,
                lightColor: '#7C3AED',
                highPriorityNotifications: true,
                reactionNotifications: true
            },
            storage: {
                lessDataCalls: false,
                proxyEnabled: false,
                mediaUploadQuality: 'auto',
                autoDownloadQuality: 'standard'
            },
            chat: {
                displayTheme: 'light',
                defaultChatTheme: 'purple',
                fontSize: 'medium',
                enterKeySends: true,
                mediaVisibility: true
            },
            accessibility: {
                largeText: false,
                highContrast: false,
                screenReader: true,
                reducedMotion: false,
                voiceControl: false
            },
            language: {
                appLanguage: 'en'
            },
            favorites: []
        };
        let userStatuses = [];
        let unsubscribeMessages = null;
        let unsubscribeChats = null;
        let currentEditingFriendId = null;
        let typingTimeout = null;
        let typingListener = null;

        // DOM Elements
        const loadingScreen = document.getElementById('loadingScreen');
        const chatApp = document.getElementById('chatApp');
        const settingsModal = document.getElementById('settingsModal');
        const addFriendModal = document.getElementById('addFriendModal');
        const friendSearchResultsModal = document.getElementById('friendSearchResultsModal');
        const editFriendModal = document.getElementById('editFriendModal');
        const profileSettingsModal = document.getElementById('profileSettingsModal');
        const privacySettingsModal = document.getElementById('privacySettingsModal');
        const accountSettingsModal = document.getElementById('accountSettingsModal');
        const accessibilitySettingsModal = document.getElementById('accessibilitySettingsModal');
        const notificationsSettingsModal = document.getElementById('notificationsSettingsModal');
        const storageSettingsModal = document.getElementById('storageSettingsModal');
        const languageSettingsModal = document.getElementById('languageSettingsModal');
        const chatSettingsModal = document.getElementById('chatSettingsModal');
        const favoritesSettingsModal = document.getElementById('favoritesSettingsModal');
        const helpCenterModal = document.getElementById('helpCenterModal');
        const appInfoModal = document.getElementById('appInfoModal');
        const inviteFriendsModal = document.getElementById('inviteFriendsModal');
        const statusCreation = document.getElementById('statusCreation');
        const videoConferenceModal = document.getElementById('videoConferenceModal');
        const emojiPicker = document.getElementById('emojiPicker');
        const createGroupModal = document.getElementById('createGroupModal');
        const joinGroupModal = document.getElementById('joinGroupModal');

        // Safety function to check if element exists
        function safeElement(id) {
            const element = document.getElementById(id);
            if (!element) {
                console.warn(`Element with id '${id}' not found`);
            }
            return element;
        }

        // Safe version of classList operations
        function safeClassList(id, action, className) {
            const element = safeElement(id);
            if (element && element.classList) {
                element.classList[action](className);
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', initApp);

        function initApp() {
            // Check if user is logged in
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    loadUserData();
                } else {
                    // Redirect to login if not authenticated
                    window.location.href = 'login.html';
                }
            });
        }

        async function loadUserData() {
            try {
                // Get user document from Firestore
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                
                if (userDoc.exists) {
                    currentUserData = userDoc.data();
                    initializeUserData();
                } else {
                    // Create user document if it doesn't exist
                    currentUserData = {
                        uid: currentUser.uid,
                        email: currentUser.email,
                        displayName: currentUser.displayName || currentUser.email.split('@')[0],
                        photoURL: currentUser.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(currentUser.displayName || currentUser.email)}&background=7C3AED&color=fff`,
                        coverURL: '',
                        about: 'Life without Christ is motion without meaning',
                        phone: '',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        lastSeen: firebase.firestore.FieldValue.serverTimestamp(),
                        status: 'online',
                        mood: 'happy'
                    };
                    
                    await db.collection('users').doc(currentUser.uid).set(currentUserData);
                    initializeUserData();
                }
                
                showChatApp();
                setupEventListeners();
                loadUserSettings();
                loadStatusUpdates();
                loadFriends();
                loadAllUsers();
                initEmojiPicker();
                loadChatsTemporary(); // Use the safe version
                requestNotificationPermission();
            } catch (error) {
                console.error('Error loading user data:', error);
                showToast('Error loading user data', 'error');
            }
        }

        function initializeUserData() {
            // Set user info in UI
            document.getElementById('userName').textContent = currentUserData.displayName;
            document.getElementById('userAvatar').src = currentUserData.photoURL;
            
            // Update settings modal with user data
            document.getElementById('settingsUserName').textContent = currentUserData.displayName;
            document.getElementById('settingsProfilePic').src = currentUserData.photoURL;
            
            // Update profile settings with user data
            document.getElementById('profileName').value = currentUserData.displayName;
            document.getElementById('profileAbout').value = currentUserData.about || '';
            document.getElementById('profileEmail').value = currentUserData.email;
            document.getElementById('profilePhone').value = currentUserData.phone || '';
            document.getElementById('profilePicPreview').src = currentUserData.photoURL;
            document.getElementById('profileCoverPreview').src = currentUserData.coverURL || '';
            
            // Load user preferences
            loadUserPreferences();
        }

        function showChatApp() {
            loadingScreen.classList.add('hidden');
            chatApp.classList.remove('hidden');
        }

        function loadUserPreferences() {
            const theme = localStorage.getItem('kynecta-theme') || 'light';
            setTheme(theme);
        }

        function setTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('kynecta-theme', theme);
            
            // Update theme icon
            const themeIcon = document.getElementById('themeIcon');
            if (theme === 'dark') {
                themeIcon.className = 'fas fa-sun';
            } else {
                themeIcon.className = 'fas fa-moon';
            }
        }

        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            toastContainer.appendChild(toast);
            
            // Trigger animation
            setTimeout(() => toast.classList.add('show'), 10);
            
            // Remove after delay
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        function loadUserSettings() {
            // Load settings from localStorage or use defaults
            const savedSettings = localStorage.getItem('kynecta-settings');
            if (savedSettings) {
                userSettings = JSON.parse(savedSettings);
            }
            
            // Apply settings to UI
            applyUserSettings();
        }

        function saveUserSettings() {
            localStorage.setItem('kynecta-settings', JSON.stringify(userSettings));
        }

        function applyUserSettings() {
            // Apply theme
            setTheme(userSettings.chat.displayTheme);
            
            // Apply accessibility settings
            applyAccessibilitySettings();
            
            // Apply chat settings
            applyChatSettings();
        }

        function applyAccessibilitySettings() {
            // Font size
            document.body.style.fontSize = userSettings.accessibility.largeText ? '18px' : '16px';
            
            // High contrast
            if (userSettings.accessibility.highContrast) {
                document.body.classList.add('high-contrast');
            } else {
                document.body.classList.remove('high-contrast');
            }
            
            // Reduced motion
            if (userSettings.accessibility.reducedMotion) {
                document.body.classList.add('reduce-motion');
            } else {
                document.body.classList.remove('reduce-motion');
            }
        }

        function applyChatSettings() {
            // Enter key sends
            const messageInput = document.getElementById('messageInput');
            if (userSettings.chat.enterKeySends) {
                messageInput.setAttribute('data-enter-sends', 'true');
            } else {
                messageInput.setAttribute('data-enter-sends', 'false');
            }
        }

        function loadStatusUpdates() {
            const statusUpdates = document.getElementById('statusUpdates');
            
            // Load statuses from Firebase
            db.collection('statuses')
                .where('userId', '==', currentUser.uid)
                .orderBy('timestamp', 'desc')
                .limit(10)
                .get()
                .then(snapshot => {
                    if (snapshot.empty) {
                        statusUpdates.innerHTML = `
                            <div class="text-center text-gray-500 py-8">
                                <i class="fas fa-images text-4xl mb-3 text-gray-300 block"></i>
                                <p>No status updates yet</p>
                                <p class="text-sm mt-1">Share a photo, video, or text update</p>
                            </div>
                        `;
                        return;
                    }
                    
                    statusUpdates.innerHTML = '';
                    snapshot.forEach(doc => {
                        const status = doc.data();
                        const statusElement = document.createElement('div');
                        statusElement.className = 'flex items-center space-x-3 p-3 rounded-xl hover:bg-gray-50 transition-colors cursor-pointer';
                        
                        let statusContent = '';
                        if (status.type === 'emoji') {
                            statusContent = `<div class="w-12 h-12 rounded-full bg-gradient-to-r from-purple-500 to-green-500 flex items-center justify-center text-white text-xl">${status.content}</div>`;
                        } else if (status.type === 'text') {
                            statusContent = `<div class="w-12 h-12 rounded-full bg-gradient-to-r from-blue-500 to-teal-500 flex items-center justify-center text-white"><i class="fas fa-font"></i></div>`;
                        } else if (status.type === 'image') {
                            statusContent = `<div class="w-12 h-12 rounded-full bg-cover bg-center" style="background-image: url('${status.content}')"></div>`;
                        } else if (status.type === 'video') {
                            statusContent = `<div class="w-12 h-12 rounded-full bg-gradient-to-r from-red-500 to-pink-500 flex items-center justify-center text-white"><i class="fas fa-video"></i></div>`;
                        } else if (status.type === 'audio') {
                            statusContent = `<div class="w-12 h-12 rounded-full bg-gradient-to-r from-orange-500 to-amber-500 flex items-center justify-center text-white"><i class="fas fa-music"></i></div>`;
                        }
                        
                        statusElement.innerHTML = `
                            ${statusContent}
                            <div>
                                <p class="font-medium">${status.userDisplayName}</p>
                                <p class="text-sm text-gray-500">${formatTimeAgo(status.timestamp)}</p>
                            </div>
                        `;
                        
                        statusUpdates.appendChild(statusElement);
                    });
                })
                .catch(error => {
                    console.error('Error loading status updates:', error);
                    statusUpdates.innerHTML = `
                        <div class="text-center text-gray-500 py-8">
                            <i class="fas fa-exclamation-triangle text-4xl mb-3 text-gray-300 block"></i>
                            <p>Error loading status updates</p>
                            <p class="text-sm mt-1">Please try again later</p>
                        </div>
                    `;
                });
        }

        function formatTimeAgo(timestamp) {
            if (!timestamp) return 'Just now';
            
            const now = new Date();
            const time = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            const diffMs = now - time;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return time.toLocaleDateString();
        }

        function openStatusCreation() {
            statusCreation.style.display = 'flex';
            resetStatusCreation();
        }

        function resetStatusCreation() {
            // Reset all previews
            document.getElementById('emojiPreview').classList.remove('hidden');
            document.getElementById('textPreview').classList.add('hidden');
            document.getElementById('imagePreview').classList.add('hidden');
            document.getElementById('videoPreview').classList.add('hidden');
            document.getElementById('audioPreview').classList.add('hidden');
            
            // Reset active option
            document.querySelectorAll('.status-option').forEach(option => {
                option.classList.remove('active');
            });
            document.querySelector('.status-option[data-type="emoji"]').classList.add('active');
            
            // Reset content
            document.getElementById('emojiPreview').textContent = 'ðŸ˜Š';
            document.getElementById('statusTextInput').value = '';
            document.getElementById('statusImagePreview').classList.add('hidden');
            document.getElementById('statusVideoPreview').classList.add('hidden');
            document.getElementById('statusAudioPreview').classList.add('hidden');
        }

        async function uploadToCloudinary(file, resourceType = 'image') {
            return new Promise((resolve, reject) => {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('upload_preset', cloudinaryConfig.uploadPreset);
                formData.append('cloud_name', cloudinaryConfig.cloudName);
                
                fetch(`https://api.cloudinary.com/v1_1/${cloudinaryConfig.cloudName}/${resourceType}/upload`, {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.secure_url) {
                        resolve(data.secure_url);
                    } else {
                        reject(new Error('Upload failed'));
                    }
                })
                .catch(error => {
                    reject(error);
                });
            });
        }

        async function postStatus(type, content) {
            try {
                let finalContent = content;
                
                // Handle file uploads to Cloudinary
                if (type === 'image' || type === 'video' || type === 'audio') {
                    showToast('Uploading media...', 'info');
                    
                    // For demo purposes, we'll use a placeholder
                    // In a real app, you would get the file and upload it
                    if (type === 'image') {
                        finalContent = 'https://res.cloudinary.com/dhjnxa5rh/image/upload/v1621234567/placeholder.jpg';
                    } else if (type === 'video') {
                        finalContent = 'https://res.cloudinary.com/dhjnxa5rh/video/upload/v1621234567/placeholder.mp4';
                    } else if (type === 'audio') {
                        finalContent = 'https://res.cloudinary.com/dhjnxa5rh/audio/upload/v1621234567/placeholder.mp3';
                    }
                }
                
                const newStatus = {
                    type: type,
                    content: finalContent,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000), // 24 hours from now
                    userId: currentUser.uid,
                    userDisplayName: currentUserData.displayName,
                    userPhotoURL: currentUserData.photoURL
                };
                
                // Save to Firestore
                await db.collection('statuses').add(newStatus);
                
                // Update UI
                loadStatusUpdates();
                showToast('Status posted successfully', 'success');
            } catch (error) {
                console.error('Error posting status:', error);
                showToast('Error posting status', 'error');
            }
        }

        function loadFriends() {
            // Fetch friends from Firebase
            db.collection('friendships')
                .where('users', 'array-contains', currentUser.uid)
                .where('status', '==', 'accepted')
                .onSnapshot(snapshot => {
                    friends = [];
                    const friendPromises = [];
                    
                    snapshot.forEach(doc => {
                        const friendship = doc.data();
                        const friendId = friendship.users.find(id => id !== currentUser.uid);
                        
                        // Get friend details
                        const friendPromise = db.collection('users').doc(friendId).get().then(friendDoc => {
                            if (friendDoc.exists) {
                                const friendData = friendDoc.data();
                                friends.push({
                                    id: friendId,
                                    friendshipId: doc.id,
                                    ...friendData
                                });
                            }
                        });
                        
                        friendPromises.push(friendPromise);
                    });
                    
                    Promise.all(friendPromises).then(() => {
                        renderFriends(friends);
                        
                        if (friends.length === 0) {
                            document.getElementById('noFriendsMessage').classList.remove('hidden');
                        } else {
                            document.getElementById('noFriendsMessage').classList.add('hidden');
                        }
                    });
                }, error => {
                    console.error('Error loading friends:', error);
                    showToast('Error loading friends', 'error');
                });
        }

        function loadAllUsers() {
            // Fetch all registered users from Firebase
            db.collection('users')
                .where('uid', '!=', currentUser.uid)
                .onSnapshot(snapshot => {
                    allUsers = [];
                    snapshot.forEach(doc => {
                        allUsers.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                }, error => {
                    console.error('Error loading users:', error);
                });
        }

        async function searchUsers(query) {
            if (!query) return [];
            
            // Search by name, email, or phone
            const nameResults = allUsers.filter(user => 
                user.displayName && user.displayName.toLowerCase().includes(query.toLowerCase())
            );
            
            const emailResults = allUsers.filter(user => 
                user.email && user.email.toLowerCase().includes(query.toLowerCase())
            );
            
            const phoneResults = allUsers.filter(user => 
                user.phone && user.phone.includes(query)
            );
            
            // Combine and remove duplicates
            const allResults = [...nameResults, ...emailResults, ...phoneResults];
            const uniqueResults = allResults.filter((user, index, self) => 
                index === self.findIndex(u => u.id === user.id)
            );
            
            return uniqueResults;
        }

        async function sendFriendRequest(friendId) {
            try {
                // Check if friendship already exists
                const existingFriendship = await db.collection('friendships')
                    .where('users', 'array-contains', currentUser.uid)
                    .where('status', 'in', ['pending', 'accepted'])
                    .get();
                
                const alreadyFriends = existingFriendship.docs.some(doc => {
                    const data = doc.data();
                    return data.users.includes(friendId);
                });
                
                if (alreadyFriends) {
                    showToast('Friend request already sent or user is already your friend', 'error');
                    return;
                }
                
                // Create friendship document
                const friendship = {
                    users: [currentUser.uid, friendId],
                    status: 'pending',
                    requestedBy: currentUser.uid,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('friendships').add(friendship);
                showToast('Friend request sent successfully', 'success');
            } catch (error) {
                console.error('Error sending friend request:', error);
                showToast('Error sending friend request', 'error');
            }
        }

        function removeFriend(friendId) {
            // Find the friendship document
            db.collection('friendships')
                .where('users', 'array-contains', currentUser.uid)
                .where('status', '==', 'accepted')
                .get()
                .then(snapshot => {
                    snapshot.forEach(doc => {
                        const friendship = doc.data();
                        if (friendship.users.includes(friendId)) {
                            // Delete the friendship
                            db.collection('friendships').doc(doc.id).delete()
                                .then(() => {
                                    showToast('Friend removed successfully', 'success');
                                })
                                .catch(error => {
                                    console.error('Error removing friend:', error);
                                    showToast('Error removing friend', 'error');
                                });
                        }
                    });
                })
                .catch(error => {
                    console.error('Error finding friendship:', error);
                    showToast('Error removing friend', 'error');
                });
        }

        function renderFriends(friendsToRender) {
            const friendsList = document.getElementById('friendsList');
            friendsList.innerHTML = '';
            
            friendsToRender.forEach(friend => {
                const friendItem = document.createElement('div');
                friendItem.className = 'contact-item';
                friendItem.dataset.friendId = friend.id;
                friendItem.innerHTML = `
                    <div class="contact-avatar">
                        <img class="w-12 h-12 rounded-full object-cover" src="${friend.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(friend.displayName)}&background=7C3AED&color=fff`}" alt="${friend.displayName}">
                        ${friend.status === 'online' ? '<div class="online-indicator"></div>' : ''}
                    </div>
                    <div class="contact-info">
                        <div class="contact-name">${friend.displayName}</div>
                        <div class="contact-status">${friend.status || 'offline'}</div>
                    </div>
                    <div class="flex space-x-2">
                        <button class="w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center hover:bg-purple-200 transition-colors message-friend" data-name="${friend.displayName}" data-id="${friend.id}">
                            <i class="fas fa-comment"></i>
                        </button>
                        <button class="w-10 h-10 rounded-full bg-green-100 text-green-600 flex items-center justify-center hover:bg-green-200 transition-colors call-friend" data-name="${friend.displayName}" data-id="${friend.id}">
                            <i class="fas fa-phone"></i>
                        </button>
                        <button class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center hover:bg-blue-200 transition-colors edit-friend" data-name="${friend.displayName}" data-id="${friend.id}" data-status="${friend.status || 'offline'}">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                `;
                
                friendsList.appendChild(friendItem);
            });

            // Add event listeners to message and call buttons
            document.querySelectorAll('.message-friend').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const friendId = e.currentTarget.dataset.id;
                    const friendName = e.currentTarget.dataset.name;
                    startChat(friendId, friendName);
                });
            });

            document.querySelectorAll('.call-friend').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const friendId = e.currentTarget.dataset.id;
                    const friendName = e.currentTarget.dataset.name;
                    startCall(friendId, friendName);
                });
            });

            // Add event listeners to edit buttons
            document.querySelectorAll('.edit-friend').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const friendId = e.currentTarget.dataset.id;
                    const friendName = e.currentTarget.dataset.name;
                    const friendStatus = e.currentTarget.dataset.status;
                    openEditFriendModal(friendId, friendName, friendStatus);
                });
            });
        }

        function openEditFriendModal(friendId, name, status) {
            currentEditingFriendId = friendId;
            document.getElementById('editFriendName').value = name;
            document.getElementById('editFriendStatus').value = status;
            editFriendModal.classList.remove('hidden');
        }

        function searchFriends(query) {
            if (!query) {
                renderFriends(friends);
                return;
            }
            
            const filteredFriends = friends.filter(friend => 
                friend.displayName.toLowerCase().includes(query.toLowerCase()) ||
                (friend.email && friend.email.toLowerCase().includes(query.toLowerCase())) ||
                (friend.phone && friend.phone.includes(query))
            );
            
            renderFriends(filteredFriends);
            
            if (filteredFriends.length === 0) {
                document.getElementById('noFriendsMessage').classList.remove('hidden');
                document.getElementById('noFriendsMessage').innerHTML = `
                    <i class="fas fa-search text-4xl mb-3 text-gray-300 block"></i>
                    <p>No friends found</p>
                    <p class="text-sm mt-1">Try a different search term</p>
                `;
            } else {
                document.getElementById('noFriendsMessage').classList.add('hidden');
            }
        }

        // ðŸ”§ CORE DATA FLOW LOGIC - Chat Session Management
        async function startChat(friendId, friendName) {
            try {
                // Create or get chat ID
                const chatId = [currentUser.uid, friendId].sort().join('_');
                
                // Check if chat document exists
                const chatDoc = await db.collection('chats').doc(chatId).get();
                
                if (!chatDoc.exists) {
                    // Create new chat document
                    await db.collection('chats').doc(chatId).set({
                        participants: [currentUser.uid, friendId],
                        participantNames: {
                            [currentUser.uid]: currentUserData.displayName,
                            [friendId]: friendName
                        },
                        lastMessage: '',
                        lastMessageTime: firebase.firestore.FieldValue.serverTimestamp(),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        typing: {}
                    });
                }
                
                // Set current chat
                currentChat = {
                    id: chatId,
                    friendId: friendId,
                    name: friendName
                };
                
                // Update UI
                document.getElementById('chatHeader').classList.remove('hidden');
                document.getElementById('inputArea').classList.remove('hidden');
                document.getElementById('noMessagesMessage').classList.add('hidden');
                document.getElementById('chatTitle').textContent = friendName;
                document.getElementById('chatAvatar').src = `https://ui-avatars.com/api/?name=${encodeURIComponent(friendName)}&background=7C3AED&color=fff`;
                
                // Enable message input
                document.getElementById('messageInput').disabled = false;
                document.getElementById('sendBtn').disabled = false;
                
                // Load messages
                loadMessages(chatId);
                
                // Mark messages as read
                markMessagesAsRead(chatId);
                
                // Hide friend list on mobile
                if (window.innerWidth < 768) {
                    document.getElementById('chatListContainer').classList.add('hidden');
                }
            } catch (error) {
                console.error('Error starting chat:', error);
                showToast('Error starting chat', 'error');
            }
        }

        // ðŸ”§ CORE DATA FLOW LOGIC - Real-Time Message Loading
        function loadMessages(chatId) {
            // Unsubscribe from previous listeners
            if (unsubscribeMessages) {
                unsubscribeMessages();
            }
            if (typingListener) {
                typingListener();
            }
            
            const messagesContainer = document.getElementById('messagesContainer');
            messagesContainer.innerHTML = '';
            
            // Subscribe to messages for this chat
            unsubscribeMessages = db.collection('messages')
                .where('chatId', '==', chatId)
                .orderBy('timestamp', 'asc')
                .onSnapshot(snapshot => {
                    messagesContainer.innerHTML = '';
                    
                    if (snapshot.empty) {
                        messagesContainer.innerHTML = `
                            <div class="text-center text-gray-500 py-10">
                                <i class="fas fa-comments text-4xl mb-3 text-gray-300 block"></i>
                                <p>No messages yet</p>
                                <p class="text-sm mt-1">Send a message to start the conversation</p>
                            </div>
                        `;
                        return;
                    }
                    
                    let lastDate = null;
                    
                    snapshot.forEach(doc => {
                        const message = doc.data();
                        
                        // Check if we need to add a date separator
                        const messageDate = message.timestamp ? message.timestamp.toDate().toDateString() : new Date().toDateString();
                        if (messageDate !== lastDate) {
                            addDateSeparator(messageDate);
                            lastDate = messageDate;
                        }
                        
                        addMessageToUI(message, doc.id);
                    });
                    
                    // Scroll to bottom
                    setTimeout(() => {
                        messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    }, 100);
                    
                    // Mark messages as read
                    markMessagesAsRead(chatId);
                }, error => {
                    console.error('Error loading messages:', error);
                    showToast('Error loading messages', 'error');
                });
            
            // Listen for typing indicators
            typingListener = db.collection('chats').doc(chatId)
                .onSnapshot(doc => {
                    if (doc.exists) {
                        const chatData = doc.data();
                        const typing = chatData.typing || {};
                        
                        // Remove current user from typing indicators
                        delete typing[currentUser.uid];
                        
                        const typingUsers = Object.keys(typing).filter(userId => typing[userId] === true);
                        
                        if (typingUsers.length > 0) {
                            // Get names of typing users
                            const typingNames = typingUsers.map(userId => {
                                return chatData.participantNames && chatData.participantNames[userId] 
                                    ? chatData.participantNames[userId] 
                                    : 'Someone';
                            });
                            
                            document.getElementById('typingUsers').textContent = typingNames.join(', ');
                            document.getElementById('isTyping').classList.remove('hidden');
                        } else {
                            document.getElementById('isTyping').classList.add('hidden');
                        }
                    }
                });
        }

        function addDateSeparator(dateString) {
            const messagesContainer = document.getElementById('messagesContainer');
            const dateElement = document.createElement('div');
            dateElement.className = 'date-separator';
            
            const today = new Date().toDateString();
            const yesterday = new Date(Date.now() - 86400000).toDateString();
            
            let displayDate = dateString;
            if (dateString === today) {
                displayDate = 'Today';
            } else if (dateString === yesterday) {
                displayDate = 'Yesterday';
            } else {
                displayDate = new Date(dateString).toLocaleDateString();
            }
            
            dateElement.innerHTML = `<span>${displayDate}</span>`;
            messagesContainer.appendChild(dateElement);
        }

        function addMessageToUI(message, messageId) {
            const messagesContainer = document.getElementById('messagesContainer');
            const messageElement = document.createElement('div');
            
            const isSent = message.senderId === currentUser.uid;
            const messageTime = message.timestamp ? message.timestamp.toDate().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : 'Just now';
            
            let statusIcon = 'ðŸ•’'; // sent
            if (message.status === 'delivered') statusIcon = 'âœ“âœ“';
            if (message.status === 'read') statusIcon = 'âœ“âœ“ðŸ”µ';
            
            messageElement.className = `message-container ${isSent ? 'sent' : 'received'}`;
            messageElement.innerHTML = `
                <div class="message-bubble ${isSent ? 'message-sent' : 'message-received'}">
                    <div class="message-text">${message.text}</div>
                    <div class="message-time">${messageTime} ${isSent ? statusIcon : ''}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageElement);
        }

        // ðŸ”§ CORE DATA FLOW LOGIC - Send Message
        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const text = messageInput.value.trim();
            
            if (!text || !currentChat) return;
            
            const message = {
                text: text,
                senderId: currentUser.uid,
                senderName: currentUserData.displayName,
                chatId: currentChat.id,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                status: 'sent'
            };
            
            // Add message to Firebase
            db.collection('messages').add(message)
                .then(() => {
                    // Clear input
                    messageInput.value = '';
                    
                    // Update chat document with last message
                    db.collection('chats').doc(currentChat.id).update({
                        lastMessage: text,
                        lastMessageTime: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    // Update message status to delivered for all messages in this chat
                    updateMessageStatus(currentChat.id, 'delivered');
                    
                    // Scroll to bottom
                    const messagesContainer = document.getElementById('messagesContainer');
                    setTimeout(() => {
                        messagesContainer.scrollTop = messagesContainer.scrollHeight;
                    }, 100);
                    
                    // Send push notification
                    sendPushNotification(currentChat.friendId, currentUserData.displayName, text);
                })
                .catch(error => {
                    console.error('Error sending message:', error);
                    showToast('Error sending message', 'error');
                });
        }

        function updateMessageStatus(chatId, status) {
            // Update all messages in this chat that are sent by the current user
            db.collection('messages')
                .where('chatId', '==', chatId)
                .where('senderId', '==', currentUser.uid)
                .where('status', '==', 'sent')
                .get()
                .then(snapshot => {
                    const batch = db.batch();
                    
                    snapshot.forEach(doc => {
                        batch.update(doc.ref, { status: status });
                    });
                    
                    return batch.commit();
                })
                .catch(error => {
                    console.error('Error updating message status:', error);
                });
        }

        function markMessagesAsRead(chatId) {
            // Mark all messages in this chat as read
            db.collection('messages')
                .where('chatId', '==', chatId)
                .where('senderId', '!=', currentUser.uid)
                .where('status', 'in', ['sent', 'delivered'])
                .get()
                .then(snapshot => {
                    const batch = db.batch();
                    
                    snapshot.forEach(doc => {
                        batch.update(doc.ref, { status: 'read' });
                    });
                    
                    return batch.commit();
                })
                .catch(error => {
                    console.error('Error marking messages as read:', error);
                });
        }

        // ðŸ”§ CORE DATA FLOW LOGIC - File/Media Upload
        async function uploadFile(file) {
            try {
                showToast('Uploading file...', 'info');
                
                // Upload to Firebase Storage
                const storageRef = storage.ref();
                const fileRef = storageRef.child(`chat_files/${currentChat.id}/${Date.now()}_${file.name}`);
                const uploadTask = fileRef.put(file);
                
                // Show upload progress
                const filePreview = document.getElementById('filePreview');
                const fileName = document.getElementById('fileName');
                const fileSize = document.getElementById('fileSize');
                const uploadProgressBar = document.getElementById('uploadProgressBar');
                
                fileName.textContent = file.name;
                fileSize.textContent = formatFileSize(file.size);
                filePreview.classList.remove('hidden');
                
                uploadTask.on('state_changed', 
                    (snapshot) => {
                        // Update progress bar
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        uploadProgressBar.style.width = `${progress}%`;
                    },
                    (error) => {
                        console.error('Error uploading file:', error);
                        showToast('Error uploading file', 'error');
                        filePreview.classList.add('hidden');
                    },
                    async () => {
                        // Upload completed
                        const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();
                        
                        // Create message with file
                        const message = {
                            text: `Shared a file: ${file.name}`,
                            senderId: currentUser.uid,
                            senderName: currentUserData.displayName,
                            chatId: currentChat.id,
                            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                            status: 'sent',
                            file: {
                                name: file.name,
                                url: downloadURL,
                                type: file.type,
                                size: file.size
                            }
                        };
                        
                        // Add message to Firebase
                        await db.collection('messages').add(message);
                        
                        // Update chat document with last message
                        await db.collection('chats').doc(currentChat.id).update({
                            lastMessage: `Shared a file: ${file.name}`,
                            lastMessageTime: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                        // Hide file preview
                        filePreview.classList.add('hidden');
                        
                        showToast('File uploaded successfully', 'success');
                    }
                );
            } catch (error) {
                console.error('Error uploading file:', error);
                showToast('Error uploading file', 'error');
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // SAFE VERSION: Load chats with null checks
        function loadChatsTemporary() {
            if (unsubscribeChats) {
                unsubscribeChats();
            }
            
            const chatList = document.getElementById('chatList');
            const noChatsMessage = document.getElementById('noChatsMessage');
            
            // Safety check - if elements don't exist, return early
            if (!chatList || !noChatsMessage) {
                console.error('Chat list elements not found');
                return;
            }
            
            unsubscribeChats = db.collection('chats')
                .where('participants', 'array-contains', currentUser.uid)
                .onSnapshot({
                    next: (snapshot) => {
                        // Double-check elements still exist
                        if (!chatList || !noChatsMessage) return;
                        
                        chatList.innerHTML = '';
                        
                        if (snapshot.empty) {
                            noChatsMessage.classList.remove('hidden');
                            return;
                        }
                        
                        noChatsMessage.classList.add('hidden');
                        
                        // Sort manually in JavaScript
                        const chats = [];
                        snapshot.forEach(doc => {
                            chats.push({ id: doc.id, ...doc.data() });
                        });
                        
                        // Manual sort by lastMessageTime
                        chats.sort((a, b) => {
                            const timeA = a.lastMessageTime ? a.lastMessageTime.toDate() : new Date(0);
                            const timeB = b.lastMessageTime ? b.lastMessageTime.toDate() : new Date(0);
                            return timeB - timeA; // Descending order
                        });
                        
                        chats.forEach(chat => {
                            const otherParticipantId = chat.participants.find(id => id !== currentUser.uid);
                            const otherParticipantName = chat.participantNames ? chat.participantNames[otherParticipantId] : 'Unknown User';
                            
                            const chatItem = document.createElement('div');
                            chatItem.className = 'contact-item';
                            chatItem.dataset.chatId = chat.id;
                            chatItem.dataset.otherUserId = otherParticipantId;
                            
                            chatItem.innerHTML = `
                                <div class="contact-avatar">
                                    <img class="w-12 h-12 rounded-full object-cover" src="https://ui-avatars.com/api/?name=${encodeURIComponent(otherParticipantName)}&background=7C3AED&color=fff" alt="${otherParticipantName}">
                                </div>
                                <div class="contact-info">
                                    <div class="contact-name">${otherParticipantName}</div>
                                    <div class="contact-status">${chat.lastMessage || 'No messages yet'}</div>
                                </div>
                                <div class="last-seen">
                                    ${chat.lastMessageTime ? formatTimeAgo(chat.lastMessageTime) : ''}
                                </div>
                            `;
                            
                            chatItem.addEventListener('click', () => {
                                startChat(otherParticipantId, otherParticipantName);
                            });
                            
                            chatList.appendChild(chatItem);
                        });
                    },
                    error: (error) => {
                        console.error('Error loading chats:', error);
                        // Check if elements exist before showing toast
                        if (document.getElementById('chatList')) {
                            showToast('Error loading chats', 'error');
                        }
                    }
                });
        }

        function startCall(friendId, friendName) {
            // For now, just show a toast notification
            showToast(`Calling ${friendName}...`, 'info');
            
            // In a real implementation, you would integrate with a WebRTC service
            // and show the call interface
        }

        // ðŸ‘¤ USER MANAGEMENT - Update Profile
        async function updateProfile() {
            try {
                const name = document.getElementById('profileName').value.trim();
                const about = document.getElementById('profileAbout').value.trim();
                const email = document.getElementById('profileEmail').value.trim();
                const phone = document.getElementById('profilePhone').value.trim();
                
                if (!name) {
                    showToast('Display name is required', 'error');
                    return;
                }
                
                const updates = {
                    displayName: name,
                    about: about,
                    email: email,
                    phone: phone,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('users').doc(currentUser.uid).update(updates);
                
                // Update current user data
                currentUserData.displayName = name;
                currentUserData.about = about;
                currentUserData.email = email;
                currentUserData.phone = phone;
                
                // Update UI
                document.getElementById('userName').textContent = name;
                document.getElementById('settingsUserName').textContent = name;
                
                showToast('Profile updated successfully', 'success');
            } catch (error) {
                console.error('Error updating profile:', error);
                showToast('Error updating profile', 'error');
            }
        }

        // ðŸ‘¤ USER MANAGEMENT - Upload Profile Picture
        async function uploadProfilePicture(file) {
            try {
                showToast('Uploading profile picture...', 'info');
                
                // Upload to Firebase Storage
                const storageRef = storage.ref();
                const fileRef = storageRef.child(`profile_pictures/${currentUser.uid}/${file.name}`);
                const snapshot = await fileRef.put(file);
                const downloadURL = await snapshot.ref.getDownloadURL();
                
                // Update user document
                await db.collection('users').doc(currentUser.uid).update({
                    photoURL: downloadURL,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Update current user data
                currentUserData.photoURL = downloadURL;
                
                // Update UI
                document.getElementById('userAvatar').src = downloadURL;
                document.getElementById('settingsProfilePic').src = downloadURL;
                document.getElementById('profilePicPreview').src = downloadURL;
                
                showToast('Profile picture updated successfully', 'success');
            } catch (error) {
                console.error('Error uploading profile picture:', error);
                showToast('Error uploading profile picture', 'error');
            }
        }

        // ðŸ‘¤ USER MANAGEMENT - Upload Cover Picture
        async function uploadCoverPicture(file) {
            try {
                showToast('Uploading cover picture...', 'info');
                
                // Upload to Firebase Storage
                const storageRef = storage.ref();
                const fileRef = storageRef.child(`cover_pictures/${currentUser.uid}/${file.name}`);
                const snapshot = await fileRef.put(file);
                const downloadURL = await snapshot.ref.getDownloadURL();
                
                // Update user document
                await db.collection('users').doc(currentUser.uid).update({
                    coverURL: downloadURL,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Update current user data
                currentUserData.coverURL = downloadURL;
                
                // Update UI
                document.getElementById('profileCoverPreview').src = downloadURL;
                
                showToast('Cover picture updated successfully', 'success');
            } catch (error) {
                console.error('Error uploading cover picture:', error);
                showToast('Error uploading cover picture', 'error');
            }
        }

        // ðŸ’¡ ADVANCED UX - Typing Indicator
        function handleTypingIndicator() {
            if (currentChat) {
                // Send typing indicator
                db.collection('chats').doc(currentChat.id).update({
                    [`typing.${currentUser.uid}`]: true,
                    lastActivity: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Clear previous timeout
                if (typingTimeout) {
                    clearTimeout(typingTimeout);
                }
                
                // Set timeout to remove typing indicator
                typingTimeout = setTimeout(() => {
                    db.collection('chats').doc(currentChat.id).update({
                        [`typing.${currentUser.uid}`]: false
                    });
                }, 1000);
            }
        }

        // ðŸ’¡ ADVANCED UX - Push Notifications
        async function requestNotificationPermission() {
            try {
                // Check if permission is already denied/blocked
                if (Notification.permission === 'denied') {
                    console.log('Notifications blocked by user. User must manually enable in browser settings.');
                    return;
                }
                
                // Don't ask if already granted
                if (Notification.permission === 'granted') {
                    console.log('Notifications already granted');
                    return;
                }
                
                // Only ask if permission is default
                if (Notification.permission === 'default') {
                    const permission = await Notification.requestPermission();
                    if (permission === 'granted') {
                        console.log('Notification permission granted');
                        // Get FCM token here if needed
                    }
                }
            } catch (error) {
                console.error('Error with notification permission:', error);
            }
        }

        async function sendPushNotification(userId, senderName, message) {
            try {
                // Get recipient's FCM token
                const recipientDoc = await db.collection('users').doc(userId).get();
                if (recipientDoc.exists) {
                    const recipientData = recipientDoc.data();
                    const fcmToken = recipientData.fcmToken;
                    
                    if (fcmToken) {
                        // In a real implementation, you would send a push notification
                        // through Firebase Cloud Messaging or a server
                        console.log(`Sending push notification to ${userId}: ${senderName}: ${message}`);
                    }
                }
            } catch (error) {
                console.error('Error sending push notification:', error);
            }
        }

        // ðŸ’¡ ADVANCED UX - Client-Side Caching
        function cacheMessages(chatId, messages) {
            try {
                const cacheKey = `kynecta_messages_${chatId}`;
                localStorage.setItem(cacheKey, JSON.stringify({
                    timestamp: Date.now(),
                    messages: messages
                }));
            } catch (error) {
                console.error('Error caching messages:', error);
            }
        }

        function getCachedMessages(chatId) {
            try {
                const cacheKey = `kynecta_messages_${chatId}`;
                const cached = localStorage.getItem(cacheKey);
                
                if (cached) {
                    const data = JSON.parse(cached);
                    // Return cached messages if they're less than 5 minutes old
                    if (Date.now() - data.timestamp < 5 * 60 * 1000) {
                        return data.messages;
                    }
                }
            } catch (error) {
                console.error('Error getting cached messages:', error);
            }
            
            return null;
        }

        function initEmojiPicker() {
            const emojiCategories = [
                {
                    title: 'Smileys & People',
                    emojis: ['ðŸ˜€', 'ðŸ˜ƒ', 'ðŸ˜„', 'ðŸ˜', 'ðŸ˜†', 'ðŸ˜…', 'ðŸ˜‚', 'ðŸ¤£', 'ðŸ˜Š', 'ðŸ˜‡', 'ðŸ™‚', 'ðŸ™ƒ', 'ðŸ˜‰', 'ðŸ˜Œ', 'ðŸ˜', 'ðŸ¥°', 'ðŸ˜˜', 'ðŸ˜—', 'ðŸ˜™', 'ðŸ˜š', 'ðŸ˜‹', 'ðŸ˜›', 'ðŸ˜', 'ðŸ˜œ', 'ðŸ¤ª', 'ðŸ¤¨', 'ðŸ§', 'ðŸ¤“', 'ðŸ˜Ž', 'ðŸ¤©', 'ðŸ¥³', 'ðŸ˜', 'ðŸ˜’', 'ðŸ˜ž', 'ðŸ˜”', 'ðŸ˜Ÿ', 'ðŸ˜•', 'ðŸ™', 'â˜¹ï¸', 'ðŸ˜£', 'ðŸ˜–', 'ðŸ˜«', 'ðŸ˜©', 'ðŸ¥º', 'ðŸ˜¢', 'ðŸ˜­', 'ðŸ˜¤', 'ðŸ˜ ', 'ðŸ˜¡', 'ðŸ¤¬', 'ðŸ¤¯', 'ðŸ˜³', 'ðŸ¥µ', 'ðŸ¥¶', 'ðŸ˜±', 'ðŸ˜¨', 'ðŸ˜°', 'ðŸ˜¥', 'ðŸ˜“', 'ðŸ¤—', 'ðŸ¤”', 'ðŸ¤­', 'ðŸ¤«', 'ðŸ¤¥', 'ðŸ˜¶', 'ðŸ˜', 'ðŸ˜‘', 'ðŸ˜¬', 'ðŸ™„', 'ðŸ˜¯', 'ðŸ˜¦', 'ðŸ˜§', 'ðŸ˜®', 'ðŸ˜²', 'ðŸ¥±', 'ðŸ˜´', 'ðŸ¤¤', 'ðŸ˜ª', 'ðŸ˜µ', 'ðŸ¤', 'ðŸ¥´', 'ðŸ¤¢', 'ðŸ¤®', 'ðŸ¤§', 'ðŸ˜·', 'ðŸ¤’', 'ðŸ¤•', 'ðŸ¤‘', 'ðŸ¤ ', 'ðŸ˜ˆ', 'ðŸ‘¿', 'ðŸ‘¹', 'ðŸ‘º', 'ðŸ¤¡', 'ðŸ’©', 'ðŸ‘»', 'ðŸ’€', 'â˜ ï¸', 'ðŸ‘½', 'ðŸ‘¾', 'ðŸ¤–', 'ðŸŽƒ', 'ðŸ˜º', 'ðŸ˜¸', 'ðŸ˜¹', 'ðŸ˜»', 'ðŸ˜¼', 'ðŸ˜½', 'ðŸ™€', 'ðŸ˜¿', 'ðŸ˜¾']
                },
                {
                    title: 'Animals & Nature',
                    emojis: ['ðŸµ', 'ðŸ’', 'ðŸ¦', 'ðŸ¦§', 'ðŸ¶', 'ðŸ•', 'ðŸ¦®', 'ðŸ©', 'ðŸº', 'ðŸ¦Š', 'ðŸ¦', 'ðŸ±', 'ðŸˆ', 'ðŸ¦', 'ðŸ¯', 'ðŸ…', 'ðŸ†', 'ðŸ´', 'ðŸŽ', 'ðŸ¦„', 'ðŸ¦“', 'ðŸ¦Œ', 'ðŸ®', 'ðŸ‚', 'ðŸƒ', 'ðŸ„', 'ðŸ·', 'ðŸ–', 'ðŸ—', 'ðŸ½', 'ðŸ', 'ðŸ‘', 'ðŸ', 'ðŸª', 'ðŸ«', 'ðŸ¦™', 'ðŸ¦’', 'ðŸ˜', 'ðŸ¦', 'ðŸ¦›', 'ðŸ­', 'ðŸ', 'ðŸ€', 'ðŸ¹', 'ðŸ°', 'ðŸ‡', 'ðŸ¿ï¸', 'ðŸ¦”', 'ðŸ¦‡', 'ðŸ»', 'ðŸ¨', 'ðŸ¼', 'ðŸ¦¥', 'ðŸ¦¦', 'ðŸ¦¨', 'ðŸ¦˜', 'ðŸ¦¡', 'ðŸ¾', 'ðŸ¦ƒ', 'ðŸ”', 'ðŸ“', 'ðŸ£', 'ðŸ¤', 'ðŸ¥', 'ðŸ¦', 'ðŸ§', 'ðŸ•Šï¸', 'ðŸ¦…', 'ðŸ¦†', 'ðŸ¦¢', 'ðŸ¦‰', 'ðŸ¦©', 'ðŸ¦š', 'ðŸ¦œ', 'ðŸ¸', 'ðŸŠ', 'ðŸ¢', 'ðŸ¦Ž', 'ðŸ', 'ðŸ²', 'ðŸ‰', 'ðŸ¦•', 'ðŸ¦–', 'ðŸ³', 'ðŸ‹', 'ðŸ¬', 'ðŸŸ', 'ðŸ ', 'ðŸ¡', 'ðŸ¦ˆ', 'ðŸ™', 'ðŸš', 'ðŸŒ', 'ðŸ¦‹', 'ðŸ›', 'ðŸœ', 'ðŸ', 'ðŸž', 'ðŸ¦—', 'ðŸ•·ï¸', 'ðŸ•¸ï¸', 'ðŸ¦‚', 'ðŸ¦Ÿ', 'ðŸ¦ ', 'ðŸ’', 'ðŸŒ¸', 'ðŸ’®', 'ðŸµï¸', 'ðŸŒ¹', 'ðŸ¥€', 'ðŸŒº', 'ðŸŒ»', 'ðŸŒ¼', 'ðŸŒ·', 'ðŸŒ±', 'ðŸŒ²', 'ðŸŒ³', 'ðŸŒ´', 'ðŸŒµ', 'ðŸŒ¾', 'ðŸŒ¿', 'â˜˜ï¸', 'ðŸ€', 'ðŸ', 'ðŸ‚', 'ðŸƒ']
                },
                {
                    title: 'Food & Drink',
                    emojis: ['ðŸ‡', 'ðŸˆ', 'ðŸ‰', 'ðŸŠ', 'ðŸ‹', 'ðŸŒ', 'ðŸ', 'ðŸ¥­', 'ðŸŽ', 'ðŸ', 'ðŸ', 'ðŸ‘', 'ðŸ’', 'ðŸ“', 'ðŸ¥', 'ðŸ…', 'ðŸ¥¥', 'ðŸ¥‘', 'ðŸ†', 'ðŸ¥”', 'ðŸ¥•', 'ðŸŒ½', 'ðŸŒ¶ï¸', 'ðŸ¥’', 'ðŸ¥¬', 'ðŸ¥¦', 'ðŸ§„', 'ðŸ§…', 'ðŸ„', 'ðŸ¥œ', 'ðŸŒ°', 'ðŸž', 'ðŸ¥', 'ðŸ¥–', 'ðŸ¥¨', 'ðŸ¥¯', 'ðŸ¥ž', 'ðŸ§‡', 'ðŸ§€', 'ðŸ–', 'ðŸ—', 'ðŸ¥©', 'ðŸ¥“', 'ðŸ”', 'ðŸŸ', 'ðŸ•', 'ðŸŒ­', 'ðŸ¥ª', 'ðŸŒ®', 'ðŸŒ¯', 'ðŸ¥™', 'ðŸ§†', 'ðŸ¥š', 'ðŸ³', 'ðŸ¥˜', 'ðŸ²', 'ðŸ¥£', 'ðŸ¥—', 'ðŸ¿', 'ðŸ§ˆ', 'ðŸ§‚', 'ðŸ¥«', 'ðŸ±', 'ðŸ˜', 'ðŸ™', 'ðŸš', 'ðŸ›', 'ðŸœ', 'ðŸ', 'ðŸ ', 'ðŸ¢', 'ðŸ£', 'ðŸ¤', 'ðŸ¥', 'ðŸ¥®', 'ðŸ¡', 'ðŸ¥Ÿ', 'ðŸ¥ ', 'ðŸ¥¡', 'ðŸ¦€', 'ðŸ¦ž', 'ðŸ¦', 'ðŸ¦‘', 'ðŸ¦ª', 'ðŸ¦', 'ðŸ§', 'ðŸ¨', 'ðŸ©', 'ðŸª', 'ðŸŽ‚', 'ðŸ°', 'ðŸ§', 'ðŸ¥§', 'ðŸ«', 'ðŸ¬', 'ðŸ­', 'ðŸ®', 'ðŸ¯', 'ðŸ¼', 'ðŸ¥›', 'â˜•', 'ðŸµ', 'ðŸ¶', 'ðŸ¾', 'ðŸ·', 'ðŸ¸', 'ðŸ¹', 'ðŸº', 'ðŸ»', 'ðŸ¥‚', 'ðŸ¥ƒ', 'ðŸ¥¤', 'ðŸ§ƒ', 'ðŸ§‰', 'ðŸ§Š', 'ðŸ¥¢', 'ðŸ½ï¸', 'ðŸ´', 'ðŸ¥„', 'ðŸ”ª', 'ðŸº']
                },
                {
                    title: 'Activities',
                    emojis: ['âš½', 'ðŸ€', 'ðŸˆ', 'âš¾', 'ðŸ¥Ž', 'ðŸŽ¾', 'ðŸ', 'ðŸ‰', 'ðŸ¥', 'ðŸŽ±', 'ðŸª€', 'ðŸ“', 'ðŸ¸', 'ðŸ’', 'ðŸ‘', 'ðŸ¥', 'ðŸ', 'ðŸª', 'ðŸ¥…', 'â›³', 'ðŸªƒ', 'ðŸ¹', 'ðŸŽ£', 'ðŸ¤¿', 'ðŸ¥Š', 'ðŸ¥‹', 'ðŸŽ½', 'ðŸ›¹', 'ðŸ›·', 'â›¸ï¸', 'ðŸ¥Œ', 'ðŸŽ¿', 'â›·ï¸', 'ðŸ‚', 'ðŸª‚', 'ðŸ‹ï¸', 'ðŸ¤¼', 'ðŸ¤¸', 'â›¹ï¸', 'ðŸ¤¾', 'ðŸŒï¸', 'ðŸ‡', 'ðŸ§˜', 'ðŸ„', 'ðŸŠ', 'ðŸ¤½', 'ðŸš£', 'ðŸ§—', 'ðŸšµ', 'ðŸš´', 'ðŸ†', 'ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰', 'ðŸ…', 'ðŸŽ–ï¸', 'ðŸµï¸', 'ðŸŽ—ï¸', 'ðŸŽ«', 'ðŸŽŸï¸', 'ðŸŽª', 'ðŸ¤¹', 'ðŸŽ­', 'ðŸ©°', 'ðŸŽ¨', 'ðŸŽ¬', 'ðŸŽ¤', 'ðŸŽ§', 'ðŸŽ¼', 'ðŸŽ¹', 'ðŸ¥', 'ðŸª˜', 'ðŸŽ·', 'ðŸŽº', 'ðŸŽ¸', 'ðŸª•', 'ðŸŽ»', 'ðŸŽ²', 'â™Ÿï¸', 'ðŸŽ¯', 'ðŸŽ³', 'ðŸŽ®', 'ðŸŽ°', 'ðŸ§©']
                },
                {
                    title: 'Travel & Places',
                    emojis: ['ðŸš—', 'ðŸš•', 'ðŸš™', 'ðŸšŒ', 'ðŸšŽ', 'ðŸŽï¸', 'ðŸš“', 'ðŸš‘', 'ðŸš’', 'ðŸš', 'ðŸ›»', 'ðŸšš', 'ðŸš›', 'ðŸšœ', 'ðŸ¦¯', 'ðŸ¦½', 'ðŸ¦¼', 'ðŸ›´', 'ðŸš²', 'ðŸ›µ', 'ðŸï¸', 'ðŸ›º', 'ðŸš¨', 'ðŸš”', 'ðŸš', 'ðŸš˜', 'ðŸš–', 'ðŸš¡', 'ðŸš ', 'ðŸšŸ', 'ðŸšƒ', 'ðŸš‹', 'ðŸšž', 'ðŸš', 'ðŸš„', 'ðŸš…', 'ðŸšˆ', 'ðŸš‚', 'ðŸš†', 'ðŸš‡', 'ðŸšŠ', 'ðŸš‰', 'âœˆï¸', 'ðŸ›«', 'ðŸ›¬', 'ðŸ›©ï¸', 'ðŸ’º', 'ðŸ›°ï¸', 'ðŸš€', 'ðŸ›¸', 'ðŸš', 'ðŸ›¶', 'â›µ', 'ðŸš¤', 'ðŸ›¥ï¸', 'ðŸ›³ï¸', 'â›´ï¸', 'ðŸš¢', 'âš“', 'â›½', 'ðŸš§', 'ðŸš¦', 'ðŸš¥', 'ðŸš', 'ðŸ—ºï¸', 'ðŸ—¿', 'ðŸ—½', 'ðŸ—¼', 'ðŸ°', 'ðŸ¯', 'ðŸŸï¸', 'ðŸŽ¡', 'ðŸŽ¢', 'ðŸŽ ', 'â›²', 'â›±ï¸', 'ðŸ–ï¸', 'ðŸï¸', 'ðŸœï¸', 'ðŸŒ‹', 'â›°ï¸', 'ðŸ”ï¸', 'ðŸ—»', 'ðŸ•ï¸', 'ðŸ ', 'ðŸ¡', 'ðŸ˜ï¸', 'ðŸšï¸', 'ðŸ—ï¸', 'ðŸ­', 'ðŸ¢', 'ðŸ¬', 'ðŸ£', 'ðŸ¤', 'ðŸ¥', 'ðŸ¦', 'ðŸ¨', 'ðŸª', 'ðŸ«', 'ðŸ©', 'ðŸ’’', 'ðŸ›ï¸', 'â›ª', 'ðŸ•Œ', 'ðŸ•', 'ðŸ›•', 'ðŸ•‹', 'â›©ï¸', 'ðŸ—¾', 'ðŸŽ‘', 'ðŸžï¸', 'ðŸŒ…', 'ðŸŒ„', 'ðŸŒ ', 'ðŸŽ‡', 'ðŸŽ†', 'ðŸŒ‡', 'ðŸŒ†', 'ðŸ™ï¸', 'ðŸŒƒ', 'ðŸŒŒ', 'ðŸŒ‰', 'ðŸŒ']
                },
                {
                    title: 'Objects',
                    emojis: ['âŒš', 'ðŸ“±', 'ðŸ“²', 'ðŸ’»', 'âŒ¨ï¸', 'ðŸ–¥ï¸', 'ðŸ–¨ï¸', 'ðŸ–±ï¸', 'ðŸ–²ï¸', 'ðŸ•¹ï¸', 'ðŸ—œï¸', 'ðŸ’½', 'ðŸ’¾', 'ðŸ’¿', 'ðŸ“€', 'ðŸ“¼', 'ðŸ“·', 'ðŸ“¸', 'ðŸ“¹', 'ðŸŽ¥', 'ðŸ“½ï¸', 'ðŸŽžï¸', 'ðŸ“ž', 'â˜Žï¸', 'ðŸ“Ÿ', 'ðŸ“ ', 'ðŸ“º', 'ðŸ“»', 'ðŸŽ™ï¸', 'ðŸŽšï¸', 'ðŸŽ›ï¸', 'ðŸ§­', 'â±ï¸', 'â²ï¸', 'â°', 'ðŸ•°ï¸', 'âŒ›', 'â³', 'ðŸ“¡', 'ðŸ”‹', 'ðŸ”Œ', 'ðŸ’¡', 'ðŸ”¦', 'ðŸ•¯ï¸', 'ðŸª”', 'ðŸ§¯', 'ðŸ›¢ï¸', 'ðŸ’¸', 'ðŸ’µ', 'ðŸ’´', 'ðŸ’¶', 'ðŸ’·', 'ðŸ’°', 'ðŸ’³', 'ðŸ’Ž', 'âš–ï¸', 'ðŸ§°', 'ðŸ”§', 'ðŸ”¨', 'âš’ï¸', 'ðŸ› ï¸', 'â›ï¸', 'ðŸ”©', 'âš™ï¸', 'ðŸ§±', 'â›“ï¸', 'ðŸ§²', 'ðŸ”«', 'ðŸ’£', 'ðŸ§¨', 'ðŸª“', 'ðŸ”ª', 'ðŸ—¡ï¸', 'âš”ï¸', 'ðŸ›¡ï¸', 'ðŸš¬', 'âš°ï¸', 'âš±ï¸', 'ðŸº', 'ðŸ”®', 'ðŸ“¿', 'ðŸ§¿', 'ðŸ’ˆ', 'âš—ï¸', 'ðŸ”­', 'ðŸ”¬', 'ðŸ•³ï¸', 'ðŸ©¹', 'ðŸ©º', 'ðŸ’Š', 'ðŸ’‰', 'ðŸ©¸', 'ðŸ§¬', 'ðŸ¦ ', 'ðŸ§«', 'ðŸ§ª', 'ðŸŒ¡ï¸', 'ðŸ§¹', 'ðŸ§º', 'ðŸ§»', 'ðŸš½', 'ðŸš°', 'ðŸš¿', 'ðŸ›', 'ðŸ›€', 'ðŸ§¼', 'ðŸª’', 'ðŸ§½', 'ðŸ§´', 'ðŸ›Žï¸', 'ðŸ”‘', 'ðŸ—ï¸', 'ðŸšª', 'ðŸª‘', 'ðŸ›‹ï¸', 'ðŸ›ï¸', 'ðŸ›Œ', 'ðŸ§¸', 'ðŸ–¼ï¸', 'ðŸ›ï¸', 'ðŸ›’', 'ðŸŽ', 'ðŸŽˆ', 'ðŸŽ', 'ðŸŽ€', 'ðŸŽŠ', 'ðŸŽ‰', 'ðŸŽŽ', 'ðŸ®', 'ðŸŽ', 'âœ‰ï¸', 'ðŸ“©', 'ðŸ“¨', 'ðŸ“§', 'ðŸ’Œ', 'ðŸ“¥', 'ðŸ“¤', 'ðŸ“¦', 'ðŸ·ï¸', 'ðŸ“ª', 'ðŸ“«', 'ðŸ“¬', 'ðŸ“­', 'ðŸ“®', 'ðŸ“¯', 'ðŸ“œ', 'ðŸ“ƒ', 'ðŸ“„', 'ðŸ“‘', 'ðŸ§¾', 'ðŸ“Š', 'ðŸ“ˆ', 'ðŸ“‰', 'ðŸ—’ï¸', 'ðŸ—“ï¸', 'ðŸ“†', 'ðŸ“…', 'ðŸ—‘ï¸', 'ðŸ“‡', 'ðŸ—ƒï¸', 'ðŸ—³ï¸', 'ðŸ—„ï¸', 'ðŸ“‹', 'ðŸ“', 'ðŸ“‚', 'ðŸ—‚ï¸', 'ðŸ—žï¸', 'ðŸ“°', 'ðŸ““', 'ðŸ“”', 'ðŸ“’', 'ðŸ“•', 'ðŸ“—', 'ðŸ“˜', 'ðŸ“™', 'ðŸ“š', 'ðŸ“–', 'ðŸ”–', 'ðŸ§·', 'ðŸ”—', 'ðŸ“Ž', 'ðŸ–‡ï¸', 'ðŸ“', 'ðŸ“', 'ðŸ§®', 'ðŸ“Œ', 'ðŸ“', 'âœ‚ï¸', 'ðŸ–Šï¸', 'ðŸ–‹ï¸', 'âœ’ï¸', 'ðŸ–Œï¸', 'ðŸ–ï¸', 'ðŸ“', 'âœï¸', 'ðŸ”', 'ðŸ”Ž', 'ðŸ”', 'ðŸ”', 'ðŸ”’', 'ðŸ”“']
                },
                {
                    title: 'Symbols',
                    emojis: ['â¤ï¸', 'ðŸ§¡', 'ðŸ’›', 'ðŸ’š', 'ðŸ’™', 'ðŸ’œ', 'ðŸ–¤', 'ðŸ¤', 'ðŸ¤Ž', 'ðŸ’”', 'â£ï¸', 'ðŸ’•', 'ðŸ’ž', 'ðŸ’“', 'ðŸ’—', 'ðŸ’–', 'ðŸ’˜', 'ðŸ’', 'ðŸ’Ÿ', 'â˜®ï¸', 'âœï¸', 'â˜ªï¸', 'ðŸ•‰ï¸', 'â˜¸ï¸', 'âœ¡ï¸', 'ðŸ”¯', 'ðŸ•Ž', 'â˜¯ï¸', 'â˜¦ï¸', 'ðŸ›', 'â›Ž', 'â™ˆ', 'â™‰', 'â™Š', 'â™‹', 'â™Œ', 'â™', 'â™Ž', 'â™', 'â™', 'â™‘', 'â™’', 'â™“', 'ðŸ†”', 'âš›ï¸', 'ðŸ‰‘', 'â˜¢ï¸', 'â˜£ï¸', 'ðŸ“´', 'ðŸ“³', 'ðŸˆ¶', 'ðŸˆš', 'ðŸˆ¸', 'ðŸˆº', 'ðŸˆ·ï¸', 'âœ´ï¸', 'ðŸ†š', 'ðŸ’®', 'ðŸ‰', 'ãŠ™ï¸', 'ãŠ—ï¸', 'ðŸˆ´', 'ðŸˆµ', 'ðŸˆ¹', 'ðŸˆ²', 'ðŸ…°ï¸', 'ðŸ…±ï¸', 'ðŸ†Ž', 'ðŸ†‘', 'ðŸ…¾ï¸', 'ðŸ†˜', 'âŒ', 'â­•', 'ðŸ›‘', 'â›”', 'ðŸ“›', 'ðŸš«', 'ðŸ’¯', 'ðŸ’¢', 'â™¨ï¸', 'ðŸš·', 'ðŸš¯', 'ðŸš³', 'ðŸš±', 'ðŸ”ž', 'ðŸ“µ', 'ðŸš­', 'â—', 'â•', 'â“', 'â”', 'â€¼ï¸', 'â‰ï¸', 'ðŸ”…', 'ðŸ”†', 'ã€½ï¸', 'âš ï¸', 'ðŸš¸', 'ðŸ”±', 'âšœï¸', 'ðŸ”°', 'â™»ï¸', 'âœ…', 'ðŸˆ¯', 'ðŸ’¹', 'â‡ï¸', 'âœ³ï¸', 'âŽ', 'ðŸŒ', 'ðŸ’ ', 'â“‚ï¸', 'ðŸŒ€', 'ðŸ’¤', 'ðŸ§', 'ðŸš¾', 'â™¿', 'ðŸ…¿ï¸', 'ðŸˆ³', 'ðŸˆ‚ï¸', 'ðŸ›‚', 'ðŸ›ƒ', 'ðŸ›„', 'ðŸ›…', 'ðŸš¹', 'ðŸšº', 'ðŸš¼', 'ðŸš»', 'ðŸš®', 'ðŸŽ¦', 'ðŸ“¶', 'ðŸˆ', 'ðŸ”£', 'â„¹ï¸', 'ðŸ”¤', 'ðŸ”¡', 'ðŸ” ', 'ðŸ†–', 'ðŸ†—', 'ðŸ†™', 'ðŸ†’', 'ðŸ†•', 'ðŸ†“', '0ï¸âƒ£', '1ï¸âƒ£', '2ï¸âƒ£', '3ï¸âƒ£', '4ï¸âƒ£', '5ï¸âƒ£', '6ï¸âƒ£', '7ï¸âƒ£', '8ï¸âƒ£', '9ï¸âƒ£', 'ðŸ”Ÿ', 'ðŸ”¢', '#ï¸âƒ£', '*ï¸âƒ£', 'âï¸', 'â–¶ï¸', 'â¸ï¸', 'â¯ï¸', 'â¹ï¸', 'âºï¸', 'â­ï¸', 'â®ï¸', 'â©', 'âª', 'â«', 'â¬', 'â—€ï¸', 'ðŸ”¼', 'ðŸ”½', 'âž¡ï¸', 'â¬…ï¸', 'â¬†ï¸', 'â¬‡ï¸', 'â†—ï¸', 'â†˜ï¸', 'â†™ï¸', 'â†–ï¸', 'â†•ï¸', 'â†”ï¸', 'â†ªï¸', 'â†©ï¸', 'â¤´ï¸', 'â¤µï¸', 'ðŸ”€', 'ðŸ”', 'ðŸ”‚', 'ðŸ”„', 'ðŸ”ƒ', 'ðŸŽµ', 'ðŸŽ¶', 'âž•', 'âž–', 'âž—', 'âœ–ï¸', 'â™¾ï¸', 'ðŸ’²', 'ðŸ’±', 'â„¢ï¸', 'Â©ï¸', 'Â®ï¸', 'ã€°ï¸', 'âž°', 'âž¿', 'ðŸ”š', 'ðŸ”™', 'ðŸ”›', 'ðŸ”', 'ðŸ”œ', 'âœ”ï¸', 'â˜‘ï¸', 'ðŸ”˜', 'ðŸ”´', 'ðŸŸ ', 'ðŸŸ¡', 'ðŸŸ¢', 'ðŸ”µ', 'ðŸŸ£', 'âš«', 'âšª', 'ðŸŸ¤', 'ðŸ”º', 'ðŸ”»', 'ðŸ”¸', 'ðŸ”¹', 'ðŸ”¶', 'ðŸ”·', 'ðŸ”³', 'ðŸ”²', 'â–ªï¸', 'â–«ï¸', 'â—¾', 'â—½', 'â—¼ï¸', 'â—»ï¸', 'ðŸŸ¥', 'ðŸŸ§', 'ðŸŸ¨', 'ðŸŸ©', 'ðŸŸ¦', 'ðŸŸª', 'â¬›', 'â¬œ', 'ðŸŸ«', 'ðŸ”ˆ', 'ðŸ”‡', 'ðŸ”‰', 'ðŸ”Š', 'ðŸ””', 'ðŸ”•', 'ðŸ“£', 'ðŸ“¢', 'ðŸ‘ï¸â€ðŸ—¨ï¸', 'ðŸ’¬', 'ðŸ’­', 'ðŸ—¯ï¸', 'â™ ï¸', 'â™£ï¸', 'â™¥ï¸', 'â™¦ï¸', 'ðŸƒ', 'ðŸŽ´', 'ðŸ€„', 'ðŸ•', 'ðŸ•‘', 'ðŸ•’', 'ðŸ•“', 'ðŸ•”', 'ðŸ••', 'ðŸ•–', 'ðŸ•—', 'ðŸ•˜', 'ðŸ•™', 'ðŸ•š', 'ðŸ•›', 'ðŸ•œ', 'ðŸ•', 'ðŸ•ž', 'ðŸ•Ÿ', 'ðŸ• ', 'ðŸ•¡', 'ðŸ•¢', 'ðŸ•£', 'ðŸ•¤', 'ðŸ•¥', 'ðŸ•¦', 'ðŸ•§']
                }
            ];

            emojiPicker.innerHTML = '';

            emojiCategories.forEach(category => {
                const categoryElement = document.createElement('div');
                categoryElement.className = 'emoji-category';
                
                const categoryTitle = document.createElement('div');
                categoryTitle.className = 'emoji-category-title';
                categoryTitle.textContent = category.title;
                
                const emojiGrid = document.createElement('div');
                emojiGrid.className = 'emoji-grid';
                
                category.emojis.forEach(emoji => {
                    const emojiOption = document.createElement('div');
                    emojiOption.className = 'emoji-option';
                    emojiOption.textContent = emoji;
                    emojiOption.addEventListener('click', () => {
                        const messageInput = document.getElementById('messageInput');
                        messageInput.value += emoji;
                        emojiPicker.style.display = 'none';
                        messageInput.focus();
                    });
                    
                    emojiGrid.appendChild(emojiOption);
                });
                
                categoryElement.appendChild(categoryTitle);
                categoryElement.appendChild(emojiGrid);
                emojiPicker.appendChild(categoryElement);
            });
        }

        // Enhanced Friend Search with Multiple Options
        async function enhancedFriendSearch(query) {
            if (!query) return [];
            
            const results = await searchUsers(query);
            return results;
        }

        function displayEnhancedSearchResults(results) {
            const enhancedSearchResults = document.getElementById('enhancedSearchResults');
            enhancedSearchResults.innerHTML = '';
            
            if (results.length === 0) {
                enhancedSearchResults.innerHTML = '<p class="text-center text-gray-500 py-4">No users found</p>';
                return;
            }
            
            results.forEach(user => {
                const resultItem = document.createElement('div');
                resultItem.className = 'flex items-center p-3 border-b border-gray-200 hover:bg-gray-50 cursor-pointer';
                resultItem.innerHTML = `
                    <img class="w-10 h-10 rounded-full mr-3" src="${user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName)}&background=7C3AED&color=fff`}" alt="${user.displayName}">
                    <div class="flex-1">
                        <p class="font-medium">${user.displayName}</p>
                        <p class="text-sm text-gray-500">${user.email || user.phone || ''}</p>
                    </div>
                    <div class="flex space-x-2">
                        <button class="bg-purple-600 text-white px-3 py-1 rounded-lg add-friend" data-id="${user.id}" data-name="${user.displayName}">
                            <i class="fas fa-user-plus"></i>
                        </button>
                        <button class="bg-green-600 text-white px-3 py-1 rounded-lg message-user" data-id="${user.id}" data-name="${user.displayName}">
                            <i class="fas fa-comment"></i>
                        </button>
                    </div>
                `;
                
                enhancedSearchResults.appendChild(resultItem);
            });
            
            // Add event listeners to buttons
            document.querySelectorAll('.add-friend').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const userId = e.currentTarget.dataset.id;
                    const userName = e.currentTarget.dataset.name;
                    sendFriendRequest(userId);
                    friendSearchResultsModal.classList.add('hidden');
                    showToast(`Friend request sent to ${userName}`, 'success');
                });
            });

            document.querySelectorAll('.message-user').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const userId = e.currentTarget.dataset.id;
                    const userName = e.currentTarget.dataset.name;
                    startChat(userId, userName);
                    friendSearchResultsModal.classList.add('hidden');
                });
            });
        }

        // NEW FEATURES IMPLEMENTATION

        // Group Creation and Management
        function openCreateGroupModal() {
            createGroupModal.classList.remove('hidden');
            populateGroupParticipants();
        }

        function populateGroupParticipants() {
            const groupParticipants = document.getElementById('groupParticipants');
            groupParticipants.innerHTML = '';
            
            if (friends.length === 0) {
                groupParticipants.innerHTML = '<div class="text-gray-500 text-center py-4">No friends available to add to group</div>';
                return;
            }
            
            friends.forEach(friend => {
                const participantItem = document.createElement('div');
                participantItem.className = 'flex items-center p-2 border-b border-gray-100';
                participantItem.innerHTML = `
                    <div class="flex items-center flex-1">
                        <img class="w-8 h-8 rounded-full mr-3" src="${friend.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(friend.displayName)}&background=7C3AED&color=fff`}" alt="${friend.displayName}">
                        <span class="font-medium">${friend.displayName}</span>
                    </div>
                    <input type="checkbox" class="group-participant-checkbox" data-id="${friend.id}" data-name="${friend.displayName}">
                `;
                
                groupParticipants.appendChild(participantItem);
            });
        }

        async function createGroup() {
            const groupName = document.getElementById('groupName').value.trim();
            const groupDescription = document.getElementById('groupDescription').value.trim();
            const groupPrivacy = document.getElementById('groupPrivacy').value;
            
            if (!groupName) {
                showToast('Group name is required', 'error');
                return;
            }
            
            // Get selected participants
            const selectedParticipants = Array.from(document.querySelectorAll('.group-participant-checkbox:checked'))
                .map(checkbox => ({
                    id: checkbox.dataset.id,
                    name: checkbox.dataset.name
                }));
            
            if (selectedParticipants.length === 0) {
                showToast('Please select at least one participant', 'error');
                return;
            }
            
            try {
                // Create group document
                const groupData = {
                    name: groupName,
                    description: groupDescription,
                    privacy: groupPrivacy,
                    createdBy: currentUser.uid,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    participants: [currentUser.uid, ...selectedParticipants.map(p => p.id)],
                    participantNames: {
                        [currentUser.uid]: currentUserData.displayName
                    },
                    admin: currentUser.uid,
                    lastMessage: '',
                    lastMessageTime: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Add participant names
                selectedParticipants.forEach(participant => {
                    groupData.participantNames[participant.id] = participant.name;
                });
                
                const groupRef = await db.collection('groups').add(groupData);
                
                // Create initial group message
                const welcomeMessage = {
                    text: `${currentUserData.displayName} created the group "${groupName}"`,
                    senderId: currentUser.uid,
                    senderName: currentUserData.displayName,
                    groupId: groupRef.id,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'sent',
                    type: 'system'
                };
                
                await db.collection('groupMessages').add(welcomeMessage);
                
                showToast('Group created successfully', 'success');
                createGroupModal.classList.add('hidden');
                
                // Reset form
                document.getElementById('groupName').value = '';
                document.getElementById('groupDescription').value = '';
                document.getElementById('groupPrivacy').value = 'public';
                
            } catch (error) {
                console.error('Error creating group:', error);
                showToast('Error creating group', 'error');
            }
        }

        function openJoinGroupModal() {
            joinGroupModal.classList.remove('hidden');
        }

        async function joinGroup() {
            const groupCode = document.getElementById('groupCode').value.trim();
            
            if (!groupCode) {
                showToast('Please enter a group code or link', 'error');
                return;
            }
            
            try {
                // For demo purposes, we'll simulate joining a group
                // In a real implementation, you would validate the group code/link
                // and add the user to the group
                
                showToast('Joining group...', 'info');
                
                // Simulate API call
                setTimeout(() => {
                    showToast('Successfully joined the group', 'success');
                    joinGroupModal.classList.add('hidden');
                    document.getElementById('groupCode').value = '';
                }, 1500);
                
            } catch (error) {
                console.error('Error joining group:', error);
                showToast('Error joining group', 'error');
            }
        }

        // Avatar Settings Implementation
        function openAvatarSettings() {
            // For now, redirect to profile settings
            profileSettingsModal.classList.remove('hidden');
            settingsModal.classList.add('hidden');
        }

        // Favorites Management
        function openFavoritesSettings() {
            favoritesSettingsModal.classList.remove('hidden');
            settingsModal.classList.add('hidden');
            loadFavorites();
        }

        function loadFavorites() {
            const favoritesListContent = document.getElementById('favoritesListContent');
            
            if (userSettings.favorites.length === 0) {
                favoritesListContent.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-star text-4xl mb-3 text-gray-300 block"></i>
                        <p>No favorites yet</p>
                        <p class="text-sm mt-1">Add contacts or chats to favorites for quick access</p>
                    </div>
                `;
                return;
            }
            
            favoritesListContent.innerHTML = '';
            
            userSettings.favorites.forEach(favorite => {
                const favoriteItem = document.createElement('div');
                favoriteItem.className = 'flex items-center justify-between p-3 border-b border-gray-200';
                
                favoriteItem.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-green-500 flex items-center justify-center text-white mr-3">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <p class="font-medium">${favorite.name}</p>
                            <p class="text-sm text-gray-500">${favorite.type}</p>
                        </div>
                    </div>
                    <button class="text-red-500 hover:text-red-700 remove-favorite" data-id="${favorite.id}">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                favoritesListContent.appendChild(favoriteItem);
            });
            
            // Add event listeners to remove buttons
            document.querySelectorAll('.remove-favorite').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const favoriteId = e.currentTarget.dataset.id;
                    removeFromFavorites(favoriteId);
                });
            });
        }

        function removeFromFavorites(favoriteId) {
            userSettings.favorites = userSettings.favorites.filter(f => f.id !== favoriteId);
            saveUserSettings();
            loadFavorites();
            showToast('Removed from favorites', 'success');
        }

        // Help Center Implementation
        function openHelpSection(section) {
            const sections = {
                'getting-started': {
                    title: 'Getting Started',
                    content: `
                        <h3 class="text-lg font-semibold mb-4">Welcome to Kynecta!</h3>
                        <p class="mb-3">Kynecta is an advanced mood-based chat application that helps you connect with friends in a more meaningful way.</p>
                        
                        <h4 class="font-semibold mb-2">Basic Features:</h4>
                        <ul class="list-disc pl-5 mb-4 space-y-1">
                            <li><strong>Chats:</strong> Start one-on-one conversations with your friends</li>
                            <li><strong>Groups:</strong> Create or join group conversations</li>
                            <li><strong>Status Updates:</strong> Share what you're feeling with emojis, text, images, videos, or audio</li>
                            <li><strong>Mood Settings:</strong> Set your current mood to influence chat suggestions and themes</li>
                            <li><strong>Calls:</strong> Make voice and video calls to your contacts</li>
                        </ul>
                        
                        <h4 class="font-semibold mb-2">Getting Started Steps:</h4>
                        <ol class="list-decimal pl-5 space-y-1">
                            <li>Add friends using their email, phone number, or name</li>
                            <li>Start a conversation by clicking on a friend's name</li>
                            <li>Set your mood in the Tools tab to personalize your experience</li>
                            <li>Share status updates to let friends know what you're up to</li>
                            <li>Explore the various settings to customize Kynecta to your preferences</li>
                        </ol>
                    `
                },
                'privacy-security': {
                    title: 'Privacy & Security',
                    content: `
                        <h3 class="text-lg font-semibold mb-4">Your Privacy Matters</h3>
                        <p class="mb-3">At Kynecta, we take your privacy and security seriously. Here's how we protect your data:</p>
                        
                        <h4 class="font-semibold mb-2">Data Protection:</h4>
                        <ul class="list-disc pl-5 mb-4 space-y-1">
                            <li><strong>End-to-End Encryption:</strong> Your messages are encrypted so only you and the recipient can read them</li>
                            <li><strong>Secure Storage:</strong> Your data is stored securely on Firebase servers with multiple layers of protection</li>
                            <li><strong>Privacy Controls:</strong> You control who can see your profile information, status, and last seen time</li>
                            <li><strong>No Data Selling:</strong> We never sell your personal information to third parties</li>
                        </ul>
                        
                        <h4 class="font-semibold mb-2">Security Features:</h4>
                        <ul class="list-disc pl-5 mb-4 space-y-1">
                            <li><strong>Two-Step Verification:</strong> Add an extra layer of security to your account</li>
                            <li><strong>Security Notifications:</strong> Get alerts about unusual activity on your account</li>
                            <li><strong>App Lock:</strong> Protect the app with a passcode or biometric authentication</li>
                            <li><strong>Disappearing Messages:</strong> Set messages to automatically delete after a certain time</li>
                        </ul>
                        
                        <p class="text-sm text-gray-600">For more details, please review our complete Privacy Policy in the App Information section.</p>
                    `
                },
                'troubleshooting': {
                    title: 'Troubleshooting',
                    content: `
                        <h3 class="text-lg font-semibold mb-4">Common Issues & Solutions</h3>
                        
                        <h4 class="font-semibold mb-2">Messages Not Sending:</h4>
                        <ul class="list-disc pl-5 mb-4 space-y-1">
                            <li><strong>Check your internet connection</strong> - Make sure you're connected to Wi-Fi or mobile data</li>
                            <li><strong>Restart the app</strong> - Close and reopen Kynecta</li>
                            <li><strong>Clear cache</strong> - Go to Settings > Storage & Data > Clear Cache</li>
                            <li><strong>Update the app</strong> - Make sure you're using the latest version</li>
                        </ul>
                        
                        <h4 class="font-semibold mb-2">Can't Make or Receive Calls:</h4>
                        <ul class="list-disc pl-5 mb-4 space-y-1">
                            <li><strong>Check microphone permissions</strong> - Make sure Kynecta has permission to access your microphone</li>
                            <li><strong>Check camera permissions</strong> - For video calls, ensure camera access is enabled</li>
                            <li><strong>Strong internet connection</strong> - Calls require a stable internet connection</li>
                            <li><strong>Restart your device</strong> - Sometimes a simple restart fixes call issues</li>
                        </ul>
                        
                        <h4 class="font-semibold mb-2">App Crashes or Freezes:</h4>
                        <ul class="list-disc pl-5 mb-4 space-y-1">
                            <li><strong>Update the app</strong> - Check for updates in your app store</li>
                            <li><strong>Clear app cache</strong> - Go to Settings > Storage & Data > Clear Cache</li>
                            <li><strong>Reinstall the app</strong> - As a last resort, uninstall and reinstall Kynecta</li>
                        </ul>
                        
                        <h4 class="font-semibold mb-2">Can't Add Friends:</h4>
                        <ul class="list-disc pl-5 mb-4 space-y-1">
                            <li><strong>Check spelling</strong> - Make sure you're entering the correct email, phone number, or name</li>
                            <li><strong>Friend not on Kynecta</strong> - The person needs to have a Kynecta account</li>
                            <li><strong>Privacy settings</strong> - The person may have restricted who can add them</li>
                        </ul>
                        
                        <p class="text-sm text-gray-600">If you're still experiencing issues, please contact our support team.</p>
                    `
                },
                'faqs': {
                    title: 'Frequently Asked Questions',
                    content: `
                        <h3 class="text-lg font-semibold mb-4">Frequently Asked Questions</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold mb-1">How do I change my profile picture?</h4>
                                <p class="text-sm text-gray-600">Go to Settings > Profile > Click on your profile picture > Select a new image from your device.</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-1">Can I use Kynecta on multiple devices?</h4>
                                <p class="text-sm text-gray-600">Yes, you can use Kynecta on multiple devices. Your messages will sync across all devices where you're logged in.</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-1">How do I create a group chat?</h4>
                                <p class="text-sm text-gray-600">Click on the "New Group" button in the chat list, give your group a name, and add participants from your friends list.</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-1">Can I recover deleted messages?</h4>
                                <p class="text-sm text-gray-600">Once messages are deleted, they cannot be recovered. We recommend exporting important conversations regularly.</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-1">How does the mood feature work?</h4>
                                <p class="text-sm text-gray-600">Your mood influences chat suggestions, themes, and AI recommendations. Set your mood in the Tools tab to personalize your experience.</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-1">Is Kynecta free to use?</h4>
                                <p class="text-sm text-gray-600">Yes, Kynecta is completely free to use with no hidden charges.</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-1">How do I block someone?</h4>
                                <p class="text-sm text-gray-600">Go to the chat with the person you want to block, click on their name, and select "Block Contact" from the menu.</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-1">Can I customize notification sounds?</h4>
                                <p class="text-sm text-gray-600">Yes, go to Settings > Notifications to customize notification sounds for different types of alerts.</p>
                            </div>
                        </div>
                    `
                }
            };
            
            const sectionData = sections[section];
            if (!sectionData) return;
            
            // Create a modal to display the help content
            const helpContentModal = document.createElement('div');
            helpContentModal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            helpContentModal.innerHTML = `
                <div class="bg-white rounded-2xl w-full max-w-2xl max-h-[80vh] overflow-hidden">
                    <div class="kynecta-header p-6">
                        <div class="flex items-center justify-between">
                            <h3 class="text-xl font-semibold text-white">${sectionData.title}</h3>
                            <button class="text-white/80 hover:text-white transition-colors close-help-content">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                    </div>
                    <div class="p-6 overflow-y-auto max-h-[60vh] custom-scrollbar">
                        ${sectionData.content}
                    </div>
                    <div class="p-4 border-t border-gray-200">
                        <button class="w-full py-3 bg-gray-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity close-help-content">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(helpContentModal);
            
            // Add event listeners to close buttons
            helpContentModal.querySelectorAll('.close-help-content').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.body.removeChild(helpContentModal);
                });
            });
        }

        // Contact Support and Send Feedback
        function contactSupport() {
            const email = 'nchagwadennis45@gmail.com';
            const phone = '0746676627';
            
            const contactModal = document.createElement('div');
            contactModal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            contactModal.innerHTML = `
                <div class="bg-white rounded-2xl w-full max-w-md max-h-[80vh] overflow-hidden">
                    <div class="kynecta-header p-6">
                        <div class="flex items-center justify-between">
                            <h3 class="text-xl font-semibold text-white">Contact Support</h3>
                            <button class="text-white/80 hover:text-white transition-colors close-contact-modal">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                    </div>
                    <div class="p-6">
                        <p class="mb-4">We're here to help! Reach out to us through any of the following channels:</p>
                        
                        <div class="space-y-3 mb-6">
                            <div class="flex items-center p-3 bg-gray-50 rounded-xl">
                                <i class="fas fa-envelope text-purple-600 mr-3"></i>
                                <div>
                                    <p class="font-medium">Email</p>
                                    <p class="text-sm text-gray-600">${email}</p>
                                </div>
                            </div>
                            
                            <div class="flex items-center p-3 bg-gray-50 rounded-xl">
                                <i class="fas fa-phone text-purple-600 mr-3"></i>
                                <div>
                                    <p class="font-medium">Phone</p>
                                    <p class="text-sm text-gray-600">${phone}</p>
                                </div>
                            </div>
                            
                            <div class="flex items-center p-3 bg-gray-50 rounded-xl">
                                <i class="fas fa-clock text-purple-600 mr-3"></i>
                                <div>
                                    <p class="font-medium">Response Time</p>
                                    <p class="text-sm text-gray-600">Within 24 hours</p>
                                </div>
                            </div>
                        </div>
                        
                        <p class="text-sm text-gray-600">Please include your user ID (${currentUser.uid}) when contacting support for faster assistance.</p>
                    </div>
                    <div class="p-4 border-t border-gray-200">
                        <button class="w-full py-3 bg-gray-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity close-contact-modal">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(contactModal);
            
            // Add event listeners to close buttons
            contactModal.querySelectorAll('.close-contact-modal').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.body.removeChild(contactModal);
                });
            });
        }

        function sendFeedback() {
            const feedbackModal = document.createElement('div');
            feedbackModal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            feedbackModal.innerHTML = `
                <div class="bg-white rounded-2xl w-full max-w-md max-h-[80vh] overflow-hidden">
                    <div class="kynecta-header p-6">
                        <div class="flex items-center justify-between">
                            <h3 class="text-xl font-semibold text-white">Send Feedback</h3>
                            <button class="text-white/80 hover:text-white transition-colors close-feedback-modal">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Feedback Type</label>
                            <select id="feedbackType" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors">
                                <option value="bug">Bug Report</option>
                                <option value="suggestion">Feature Suggestion</option>
                                <option value="improvement">Improvement Idea</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                            <textarea id="feedbackDescription" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Please describe your feedback in detail..." rows="5"></textarea>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email (Optional)</label>
                            <input type="email" id="feedbackEmail" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Your email if you'd like a response">
                        </div>
                    </div>
                    <div class="p-4 border-t border-gray-200 flex space-x-3">
                        <button class="flex-1 py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity" id="submitFeedback">
                            Submit Feedback
                        </button>
                        <button class="flex-1 py-3 bg-gray-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity close-feedback-modal">
                            Cancel
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(feedbackModal);
            
            // Add event listeners
            feedbackModal.querySelector('#submitFeedback').addEventListener('click', () => {
                const type = feedbackModal.querySelector('#feedbackType').value;
                const description = feedbackModal.querySelector('#feedbackDescription').value.trim();
                const email = feedbackModal.querySelector('#feedbackEmail').value.trim();
                
                if (!description) {
                    showToast('Please provide a description', 'error');
                    return;
                }
                
                // In a real implementation, you would send this to your backend
                // For now, we'll just show a success message
                showToast('Thank you for your feedback!', 'success');
                document.body.removeChild(feedbackModal);
            });
            
            feedbackModal.querySelectorAll('.close-feedback-modal').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.body.removeChild(feedbackModal);
                });
            });
        }

        // App Info - Legal Links
        function openLegalDocument(type) {
            // In a real implementation, you would fetch these from your server
            // For now, we'll show placeholder content
            const documents = {
                'terms': {
                    title: 'Terms of Service',
                    content: `
                        <h3 class="text-lg font-semibold mb-4">Kynecta Terms of Service</h3>
                        <p class="mb-3">Last Updated: November 2025</p>
                        
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold mb-2">1. Acceptance of Terms</h4>
                                <p class="text-sm">By accessing or using Kynecta, you agree to be bound by these Terms of Service and our Privacy Policy.</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-2">2. Description of Service</h4>
                                <p class="text-sm">Kynecta provides a mood-based chat platform that allows users to communicate through text, voice, video, and share status updates.</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-2">3. User Accounts</h4>
                                <p class="text-sm">You are responsible for maintaining the confidentiality of your account and password. You agree to accept responsibility for all activities that occur under your account.</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-2">4. User Conduct</h4>
                                <p class="text-sm">You agree not to use the service to: harass, abuse, or harm others; transmit any content that is unlawful, harmful, or inappropriate; or violate any applicable laws.</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-2">5. Privacy</h4>
                                <p class="text-sm">Your privacy is important to us. Please review our Privacy Policy to understand how we collect, use, and protect your information.</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-2">6. Termination</h4>
                                <p class="text-sm">We may terminate or suspend your account at any time without notice for conduct that we believe violates these Terms or is harmful to other users.</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-2">7. Changes to Terms</h4>
                                <p class="text-sm">We reserve the right to modify these terms at any time. We will notify users of any material changes.</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-2">8. Contact Information</h4>
                                <p class="text-sm">If you have any questions about these Terms, please contact us at nchagwadennis45@gmail.com</p>
                            </div>
                        </div>
                    `
                },
                'privacy': {
                    title: 'Privacy Policy',
                    content: `
                        <h3 class="text-lg font-semibold mb-4">Kynecta Privacy Policy</h3>
                        <p class="mb-3">Last Updated: November 2025</p>
                        
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold mb-2">1. Information We Collect</h4>
                                <p class="text-sm">We collect information you provide directly to us, such as when you create an account, use our services, or contact us for support. This may include your name, email address, phone number, profile information, and the content of your messages.</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-2">2. How We Use Your Information</h4>
                                <p class="text-sm">We use the information we collect to provide, maintain, and improve our services; to communicate with you; to personalize your experience; and to ensure the security of our services.</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-2">3. Information Sharing</h4>
                                <p class="text-sm">We do not sell your personal information to third parties. We may share your information with service providers who assist us in operating our services, or when required by law.</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-2">4. Data Security</h4>
                                <p class="text-sm">We implement appropriate technical and organizational measures to protect your personal information against unauthorized access, alteration, or destruction.</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-2">5. Your Rights</h4>
                                <p class="text-sm">You have the right to access, correct, or delete your personal information. You can also object to or restrict certain processing of your information.</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-2">6. Data Retention</h4>
                                <p class="text-sm">We retain your personal information for as long as necessary to provide our services and fulfill the purposes outlined in this policy.</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-2">7. Changes to This Policy</h4>
                                <p class="text-sm">We may update this privacy policy from time to time. We will notify you of any changes by posting the new policy on this page.</p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-2">8. Contact Us</h4>
                                <p class="text-sm">If you have any questions about this Privacy Policy, please contact us at nchagwadennis45@gmail.com</p>
                            </div>
                        </div>
                    `
                },
                'opensource': {
                    title: 'Open Source Licenses',
                    content: `
                        <h3 class="text-lg font-semibold mb-4">Open Source Licenses</h3>
                        <p class="mb-4">Kynecta uses the following open source libraries and frameworks:</p>
                        
                        <div class="space-y-3">
                            <div class="p-3 bg-gray-50 rounded-xl">
                                <h4 class="font-semibold">Firebase</h4>
                                <p class="text-sm text-gray-600">Backend-as-a-Service platform provided by Google</p>
                                <p class="text-xs text-gray-500">License: Apache 2.0</p>
                            </div>
                            
                            <div class="p-3 bg-gray-50 rounded-xl">
                                <h4 class="font-semibold">Tailwind CSS</h4>
                                <p class="text-sm text-gray-600">Utility-first CSS framework</p>
                                <p class="text-xs text-gray-500">License: MIT</p>
                            </div>
                            
                            <div class="p-3 bg-gray-50 rounded-xl">
                                <h4 class="font-semibold">Font Awesome</h4>
                                <p class="text-sm text-gray-600">Icon library and toolkit</p>
                                <p class="text-xs text-gray-500">License: Font Awesome Free License</p>
                            </div>
                            
                            <div class="p-3 bg-gray-50 rounded-xl">
                                <h4 class="font-semibold">Cloudinary</h4>
                                <p class="text-sm text-gray-600">Cloud-based image and video management</p>
                                <p class="text-xs text-gray-500">License: Proprietary</p>
                            </div>
                        </div>
                        
                        <p class="mt-4 text-sm text-gray-600">For complete license information, please visit the respective project websites.</p>
                    `
                }
            };
            
            const documentData = documents[type];
            if (!documentData) return;
            
            const legalModal = document.createElement('div');
            legalModal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            legalModal.innerHTML = `
                <div class="bg-white rounded-2xl w-full max-w-2xl max-h-[80vh] overflow-hidden">
                    <div class="kynecta-header p-6">
                        <div class="flex items-center justify-between">
                            <h3 class="text-xl font-semibold text-white">${documentData.title}</h3>
                            <button class="text-white/80 hover:text-white transition-colors close-legal-modal">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                    </div>
                    <div class="p-6 overflow-y-auto max-h-[60vh] custom-scrollbar">
                        ${documentData.content}
                    </div>
                    <div class="p-4 border-t border-gray-200">
                        <button class="w-full py-3 bg-gray-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity close-legal-modal">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(legalModal);
            
            // Add event listeners to close buttons
            legalModal.querySelectorAll('.close-legal-modal').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.body.removeChild(legalModal);
                });
            });
        }

        // Invite Friends Implementation
        function shareLink() {
            const inviteLink = 'https://kynecta.app/invite/KYNECTA2025';
            
            // Copy to clipboard
            navigator.clipboard.writeText(inviteLink).then(() => {
                showToast('Invite link copied to clipboard!', 'success');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = inviteLink;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showToast('Invite link copied to clipboard!', 'success');
            });
        }

        function shareQR() {
            // In a real implementation, you would generate a QR code
            // For now, we'll show a placeholder
            showToast('QR code would be generated here', 'info');
        }

        function shareWhatsApp() {
            const message = 'Join me on Kynecta! Download the app at: https://kynecta.app/invite/KYNECTA2025';
            const url = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        }

        function shareSMS() {
            const message = 'Join me on Kynecta! Download the app at: https://kynecta.app/invite/KYNECTA2025';
            const url = `sms:?body=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        }

        function copyReferralCode() {
            const referralCode = 'KYNECTA2025';
            
            navigator.clipboard.writeText(referralCode).then(() => {
                showToast('Referral code copied to clipboard!', 'success');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = referralCode;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showToast('Referral code copied to clipboard!', 'success');
            });
        }

        function setupEventListeners() {
            // Settings button
            document.getElementById('menuBtn').addEventListener('click', () => {
                settingsModal.classList.remove('hidden');
            });

            // Close settings
            document.getElementById('closeSettings').addEventListener('click', () => {
                settingsModal.classList.add('hidden');
            });

            // Add friend button
            document.getElementById('addFriendBtn').addEventListener('click', () => {
                addFriendModal.classList.remove('hidden');
            });

            // Enhanced friend search
            document.getElementById('searchFriend').addEventListener('click', async () => {
                const query = document.getElementById('friendSearchInput').value.trim();
                
                if (!query) {
                    showToast('Please enter a name, email, or phone number', 'error');
                    return;
                }
                
                const results = await enhancedFriendSearch(query);
                displayEnhancedSearchResults(results);
                friendSearchResultsModal.classList.remove('hidden');
                addFriendModal.classList.add('hidden');
            });

            // Close enhanced search
            document.getElementById('closeEnhancedSearch').addEventListener('click', () => {
                friendSearchResultsModal.classList.add('hidden');
                document.getElementById('friendSearchInput').value = '';
            });

            // Cancel friend
            document.getElementById('cancelFriend').addEventListener('click', () => {
                addFriendModal.classList.add('hidden');
                document.getElementById('friendSearchInput').value = '';
            });

            // Message friend
            document.getElementById('messageFriend').addEventListener('click', () => {
                if (currentEditingFriendId) {
                    const friend = friends.find(f => f.id === currentEditingFriendId);
                    if (friend) {
                        startChat(friend.id, friend.displayName);
                        editFriendModal.classList.add('hidden');
                        currentEditingFriendId = null;
                    }
                }
            });

            // Call friend
            document.getElementById('callFriend').addEventListener('click', () => {
                if (currentEditingFriendId) {
                    const friend = friends.find(f => f.id === currentEditingFriendId);
                    if (friend) {
                        startCall(friend.id, friend.displayName);
                        editFriendModal.classList.add('hidden');
                        currentEditingFriendId = null;
                    }
                }
            });

            // Remove friend
            document.getElementById('removeFriend').addEventListener('click', () => {
                if (currentEditingFriendId) {
                    removeFriend(currentEditingFriendId);
                    editFriendModal.classList.add('hidden');
                    currentEditingFriendId = null;
                }
            });

            // Cancel edit friend
            document.getElementById('cancelEditFriend').addEventListener('click', () => {
                editFriendModal.classList.add('hidden');
                currentEditingFriendId = null;
            });

            // Friend search
            document.getElementById('friendSearch').addEventListener('input', (e) => {
                searchFriends(e.target.value);
            });

            // Profile settings
            document.getElementById('profileSettingsBtn').addEventListener('click', () => {
                profileSettingsModal.classList.remove('hidden');
                settingsModal.classList.add('hidden');
            });

            // Close profile settings
            document.getElementById('closeProfileSettings').addEventListener('click', () => {
                profileSettingsModal.classList.add('hidden');
            });

            // Save profile
            document.getElementById('saveProfile').addEventListener('click', updateProfile);

            // Cancel profile
            document.getElementById('cancelProfile').addEventListener('click', () => {
                profileSettingsModal.classList.add('hidden');
                // Reset form to current values
                document.getElementById('profileName').value = currentUserData.displayName;
                document.getElementById('profileAbout').value = currentUserData.about || '';
                document.getElementById('profileEmail').value = currentUserData.email;
                document.getElementById('profilePhone').value = currentUserData.phone || '';
            });

            // Profile picture upload
            document.getElementById('profilePictureUpload').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    uploadProfilePicture(file);
                }
            });

            // Cover picture upload
            document.getElementById('coverPicUpload').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    uploadCoverPicture(file);
                }
            });

            // Profile picture edit button
            document.querySelector('.profile-photo-edit').addEventListener('click', () => {
                document.getElementById('profilePictureUpload').click();
            });

            // Cover picture edit button
            document.querySelector('.profile-cover-edit').addEventListener('click', () => {
                document.getElementById('coverPicUpload').click();
            });

            // Privacy settings
            document.getElementById('privacySettingsBtn').addEventListener('click', () => {
                privacySettingsModal.classList.remove('hidden');
                settingsModal.classList.add('hidden');
            });

            // Close privacy settings
            document.getElementById('closePrivacySettings').addEventListener('click', () => {
                privacySettingsModal.classList.add('hidden');
            });

            // Save privacy settings
            document.getElementById('savePrivacy').addEventListener('click', () => {
                // Save privacy settings to localStorage
                userSettings.privacy.lastSeen = document.getElementById('lastSeenPrivacy').value;
                userSettings.privacy.profilePhoto = document.getElementById('profilePhotoPrivacy').value;
                userSettings.privacy.about = document.getElementById('aboutPrivacy').value;
                userSettings.privacy.status = document.getElementById('statusPrivacy').value;
                userSettings.privacy.readReceipts = document.getElementById('readReceiptsPrivacy').checked;
                userSettings.privacy.disappearingMessages = document.getElementById('disappearingMessagesPrivacy').value;
                userSettings.privacy.groups = document.getElementById('groupsPrivacy').value;
                userSettings.privacy.calls = document.getElementById('callsPrivacy').value;
                
                saveUserSettings();
                showToast('Privacy settings saved successfully', 'success');
                privacySettingsModal.classList.add('hidden');
            });

            // Cancel privacy settings
            document.getElementById('cancelPrivacy').addEventListener('click', () => {
                privacySettingsModal.classList.add('hidden');
            });

            // Account settings
            document.getElementById('securitySettingsBtn').addEventListener('click', () => {
                accountSettingsModal.classList.remove('hidden');
                settingsModal.classList.add('hidden');
            });

            // Close account settings
            document.getElementById('closeAccountSettings').addEventListener('click', () => {
                accountSettingsModal.classList.add('hidden');
            });

            // Cancel account settings
            document.getElementById('cancelAccount').addEventListener('click', () => {
                accountSettingsModal.classList.add('hidden');
            });

            // NEW: Security notifications
            document.getElementById('securityNotificationsBtn').addEventListener('click', () => {
                showToast('Security notifications settings would open here', 'info');
            });

            // NEW: Passkeys
            document.getElementById('passkeysBtn').addEventListener('click', () => {
                showToast('Passkeys setup would open here', 'info');
            });

            // NEW: Email address
            document.getElementById('emailAddressBtn').addEventListener('click', () => {
                showToast('Email address change would open here', 'info');
            });

            // NEW: Two-step verification
            document.getElementById('twoStepVerificationBtn').addEventListener('click', () => {
                showToast('Two-step verification setup would open here', 'info');
            });

            // NEW: Business platform
            document.getElementById('businessPlatformBtn').addEventListener('click', () => {
                showToast('Business platform management would open here', 'info');
            });

            // NEW: Change number
            document.getElementById('changeNumberBtn').addEventListener('click', () => {
                showToast('Change number process would start here', 'info');
            });

            // NEW: Request account info
            document.getElementById('requestAccountInfoBtn').addEventListener('click', () => {
                showToast('Account info request would be processed here', 'info');
            });

            // NEW: Delete account
            document.getElementById('deleteAccountBtn').addEventListener('click', () => {
                if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                    showToast('Account deletion process would start here', 'info');
                }
            });

            // Avatar settings
            document.getElementById('avatarSettingsBtn').addEventListener('click', openAvatarSettings);

            // Favorites settings
            document.getElementById('favoritesSettingsBtn').addEventListener('click', openFavoritesSettings);

            // Close favorites settings
            document.getElementById('closeFavoritesSettings').addEventListener('click', () => {
                favoritesSettingsModal.classList.add('hidden');
            });

            // Add to favorites
            document.getElementById('addToFavorites').addEventListener('click', () => {
                // In a real implementation, you would show a list of contacts/chats to add to favorites
                showToast('Add to favorites feature would open here', 'info');
            });

            // Accessibility settings
            document.getElementById('accessibilityBtn').addEventListener('click', () => {
                accessibilitySettingsModal.classList.remove('hidden');
                settingsModal.classList.add('hidden');
                
                // Load current accessibility settings
                document.getElementById('darkModeToggle').checked = userSettings.chat.displayTheme === 'dark';
                document.getElementById('fontSizeSelect').value = userSettings.accessibility.fontSize || 'medium';
                document.getElementById('highContrastToggle').checked = userSettings.accessibility.highContrast;
                document.getElementById('screenReaderToggle').checked = userSettings.accessibility.screenReader;
                document.getElementById('reduceAnimationsToggle').checked = userSettings.accessibility.reducedMotion;
                document.getElementById('textToSpeechToggle').checked = userSettings.accessibility.textToSpeech;
            });

            // Close accessibility settings
            document.getElementById('closeAccessibilitySettings').addEventListener('click', () => {
                accessibilitySettingsModal.classList.add('hidden');
            });

            // Save accessibility settings
            document.getElementById('saveAccessibility').addEventListener('click', () => {
                userSettings.chat.displayTheme = document.getElementById('darkModeToggle').checked ? 'dark' : 'light';
                userSettings.accessibility.fontSize = document.getElementById('fontSizeSelect').value;
                userSettings.accessibility.highContrast = document.getElementById('highContrastToggle').checked;
                userSettings.accessibility.screenReader = document.getElementById('screenReaderToggle').checked;
                userSettings.accessibility.reducedMotion = document.getElementById('reduceAnimationsToggle').checked;
                userSettings.accessibility.textToSpeech = document.getElementById('textToSpeechToggle').checked;
                
                saveUserSettings();
                applyUserSettings();
                showToast('Accessibility settings saved successfully', 'success');
                accessibilitySettingsModal.classList.add('hidden');
            });

            // Notifications settings
            document.getElementById('notificationsSettingsBtn').addEventListener('click', () => {
                notificationsSettingsModal.classList.remove('hidden');
                settingsModal.classList.add('hidden');
                
                // Load current notification settings
                document.getElementById('pushNotificationsToggle').checked = userSettings.notifications.pushNotifications;
                document.getElementById('messageNotificationsToggle').checked = userSettings.notifications.messageNotifications;
                document.getElementById('groupNotificationsToggle').checked = userSettings.notifications.groupNotifications;
                document.getElementById('callNotificationsToggle').checked = userSettings.notifications.callNotifications;
                document.getElementById('soundToggle').checked = userSettings.notifications.sound;
                document.getElementById('vibrationToggle').checked = userSettings.notifications.vibrate;
                document.getElementById('doNotDisturbToggle').checked = userSettings.notifications.doNotDisturb;
                
                // Show/hide DND schedule based on toggle
                if (userSettings.notifications.doNotDisturb) {
                    document.getElementById('doNotDisturbSchedule').classList.remove('hidden');
                } else {
                    document.getElementById('doNotDisturbSchedule').classList.add('hidden');
                }
            });

            // Toggle DND schedule visibility
            document.getElementById('doNotDisturbToggle').addEventListener('change', (e) => {
                if (e.target.checked) {
                    document.getElementById('doNotDisturbSchedule').classList.remove('hidden');
                } else {
                    document.getElementById('doNotDisturbSchedule').classList.add('hidden');
                }
            });

            // Close notifications settings
            document.getElementById('closeNotificationsSettings').addEventListener('click', () => {
                notificationsSettingsModal.classList.add('hidden');
            });

            // Save notifications settings
            document.getElementById('saveNotifications').addEventListener('click', () => {
                userSettings.notifications.pushNotifications = document.getElementById('pushNotificationsToggle').checked;
                userSettings.notifications.messageNotifications = document.getElementById('messageNotificationsToggle').checked;
                userSettings.notifications.groupNotifications = document.getElementById('groupNotificationsToggle').checked;
                userSettings.notifications.callNotifications = document.getElementById('callNotificationsToggle').checked;
                userSettings.notifications.sound = document.getElementById('soundToggle').checked;
                userSettings.notifications.vibrate = document.getElementById('vibrationToggle').checked;
                userSettings.notifications.doNotDisturb = document.getElementById('doNotDisturbToggle').checked;
                
                if (userSettings.notifications.doNotDisturb) {
                    userSettings.notifications.dndStartTime = document.getElementById('dndStartTime').value;
                    userSettings.notifications.dndEndTime = document.getElementById('dndEndTime').value;
                }
                
                saveUserSettings();
                showToast('Notification settings saved successfully', 'success');
                notificationsSettingsModal.classList.add('hidden');
            });

            // Storage settings
            document.getElementById('storageSettingsBtn').addEventListener('click', () => {
                storageSettingsModal.classList.remove('hidden');
                settingsModal.classList.add('hidden');
                
                // Load current storage settings
                document.getElementById('autoDownloadToggle').checked = userSettings.storage.autoDownload;
                document.getElementById('wifiOnlyToggle').checked = userSettings.storage.wifiOnly;
                document.getElementById('mediaUploadQuality').value = userSettings.storage.mediaUploadQuality;
                
                // Calculate and display storage usage
                calculateStorageUsage();
            });

            // Close storage settings
            document.getElementById('closeStorageSettings').addEventListener('click', () => {
                storageSettingsModal.classList.add('hidden');
            });

            // Save storage settings
            document.getElementById('saveStorage').addEventListener('click', () => {
                userSettings.storage.autoDownload = document.getElementById('autoDownloadToggle').checked;
                userSettings.storage.wifiOnly = document.getElementById('wifiOnlyToggle').checked;
                userSettings.storage.mediaUploadQuality = document.getElementById('mediaUploadQuality').value;
                
                saveUserSettings();
                showToast('Storage settings saved successfully', 'success');
                storageSettingsModal.classList.add('hidden');
            });

            // Clear cache
            document.getElementById('clearCache').addEventListener('click', () => {
                if (confirm('Are you sure you want to clear the cache? This will remove temporary files but not your messages.')) {
                    // Clear localStorage cache
                    Object.keys(localStorage).forEach(key => {
                        if (key.startsWith('kynecta_')) {
                            localStorage.removeItem(key);
                        }
                    });
                    
                    showToast('Cache cleared successfully', 'success');
                    calculateStorageUsage();
                }
            });

            // Language settings
            document.getElementById('languageSettingsBtn').addEventListener('click', () => {
                languageSettingsModal.classList.remove('hidden');
                settingsModal.classList.add('hidden');
                
                // Load current language settings
                document.getElementById('appLanguageSelect').value = userSettings.language.appLanguage;
                document.getElementById('autoDetectLanguageToggle').checked = userSettings.language.autoDetect;
            });

            // Close language settings
            document.getElementById('closeLanguageSettings').addEventListener('click', () => {
                languageSettingsModal.classList.add('hidden');
            });

            // Save language settings
            document.getElementById('saveLanguage').addEventListener('click', () => {
                userSettings.language.appLanguage = document.getElementById('appLanguageSelect').value;
                userSettings.language.autoDetect = document.getElementById('autoDetectLanguageToggle').checked;
                
                saveUserSettings();
                showToast('Language settings saved successfully', 'success');
                languageSettingsModal.classList.add('hidden');
            });

            // Chat settings
            document.getElementById('chatsSettingsBtn').addEventListener('click', () => {
                chatSettingsModal.classList.remove('hidden');
                settingsModal.classList.add('hidden');
                
                // Load current chat settings
                document.getElementById('enterKeySendsToggle').checked = userSettings.chat.enterKeySends;
                document.getElementById('readReceiptsToggle').checked = userSettings.chat.readReceipts;
                document.getElementById('lastSeenToggle').checked = userSettings.chat.showLastSeen;
                document.getElementById('mediaVisibilityToggle').checked = userSettings.chat.mediaVisibility;
                document.getElementById('chatBackupToggle').checked = userSettings.chat.autoBackup;
            });

            // Close chat settings
            document.getElementById('closeChatSettings').addEventListener('click', () => {
                chatSettingsModal.classList.add('hidden');
            });

            // Save chat settings
            document.getElementById('saveChatSettings').addEventListener('click', () => {
                userSettings.chat.enterKeySends = document.getElementById('enterKeySendsToggle').checked;
                userSettings.chat.readReceipts = document.getElementById('readReceiptsToggle').checked;
                userSettings.chat.showLastSeen = document.getElementById('lastSeenToggle').checked;
                userSettings.chat.mediaVisibility = document.getElementById('mediaVisibilityToggle').checked;
                userSettings.chat.autoBackup = document.getElementById('chatBackupToggle').checked;
                
                saveUserSettings();
                applyUserSettings();
                showToast('Chat settings saved successfully', 'success');
                chatSettingsModal.classList.add('hidden');
            });

            // Help center
            document.getElementById('helpCenterBtn').addEventListener('click', () => {
                helpCenterModal.classList.remove('hidden');
                settingsModal.classList.add('hidden');
            });

            // Close help center
            document.getElementById('closeHelpCenter').addEventListener('click', () => {
                helpCenterModal.classList.add('hidden');
            });

            // Help section clicks
            document.querySelectorAll('.help-section').forEach(section => {
                section.addEventListener('click', () => {
                    const sectionName = section.dataset.section;
                    openHelpSection(sectionName);
                });
            });

            // Contact support
            document.getElementById('contactSupport').addEventListener('click', contactSupport);

            // Send feedback
            document.getElementById('sendFeedback').addEventListener('click', sendFeedback);

            // App info
            document.getElementById('appInfoBtn').addEventListener('click', () => {
                appInfoModal.classList.remove('hidden');
                settingsModal.classList.add('hidden');
            });

            // Close app info
            document.getElementById('closeAppInfo').addEventListener('click', () => {
                appInfoModal.classList.add('hidden');
            });

            // Legal documents
            document.getElementById('termsOfServiceBtn').addEventListener('click', () => {
                openLegalDocument('terms');
            });

            document.getElementById('privacyPolicyBtn').addEventListener('click', () => {
                openLegalDocument('privacy');
            });

            document.getElementById('openSourceBtn').addEventListener('click', () => {
                openLegalDocument('opensource');
            });

            // Invite friends
            document.getElementById('inviteContactBtn').addEventListener('click', () => {
                inviteFriendsModal.classList.remove('hidden');
                settingsModal.classList.add('hidden');
            });

            // Close invite friends
            document.getElementById('closeInviteFriends').addEventListener('click', () => {
                inviteFriendsModal.classList.add('hidden');
            });

            // Invite methods
            document.getElementById('shareLink').addEventListener('click', shareLink);
            document.getElementById('shareQR').addEventListener('click', shareQR);
            document.getElementById('shareWhatsApp').addEventListener('click', shareWhatsApp);
            document.getElementById('shareSMS').addEventListener('click', shareSMS);
            document.getElementById('copyReferralCode').addEventListener('click', copyReferralCode);

            // NEW: Group creation
            document.getElementById('newGroupBtn').addEventListener('click', openCreateGroupModal);

            // Close create group
            document.getElementById('closeCreateGroup').addEventListener('click', () => {
                createGroupModal.classList.add('hidden');
            });

            // Create group
            document.getElementById('createGroup').addEventListener('click', createGroup);

            // Cancel create group
            document.getElementById('cancelCreateGroup').addEventListener('click', () => {
                createGroupModal.classList.add('hidden');
            });

            // NEW: Join group
            document.getElementById('manageFavorites').addEventListener('click', () => {
                // For now, we'll use this button to open join group modal
                // In a real implementation, you would have a dedicated join group button
                openJoinGroupModal();
            });

            // Close join group
            document.getElementById('closeJoinGroup').addEventListener('click', () => {
                joinGroupModal.classList.add('hidden');
            });

            // Join group
            document.getElementById('joinGroup').addEventListener('click', joinGroup);

            // Cancel join group
            document.getElementById('cancelJoinGroup').addEventListener('click', () => {
                joinGroupModal.classList.add('hidden');
            });

            // Status creation
            document.getElementById('myStatus').addEventListener('click', openStatusCreation);

            document.getElementById('closeStatusCreation').addEventListener('click', () => {
                statusCreation.style.display = 'none';
            });

            // Status type selection
            document.querySelectorAll('.status-option').forEach(option => {
                option.addEventListener('click', (e) => {
                    const type = e.currentTarget.dataset.type;
                    
                    // Update active option
                    document.querySelectorAll('.status-option').forEach(opt => {
                        opt.classList.remove('active');
                    });
                    e.currentTarget.classList.add('active');
                    
                    // Show corresponding preview
                    document.getElementById('emojiPreview').classList.add('hidden');
                    document.getElementById('textPreview').classList.add('hidden');
                    document.getElementById('imagePreview').classList.add('hidden');
                    document.getElementById('videoPreview').classList.add('hidden');
                    document.getElementById('audioPreview').classList.add('hidden');
                    
                    document.getElementById(`${type}Preview`).classList.remove('hidden');
                });
            });

            // Post status
            document.getElementById('postStatus').addEventListener('click', () => {
                const activeType = document.querySelector('.status-option.active').dataset.type;
                let content = '';
                
                if (activeType === 'emoji') {
                    content = document.getElementById('emojiPreview').textContent;
                } else if (activeType === 'text') {
                    content = document.getElementById('statusTextInput').value.trim();
                    if (!content) {
                        showToast('Please enter some text for your status', 'error');
                        return;
                    }
                } else if (activeType === 'image') {
                    if (document.getElementById('statusImagePreview').classList.contains('hidden')) {
                        showToast('Please upload an image for your status', 'error');
                        return;
                    }
                    content = document.getElementById('statusImagePreview').src;
                } else if (activeType === 'video') {
                    if (document.getElementById('statusVideoPreview').classList.contains('hidden')) {
                        showToast('Please upload a video for your status', 'error');
                        return;
                    }
                    content = document.getElementById('statusVideoPreview').src;
                } else if (activeType === 'audio') {
                    if (document.getElementById('statusAudioPreview').classList.contains('hidden')) {
                        showToast('Please upload an audio for your status', 'error');
                        return;
                    }
                    content = document.getElementById('statusAudioPreview').src;
                }
                
                postStatus(activeType, content);
                statusCreation.style.display = 'none';
            });

            // Upload image for status
            document.getElementById('uploadImageBtn').addEventListener('click', () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            document.getElementById('statusImagePreview').src = event.target.result;
                            document.getElementById('statusImagePreview').classList.remove('hidden');
                        };
                        reader.readAsDataURL(file);
                    }
                };
                
                input.click();
            });

            // Upload video for status
            document.getElementById('uploadVideoBtn').addEventListener('click', () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'video/*';
                
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        // Check if video is longer than 6 seconds
                        const video = document.createElement('video');
                        video.preload = 'metadata';
                        
                        video.onloadedmetadata = () => {
                            if (video.duration > 6) {
                                showToast('Video must be 6 seconds or shorter', 'error');
                                return;
                            }
                            
                            const reader = new FileReader();
                            reader.onload = (event) => {
                                document.getElementById('statusVideoPreview').src = event.target.result;
                                document.getElementById('statusVideoPreview').classList.remove('hidden');
                            };
                            reader.readAsDataURL(file);
                        };
                        
                        video.src = URL.createObjectURL(file);
                    }
                };
                
                input.click();
            });

            // Upload audio for status
            document.getElementById('uploadAudioBtn').addEventListener('click', () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'audio/*';
                
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        // Check if audio is longer than 6 seconds
                        const audio = document.createElement('audio');
                        audio.preload = 'metadata';
                        
                        audio.onloadedmetadata = () => {
                            if (audio.duration > 6) {
                                showToast('Audio must be 6 seconds or shorter', 'error');
                                return;
                            }
                            
                            const reader = new FileReader();
                            reader.onload = (event) => {
                                document.getElementById('statusAudioPreview').src = event.target.result;
                                document.getElementById('statusAudioPreview').classList.remove('hidden');
                            };
                            reader.readAsDataURL(file);
                        };
                        
                        audio.src = URL.createObjectURL(file);
                    }
                };
                
                input.click();
            });

            // Emoji button
            document.getElementById('emojiBtn').addEventListener('click', () => {
                if (emojiPicker.style.display === 'block') {
                    emojiPicker.style.display = 'none';
                } else {
                    emojiPicker.style.display = 'block';
                }
            });

            // Close emoji picker when clicking outside
            document.addEventListener('click', (e) => {
                if (!emojiPicker.contains(e.target) && e.target.id !== 'emojiBtn') {
                    emojiPicker.style.display = 'none';
                }
            });

            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', () => {
                const currentTheme = document.body.getAttribute('data-theme');
                setTheme(currentTheme === 'light' ? 'dark' : 'light');
            });

            // Tab switching
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const tab = e.currentTarget.dataset.tab;
                    
                    // Update active tab
                    document.querySelectorAll('.tab-btn').forEach(b => {
                        b.classList.remove('tab-active', 'text-purple-600');
                        b.classList.add('text-gray-500');
                    });
                    
                    e.currentTarget.classList.add('tab-active', 'text-purple-600');
                    e.currentTarget.classList.remove('text-gray-500');
                    
                    // Show corresponding tab content
                    document.querySelectorAll('.tab-panel').forEach(panel => {
                        panel.classList.add('hidden');
                    });
                    
                    document.getElementById(`${tab}Tab`).classList.remove('hidden');
                });
            });

            // Logout
            document.getElementById('logoutBtn').addEventListener('click', () => {
                showToast('Logging out...', 'info');
                auth.signOut().then(() => {
                    window.location.href = 'login.html';
                }).catch(() => {
                    showToast('Error logging out', 'error');
                });
            });

            // Back to chats on mobile
            document.getElementById('backToChats').addEventListener('click', () => {
                document.getElementById('chatListContainer').classList.remove('hidden');
            });

            // Mood options
            document.querySelectorAll('.mood-option').forEach(option => {
                option.addEventListener('click', (e) => {
                    const mood = e.currentTarget.dataset.mood;
                    const moodNames = {
                        happy: 'Happy',
                        calm: 'Calm',
                        energetic: 'Energetic',
                        focused: 'Focused',
                        creative: 'Creative'
                    };
                    
                    // Update all mood options
                    document.querySelectorAll('.mood-option').forEach(opt => {
                        opt.classList.remove('border-purple-500', 'text-purple-600', 'bg-purple-50');
                    });
                    
                    // Highlight selected mood
                    e.currentTarget.classList.add('border-purple-500', 'text-purple-600', 'bg-purple-50');
                    
                    showToast(`Mood set to ${moodNames[mood]}`, 'success');
                    
                    // Show mood suggestion
                    const suggestion = document.getElementById('moodSuggestion');
                    const suggestionText = document.getElementById('suggestionText');
                    
                    const suggestions = {
                        happy: "Your positive mood might be perfect for sharing exciting news or planning fun activities!",
                        calm: "Your calm demeanor is great for having deep, meaningful conversations.",
                        energetic: "Your energetic vibe could help motivate others or brainstorm new ideas!",
                        focused: "Your focused mindset is perfect for discussing important topics or making decisions.",
                        creative: "Your creative mood is ideal for sharing ideas or working on projects together!"
                    };
                    
                    suggestionText.textContent = suggestions[mood];
                    suggestion.classList.remove('hidden');
                });
            });

            // Dismiss suggestion
            document.getElementById('dismissSuggestion').addEventListener('click', () => {
                document.getElementById('moodSuggestion').classList.add('hidden');
            });

            // File attachment
            document.getElementById('attachBtn').addEventListener('click', () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*,video/*,.pdf,.doc,.docx,.txt';
                
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file && currentChat) {
                        uploadFile(file);
                    } else if (!currentChat) {
                        showToast('Please select a chat first', 'error');
                    }
                };
                
                input.click();
            });

            // Typing indicator
            document.getElementById('messageInput').addEventListener('input', handleTypingIndicator);

            // Send message on Enter key
            document.getElementById('messageInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && userSettings.chat.enterKeySends) {
                    sendMessage();
                }
            });

            // Send message on button click
            document.getElementById('sendBtn').addEventListener('click', sendMessage);

            // Responsive behavior
            window.addEventListener('resize', () => {
                if (window.innerWidth >= 768 && currentChat) {
                    document.getElementById('chatListContainer').classList.remove('hidden');
                }
            });

            // Add error handling for images
            document.addEventListener('error', function(e) {
                if (e.target.tagName === 'IMG') {
                    console.log('Image failed to load:', e.target.src);
                    e.target.style.display = 'none';
                }
            }, true);

            // Quick action buttons in Tools tab
            document.getElementById('privacyBtn').addEventListener('click', () => {
                privacySettingsModal.classList.remove('hidden');
            });

            document.getElementById('settingsBtn').addEventListener('click', () => {
                settingsModal.classList.remove('hidden');
            });

            document.getElementById('storageBtn').addEventListener('click', () => {
                storageSettingsModal.classList.remove('hidden');
            });

            document.getElementById('inviteBtn').addEventListener('click', () => {
                inviteFriendsModal.classList.remove('hidden');
            });
        }

        function calculateStorageUsage() {
            // Calculate approximate storage usage
            let totalSize = 0;
            
            // Calculate localStorage usage
            for (let key in localStorage) {
                if (localStorage.hasOwnProperty(key)) {
                    totalSize += localStorage[key].length * 2; // Approximate size in bytes
                }
            }
            
            // Convert to MB
            const sizeInMB = (totalSize / (1024 * 1024)).toFixed(2);
            const progressPercentage = Math.min((totalSize / (50 * 1024 * 1024)) * 100, 100); // Assuming 50MB max
            
            document.getElementById('storageUsage').textContent = `${sizeInMB} MB used`;
            document.getElementById('storageProgress').style.width = `${progressPercentage}%`;
        }

        // Temporary debug
        console.log('DOM Elements check:');
        console.log('chatList:', document.getElementById('chatList'));
        console.log('noChatsMessage:', document.getElementById('noChatsMessage'));
        console.log('tabContent:', document.getElementById('tabContent'));

        // Check if we're on the right tab
        const activeTab = document.querySelector('.tab-panel.active');
        console.log('Active tab:', activeTab ? activeTab.id : 'No active tab found');
    </script>
</body>
</html>