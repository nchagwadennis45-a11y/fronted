<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
    <link rel="icon" href="../icons/moodchat-192.png">
    <link rel="icon" href="../icons/moodchat-512.png">
    <meta name="theme-color" content="#000000">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kynecta - Advanced Mood-Based Chat</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-messaging-compat.js"></script>
    
    <script src="user-data.js"></script>
    <script src="display-user-selections.js"></script>
    
    <meta name="ignore-tailwind-cdn-warning" content="true">
    <style>
        /* Embedded Tailwind CSS to avoid MIME type error */
        /*! tailwindcss v2.2.19 | MIT License | https://tailwindcss.com */
        /*! modern-normalize v1.1.0 | MIT License | https://github.com/sindresorhus/modern-normalize */
        /* ... Tailwind CSS content would be here ... */
        /* For brevity, I'm including only essential parts */
        
        /* Disable right-click and inspect */
        * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Allow selection in input and textarea */
        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        /* Disable text selection */
        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Mood indicators */
        .mood-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        .mood-happy-indicator { background-color: #FBBF24; }
        .mood-calm-indicator { background-color: #60A5FA; }
        .mood-energetic-indicator { background-color: #F87171; }
        .mood-focused-indicator { background-color: #34D399; }
        .mood-creative-indicator { background-color: #A78BFA; }
        
        /* Typing animation */
        .typing-indicator {
            display: flex;
            align-items: center;
            color: #6B7280;
            font-size: 0.875rem;
        }
        .typing-dots {
            display: flex;
            margin-left: 4px;
        }
        .typing-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background-color: #6B7280;
            margin: 0 1px;
            animation: typing 1.4s infinite both;
        }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing {
            0%, 60%, 100% { opacity: 0.3; }
            30% { opacity: 1; }
        }
        
        /* Message bubbles */
        .message-bubble {
            max-width: 70%;
            word-wrap: break-word;
            border-radius: 18px;
            padding: 12px 16px;
            position: relative;
        }
        .message-bubble.sent {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }
        .message-bubble.received {
            background-color: #f3f4f6;
            color: #374151;
            margin-right: auto;
            border-bottom-left-radius: 4px;
        }
        
        /* Loading animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        /* Fade in animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        /* Header styles */
        .kynecta-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        /* Optimized iframe container */
        .iframe-container {
            position: fixed;
            top: 0;
            left: 64px;
            right: 0;
            bottom: 0;
            width: calc(100% - 64px);
            height: 100vh;
            background: white;
            z-index: 30;
            transition: opacity 0.2s ease;
            opacity: 1;
        }
        
        .content-iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
        }
        
        /* Navigation styles */
        .nav-icon {
            transition: all 0.2s ease;
        }
        
        .nav-icon.active {
            background-color: #7c3aed;
            color: white;
        }
        
        /* Content area transitions */
        .content-area {
            display: none;
            transition: opacity 0.2s ease;
            opacity: 1;
        }
        
        .content-area:not(.hidden) {
            display: block;
        }
        
        /* Sidebar permanent visibility */
        .fixed.left-0 {
            z-index: 100 !important;
            position: fixed !important;
            top: 0;
            left: 0;
            bottom: 0;
            height: 100vh;
        }
        
        /* Loading screen animation */
        #loadingScreen {
            transition: opacity 0.2s ease;
            z-index: 9999;
        }
        
        /* Ensure sidebar is always visible and on top */
        #permanentSidebar {
            z-index: 1000 !important;
            transform: translateZ(0);
            will-change: transform;
        }
        
        /* Mobile optimizations */
        @media (max-width: 767px) {
            .iframe-container {
                left: 64px;
                width: calc(100% - 64px);
                z-index: 30;
            }
            
            .fixed.left-0 {
                z-index: 1000 !important;
                width: 64px;
            }
        }
        
        /* Tablet optimizations */
        @media (min-width: 768px) and (max-width: 1023px) {
            .iframe-container {
                left: 64px;
                width: calc(100% - 64px);
            }
            
            .fixed.left-0 {
                z-index: 1000 !important;
            }
        }
        
        /* Desktop optimizations */
        @media (min-width: 1024px) {
            .iframe-container {
                left: 64px;
                width: calc(100% - 64px);
            }
            
            .fixed.left-0 {
                z-index: 1000 !important;
            }
        }
        
        /* Ensure sidebar stays on top of everything */
        #permanentSidebar {
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }
        
        /* Adjust chat app margin for sidebar */
        #chatApp {
            margin-left: 64px;
            width: calc(100% - 64px);
        }
        
        /* Adjust content areas for sidebar */
        #chatsContent,
        #toolsContent,
        #settingsContent {
            margin-left: 0;
            width: 100%;
        }
        
        /* Make sure iframe pages don't hide sidebar */
        .content-area.iframe-container {
            left: 64px;
            width: calc(100% - 64px);
        }
        
        /* Friend list item */
        .friend-item {
            transition: all 0.2s ease;
            cursor: pointer;
            border-radius: 12px;
        }
        
        .friend-item:hover {
            background-color: #f3f4f6;
            transform: translateX(4px);
        }
        
        .friend-item.selected {
            background-color: #e0e7ff;
            border-left: 4px solid #4f46e5;
        }
        
        /* Scroll to bottom button */
        .scroll-to-bottom {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .scroll-to-bottom:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }
        
        /* Toggle switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #4f46e5;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        /* Emoji picker */
        .emoji-picker {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        
        .emoji-item {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            font-size: 20px;
        }
        
        .emoji-item:hover {
            background-color: #f3f4f6;
            transform: scale(1.1);
        }
        
        /* Upload progress */
        .upload-progress {
            width: 100px;
            height: 4px;
            background-color: #e5e7eb;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .upload-progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }
        
        /* Mood tags */
        .mood-tag {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            margin: 2px;
        }
        
        .mood-tag.happy {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .mood-tag.calm {
            background-color: #dbeafe;
            color: #1e40af;
        }
        
        .mood-tag.energetic {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        .mood-tag.focused {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .mood-tag.creative {
            background-color: #ede9fe;
            color: #5b21b6;
        }
        
        /* Interest tags */
        .interest-tag {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            margin: 2px;
            background-color: #f3f4f6;
            color: #4b5563;
        }
        
        /* Goal progress */
        .goal-progress {
            height: 6px;
            background-color: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
        }
        
        .goal-progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        /* Poll results */
        .poll-option {
            background-color: #f9fafb;
            border-radius: 8px;
            padding: 8px 12px;
            margin-bottom: 4px;
        }
        
        .poll-bar {
            height: 8px;
            background-color: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 4px;
        }
        
        .poll-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body class="h-full overflow-hidden bg-gray-50" data-theme="light">
    <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <div id="loadingScreen" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="w-16 h-16 bg-gradient-to-r from-purple-500 to-green-500 rounded-2xl flex items-center justify-center mx-auto mb-4 animate-pulse">
                <span class="text-white text-2xl">ðŸ§ </span>
            </div>
            <h2 class="text-xl font-semibold text-gray-700 mb-2">Kynecta</h2>
            <p class="text-gray-500">Loading...</p>
        </div>
    </div>

    <!-- Permanent Sidebar - Always Visible -->
    <div id="permanentSidebar" class="fixed left-0 top-0 bottom-0 w-16 bg-gray-900 z-40 flex flex-col items-center py-6 space-y-8">
        <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-green-500 rounded-2xl flex items-center justify-center">
            <span class="text-white text-xl font-bold">K</span>
        </div>
        
        <div class="flex-1 flex flex-col items-center space-y-8">
            <button class="nav-icon text-white text-2xl p-3 rounded-2xl bg-purple-700" data-page="chats" title="Chats">
                <i class="fas fa-comments"></i>
            </button>
            
            <button class="nav-icon text-gray-400 hover:text-white text-2xl p-3 rounded-2xl hover:bg-gray-800 transition-all" data-page="status" title="Status">
                <i class="fas fa-circle"></i>
            </button>
            
            <button class="nav-icon text-gray-400 hover:text-white text-2xl p-3 rounded-2xl hover:bg-gray-800 transition-all" data-page="group" title="Groups">
                <i class="fas fa-users"></i>
            </button>
            
            <button class="nav-icon text-gray-400 hover:text-white text-2xl p-3 rounded-2xl hover:bg-gray-800 transition-all" data-page="friends" title="Friends">
                <i class="fas fa-user-friends"></i>
            </button>
            
            <button class="nav-icon text-gray-400 hover:text-white text-2xl p-3 rounded-2xl hover:bg-gray-800 transition-all" data-page="calls" title="Calls">
                <i class="fas fa-phone"></i>
            </button>
            
            <button class="nav-icon text-gray-400 hover:text-white text-2xl p-3 rounded-2xl hover:bg-gray-800 transition-all" data-page="tools" title="Tools">
                <i class="fas fa-tools"></i>
            </button>
        </div>
        
        <button class="nav-icon text-gray-400 hover:text-white text-2xl p-3 rounded-2xl hover:bg-gray-800 transition-all" data-page="settings" title="Settings">
            <i class="fas fa-cog"></i>
        </button>
    </div>

    <!-- Status Page Iframe -->
    <div id="statusContent" class="content-area iframe-container hidden">
        <iframe id="statusIframe" class="content-iframe" src="status.html" title="Status"></iframe>
    </div>

    <!-- Group Page Iframe -->
    <div id="groupContent" class="content-area iframe-container hidden">
        <iframe id="groupIframe" class="content-iframe" src="group.html" title="Groups"></iframe>
    </div>

    <!-- Friends Page Iframe -->
    <div id="friendsContent" class="content-area iframe-container hidden">
        <iframe id="friendsIframe" class="content-iframe" src="friend.html" title="Friends"></iframe>
    </div>

    <!-- Calls Page Iframe -->
    <div id="callsContent" class="content-area iframe-container hidden">
        <iframe id="callsIframe" class="content-iframe" src="calls.html" title="Calls"></iframe>
    </div>

    <!-- Main Chat Application -->
    <div id="chatApp" class="h-full hidden">
        <!-- Chats Page Content -->
        <div id="chatsContent" class="content-area h-full">
            <div class="flex h-full pb-0">
                <div id="chatListContainer" class="chat-list-container w-full md:w-1/3 lg:w-1/4 bg-white flex flex-col border-r border-gray-200">
                    <div class="kynecta-header p-4 flex justify-between items-center">
                        <div class="flex items-center">
                            <img id="userAvatar" class="w-12 h-12 rounded-2xl bg-white/20 flex items-center justify-center text-white font-semibold mr-3 object-cover border-2 border-white/30" src="" alt="Profile">
                            <div>
                                <span id="userName" class="font-semibold text-white block"></span>
                                <span id="userMood" class="text-white/80 text-sm"></span>
                            </div>
                        </div>
                        <div class="flex space-x-3 text-white">
                            <button id="startNewChatBtn" class="text-xl cursor-pointer hover:scale-110 transition-transform" title="Start New Chat">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button id="themeToggle" class="text-xl cursor-pointer hover:scale-110 transition-transform">
                                <i class="fas fa-moon" id="themeIcon"></i>
                            </button>
                        </div>
                    </div>

                    <div class="personalization-info bg-purple-800/30 p-3 border-b border-purple-700/30">
                        <div class="flex items-center text-sm text-gray-300">
                            <i class="fas fa-magic mr-2"></i>
                            <span>Content is personalized based on your moods and interests</span>
                        </div>
                        
                        <div class="flex flex-wrap mt-2 gap-1">
                            <div id="currentMoodsMini" class="flex flex-wrap gap-1"></div>
                            <div id="currentInterestsMini" class="flex flex-wrap gap-1"></div>
                        </div>
                    </div>

                    <div class="bg-white p-3">
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-search text-gray-400"></i>
                            </div>
                            <input type="text" id="searchInput" class="w-full bg-gray-100 rounded-xl py-3 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:bg-white transition-all" placeholder="Search connections...">
                        </div>
                    </div>

                    <!-- Start New Chat Section -->
                    <div id="startNewChatSection" class="hidden bg-white border-b border-gray-200">
                        <div class="p-4">
                            <h3 class="font-semibold mb-3 text-gray-700">Start New Chat</h3>
                            <div id="friendsListForChat" class="max-h-60 overflow-y-auto">
                                <!-- Friends will be loaded here -->
                                <div class="text-center py-8 text-gray-500">
                                    <i class="fas fa-user-friends text-3xl mb-3"></i>
                                    <p>Loading friends...</p>
                                </div>
                            </div>
                            <div class="flex space-x-2 mt-3">
                                <button id="cancelNewChat" class="flex-1 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition-colors">
                                    Cancel
                                </button>
                                <button id="confirmStartChat" class="flex-1 py-2 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-lg font-medium hover:opacity-90 transition-opacity" disabled>
                                    Start Chat
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="tab-panels flex-1 overflow-y-auto custom-scrollbar">
                        <div id="chatsTab" class="tab-panel active">
                            <div id="chatList" class="space-y-1 p-2">
                                <!-- Chats will be loaded here -->
                                <div id="noChatsMessage" class="p-8 text-center text-gray-500">
                                    <i class="fas fa-comments text-4xl mb-3 text-gray-300 block"></i>
                                    <p>No chats yet</p>
                                    <p class="text-sm mt-1">Start a new conversation to begin</p>
                                    <button id="startFirstChatBtn" class="mt-4 px-4 py-2 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-lg font-medium hover:opacity-90 transition-opacity">
                                        Start New Chat
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="chatArea" class="chat-area flex-1 flex flex-col bg-gray-50 w-full h-full hidden md:flex">
                    <div id="chatHeader" class="kynecta-header p-4 flex justify-between items-center hidden">
                        <div class="flex items-center">
                            <div class="md:hidden mr-3">
                                <i class="fas fa-arrow-left text-white cursor-pointer hover:scale-110 transition-transform" id="backToChats" onclick="showChatList()"></i>
                            </div>
                            <img id="chatAvatar" class="w-12 h-12 rounded-2xl bg-white/20 flex items-center justify-center text-white font-semibold mr-3 object-cover border-2 border-white/30" src="" alt="Chat">
                            <div>
                                <h3 id="chatTitle" class="font-semibold text-white"></h3>
                                <p id="chatStatus" class="text-white/80 text-sm flex items-center">
                                    <span id="moodIndicator" class="mood-indicator mood-happy-indicator"></span>
                                    <span id="statusText"></span>
                                    <span id="typingIndicator" class="typing-indicator hidden ml-2">
                                        typing
                                        <div class="typing-dots">
                                            <div class="typing-dot"></div>
                                            <div class="typing-dot"></div>
                                            <div class="typing-dot"></div>
                                        </div>
                                    </span>
                                </p>
                            </div>
                        </div>
                        <div class="flex space-x-3 text-white">
                            <i class="fas fa-microphone text-xl cursor-pointer hover:scale-110 transition-transform" id="voiceToTextBtnHeader" title="Voice to Text"></i>
                            <i class="fas fa-phone text-xl cursor-pointer hover:scale-110 transition-transform friend-call-btn" data-id="" data-name=""></i>
                            <i class="fas fa-video text-xl cursor-pointer hover:scale-110 transition-transform friend-video-call-btn" data-id="" data-name=""></i>
                            <i class="fas fa-ellipsis-v text-xl cursor-pointer hover:scale-110 transition-transform" id="chatMenuBtn"></i>
                        </div>
                    </div>

                    <div id="sharedGoalsSection" class="hidden mx-4 mt-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl border border-blue-200">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="font-semibold text-blue-800 flex items-center">
                                <i class="fas fa-bullseye mr-2"></i>
                                Shared Goals
                            </h3>
                            <button id="toggleGoals" class="text-blue-500 hover:text-blue-700 transition-colors">
                                <i class="fas fa-chevron-up"></i>
                            </button>
                        </div>
                        <div id="sharedGoalsContent">
                            <div id="noGoalsMessage" class="text-center text-blue-500 py-2">
                                <p>No shared goals yet. Create one to get started!</p>
                            </div>
                            <div id="goalsList" class="space-y-3 hidden">
                            </div>
                            <button id="createGoalBtn" class="w-full mt-3 py-2 bg-blue-500 text-white rounded-xl font-semibold hover:bg-blue-600 transition-colors flex items-center justify-center">
                                <i class="fas fa-plus mr-2"></i>Create New Goal
                            </button>
                        </div>
                    </div>

                    <div id="highlightsPanel" class="hidden bg-white border-b border-gray-200 p-3">
                        <div class="flex justify-between items-center">
                            <h3 class="font-semibold text-purple-700 flex items-center">
                                <i class="fas fa-tags mr-2"></i>
                                Message Highlights
                            </h3>
                            <button id="toggleHighlights" class="text-purple-500 hover:text-purple-700 transition-colors">
                                <i class="fas fa-chevron-down"></i>
                            </button>
                        </div>
                        <div id="highlightsContent" class="hidden mt-2">
                            <div class="flex flex-wrap gap-2" id="hashtagsList">
                            </div>
                            <div id="noHighlightsMessage" class="text-center text-gray-500 py-3">
                                <p>No highlighted messages yet. Use #important or #todo in your messages.</p>
                            </div>
                        </div>
                    </div>

                    <div id="messageSelectionToolbar" class="hidden bg-purple-600 text-white p-3 flex items-center justify-between">
                        <div class="flex items-center">
                            <i class="fas fa-check-circle mr-2"></i>
                            <span id="selectedMessagesCount">0</span> messages selected
                        </div>
                        <div class="flex space-x-2">
                            <button id="forwardSelected" class="p-2 hover:bg-purple-700 rounded-lg" title="Forward">
                                <i class="fas fa-share"></i>
                            </button>
                            <button id="starSelected" class="p-2 hover:bg-purple-700 rounded-lg" title="Star">
                                <i class="far fa-star"></i>
                            </button>
                            <button id="deleteSelected" class="p-2 hover:bg-red-600 rounded-lg" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button id="cancelSelection" class="p-2 hover:bg-purple-700 rounded-lg" title="Cancel">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>

                    <div id="replyPreviewBar" class="hidden bg-gray-100 border-l-4 border-purple-500 p-3 mx-4 mt-2 rounded-lg">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="text-sm text-gray-500 flex items-center">
                                    <i class="fas fa-reply mr-1"></i>
                                    Replying to <span id="replyToName" class="font-medium ml-1"></span>
                                </div>
                                <div id="replyPreviewContent" class="text-sm truncate"></div>
                            </div>
                            <button id="cancelReply" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>

                    <div id="messagesContainer" class="flex-1 overflow-y-auto p-4 custom-scrollbar relative">
                        <div id="noMessagesMessage" class="text-center text-gray-500 py-10">
                            <i class="fas fa-comments text-4xl mb-3 text-gray-300 block"></i>
                            <p>No messages yet</p>
                            <p class="text-sm mt-1">Select a chat or group to start messaging</p>
                        </div>
                        <div id="messagesList" class="space-y-4">
                        </div>
                        <div id="scrollToBottom" class="scroll-to-bottom hidden">
                            <i class="fas fa-chevron-down"></i>
                        </div>
                    </div>

                    <div id="pollResultsSection" class="hidden mx-4 mb-2 p-4 bg-gradient-to-r from-green-50 to-teal-50 rounded-2xl border border-green-200">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <p class="text-sm font-semibold text-green-800 flex items-center">
                                    <i class="fas fa-chart-bar mr-2"></i>
                                    Poll Results
                                </p>
                                <div id="pollResultsContent" class="mt-2 space-y-2">
                                </div>
                            </div>
                            <button id="dismissPollResults" class="text-green-400 hover:text-green-600 transition-colors ml-2">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>

                    <div id="moodSuggestion" class="hidden mx-4 mb-2 p-4 rounded-2xl bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-sm font-semibold text-purple-800 flex items-center">
                                    <i class="fas fa-smile mr-2"></i>
                                    Mood-based Suggestion
                                </p>
                                <p id="suggestionText" class="text-sm text-purple-600 mt-1"></p>
                            </div>
                            <button id="dismissSuggestion" class="text-purple-400 hover:text-purple-600 transition-colors">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>

                    <div id="inputArea" class="bg-white p-4 border-t border-gray-200 hidden">
                        <div class="flex items-center">
                            <div class="flex space-x-2 mr-3">
                                <button class="w-12 h-12 rounded-2xl flex items-center justify-center text-gray-500 hover:bg-purple-50 hover:text-purple-600 transition-all" id="attachBtn">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <div class="flex-1 relative">
                                <textarea id="messageInput" class="w-full bg-gray-100 py-4 px-4 rounded-2xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:bg-white transition-all resize-none" placeholder="Type a message..." rows="3" disabled style="min-height: 80px; max-height: 150px; font-size: 16px; line-height: 1.5;"></textarea>
                                <div id="emojiPicker" class="emoji-picker hidden absolute bottom-full mb-2 bg-white border border-gray-300 rounded-lg shadow-lg p-2 grid grid-cols-8 gap-1 max-h-48 overflow-y-auto">
                                </div>
                                <div id="isTyping" class="absolute -top-6 left-0 text-xs text-gray-500 hidden">
                                    <span id="typingUsers"></span> is typing...
                                </div>
                            </div>
                            <div class="ml-3">
                                <button id="sendBtn" class="w-10 h-10 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-2xl flex items-center justify-center hover:opacity-90 transition-all shadow-lg" disabled>
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>

                        <div id="pollCreationSection" class="hidden mt-3 p-3 bg-gray-100 rounded-xl">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-semibold text-gray-700">Create Poll</h4>
                                <button id="closePollCreation" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <input type="text" id="pollQuestion" class="w-full p-2 mb-2 border border-gray-300 rounded-lg" placeholder="Enter poll question">
                            <div id="pollOptions" class="space-y-2 mb-2">
                                <input type="text" class="w-full p-2 border border-gray-300 rounded-lg poll-option" placeholder="Option 1">
                                <input type="text" class="w-full p-2 border border-gray-300 rounded-lg poll-option" placeholder="Option 2">
                            </div>
                            <button id="addPollOption" class="w-full py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors mb-2">
                                <i class="fas fa-plus mr-1"></i>Add Option
                            </button>
                            <div class="flex space-x-2">
                                <button id="createPoll" class="flex-1 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 transition-colors">
                                    Create Poll
                                </button>
                                <button id="cancelPoll" class="flex-1 py-2 bg-gray-500 text-white rounded-lg font-semibold hover:bg-gray-600 transition-colors">
                                    Cancel
                                </button>
                            </div>
                        </div>

                        <div id="filePreview" class="hidden mt-3 p-3 bg-gray-100 rounded-xl">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <i class="fas fa-file text-gray-600 mr-3"></i>
                                    <div>
                                        <p id="fileName" class="font-medium"></p>
                                        <p id="fileSize" class="text-sm text-gray-500"></p>
                                    </div>
                                </div>
                                <div class="upload-progress">
                                    <div id="uploadProgressBar" class="upload-progress-bar" style="width: 0%"></div>
                                </div>
                                <button id="removeFile" class="text-gray-500 hover:text-gray-700 ml-3">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tools Page Content -->
        <div id="toolsContent" class="content-area hidden h-full">
            <div class="flex h-full pb-0">
                <div class="chat-list-container w-full md:w-1/3 lg:w-1/4 bg-white flex flex-col border-r border-gray-200">
                    <div class="kynecta-header p-4 flex justify-between items-center">
                        <div class="flex items-center">
                            <img id="userAvatarTools" class="w-12 h-12 rounded-2xl bg-white/20 flex items-center justify-center text-white font-semibold mr-3 object-cover border-2 border-white/30" src="" alt="Profile">
                            <div>
                                <span id="userNameTools" class="font-semibold text-white block"></span>
                                <span id="userMoodTools" class="text-white/80 text-sm"></span>
                            </div>
                        </div>
                        <div class="flex space-x-3 text-white">
                            <button id="themeToggleTools" class="text-xl cursor-pointer hover:scale-110 transition-transform">
                                <i class="fas fa-moon" id="themeIconTools"></i>
                            </button>
                        </div>
                    </div>

                    <div class="tab-panels flex-1 overflow-y-auto custom-scrollbar p-4">
                        <div id="toolsTab" class="tab-panel active space-y-4">
                            <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-200">
                                <h3 class="font-semibold mb-3">Quick Actions</h3>
                                <div class="grid grid-cols-2 gap-3">
                                    <button class="p-4 bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl text-center hover:shadow-md transition-all" onclick="showSettingsSection('privacy')">
                                        <i class="fas fa-shield-alt text-2xl mb-2 block text-purple-600"></i>
                                        <p class="text-sm font-medium">Privacy</p>
                                    </button>
                                    <button class="p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl text-center hover:shadow-md transition-all" onclick="openSettingsModal()">
                                        <i class="fas fa-cog text-2xl mb-2 block text-blue-600"></i>
                                        <p class="text-sm font-medium">Settings</p>
                                    </button>
                                    <button class="p-4 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl text-center hover:shadow-md transition-all" onclick="showSettingsSection('storage')">
                                        <i class="fas fa-database text-2xl mb-2 block text-gray-600"></i>
                                        <p class="text-sm font-medium">Storage</p>
                                    </button>
                                    <button class="p-4 bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl text-center hover:shadow-md transition-all" onclick="closeModal('settingsModal'); document.getElementById('inviteFriendsModal').classList.remove('hidden')">
                                        <i class="fas fa-user-plus text-2xl mb-2 block text-orange-600"></i>
                                        <p class="text-sm font-medium">Invite</p>
                                    </button>
                                    <button class="p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-xl text-center hover:shadow-md transition-all" onclick="document.getElementById('catalogueModal').classList.remove('hidden')">
                                        <i class="fas fa-shopping-cart text-2xl mb-2 block text-green-600"></i>
                                        <p class="text-sm font-medium">Catalogue</p>
                                    </button>
                                    <button class="p-4 bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-xl text-center hover:shadow-md transition-all" onclick="document.getElementById('advertiseModal').classList.remove('hidden')">
                                        <i class="fas fa-bullhorn text-2xl mb-2 block text-yellow-600"></i>
                                        <p class="text-sm font-medium">Advertise</p>
                                    </button>
                                    <button class="p-4 bg-gradient-to-br from-red-50 to-red-100 rounded-xl text-center hover:shadow-md transition-all" onclick="document.getElementById('labelsModal').classList.remove('hidden')">
                                        <i class="fas fa-tags text-2xl mb-2 block text-red-600"></i>
                                        <p class="text-sm font-medium">Labels</p>
                                    </button>
                                    <button class="p-4 bg-gradient-to-br from-indigo-50 to-indigo-100 rounded-xl text-center hover:shadow-md transition-all" onclick="document.getElementById('greetingModal').classList.remove('hidden')">
                                        <i class="fas fa-comment-dots text-2xl mb-2 block text-indigo-600"></i>
                                        <p class="text-sm font-medium">Greeting</p>
                                    </button>
                                    <button class="p-4 bg-gradient-to-br from-pink-50 to-pink-100 rounded-xl text-center hover:shadow-md transition-all" onclick="document.getElementById('awayModal').classList.remove('hidden')">
                                        <i class="fas fa-clock text-2xl mb-2 block text-pink-600"></i>
                                        <p class="text-sm font-medium">Away</p>
                                    </button>
                                    <button class="p-4 bg-gradient-to-br from-teal-50 to-teal-100 rounded-xl text-center hover:shadow-md transition-all" onclick="document.getElementById('aiSummaryModal').classList.remove('hidden')">
                                        <i class="fas fa-robot text-2xl mb-2 block text-teal-600"></i>
                                        <p class="text-sm font-medium">AI Summary</p>
                                    </button>
                                    <button class="p-4 bg-gradient-to-br from-cyan-50 to-cyan-100 rounded-xl text-center hover:shadow-md transition-all" onclick="document.getElementById('smartRepliesModal').classList.remove('hidden')">
                                        <i class="fas fa-lightbulb text-2xl mb-2 block text-cyan-600"></i>
                                        <p class="text-sm font-medium">Smart Replies</p>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chat-area flex-1 flex flex-col bg-gray-50 w-full h-full hidden md:flex items-center justify-center">
                    <div class="text-center p-8 max-w-lg">
                        <i class="fas fa-tools text-6xl text-purple-400 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-700 mb-2">Business & AI Tools</h3>
                        <p class="text-gray-500 mb-6">Access powerful tools for business management, AI assistance, and productivity enhancements.</p>
                        <div class="grid grid-cols-2 gap-4">
                            <button onclick="document.getElementById('catalogueModal').classList.remove('hidden')" class="p-4 bg-white rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow">
                                <i class="fas fa-shopping-cart text-2xl text-green-500 mb-2"></i>
                                <p class="font-medium">Catalogue</p>
                            </button>
                            <button onclick="document.getElementById('aiSummaryModal').classList.remove('hidden')" class="p-4 bg-white rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow">
                                <i class="fas fa-robot text-2xl text-purple-500 mb-2"></i>
                                <p class="font-medium">AI Summary</p>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Page Content -->
        <div id="settingsContent" class="content-area hidden h-full">
            <div class="flex h-full pb-0">
                <div class="chat-list-container w-full md:w-1/3 lg:w-1/4 bg-white flex flex-col border-r border-gray-200">
                    <div class="kynecta-header p-4 flex justify-between items-center">
                        <div class="flex items-center">
                            <img id="userAvatarSettings" class="w-12 h-12 rounded-2xl bg-white/20 flex items-center justify-center text-white font-semibold mr-3 object-cover border-2 border-white/30" src="" alt="Profile">
                            <div>
                                <span id="userNameSettings" class="font-semibold text-white block"></span>
                                <span id="userMoodSettings" class="text-white/80 text-sm"></span>
                            </div>
                        </div>
                        <div class="flex space-x-3 text-white">
                            <button id="themeToggleSettings" class="text-xl cursor-pointer hover:scale-110 transition-transform">
                                <i class="fas fa-moon" id="themeIconSettings"></i>
                            </button>
                        </div>
                    </div>

                    <div class="overflow-y-auto custom-scrollbar p-0">
                        <div class="settings-scroll-container" style="height: 300px; overflow-y: auto;">
                            <div class="settings-full-list">
                                <div class="space-y-0">
                                    <div class="settings-section-item" data-section="profile">
                                        <button class="settings-item w-full text-left p-4 bg-white hover:bg-gray-50 transition-colors flex items-center justify-between border-b border-gray-100" onclick="showSettingsSection('profile')">
                                            <div class="flex items-center">
                                                <i class="fas fa-user text-purple-500 mr-3 text-xl"></i>
                                                <div>
                                                    <p class="font-medium">Profile</p>
                                                    <p class="text-sm text-gray-500">Edit your profile information</p>
                                                </div>
                                            </div>
                                            <i class="fas fa-chevron-right text-gray-400"></i>
                                        </button>
                                    </div>
                                    
                                    <div class="settings-section-item" data-section="privacy">
                                        <button class="settings-item w-full text-left p-4 bg-white hover:bg-gray-50 transition-colors flex items-center justify-between border-b border-gray-100" onclick="showSettingsSection('privacy')">
                                            <div class="flex items-center">
                                                <i class="fas fa-lock text-blue-500 mr-3 text-xl"></i>
                                                <div>
                                                    <p class="font-medium">Privacy</p>
                                                    <p class="text-sm text-gray-500">Manage your privacy settings</p>
                                                </div>
                                            </div>
                                            <i class="fas fa-chevron-right text-gray-400"></i>
                                        </button>
                                    </div>
                                    
                                    <div class="settings-section-item" data-section="notifications">
                                        <button class="settings-item w-full text-left p-4 bg-white hover:bg-gray-50 transition-colors flex items-center justify-between border-b border-gray-100" onclick="showSettingsSection('notifications')">
                                            <div class="flex items-center">
                                                <i class="fas fa-bell text-green-500 mr-3 text-xl"></i>
                                                <div>
                                                    <p class="font-medium">Notifications</p>
                                                    <p class="text-sm text-gray-500">Configure notification preferences</p>
                                                </div>
                                            </div>
                                            <i class="fas fa-chevron-right text-gray-400"></i>
                                        </button>
                                    </div>
                                    
                                    <div class="settings-section-item" data-section="account">
                                        <button class="settings-item w-full text-left p-4 bg-white hover:bg-gray-50 transition-colors flex items-center justify-between border-b border-gray-100" onclick="showSettingsSection('account')">
                                            <div class="flex items-center">
                                                <i class="fas fa-key text-red-500 mr-3 text-xl"></i>
                                                <div>
                                                    <p class="font-medium">Account</p>
                                                    <p class="text-sm text-gray-500">Account security and settings</p>
                                                </div>
                                            </div>
                                            <i class="fas fa-chevron-right text-gray-400"></i>
                                        </button>
                                    </div>
                                    
                                    <div class="settings-section-item" data-section="chat">
                                        <button class="settings-item w-full text-left p-4 bg-white hover:bg-gray-50 transition-colors flex items-center justify-between border-b border-gray-100" onclick="showSettingsSection('chat')">
                                            <div class="flex items-center">
                                                <i class="fas fa-comments text-indigo-500 mr-3 text-xl"></i>
                                                <div>
                                                    <p class="font-medium">Chat Settings</p>
                                                    <p class="text-sm text-gray-500">Configure chat preferences</p>
                                                </div>
                                            </div>
                                            <i class="fas fa-chevron-right text-gray-400"></i>
                                        </button>
                                    </div>
                                    
                                    <div class="settings-section-item" data-section="storage">
                                        <button class="settings-item w-full text-left p-4 bg-white hover:bg-gray-50 transition-colors flex items-center justify-between border-b border-gray-100" onclick="showSettingsSection('storage')">
                                            <div class="flex items-center">
                                                <i class="fas fa-database text-gray-500 mr-3 text-xl"></i>
                                                <div>
                                                    <p class="font-medium">Storage & Data</p>
                                                    <p class="text-sm text-gray-500">Manage storage and data usage</p>
                                                </div>
                                            </div>
                                            <i class="fas fa-chevron-right text-gray-400"></i>
                                        </button>
                                    </div>
                                    
                                    <div class="settings-section-item" data-section="accessibility">
                                        <button class="settings-item w-full text-left p-4 bg-white hover:bg-gray-50 transition-colors flex items-center justify-between border-b border-gray-100" onclick="showSettingsSection('accessibility')">
                                            <div class="flex items-center">
                                                <i class="fas fa-universal-access text-orange-500 mr-3 text-xl"></i>
                                                <div>
                                                    <p class="font-medium">Accessibility</p>
                                                    <p class="text-sm text-gray-500">Accessibility and display settings</p>
                                                </div>
                                            </div>
                                            <i class="fas fa-chevron-right text-gray-400"></i>
                                        </button>
                                    </div>
                                    
                                    <div class="settings-section-item" data-section="language">
                                        <button class="settings-item w-full text-left p-4 bg-white hover:bg-gray-50 transition-colors flex items-center justify-between border-b border-gray-100" onclick="showSettingsSection('language')">
                                            <div class="flex items-center">
                                                <i class="fas fa-language text-teal-500 mr-3 text-xl"></i>
                                                <div>
                                                    <p class="font-medium">Language</p>
                                                    <p class="text-sm text-gray-500">App language and region settings</p>
                                                </div>
                                            </div>
                                            <i class="fas fa-chevron-right text-gray-400"></i>
                                        </button>
                                    </div>
                                    
                                    <div class="settings-section-item" data-section="help">
                                        <button class="settings-item w-full text-left p-4 bg-white hover:bg-gray-50 transition-colors flex items-center justify-between border-b border-gray-100" onclick="showSettingsSection('help')">
                                            <div class="flex items-center">
                                                <i class="fas fa-question-circle text-yellow-500 mr-3 text-xl"></i>
                                                <div>
                                                    <p class="font-medium">Help Center</p>
                                                    <p class="text-sm text-gray-500">Help, support and FAQs</p>
                                                </div>
                                            </div>
                                            <i class="fas fa-chevron-right text-gray-400"></i>
                                        </button>
                                    </div>
                                    
                                    <div class="settings-section-item" data-section="about">
                                        <button class="settings-item w-full text-left p-4 bg-white hover:bg-gray-50 transition-colors flex items-center justify-between border-b border-gray-100" onclick="showSettingsSection('about')">
                                            <div class="flex items-center">
                                                <i class="fas fa-info-circle text-blue-500 mr-3 text-xl"></i>
                                                <div>
                                                    <p class="font-medium">About</p>
                                                    <p class="text-sm text-gray-500">App information and version</p>
                                                </div>
                                            </div>
                                            <i class="fas fa-chevron-right text-gray-400"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chat-area flex-1 flex flex-col bg-gray-50 w-full h-full hidden md:flex items-center justify-center">
                    <div class="text-center p-8 max-w-md">
                        <i class="fas fa-cog text-6xl text-purple-400 mb-4 animate-spin"></i>
                        <h3 class="text-xl font-semibold text-gray-700 mb-2">Settings & Preferences</h3>
                        <p class="text-gray-500">Customize your Kynecta experience by adjusting settings to match your preferences and needs.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Video Conference -->
    <div class="video-conference" id="videoConference">
        <div class="conference-grid" id="conferenceGrid">
        </div>
        <div class="call-controls">
            <button class="call-btn call-mute" id="conferenceMuteBtn">
                <i class="fas fa-microphone"></i>
            </button>
            <button class="call-btn call-video" id="conferenceVideoBtn">
                <i class="fas fa-video"></i>
            </button>
            <button class="call-btn call-end" id="conferenceEndBtn">
                <i class="fas fa-phone"></i>
            </button>
        </div>
    </div>

    <!-- Video Call Container -->
    <div id="videoCallContainer" class="hidden fixed inset-0 bg-black bg-opacity-80 z-50 flex flex-col items-center justify-center p-4">
        <video id="remoteVideo" autoplay playsinline class="w-full max-w-md rounded-lg mb-4"></video>
        <video id="localVideo" autoplay muted playsinline class="absolute bottom-4 right-4 w-32 h-48 object-cover rounded-lg border-2 border-white"></video>
        
        <div class="flex space-x-4">
            <button id="toggleMicBtn" class="bg-gray-600 text-white p-3 rounded-full">
                <i class="fas fa-microphone"></i>
            </button>
            <button id="toggleCameraBtn" class="bg-gray-600 text-white p-3 rounded-full">
                <i class="fas fa-video"></i>
            </button>
            <button id="switchCameraBtn" class="bg-gray-600 text-white p-3 rounded-full">
                <i class="fas fa-sync-alt"></i>
            </button>
            <button id="endCallBtn" class="bg-red-600 text-white p-3 rounded-full">
                <i class="fas fa-phone-slash"></i>
            </button>
        </div>
        
        <div class="absolute top-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-50 text-white px-4 py-2 rounded-lg">
            <div id="callStatus" class="text-sm">Connecting...</div>
            <div id="callTimer" class="text-lg font-semibold">00:00</div>
        </div>
    </div>

    <!-- Incoming Call Popup -->
    <div id="incomingCallPopup" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4">
            <h3 class="text-lg font-semibold mb-2">Incoming Call</h3>
            <p>From: <span id="incomingCallerName" class="font-medium"></span></p>
            <p>Type: <span id="incomingCallType" class="font-medium"></span></p>
            <div class="flex space-x-3 mt-4">
                <button id="acceptCallBtn" class="flex-1 bg-green-500 text-white py-2 rounded-lg">Accept</button>
                <button id="rejectCallBtn" class="flex-1 bg-red-500 text-white py-2 rounded-lg">Reject</button>
            </div>
        </div>
    </div>

    <!-- Call Container -->
    <div id="callContainer" class="hidden fixed inset-0 bg-black z-40 flex-col">
        <video id="remoteVideo" class="w-full h-full object-cover" autoplay playsinline></video>
        
        <video id="localVideo" class="absolute bottom-4 right-4 w-32 h-48 object-cover rounded-lg border-2 border-white" autoplay playsinline muted></video>
        
        <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-4">
            <button id="toggleMicBtn" class="w-12 h-12 bg-gray-600 text-white rounded-full">ðŸŽ¤</button>
            <button id="endCallBtn" class="w-12 h-12 bg-red-600 text-white rounded-full">ðŸ“ž</button>
            <button id="toggleCameraBtn" class="w-12 h-12 bg-gray-600 text-white rounded-full">ðŸ“·</button>
            <button id="switchCameraBtn" class="w-12 h-12 bg-gray-600 text-white rounded-full">ðŸ”„</button>
        </div>
        
        <div class="absolute top-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-50 text-white px-4 py-2 rounded-lg">
            <div id="callStatus" class="text-sm">Connecting...</div>
            <div id="callTimer" class="text-lg font-semibold">00:00</div>
        </div>
    </div>

    <!-- Create Goal Modal -->
    <div id="createGoalModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Create Shared Goal</h3>
                    <button id="closeCreateGoal" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('createGoalModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Goal Title</label>
                    <input type="text" id="goalTitle" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Enter goal title">
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <textarea id="goalDescription" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Enter goal description" rows="3"></textarea>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Due Date (Optional)</label>
                    <input type="date" id="goalDueDate" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors">
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Progress</label>
                    <div class="flex items-center space-x-3">
                        <input type="range" id="goalProgress" class="flex-1" min="0" max="100" value="0">
                        <span id="goalProgressValue" class="text-sm font-medium text-gray-700">0%</span>
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <button id="saveGoal" class="flex-1 py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Create Goal
                    </button>
                    <button id="cancelGoal" class="flex-1 py-3 bg-gray-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[70vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Settings</h3>
                    <button id="closeSettings" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('settingsModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[50vh] custom-scrollbar p-0">
                <div class="settings-scroll-container" style="height: 300px; overflow-y: auto;">
                    <div class="settings-full-list">
                        <div class="space-y-0">
                            <div class="settings-section-item" data-section="profile">
                                <button class="settings-item w-full text-left p-4 bg-white hover:bg-gray-50 transition-colors flex items-center justify-between border-b border-gray-100" onclick="showSettingsSection('profile')">
                                    <div class="flex items-center">
                                        <i class="fas fa-user text-purple-500 mr-3 text-xl"></i>
                                        <div>
                                            <p class="font-medium">Profile</p>
                                            <p class="text-sm text-gray-500">Edit your profile information</p>
                                        </div>
                                    </div>
                                    <i class="fas fa-chevron-right text-gray-400"></i>
                                </button>
                            </div>
                            
                            <div class="settings-section-item" data-section="privacy">
                                <button class="settings-item w-full text-left p-4 bg-white hover:bg-gray-50 transition-colors flex items-center justify-between border-b border-gray-100" onclick="showSettingsSection('privacy')">
                                    <div class="flex items-center">
                                        <i class="fas fa-lock text-blue-500 mr-3 text-xl"></i>
                                        <div>
                                            <p class="font-medium">Privacy</p>
                                            <p class="text-sm text-gray-500">Manage your privacy settings</p>
                                        </div>
                                    </div>
                                    <i class="fas fa-chevron-right text-gray-400"></i>
                                </button>
                            </div>
                            
                            <div class="settings-section-item" data-section="notifications">
                                <button class="settings-item w-full text-left p-4 bg-white hover:bg-gray-50 transition-colors flex items-center justify-between border-b border-gray-100" onclick="showSettingsSection('notifications')">
                                    <div class="flex items-center">
                                        <i class="fas fa-bell text-green-500 mr-3 text-xl"></i>
                                        <div>
                                            <p class="font-medium">Notifications</p>
                                            <p class="text-sm text-gray-500">Configure notification preferences</p>
                                        </div>
                                    </div>
                                    <i class="fas fa-chevron-right text-gray-400"></i>
                                </button>
                            </div>
                            
                            <div class="settings-section-item" data-section="account">
                                <button class="settings-item w-full text-left p-4 bg-white hover:bg-gray-50 transition-colors flex items-center justify-between border-b border-gray-100" onclick="showSettingsSection('account')">
                                    <div class="flex items-center">
                                        <i class="fas fa-key text-red-500 mr-3 text-xl"></i>
                                        <div>
                                            <p class="font-medium">Account</p>
                                            <p class="text-sm text-gray-500">Account security and settings</p>
                                        </div>
                                    </div>
                                    <i class="fas fa-chevron-right text-gray-400"></i>
                                </button>
                            </div>
                            
                            <div class="settings-section-item" data-section="chat">
                                <button class="settings-item w-full text-left p-4 bg-white hover:bg-gray-50 transition-colors flex items-center justify-between border-b border-gray-100" onclick="showSettingsSection('chat')">
                                    <div class="flex items-center">
                                        <i class="fas fa-comments text-indigo-500 mr-3 text-xl"></i>
                                        <div>
                                            <p class="font-medium">Chat Settings</p>
                                            <p class="text-sm text-gray-500">Configure chat preferences</p>
                                        </div>
                                    </div>
                                    <i class="fas fa-chevron-right text-gray-400"></i>
                                </button>
                            </div>
                            
                            <div class="settings-section-item" data-section="storage">
                                <button class="settings-item w-full text-left p-4 bg-white hover:bg-gray-50 transition-colors flex items-center justify-between border-b border-gray-100" onclick="showSettingsSection('storage')">
                                    <div class="flex items-center">
                                        <i class="fas fa-database text-gray-500 mr-3 text-xl"></i>
                                        <div>
                                            <p class="font-medium">Storage & Data</p>
                                            <p class="text-sm text-gray-500">Manage storage and data usage</p>
                                        </div>
                                    </div>
                                    <i class="fas fa-chevron-right text-gray-400"></i>
                                </button>
                            </div>
                            
                            <div class="settings-section-item" data-section="accessibility">
                                <button class="settings-item w-full text-left p-4 bg-white hover:bg-gray-50 transition-colors flex items-center justify-between border-b border-gray-100" onclick="showSettingsSection('accessibility')">
                                    <div class="flex items-center">
                                        <i class="fas fa-universal-access text-orange-500 mr-3 text-xl"></i>
                                        <div>
                                            <p class="font-medium">Accessibility</p>
                                                    <p class="text-sm text-gray-500">Accessibility and display settings</p>
                                        </div>
                                    </div>
                                    <i class="fas fa-chevron-right text-gray-400"></i>
                                </button>
                            </div>
                            
                            <div class="settings-section-item" data-section="language">
                                <button class="settings-item w-full text-left p-4 bg-white hover:bg-gray-50 transition-colors flex items-center justify-between border-b border-gray-100" onclick="showSettingsSection('language')">
                                    <div class="flex items-center">
                                        <i class="fas fa-language text-teal-500 mr-3 text-xl"></i>
                                        <div>
                                            <p class="font-medium">Language</p>
                                            <p class="text-sm text-gray-500">App language and region settings</p>
                                        </div>
                                    </div>
                                    <i class="fas fa-chevron-right text-gray-400"></i>
                                </button>
                            </div>
                            
                            <div class="settings-section-item" data-section="help">
                                <button class="settings-item w-full text-left p-4 bg-white hover:bg-gray-50 transition-colors flex items-center justify-between border-b border-gray-100" onclick="showSettingsSection('help')">
                                    <div class="flex items-center">
                                        <i class="fas fa-question-circle text-yellow-500 mr-3 text-xl"></i>
                                        <div>
                                            <p class="font-medium">Help Center</p>
                                            <p class="text-sm text-gray-500">Help, support and FAQs</p>
                                        </div>
                                    </div>
                                    <i class="fas fa-chevron-right text-gray-400"></i>
                                </button>
                            </div>
                            
                            <div class="settings-section-item" data-section="about">
                                <button class="settings-item w-full text-left p-4 bg-white hover:bg-gray-50 transition-colors flex items-center justify-between border-b border-gray-100" onclick="showSettingsSection('about')">
                                    <div class="flex items-center">
                                        <i class="fas fa-info-circle text-blue-500 mr-3 text-xl"></i>
                                        <div>
                                            <p class="font-medium">About</p>
                                            <p class="text-sm text-gray-500">App information and version</p>
                                        </div>
                                    </div>
                                    <i class="fas fa-chevron-right text-gray-400"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Friend Modal -->
    <div id="addFriendModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[80vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <h3 class="text-xl font-semibold text-white text-center">Add New Friend</h3>
            </div>
            
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Search by Email, Phone, or Name</label>
                    <input type="text" id="friendSearchInput" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Enter email, phone number, or name">
                </div>
                
                <div id="searchResults" class="mb-4 max-h-40 overflow-y-auto hidden">
                </div>
                
                <div class="flex space-x-3">
                    <button id="searchFriend" class="flex-1 py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Search
                    </button>
                    <button id="cancelFriend" class="flex-1 py-3 bg-gray-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity" onclick="closeModal('addFriendModal')">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Friend Search Results Modal -->
    <div id="friendSearchResultsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[80vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <h3 class="text-xl font-semibold text-white text-center">Search Results</h3>
            </div>
            
            <div class="p-6">
                <div id="enhancedSearchResults" class="space-y-3 max-h-60 overflow-y-auto">
                </div>
                
                <div class="mt-4">
                    <button id="closeEnhancedSearch" class="w-full py-3 bg-gray-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity" onclick="closeModal('friendSearchResultsModal')">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Friend Modal -->
    <div id="editFriendModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[80vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <h3 class="text-xl font-semibold text-white text-center">Friend Options</h3>
            </div>
            
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Name</label>
                    <input type="text" id="editFriendName" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Enter friend name" readonly>
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                    <input type="text" id="editFriendStatus" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Friend status" readonly>
                </div>
                
                <div class="flex space-x-3">
                    <button id="messageFriend" class="flex-1 py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Message
                    </button>
                    <button id="callFriend" class="flex-1 py-3 bg-blue-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Call
                    </button>
                    <button id="removeFriend" class="flex-1 py-3 bg-red-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Remove
                    </button>
                    <button id="cancelEditFriend" class="flex-1 py-3 bg-gray-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity" onclick="closeModal('editFriendModal')">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Settings Modal -->
    <div id="profileSettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Profile Settings</h3>
                    <button id="closeProfileSettings" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('profileSettingsModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="mb-6">
                    <div class="profile-cover mb-4 relative">
                        <img id="profileCoverPreview" class="w-full h-32 object-cover rounded-t-2xl" src="" alt="Cover">
                        <div class="profile-cover-edit absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity cursor-pointer" onclick="triggerFileInput('coverPicUpload')">
                            <i class="fas fa-camera mr-2 text-white"></i>
                            <span class="text-white">Edit Cover</span>
                        </div>
                        <input type="file" id="coverPicUpload" accept="image/*" class="hidden">
                    </div>
                    
                    <div class="flex justify-center -mt-12 mb-4 relative">
                        <div class="profile-upload relative">
                            <div class="w-24 h-24 rounded-full bg-gradient-to-r from-purple-500 to-green-500 flex items-center justify-center text-white text-xl font-bold border-4 border-white overflow-hidden">
                                <img id="profilePicPreview" class="w-full h-full rounded-full object-cover" src="" alt="Profile">
                            </div>
                            <input type="file" id="profilePictureUpload" accept="image/*" class="hidden">
                            <div class="profile-photo-edit absolute bottom-0 right-0 bg-purple-600 text-white p-2 rounded-full cursor-pointer hover:bg-purple-700 transition-colors" onclick="triggerFileInput('profilePictureUpload')">
                                <i class="fas fa-camera"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Display Name</label>
                    <input type="text" id="profileName" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Enter your display name">
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">About</label>
                    <textarea id="profileAbout" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Tell something about yourself" rows="3"></textarea>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" id="profileEmail" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Enter your email">
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                    <input type="tel" id="profilePhone" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Enter your phone number">
                </div>
                
                <div class="flex space-x-3">
                    <button id="saveProfile" class="flex-1 py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Save Profile
                    </button>
                    <button id="cancelProfile" class="flex-1 py-3 bg-gray-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity" onclick="closeModal('profileSettingsModal')">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy Settings Modal -->
    <div id="privacySettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Privacy Settings</h3>
                    <button id="closePrivacySettings" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('privacySettingsModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="mb-6">
                    <h4 class="font-semibold mb-4 text-lg text-gray-800">Who can see my personal info</h4>
                    
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium">Last seen & online</p>
                            </div>
                            <select id="lastSeenPrivacy" class="p-2 border border-gray-300 rounded-lg">
                                <option value="everyone">Everyone</option>
                                <option value="contacts">My contacts</option>
                                <option value="nobody">Nobody</option>
                            </select>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium">Profile photo</p>
                            </div>
                            <select id="profilePhotoPrivacy" class="p-2 border border-gray-300 rounded-lg">
                                <option value="everyone">Everyone</option>
                                <option value="contacts">My contacts</option>
                                <option value="nobody">Nobody</option>
                            </select>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium">About</p>
                            </div>
                            <select id="aboutPrivacy" class="p-2 border border-gray-300 rounded-lg">
                                <option value="everyone">Everyone</option>
                                <option value="contacts">My contacts</option>
                                <option value="nobody">Nobody</option>
                            </select>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium">Status</p>
                            </div>
                            <select id="statusPrivacy" class="p-2 border border-gray-300 rounded-lg">
                                <option value="everyone">Everyone</option>
                                <option value="contacts">My contacts</option>
                                <option value="nobody">Nobody</option>
                            </select>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium">Read receipts</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="readReceiptsPrivacy" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium">Disappearing messages</p>
                            </div>
                            <select id="disappearingMessagesPrivacy" class="p-2 border border-gray-300 rounded-lg">
                                <option value="off">Off</option>
                                <option value="24h">24 hours</option>
                                <option value="7d">7 days</option>
                                <option value="90d">90 days</option>
                            </select>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium">Groups</p>
                            </div>
                            <select id="groupsPrivacy" class="p-2 border border-gray-300 rounded-lg">
                                <option value="everyone">Everyone</option>
                                <option value="contacts">My contacts</option>
                                <option value="nobody">Nobody</option>
                            </select>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium">Calls</p>
                            </div>
                            <select id="callsPrivacy" class="p-2 border border-gray-300 rounded-lg">
                                <option value="everyone">Everyone</option>
                                <option value="contacts">My contacts</option>
                                <option value="nobody">Nobody</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <button id="savePrivacy" class="flex-1 py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Save Privacy Settings
                    </button>
                    <button id="cancelPrivacy" class="flex-1 py-3 bg-gray-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity" onclick="closeModal('privacySettingsModal')">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Account Settings Modal -->
    <div id="accountSettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Account Settings</h3>
                    <button id="closeAccountSettings" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('accountSettingsModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="space-y-4">
                    <div class="settings-item" id="securityNotificationsBtn">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Security notifications</div>
                            <div class="settings-item-description">Get alerts about unusual activity</div>
                        </div>
                        <div class="settings-item-action">
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                    
                    <div class="settings-item" id="passkeysBtn">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Passkeys</div>
                            <div class="settings-item-description">Set up passkeys for secure login</div>
                        </div>
                        <div class="settings-item-action">
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                    
                    <div class="settings-item" id="emailAddressBtn">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Email address</div>
                            <div class="settings-item-description">Change your email address</div>
                        </div>
                        <div class="settings-item-action">
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                    
                    <div class="settings-item" id="twoStepVerificationBtn">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Two-step verification</div>
                            <div class="settings-item-description">Add an extra layer of security</div>
                        </div>
                        <div class="settings-item-action">
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                    
                    <div class="settings-item" id="businessPlatformBtn">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Business platform</div>
                            <div class="settings-item-description">Manage your business account</div>
                        </div>
                        <div class="settings-item-action">
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                    
                    <div class="settings-item" id="changeNumberBtn">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Change number</div>
                            <div class="settings-item-description">Transfer your account to a new number</div>
                        </div>
                        <div class="settings-item-action">
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                    
                    <div class="settings-item" id="requestAccountInfoBtn">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Request account info</div>
                            <div class="settings-item-description">Download a report of your account</div>
                        </div>
                        <div class="settings-item-action">
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                    
                    <div class="settings-item" id="deleteAccountBtn">
                        <div class="settings-item-content">
                            <div class="settings-item-title">Delete account</div>
                            <div class="settings-item-description">Permanently delete your account</div>
                        </div>
                        <div class="settings-item-action">
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6">
                    <button id="cancelAccount" class="w-full py-3 bg-gray-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity" onclick="closeModal('accountSettingsModal')">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Accessibility Settings Modal -->
    <div id="accessibilitySettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Accessibility Settings</h3>
                    <button id="closeAccessibilitySettings" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('accessibilitySettingsModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Dark Mode</p>
                            <p class="text-sm text-gray-500">Use dark theme</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="darkModeToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Font Size</p>
                            <p class="text-sm text-gray-500">Adjust text size</p>
                        </div>
                        <select id="fontSizeSelect" class="p-2 border border-gray-300 rounded-lg">
                            <option value="small">Small</option>
                            <option value="medium" selected>Medium</option>
                            <option value="large">Large</option>
                            <option value="x-large">Extra Large</option>
                        </select>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">High Contrast</p>
                            <p class="text-sm text-gray-500">Increase color contrast</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="highContrastToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Screen Reader</p>
                            <p class="text-sm text-gray-500">Enable screen reader support</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="screenReaderToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Reduce Animations</p>
                            <p class="text-sm text-gray-500">Minimize motion effects</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="reduceAnimationsToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Text-to-Speech</p>
                            <p class="text-sm text-gray-500">Read messages aloud</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="textToSpeechToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="mt-6">
                    <button id="saveAccessibility" class="w-full py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Save Accessibility Settings
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Settings Modal -->
    <div id="notificationsSettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Notification Settings</h3>
                    <button id="closeNotificationsSettings" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('notificationsSettingsModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Push Notifications</p>
                            <p class="text-sm text-gray-500">Receive push notifications</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="pushNotificationsToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Message Notifications</p>
                            <p class="text-sm text-gray-500">Notify on new messages</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="messageNotificationsToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Group Notifications</p>
                            <p class="text-sm text-gray-500">Notify on group activities</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="groupNotificationsToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Call Notifications</p>
                            <p class="text-sm text-gray-500">Notify on incoming calls</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="callNotificationsToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Sound</p>
                            <p class="text-sm text-gray-500">Play notification sounds</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="soundToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Vibration</p>
                            <p class="text-sm text-gray-500">Vibrate on notifications</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="vibrationToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Do Not Disturb</p>
                            <p class="text-sm text-gray-500">Silence notifications during set hours</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="doNotDisturbToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div id="doNotDisturbSchedule" class="hidden space-y-2">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium">Start Time</p>
                            </div>
                            <input type="time" id="dndStartTime" class="p-2 border border-gray-300 rounded-lg" value="22:00">
                        </div>
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-medium">End Time</p>
                            </div>
                            <input type="time" id="dndEndTime" class="p-2 border border-gray-300 rounded-lg" value="07:00">
                        </div>
                    </div>
                </div>
                
                <div class="mt-6">
                    <button id="saveNotifications" class="w-full py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Save Notification Settings
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Storage Settings Modal -->
    <div id="storageSettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Storage & Data Settings</h3>
                    <button id="closeStorageSettings" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('storageSettingsModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Auto-download Media</p>
                            <p class="text-sm text-gray-500">Download media automatically</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoDownloadToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Wi-Fi Only</p>
                            <p class="text-sm text-gray-500">Download media only on Wi-Fi</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="wifiOnlyToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Media Upload Quality</p>
                            <p class="text-sm text-gray-500">Quality for uploaded media</p>
                        </div>
                        <select id="mediaUploadQuality" class="p-2 border border-gray-300 rounded-lg">
                            <option value="auto">Auto</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <p class="font-medium">Storage Usage</p>
                            <p id="storageUsage" class="text-sm text-gray-500">Calculating...</p>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div id="storageProgress" class="bg-purple-600 h-2.5 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                        <button id="clearCache" class="w-full py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors">
                            Clear Cache
                        </button>
                        <button id="manageMedia" class="w-full py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors">
                            Manage Downloaded Media
                        </button>
                    </div>
                </div>
                
                <div class="mt-6">
                    <button id="saveStorage" class="w-full py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Save Storage Settings
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Language Settings Modal -->
    <div id="languageSettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Language Settings</h3>
                    <button id="closeLanguageSettings" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('languageSettingsModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">App Language</p>
                            <p class="text-sm text-gray-500">Choose your preferred language</p>
                        </div>
                        <select id="appLanguageSelect" class="p-2 border border-gray-300 rounded-lg">
                            <option value="en">English</option>
                            <option value="sw">Swahili</option>
                            <option value="fr">French</option>
                            <option value="es">Spanish</option>
                            <option value="de">German</option>
                            <option value="zh">Chinese</option>
                            <option value="ja">Japanese</option>
                            <option value="ru">Russian</option>
                            <option value="ar">Arabic</option>
                        </select>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Auto-detect Language</p>
                            <p class="text-sm text-gray-500">Use device language settings</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoDetectLanguageToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <div class="mt-6">
                    <button id="saveLanguage" class="w-full py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Save Language Settings
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Settings Modal -->
    <div id="chatSettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Chat Settings</h3>
                    <button id="closeChatSettings" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('chatSettingsModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Enter Key Sends</p>
                            <p class="text-sm text-gray-500">Press Enter to send messages</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="enterKeySendsToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Read Receipts</p>
                            <p class="text-sm text-gray-500">Show when messages are read</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="readReceiptsToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Show Last Seen</p>
                            <p class="text-sm text-gray-500">Display when contacts were last online</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="lastSeenToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Media Visibility</p>
                            <p class="text-sm text-gray-500">Show media in gallery</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="mediaVisibilityToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Chat Backup</p>
                            <p class="text-sm text-gray-500">Automatically backup chats</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="chatBackupToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="space-y-2">
                        <button id="changeWallpaper" class="w-full py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors">
                            Change Chat Wallpaper
                        </button>
                        <button id="exportChat" class="w-full py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors">
                            Export Chat History
                        </button>
                        <button id="clearChatHistory" class="w-full py-3 bg-red-100 text-red-700 rounded-xl font-semibold hover:bg-red-200 transition-colors">
                            Clear All Chats
                        </button>
                    </div>
                </div>
                
                <div class="mt-6">
                    <button id="saveChatSettings" class="w-full py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Save Chat Settings
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Favorites Settings Modal -->
    <div id="favoritesSettingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Favorites</h3>
                    <button id="closeFavoritesSettings" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('favoritesSettingsModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div id="favoritesListContent" class="space-y-3">
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-star text-4xl mb-3 text-gray-300 block"></i>
                        <p>No favorites yet</p>
                        <p class="text-sm mt-1">Add contacts or chats to favorites for quick access</p>
                    </div>
                </div>
                
                <div class="mt-6">
                    <button id="addToFavorites" class="w-full py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Add to Favorites
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Center Modal -->
    <div id="helpCenterModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Help Center</h3>
                    <button id="closeHelpCenter" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('helpCenterModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="space-y-4">
                    <div class="bg-gray-50 p-4 rounded-xl cursor-pointer help-section" data-section="getting-started">
                        <h4 class="font-semibold mb-2">Getting Started</h4>
                        <p class="text-sm text-gray-600">Learn how to use Kynecta's basic features</p>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-xl cursor-pointer help-section" data-section="privacy-security">
                        <h4 class="font-semibold mb-2">Privacy & Security</h4>
                        <p class="text-sm text-gray-600">Understand how we protect your data</p>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-xl cursor-pointer help-section" data-section="troubleshooting">
                        <h4 class="font-semibold mb-2">Troubleshooting</h4>
                        <p class="text-sm text-gray-600">Common issues and solutions</p>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-xl cursor-pointer help-section" data-section="faqs">
                        <h4 class="font-semibold mb-2">FAQs</h4>
                        <p class="text-sm text-gray-600">Frequently asked questions</p>
                    </div>
                </div>
                
                <div class="mt-6 space-y-3">
                    <button id="contactSupport" class="w-full py-3 bg-purple-600 text-white rounded-xl font-semibold hover:bg-purple-700 transition-colors">
                        Contact Support
                    </button>
                    <button id="sendFeedback" class="w-full py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition-colors">
                        Send Feedback
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- App Info Modal -->
    <div id="appInfoModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">App Information</h3>
                    <button id="closeAppInfo" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('appInfoModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="space-y-4">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gradient-to-r from-purple-500 to-green-500 rounded-2xl flex items-center justify-center text-white text-2xl font-bold mx-auto mb-4">
                            K
                        </div>
                        <h3 class="text-xl font-semibold">Kynecta</h3>
                        <p class="text-gray-500">Advanced Mood-Based Chat</p>
                    </div>
                    
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="font-medium">Version</span>
                            <span class="text-gray-500">1.0.0</span>
                        </div>
                        
                        <div class="flex justify-between">
                            <span class="font-medium">Build</span>
                            <span class="text-gray-500">2025.08</span>
                        </div>
                        
                        <div class="flex justify-between">
                            <span class="font-medium">Developer</span>
                            <span class="text-gray-500">Denis Chacha</span>
                        </div>
                        
                        <div class="flex justify-between">
                            <span class="font-medium">Release Date</span>
                            <span class="text-gray-500">November 2025</span>
                        </div>
                    </div>
                    
                    <div class="pt-4 border-t border-gray-200">
                        <h4 class="font-semibold mb-2">Legal</h4>
                        <div class="space-y-2">
                            <button class="w-full text-left text-blue-600 hover:text-blue-800 transition-colors" id="termsOfServiceBtn">
                                Terms of Service
                            </button>
                            <button class="w-full text-left text-blue-600 hover:text-blue-800 transition-colors" id="privacyPolicyBtn">
                                Privacy Policy
                            </button>
                            <button class="w-full text-left text-blue-600 hover:text-blue-800 transition-colors" id="openSourceBtn">
                                Open Source Licenses
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Invite Friends Modal -->
    <div id="inviteFriendsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Invite Friends</h3>
                    <button id="closeInviteFriends" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('inviteFriendsModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="text-center mb-6">
                    <div class="w-24 h-24 bg-gradient-to-r from-purple-500 to-green-500 rounded-2xl flex items-center justify-center text-white text-3xl font-bold mx-auto mb-4">
                        <i class="fas fa-share-alt"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">Share Kynecta</h3>
                    <p class="text-gray-500">Invite your friends to join Kynecta</p>
                </div>
                
                <div class="space-y-3">
                    <button id="shareLink" class="w-full py-3 bg-purple-600 text-white rounded-xl font-semibold hover:bg-purple-700 transition-colors flex items-center justify-center">
                        <i class="fas fa-link mr-2"></i> Copy Invite Link
                    </button>
                    
                    <button id="shareQR" class="w-full py-3 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-colors flex items-center justify-center">
                        <i class="fas fa-qrcode mr-2"></i> Share QR Code
                    </button>
                    
                    <button id="shareWhatsApp" class="w-full py-3 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition-colors flex items-center justify-center">
                        <i class="fab fa-whatsapp mr-2"></i> Share via WhatsApp
                    </button>
                    
                    <button id="shareSMS" class="w-full py-3 bg-gray-600 text-white rounded-xl font-semibold hover:bg-gray-700 transition-colors flex items-center justify-center">
                        <i class="fas fa-sms mr-2"></i> Share via SMS
                    </button>
                </div>
                
                <div class="mt-6 p-4 bg-gray-50 rounded-xl">
                    <h4 class="font-semibold mb-2">Your Referral Code</h4>
                    <div class="flex items-center justify-between">
                        <code class="bg-white px-3 py-2 rounded-lg border border-gray-200 font-mono">KYNECTA2025</code>
                        <button id="copyReferralCode" class="text-purple-600 hover:text-purple-800 transition-colors">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Group Modal -->
    <div id="createGroupModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Create Group</h3>
                    <button id="closeCreateGroup" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('createGroupModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Group Name</label>
                    <input type="text" id="groupName" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Enter group name">
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Group Description</label>
                    <textarea id="groupDescription" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 transition-colors" placeholder="Enter group description" rows="3"></textarea>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Add Participants</label>
                    <div id="groupParticipants" class="border-2 border-gray-200 rounded-xl p-3 max-h-40 overflow-y-auto">
                        <div class="text-gray-500 text-center py-4">Select friends to add to group</div>
                    </div>
                </div>
                
                <div class="mb-6 space-y-3">
                    <label class="flex items-center">
                        <input type="checkbox" id="groupAdminsOnlySend" class="rounded border-gray-300 text-purple-600 focus:ring-purple-500">
                        <span class="ml-2 text-sm text-gray-700">Only admins can send messages</span>
                    </label>
                    
                    <label class="flex items-center">
                        <input type="checkbox" id="groupAdminsOnlyEdit" class="rounded border-gray-300 text-purple-600 focus:ring-purple-500">
                        <span class="ml-2 text-sm text-gray-700">Only admins can edit group info</span>
                    </label>
                    
                    <label class="flex items-center">
                        <input type="checkbox" id="groupEnableEncryption" class="rounded border-gray-300 text-purple-600 focus:ring-purple-500" checked>
                        <span class="ml-2 text-sm text-gray-700">Enable end-to-end encryption</span>
                    </label>
                </div>
                
                <div class="flex space-x-3">
                    <button id="createGroup" class="flex-1 py-3 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity">
                        Create Group
                    </button>
                    <button id="cancelCreateGroup" class="flex-1 py-3 bg-gray-500 text-white rounded-xl font-semibold hover:opacity-90 transition-opacity" onclick="closeModal('createGroupModal')">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mood Modal -->
    <div id="moodModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white w-11/12 max-w-md rounded-2xl p-6 shadow-lg">
            <h2 class="text-xl font-bold mb-4">Select Your Mood</h2>
            <div class="grid grid-cols-3 gap-4 text-center">
                <div class="p-4 rounded-xl bg-yellow-100 cursor-pointer mood-option" data-mood="happy">ðŸ˜Š Happy</div>
                <div class="p-4 rounded-xl bg-blue-100 cursor-pointer mood-option" data-mood="calm">ðŸ˜Œ Calm</div>
                <div class="p-4 rounded-xl bg-red-100 cursor-pointer mood-option" data-mood="energetic">ðŸ”¥ Energetic</div>
                <div class="p-4 rounded-xl bg-green-100 cursor-pointer mood-option" data-mood="focused">ðŸŽ¯ Focused</div>
                <div class="p-4 rounded-xl bg-purple-100 cursor-pointer mood-option" data-mood="creative">ðŸŽ¨ Creative</div>
            </div>
            <button class="w-full mt-6 bg-purple-600 text-white p-3 rounded-xl" id="closeMood" onclick="closeModal('moodModal')">
                Close
            </button>
        </div>
    </div>

    <!-- Quick Actions Modal -->
    <div id="quickActionsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white w-11/12 max-w-md rounded-2xl p-6 shadow-lg">
            <h2 class="text-xl font-bold mb-4">Quick Actions</h2>
            <div class="grid grid-cols-2 gap-4">
                <button class="p-4 bg-purple-500 text-white rounded-xl">ðŸ“¸ Post Status</button>
                <button class="p-4 bg-blue-500 text-white rounded-xl">ðŸ“ Share File</button>
                <button class="p-4 bg-green-500 text-white rounded-xl">ðŸ—£ Voice Note</button>
                <button class="p-4 bg-red-500 text-white rounded-xl">ðŸ“ž Quick Call</button>
            </div>
            <button class="w-full mt-6 bg-gray-700 text-white p-3 rounded-xl" id="closeQuickActions" onclick="closeModal('quickActionsModal')">
                Close
            </button>
        </div>
    </div>

    <!-- Catalogue Modal -->
    <div id="catalogueModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Add Product</h3>
                    <button id="closeCatalogue" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('catalogueModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Product Name</label>
                        <input type="text" id="productName" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-500" placeholder="Enter product name">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Price</label>
                        <input type="number" id="productPrice" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-500" placeholder="0.00">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea id="productDescription" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-500" placeholder="Product description" rows="3"></textarea>
                    </div>
                </div>
                <button id="saveCatalogue" class="w-full mt-6 bg-purple-600 text-white py-3 rounded-xl font-semibold hover:bg-purple-700 transition-colors">
                    Add to Catalogue
                </button>
            </div>
        </div>
    </div>

    <!-- Advertise Modal -->
    <div id="advertiseModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Create Advertisement</h3>
                    <button id="closeAdvertise" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('advertiseModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ad Title</label>
                        <input type="text" id="adTitle" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-500" placeholder="Enter ad title">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Target Audience</label>
                        <select id="targetAudience" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-500">
                            <option value="all">All Users</option>
                            <option value="local">Local Area</option>
                            <option value="specific">Specific Interests</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Budget ($)</label>
                        <input type="number" id="adBudget" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-500" placeholder="0.00">
                    </div>
                </div>
                <button id="launchCampaign" class="w-full mt-6 bg-green-600 text-white py-3 rounded-xl font-semibold hover:bg-green-700 transition-colors">
                    Launch Campaign
                </button>
            </div>
        </div>
    </div>

    <!-- Labels Modal -->
    <div id="labelsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Create Label</h3>
                    <button id="closeLabels" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('labelsModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Label Name</label>
                        <input type="text" id="newLabelName" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-500" placeholder="Enter label name">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Color</label>
                        <select id="labelColor" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-500">
                            <option value="purple">Purple</option>
                            <option value="blue">Blue</option>
                            <option value="green">Green</option>
                            <option value="red">Red</option>
                            <option value="orange">Orange</option>
                        </select>
                    </div>
                </div>
                <button id="createLabel" class="w-full mt-6 bg-purple-600 text-white py-3 rounded-xl font-semibold hover:bg-purple-700 transition-colors">
                    Create Label
                </button>
            </div>
        </div>
    </div>

    <!-- Greeting Modal -->
    <div id="greetingModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Greeting Message</h3>
                    <button id="closeGreeting" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('greetingModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Welcome Message</label>
                    <textarea id="greetingMessage" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-500" rows="4" placeholder="Welcome to our business! How can we help you today?"></textarea>
                </div>
                <button id="saveGreeting" class="w-full bg-purple-600 text-white py-3 rounded-xl font-semibold hover:bg-purple-700 transition-colors">
                    Save Greeting
                </button>
            </div>
        </div>
    </div>

    <!-- Away Modal -->
    <div id="awayModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Away Message</h3>
                    <button id="closeAway" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('awayModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Away Message</label>
                    <textarea id="awayMessage" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-purple-500" rows="4" placeholder="We're currently away. We'll get back to you soon!"></textarea>
                </div>
                <div class="mb-4">
                    <label class="flex items-center">
                        <input type="checkbox" id="awayEnabled" class="rounded border-gray-300 text-purple-600 focus:ring-purple-500">
                        <span class="ml-2 text-sm text-gray-700">Enable away message</span>
                    </label>
                </div>
                <button id="saveAway" class="w-full bg-purple-600 text-white py-3 rounded-xl font-semibold hover:bg-purple-700 transition-colors">
                    Save Away Message
                </button>
            </div>
        </div>
    </div>

    <!-- Business Profile Modal -->
    <div id="businessProfileModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white">Business Profile</h3>
                    <button id="closeBusinessProfile" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('businessProfileModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div class="text-center mb-6">
                    <img id="businessProfileAvatar" src="" alt="Business" class="w-20 h-20 rounded-full mx-auto mb-4 object-cover">
                    <h3 id="businessProfileName" class="text-xl font-semibold mb-2"></h3>
                    <p id="businessProfileType" class="text-gray-500">Business Account</p>
                </div>
                
                <div class="space-y-4">
                    <div id="businessGreetingSection" class="hidden">
                        <h4 class="font-semibold mb-2 flex items-center">
                            <i class="fas fa-comment-dots text-purple-500 mr-2"></i>
                            Greeting Message
                        </h4>
                        <p id="businessGreetingMessage" class="text-gray-600 text-sm bg-gray-50 p-3 rounded-lg"></p>
                    </div>
                    
                    <div id="businessAwaySection" class="hidden">
                        <h4 class="font-semibold mb-2 flex items-center">
                            <i class="fas fa-clock text-yellow-500 mr-2"></i>
                            Away Message
                        </h4>
                        <p id="businessAwayMessage" class="text-gray-600 text-sm bg-yellow-50 p-3 rounded-lg border-l-4 border-yellow-400"></p>
                    </div>
                    
                    <div id="businessCatalogueSection" class="hidden">
                        <h4 class="font-semibold mb-2 flex items-center">
                            <i class="fas fa-shopping-cart text-green-500 mr-2"></i>
                            Products & Services
                        </h4>
                        <div id="businessCatalogueList" class="space-y-2">
                        </div>
                    </div>
                </div>
            </div>
            <div class="p-4 border-t border-gray-200">
                <button id="startBusinessChat" class="w-full bg-gradient-to-r from-purple-500 to-green-500 text-white py-3 rounded-xl font-semibold hover:opacity-90 transition-opacity">
                    Start Conversation
                </button>
            </div>
        </div>
    </div>

    <!-- AI Summary Modal -->
    <div id="aiSummaryModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white flex items-center">
                        <i class="fas fa-robot mr-2"></i>
                        Conversation Summary
                    </h3>
                    <button id="closeAISummary" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('aiSummaryModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <div id="aiSummaryContent" class="prose max-w-none">
                </div>
            </div>
            <div class="p-4 border-t border-gray-200 flex space-x-3">
                <button id="copyAISummary" class="flex-1 bg-blue-600 text-white py-3 rounded-xl font-semibold hover:bg-blue-700 transition-colors">
                    <i class="fas fa-copy mr-2"></i>Copy Summary
                </button>
                <button id="closeAISummaryBtn" class="flex-1 bg-gray-500 text-white py-3 rounded-xl font-semibold hover:bg-gray-600 transition-colors" onclick="closeModal('aiSummaryModal')">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Smart Replies Modal -->
    <div id="smartRepliesModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden">
            <div class="kynecta-header p-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-white flex items-center">
                        <i class="fas fa-lightbulb mr-2"></i>
                        Smart Reply Suggestions
                    </h3>
                    <button id="closeSmartReplies" class="text-white/80 hover:text-white transition-colors" onclick="closeModal('smartRepliesModal')">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="overflow-y-auto max-h-[60vh] custom-scrollbar p-6">
                <p class="text-gray-600 mb-4">Tap any suggestion to use it:</p>
                <div id="smartRepliesList" class="space-y-2">
                </div>
            </div>
            <div class="p-4 border-t border-gray-200">
                <button id="closeSmartRepliesBtn" class="w-full bg-gray-500 text-white py-3 rounded-xl font-semibold hover:bg-gray-600 transition-colors" onclick="closeModal('smartRepliesModal')">
                    Close
                </button>
            </div>
        </div>
    </div>
   
   <script>
        // Disable right-click and inspect
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });
        
        // Disable F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
        document.addEventListener('keydown', function(e) {
            if (
                e.key === 'F12' ||
                (e.ctrlKey && e.shiftKey && e.key === 'I') ||
                (e.ctrlKey && e.shiftKey && e.key === 'J') ||
                (e.ctrlKey && e.key === 'U') ||
                (e.ctrlKey && e.shiftKey && e.key === 'C')
            ) {
                e.preventDefault();
                return false;
            }
        });

        window.tailwindConfig = { ignoreCDNWarning: true };
        
        // Navigation state management
        let currentPage = 'chats';
        let lastChatState = null;
        let selectedFriendForChat = null;
        let friendsList = [];
        let cachedUserData = null;
        
        // Load user data from cache immediately
        function loadCachedUserData() {
            const cachedData = localStorage.getItem('kynecta_user_data');
            if (cachedData) {
                try {
                    cachedUserData = JSON.parse(cachedData);
                    displayUserData(cachedUserData);
                } catch (e) {
                    console.error('Error parsing cached user data:', e);
                }
            }
        }
        
        // Display user data
        function displayUserData(userData) {
            // Update main chat area
            const userAvatar = document.getElementById('userAvatar');
            const userName = document.getElementById('userName');
            const userMood = document.getElementById('userMood');
            
            if (userAvatar && userData.profilePicture) {
                userAvatar.src = userData.profilePicture;
                userAvatar.onerror = function() {
                    this.src = 'https://ui-avatars.com/api/?name=' + encodeURIComponent(userData.displayName || 'User') + '&background=667eea&color=fff';
                };
            }
            
            if (userName) userName.textContent = userData.displayName || 'User';
            if (userMood) userMood.textContent = userData.mood || 'No mood set';
            
            // Update tools area
            const userAvatarTools = document.getElementById('userAvatarTools');
            const userNameTools = document.getElementById('userNameTools');
            const userMoodTools = document.getElementById('userMoodTools');
            
            if (userAvatarTools && userData.profilePicture) {
                userAvatarTools.src = userData.profilePicture;
            }
            if (userNameTools) userNameTools.textContent = userData.displayName || 'User';
            if (userMoodTools) userMoodTools.textContent = userData.mood || 'No mood set';
            
            // Update settings area
            const userAvatarSettings = document.getElementById('userAvatarSettings');
            const userNameSettings = document.getElementById('userNameSettings');
            const userMoodSettings = document.getElementById('userMoodSettings');
            
            if (userAvatarSettings && userData.profilePicture) {
                userAvatarSettings.src = userData.profilePicture;
            }
            if (userNameSettings) userNameSettings.textContent = userData.displayName || 'User';
            if (userMoodSettings) userMoodSettings.textContent = userData.mood || 'No mood set';
            
            // Update mood and interests
            updateMoodAndInterests(userData);
        }
        
        // Update mood and interests display
        function updateMoodAndInterests(userData) {
            const currentMoodsMini = document.getElementById('currentMoodsMini');
            const currentInterestsMini = document.getElementById('currentInterestsMini');
            
            if (currentMoodsMini && userData.moods) {
                currentMoodsMini.innerHTML = '';
                userData.moods.slice(0, 3).forEach(mood => {
                    const moodTag = document.createElement('span');
                    moodTag.className = `mood-tag ${mood.toLowerCase()}`;
                    moodTag.textContent = mood;
                    currentMoodsMini.appendChild(moodTag);
                });
            }
            
            if (currentInterestsMini && userData.interests) {
                currentInterestsMini.innerHTML = '';
                userData.interests.slice(0, 3).forEach(interest => {
                    const interestTag = document.createElement('span');
                    interestTag.className = 'interest-tag';
                    interestTag.textContent = interest;
                    currentInterestsMini.appendChild(interestTag);
                });
            }
        }
        
        // Load friends from Firebase
        async function loadFriends() {
            try {
                // First try to load from cache
                const cachedFriends = localStorage.getItem('kynecta_friends');
                if (cachedFriends) {
                    friendsList = JSON.parse(cachedFriends);
                    displayFriendsList();
                }
                
                // Then load from Firebase
                const currentUser = firebase.auth().currentUser;
                if (!currentUser) return;
                
                const db = firebase.firestore();
                const friendsRef = db.collection('users').doc(currentUser.uid).collection('friends');
                const snapshot = await friendsRef.get();
                
                friendsList = [];
                snapshot.forEach(doc => {
                    const friendData = doc.data();
                    friendData.id = doc.id;
                    friendsList.push(friendData);
                });
                
                // Cache the friends list
                localStorage.setItem('kynecta_friends', JSON.stringify(friendsList));
                
                // Update display
                displayFriendsList();
                
            } catch (error) {
                console.error('Error loading friends:', error);
            }
        }
        
        // Display friends list
        function displayFriendsList() {
            const friendsListForChat = document.getElementById('friendsListForChat');
            if (!friendsListForChat) return;
            
            if (friendsList.length === 0) {
                friendsListForChat.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-user-friends text-3xl mb-3"></i>
                        <p>No friends yet</p>
                        <p class="text-sm mt-1">Add friends to start chatting</p>
                        <button onclick="closeModal('startNewChatSection'); switchPage('friends')" class="mt-3 px-4 py-2 bg-gradient-to-r from-purple-500 to-green-500 text-white rounded-lg font-medium hover:opacity-90 transition-opacity">
                            Add Friends
                        </button>
                    </div>
                `;
                return;
            }
            
            friendsListForChat.innerHTML = '';
            friendsList.forEach(friend => {
                const friendItem = document.createElement('div');
                friendItem.className = 'friend-item p-3 rounded-lg mb-2 flex items-center cursor-pointer';
                friendItem.dataset.friendId = friend.id;
                friendItem.innerHTML = `
                    <div class="flex items-center flex-1">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-green-500 flex items-center justify-center text-white font-semibold mr-3 overflow-hidden">
                            ${friend.profilePicture ? 
                                `<img src="${friend.profilePicture}" alt="${friend.displayName}" class="w-full h-full object-cover">` :
                                `<span>${friend.displayName?.charAt(0) || 'F'}</span>`
                            }
                        </div>
                        <div class="flex-1">
                            <div class="font-medium">${friend.displayName || 'Friend'}</div>
                            <div class="text-sm text-gray-500">${friend.status || 'Online'}</div>
                        </div>
                        <div class="ml-2">
                            <input type="checkbox" class="friend-checkbox hidden" data-friend-id="${friend.id}">
                        </div>
                    </div>
                `;
                
                friendItem.addEventListener('click', function(e) {
                    if (!e.target.classList.contains('friend-checkbox')) {
                        const checkbox = this.querySelector('.friend-checkbox');
                        checkbox.checked = !checkbox.checked;
                        
                        if (checkbox.checked) {
                            this.classList.add('selected');
                            selectedFriendForChat = friend;
                        } else {
                            this.classList.remove('selected');
                            selectedFriendForChat = null;
                        }
                        
                        updateStartChatButton();
                    }
                });
                
                friendsListForChat.appendChild(friendItem);
            });
        }
        
        // Update start chat button state
        function updateStartChatButton() {
            const confirmStartChatBtn = document.getElementById('confirmStartChat');
            if (confirmStartChatBtn) {
                confirmStartChatBtn.disabled = !selectedFriendForChat;
                if (selectedFriendForChat) {
                    confirmStartChatBtn.classList.remove('opacity-50');
                } else {
                    confirmStartChatBtn.classList.add('opacity-50');
                }
            }
        }
        
        // Start new chat with selected friend
        function startNewChat() {
            if (!selectedFriendForChat) return;
            
            // Close new chat section
            const startNewChatSection = document.getElementById('startNewChatSection');
            if (startNewChatSection) {
                startNewChatSection.classList.add('hidden');
            }
            
            // Start chat with friend
            openChatWithFriend(selectedFriendForChat);
            
            // Reset selection
            selectedFriendForChat = null;
            updateStartChatButton();
            
            // Uncheck all checkboxes
            document.querySelectorAll('.friend-checkbox').forEach(cb => {
                cb.checked = false;
            });
            
            // Remove selected class
            document.querySelectorAll('.friend-item').forEach(item => {
                item.classList.remove('selected');
            });
        }
        
        // Open chat with friend
        function openChatWithFriend(friend) {
            // Update chat header
            const chatAvatar = document.getElementById('chatAvatar');
            const chatTitle = document.getElementById('chatTitle');
            const chatStatus = document.getElementById('statusText');
            
            if (chatAvatar) {
                chatAvatar.src = friend.profilePicture || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(friend.displayName || 'Friend') + '&background=667eea&color=fff';
            }
            if (chatTitle) chatTitle.textContent = friend.displayName || 'Friend';
            if (chatStatus) chatStatus.textContent = friend.status || 'Online';
            
            // Update call buttons
            document.querySelectorAll('.friend-call-btn').forEach(btn => {
                btn.dataset.id = friend.id;
                btn.dataset.name = friend.displayName;
            });
            
            document.querySelectorAll('.friend-video-call-btn').forEach(btn => {
                btn.dataset.id = friend.id;
                btn.dataset.name = friend.displayName;
            });
            
            // Show chat area
            showChatArea();
            
            // Load messages for this chat
            loadChatMessages(friend.id);
        }
        
        // Load chat messages
        function loadChatMessages(friendId) {
            const messagesList = document.getElementById('messagesList');
            const noMessagesMessage = document.getElementById('noMessagesMessage');
            
            if (!messagesList) return;
            
            // Clear current messages
            messagesList.innerHTML = '';
            
            // Try to load from cache first
            const cachedMessages = localStorage.getItem(`kynecta_chat_${friendId}`);
            if (cachedMessages) {
                try {
                    const messages = JSON.parse(cachedMessages);
                    if (messages.length > 0) {
                        displayMessages(messages);
                        noMessagesMessage.classList.add('hidden');
                        return;
                    }
                } catch (e) {
                    console.error('Error parsing cached messages:', e);
                }
            }
            
            // If no cached messages or error, show empty state
            noMessagesMessage.classList.remove('hidden');
            
            // Load from Firebase
            loadMessagesFromFirebase(friendId);
        }
        
        // Load messages from Firebase
        async function loadMessagesFromFirebase(friendId) {
            try {
                const currentUser = firebase.auth().currentUser;
                if (!currentUser) return;
                
                const db = firebase.firestore();
                const chatId = [currentUser.uid, friendId].sort().join('_');
                const messagesRef = db.collection('chats').doc(chatId).collection('messages')
                    .orderBy('timestamp', 'desc')
                    .limit(50);
                
                const snapshot = await messagesRef.get();
                const messages = [];
                
                snapshot.forEach(doc => {
                    messages.unshift(doc.data());
                });
                
                // Cache messages
                localStorage.setItem(`kynecta_chat_${friendId}`, JSON.stringify(messages));
                
                // Display messages
                displayMessages(messages);
                
                // Hide no messages message if there are messages
                const noMessagesMessage = document.getElementById('noMessagesMessage');
                if (messages.length > 0 && noMessagesMessage) {
                    noMessagesMessage.classList.add('hidden');
                }
                
            } catch (error) {
                console.error('Error loading messages:', error);
            }
        }
        
        // Display messages
        function displayMessages(messages) {
            const messagesList = document.getElementById('messagesList');
            if (!messagesList) return;
            
            messagesList.innerHTML = '';
            
            messages.forEach(message => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message-bubble ${message.senderId === firebase.auth().currentUser?.uid ? 'sent' : 'received'}`;
                messageDiv.innerHTML = `
                    <div>${message.text || ''}</div>
                    <div class="text-xs opacity-70 mt-1 text-right">${formatTime(message.timestamp)}</div>
                `;
                messagesList.appendChild(messageDiv);
            });
            
            // Scroll to bottom
            setTimeout(() => {
                const messagesContainer = document.getElementById('messagesContainer');
                if (messagesContainer) {
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }
            }, 100);
        }
        
        // Format time
        function formatTime(timestamp) {
            if (!timestamp) return '';
            
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }
        
        // Function to show loading screen
        function showLoading() {
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen) {
                loadingScreen.classList.remove('hidden');
            }
        }
        
        // Function to hide loading screen
        function hideLoading() {
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen) {
                loadingScreen.classList.add('hidden');
            }
        }
        
        // Pre-load iframes on app initialization
        function preloadIframes() {
            const iframes = [
                { id: 'statusIframe', src: 'status.html' },
                { id: 'groupIframe', src: 'group.html' },
                { id: 'callsIframe', src: 'calls.html' },
                { id: 'friendsIframe', src: 'friend.html' }
            ];
            
            iframes.forEach(iframe => {
                const element = document.getElementById(iframe.id);
                if (element) {
                    element.onload = function() {
                        console.log(`${iframe.id} loaded successfully`);
                    };
                    // Set src to pre-load
                    element.src = iframe.src;
                }
            });
        }
        
        function switchPage(pageName) {
            console.log('Switching to page:', pageName);
            currentPage = pageName;
            
            // Show loading screen only for iframe pages
            if (pageName === 'status' || pageName === 'group' || pageName === 'calls' || pageName === 'friends') {
                showLoading();
            }
            
            // Save chat state if leaving chat interface
            if (pageName !== 'chats' && pageName !== 'groups') {
                lastChatState = {
                    chatListVisible: !document.getElementById('chatListContainer').classList.contains('hidden'),
                    chatAreaVisible: !document.getElementById('chatArea').classList.contains('hidden'),
                    activeChat: document.getElementById('chatTitle').textContent
                };
            }
            
            // Hide all content areas
            const contentAreas = document.querySelectorAll('.content-area');
            contentAreas.forEach(area => {
                area.classList.add('hidden');
            });
            
            // Hide all iframes first
            document.querySelectorAll('.content-iframe').forEach(iframe => {
                iframe.classList.add('hidden');
            });
            
            // Update active navigation icon
            updateActiveNavIcon(pageName);
            
            // Handle iframe pages (Status, Group, Calls, Friends)
            if (pageName === 'status' || pageName === 'group' || pageName === 'calls' || pageName === 'friends') {
                // Hide the main chat app interface
                document.getElementById('chatApp').classList.add('hidden');
                
                // Show the specific iframe container
                const iframeContainer = document.getElementById(`${pageName}Content`);
                if (iframeContainer) {
                    iframeContainer.classList.remove('hidden');
                    
                    // Load iframe content
                    const iframe = document.getElementById(`${pageName}Iframe`);
                    if (iframe) {
                        iframe.classList.remove('hidden');
                        hideLoading();
                    }
                }
            } else {
                // Show chat app interface for other pages (chats, tools, settings)
                document.getElementById('chatApp').classList.remove('hidden');
                
                // Show selected content area
                const targetArea = document.getElementById(`${pageName}Content`);
                if (targetArea) {
                    targetArea.classList.remove('hidden');
                }
                
                // Restore chat state if returning to chats
                if (pageName === 'chats' && lastChatState) {
                    setTimeout(() => {
                        const chatListContainer = document.getElementById('chatListContainer');
                        const chatArea = document.getElementById('chatArea');
                        
                        if (lastChatState.chatListVisible) {
                            chatListContainer.classList.remove('hidden');
                        } else {
                            chatListContainer.classList.add('hidden');
                        }
                        
                        if (lastChatState.chatAreaVisible) {
                            chatArea.classList.remove('hidden');
                        } else {
                            chatArea.classList.add('hidden');
                        }
                    }, 10);
                }
                
                // Call existing switchTab function for compatibility
                if (pageName === 'chats' || pageName === 'tools' || pageName === 'settings') {
                    switchTab(pageName);
                }
                
                // Hide loading screen
                hideLoading();
            }
        }
        
        function updateActiveNavIcon(pageName) {
            const navIcons = document.querySelectorAll('.nav-icon');
            navIcons.forEach(icon => {
                icon.classList.remove('text-white', 'bg-purple-700');
                icon.classList.add('text-gray-400', 'hover:text-white', 'hover:bg-gray-800');
            });
            
            const activeIcon = document.querySelector(`[data-page="${pageName}"]`);
            if (activeIcon) {
                activeIcon.classList.remove('text-gray-400', 'hover:text-white', 'hover:bg-gray-800');
                activeIcon.classList.add('text-white', 'bg-purple-700');
            }
        }
        
        // Existing functions
        function showSettingsSection(sectionName) {
            console.log('Opening settings section:', sectionName);
            const settingsModal = document.getElementById('settingsModal');
            if (settingsModal) {
                settingsModal.classList.add('hidden');
            }
            const modalId = sectionName + 'SettingsModal';
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('hidden');
            } else {
                console.error('Modal not found:', modalId);
                alert('Opening ' + sectionName + ' settings...');
            }
        }
        
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('hidden');
            }
        }
        
        function openSettingsModal() {
            const modal = document.getElementById('settingsModal');
            if (modal) {
                modal.classList.remove('hidden');
            }
        }
        
        function triggerFileInput(inputId) {
            const fileInput = document.getElementById(inputId);
            if (fileInput) {
                fileInput.click();
            }
        }
        
        function showChatArea() {
            const chatListContainer = document.getElementById('chatListContainer');
            const chatArea = document.getElementById('chatArea');
            const chatHeader = document.getElementById('chatHeader');
            const inputArea = document.getElementById('inputArea');
            
            if (chatListContainer && chatArea) {
                chatListContainer.classList.add('hidden');
                chatArea.classList.remove('hidden');
            }
            
            if (chatHeader) {
                chatHeader.classList.remove('hidden');
            }
            
            if (inputArea) {
                inputArea.classList.remove('hidden');
            }
        }
        
        function showChatList() {
            const chatListContainer = document.getElementById('chatListContainer');
            const chatArea = document.getElementById('chatArea');
            const chatHeader = document.getElementById('chatHeader');
            const inputArea = document.getElementById('inputArea');
            
            if (chatListContainer && chatArea) {
                chatListContainer.classList.remove('hidden');
                chatArea.classList.add('hidden');
            }
            
            if (chatHeader) {
                chatHeader.classList.add('hidden');
            }
            
            if (inputArea) {
                inputArea.classList.add('hidden');
            }
            
            // Hide new chat section if visible
            const startNewChatSection = document.getElementById('startNewChatSection');
            if (startNewChatSection) {
                startNewChatSection.classList.add('hidden');
            }
        }
        
        // Start new chat
        function startNewChatFlow() {
            const startNewChatSection = document.getElementById('startNewChatSection');
            if (startNewChatSection) {
                startNewChatSection.classList.remove('hidden');
                loadFriends();
            }
        }
        
        function switchTab(tabName) {
            console.log('Switching to tab:', tabName);
            const tabPanels = document.querySelectorAll('.tab-panel');
            tabPanels.forEach(panel => {
                panel.classList.add('hidden');
                panel.classList.remove('active');
            });
            
            // Handle 'groups' tab error - redirect to group page
            if (tabName === 'groups') {
                switchPage('group');
                return;
            }
            
            const selectedTab = document.getElementById(tabName + 'Tab');
            if (selectedTab) {
                selectedTab.classList.remove('hidden');
                selectedTab.classList.add('active');
            } else {
                console.error('Tab panel not found for:', tabName);
            }
            
            const navIcons = document.querySelectorAll('.nav-icon');
            navIcons.forEach(icon => {
                icon.classList.remove('text-white', 'bg-purple-700');
                icon.classList.add('text-gray-400', 'hover:text-white', 'hover:bg-gray-800');
            });
            
            const activeIcon = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeIcon) {
                activeIcon.classList.remove('text-gray-400', 'hover:text-white', 'hover:bg-gray-800');
                activeIcon.classList.add('text-white', 'bg-purple-700');
            }
            
            const chatArea = document.getElementById('chatArea');
            const chatListContainer = document.getElementById('chatListContainer');
            if (tabName !== 'chats') {
                if (chatArea) chatArea.classList.add('hidden');
                if (chatListContainer) chatListContainer.classList.remove('hidden');
                const inputArea = document.getElementById('inputArea');
                if (inputArea) {
                    inputArea.classList.add('hidden');
                }
                const chatHeader = document.getElementById('chatHeader');
                if (chatHeader) {
                    chatHeader.classList.add('hidden');
                }
            } else {
                const chatHeader = document.getElementById('chatHeader');
                const isMobile = window.innerWidth < 768;
                if (chatHeader && !chatHeader.classList.contains('hidden')) {
                    if (isMobile) {
                        if (chatArea) chatArea.classList.remove('hidden');
                        if (chatListContainer) chatListContainer.classList.add('hidden');
                    }
                    const inputArea = document.getElementById('inputArea');
                    if (inputArea) {
                        inputArea.classList.remove('hidden');
                    }
                } else {
                    if (chatArea) chatArea.classList.add('hidden');
                    if (chatListContainer) chatListContainer.classList.remove('hidden');
                }
            }
        }
        
        // Theme toggle functionality
        function setupThemeToggle() {
            const themeToggle = document.getElementById('themeToggle');
            const themeIcon = document.getElementById('themeIcon');
            const themeToggleTools = document.getElementById('themeToggleTools');
            const themeIconTools = document.getElementById('themeIconTools');
            const themeToggleSettings = document.getElementById('themeToggleSettings');
            const themeIconSettings = document.getElementById('themeIconSettings');
            
            // Load saved theme
            const savedTheme = localStorage.getItem('kynecta_theme') || 'light';
            setTheme(savedTheme);
            
            // Setup toggle handlers
            const toggleHandlers = [
                { toggle: themeToggle, icon: themeIcon },
                { toggle: themeToggleTools, icon: themeIconTools },
                { toggle: themeToggleSettings, icon: themeIconSettings }
            ];
            
            toggleHandlers.forEach(({ toggle, icon }) => {
                if (toggle && icon) {
                    toggle.addEventListener('click', () => {
                        const currentTheme = document.body.getAttribute('data-theme');
                        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                        setTheme(newTheme);
                        localStorage.setItem('kynecta_theme', newTheme);
                    });
                }
            });
        }
        
        // Set theme
        function setTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            document.body.classList.toggle('bg-gray-50', theme === 'light');
            document.body.classList.toggle('bg-gray-900', theme === 'dark');
            document.body.classList.toggle('text-gray-900', theme === 'light');
            document.body.classList.toggle('text-white', theme === 'dark');
            
            // Update icons
            const themeIcons = document.querySelectorAll('#themeIcon, #themeIconTools, #themeIconSettings');
            themeIcons.forEach(icon => {
                if (icon) {
                    icon.className = theme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
                }
            });
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // Load cached user data immediately
            loadCachedUserData();
            
            const isMobile = window.innerWidth < 768;
            if (isMobile) {
                const chatArea = document.getElementById('chatArea');
                if (chatArea) {
                    chatArea.classList.add('hidden');
                }
                const chatListContainer = document.getElementById('chatListContainer');
                if (chatListContainer) {
                    chatListContainer.classList.remove('hidden');
                }
                const backToChats = document.getElementById('backToChats');
                if (backToChats) {
                    backToChats.addEventListener('click', showChatList);
                }
                document.addEventListener('click', function(e) {
                    if (e.target.closest('.chat-item')) {
                        showChatArea();
                    }
                });
            }
            
            // Pre-load iframes for faster navigation
            preloadIframes();
            
            // Setup theme toggle
            setupThemeToggle();
            
            // Initialize navigation
            document.querySelectorAll('.nav-icon[data-page]').forEach(icon => {
                icon.addEventListener('click', function() {
                    const pageName = this.getAttribute('data-page');
                    switchPage(pageName);
                });
            });
            
            // Setup start new chat button
            const startNewChatBtn = document.getElementById('startNewChatBtn');
            const startFirstChatBtn = document.getElementById('startFirstChatBtn');
            const cancelNewChatBtn = document.getElementById('cancelNewChat');
            const confirmStartChatBtn = document.getElementById('confirmStartChat');
            
            if (startNewChatBtn) {
                startNewChatBtn.addEventListener('click', startNewChatFlow);
            }
            
            if (startFirstChatBtn) {
                startFirstChatBtn.addEventListener('click', startNewChatFlow);
            }
            
            if (cancelNewChatBtn) {
                cancelNewChatBtn.addEventListener('click', () => {
                    const startNewChatSection = document.getElementById('startNewChatSection');
                    if (startNewChatSection) {
                        startNewChatSection.classList.add('hidden');
                    }
                    
                    // Reset selection
                    selectedFriendForChat = null;
                    updateStartChatButton();
                    
                    // Uncheck all checkboxes
                    document.querySelectorAll('.friend-checkbox').forEach(cb => {
                        cb.checked = false;
                    });
                    
                    // Remove selected class
                    document.querySelectorAll('.friend-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                });
            }
            
            if (confirmStartChatBtn) {
                confirmStartChatBtn.addEventListener('click', startNewChat);
            }
            
            // Initialize with chats page
            setTimeout(() => {
                switchPage('chats');
                hideLoading();
                
                // Load friends in background
                loadFriends();
            }, 300);
        });
        
        // Handle back button for mobile
        window.addEventListener('popstate', function(event) {
            if (window.innerWidth < 768) {
                const chatArea = document.getElementById('chatArea');
                if (chatArea && !chatArea.classList.contains('hidden')) {
                    showChatList();
                    event.preventDefault();
                }
            }
        });
    </script>
    <script src="app.js" type="text/javascript"></script>
    <script src="chat.js" type="text/javascript"></script>
    <script src="settings.js" type="text/javascript"></script>
</body>
</html>